/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var z0=Object.create;var Ma=Object.defineProperty;var K0=Object.getOwnPropertyDescriptor;var G0=Object.getOwnPropertyNames;var j0=Object.getPrototypeOf,Y0=Object.prototype.hasOwnProperty;var J0=(o,e,t)=>e in o?Ma(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var Gi=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),_f=(o,e)=>{for(var t in e)Ma(o,t,{get:e[t],enumerable:!0})},Th=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of G0(e))!Y0.call(o,s)&&s!==t&&Ma(o,s,{get:()=>e[s],enumerable:!(r=K0(e,s))||r.enumerable});return o};var Bs=(o,e,t)=>(t=o!=null?z0(j0(o)):{},Th(e||!o||!o.__esModule?Ma(t,"default",{value:o,enumerable:!0}):t,o)),Q0=o=>Th(Ma({},"__esModule",{value:!0}),o);var xt=(o,e,t)=>(J0(o,typeof e!="symbol"?e+"":e,t),t);var Ra=Gi((FM,Dh)=>{"use strict";function io(o){if(typeof o!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(o))}function Ph(o,e){for(var t="",r=0,s=-1,n=0,a,i=0;i<=o.length;++i){if(i<o.length)a=o.charCodeAt(i);else{if(a===47)break;a=47}if(a===47){if(!(s===i-1||n===1))if(s!==i-1&&n===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),s=i,n=0;continue}}else if(t.length===2||t.length===1){t="",r=0,s=i,n=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+o.slice(s+1,i):t=o.slice(s+1,i),r=i-s-1;s=i,n=0}else a===46&&n!==-1?++n:n=-1}return t}function X0(o,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+o+r:r}var _n={resolve:function(){for(var e="",t=!1,r,s=arguments.length-1;s>=-1&&!t;s--){var n;s>=0?n=arguments[s]:(r===void 0&&(r=process.cwd()),n=r),io(n),n.length!==0&&(e=n+"/"+e,t=n.charCodeAt(0)===47)}return e=Ph(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(io(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=Ph(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return io(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];io(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":_n.normalize(e)},relative:function(e,t){if(io(e),io(t),e===t||(e=_n.resolve(e),t=_n.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var s=e.length,n=s-r,a=1;a<t.length&&t.charCodeAt(a)===47;++a);for(var i=t.length,l=i-a,c=n<l?n:l,u=-1,d=0;d<=c;++d){if(d===c){if(l>c){if(t.charCodeAt(a+d)===47)return t.slice(a+d+1);if(d===0)return t.slice(a+d)}else n>c&&(e.charCodeAt(r+d)===47?u=d:d===0&&(u=0));break}var m=e.charCodeAt(r+d),g=t.charCodeAt(a+d);if(m!==g)break;m===47&&(u=d)}var h="";for(d=r+u+1;d<=s;++d)(d===s||e.charCodeAt(d)===47)&&(h.length===0?h+="..":h+="/..");return h.length>0?h+t.slice(a+u):(a+=u,t.charCodeAt(a)===47&&++a,t.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(io(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,s=-1,n=!0,a=e.length-1;a>=1;--a)if(t=e.charCodeAt(a),t===47){if(!n){s=a;break}}else n=!1;return s===-1?r?"/":".":r&&s===1?"//":e.slice(0,s)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');io(e);var r=0,s=-1,n=!0,a;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var i=t.length-1,l=-1;for(a=e.length-1;a>=0;--a){var c=e.charCodeAt(a);if(c===47){if(!n){r=a+1;break}}else l===-1&&(n=!1,l=a+1),i>=0&&(c===t.charCodeAt(i)?--i===-1&&(s=a):(i=-1,s=l))}return r===s?s=l:s===-1&&(s=e.length),e.slice(r,s)}else{for(a=e.length-1;a>=0;--a)if(e.charCodeAt(a)===47){if(!n){r=a+1;break}}else s===-1&&(n=!1,s=a+1);return s===-1?"":e.slice(r,s)}},extname:function(e){io(e);for(var t=-1,r=0,s=-1,n=!0,a=0,i=e.length-1;i>=0;--i){var l=e.charCodeAt(i);if(l===47){if(!n){r=i+1;break}continue}s===-1&&(n=!1,s=i+1),l===46?t===-1?t=i:a!==1&&(a=1):t!==-1&&(a=-1)}return t===-1||s===-1||a===0||a===1&&t===s-1&&t===r+1?"":e.slice(t,s)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return X0("/",e)},parse:function(e){io(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),s=r===47,n;s?(t.root="/",n=1):n=0;for(var a=-1,i=0,l=-1,c=!0,u=e.length-1,d=0;u>=n;--u){if(r=e.charCodeAt(u),r===47){if(!c){i=u+1;break}continue}l===-1&&(c=!1,l=u+1),r===46?a===-1?a=u:d!==1&&(d=1):a!==-1&&(d=-1)}return a===-1||l===-1||d===0||d===1&&a===l-1&&a===i+1?l!==-1&&(i===0&&s?t.base=t.name=e.slice(1,l):t.base=t.name=e.slice(i,l)):(i===0&&s?(t.name=e.slice(1,a),t.base=e.slice(1,l)):(t.name=e.slice(i,a),t.base=e.slice(i,l)),t.ext=e.slice(a,l)),i>0?t.dir=e.slice(0,i-1):s&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};_n.posix=_n;Dh.exports=_n});var cx=Gi((sO,lx)=>{var sx=require("url").parse,ML=require("events"),RL=require("https"),OL=require("http"),UL=require("util"),$L=["pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","secureProtocol","servername","checkServerIdentity"],ix=[239,187,191],BL=58,NL=32,nx=10,HL=13,ax=1024*256,VL=/^(cookie|authorization)$/i;function qL(o){return ix.every(function(e,t){return o[t]===e})}function St(o,e){var t=St.CONNECTING,r=e&&e.headers,s=!1;Object.defineProperty(this,"readyState",{get:function(){return t}}),Object.defineProperty(this,"url",{get:function(){return o}});var n=this;n.reconnectInterval=1e3,n.connectionInProgress=!1;function a(w){t!==St.CLOSED&&(t=St.CONNECTING,h("error",new fi("error",{message:w})),m&&(o=m,m=null,s=!1),setTimeout(function(){t!==St.CONNECTING||n.connectionInProgress||(n.connectionInProgress=!0,g())},n.reconnectInterval))}var i,l="";r&&r["Last-Event-ID"]&&(l=r["Last-Event-ID"],delete r["Last-Event-ID"]);var c=!1,u="",d="",m=null;function g(){var w=sx(o),v=w.protocol==="https:";if(w.headers={"Cache-Control":"no-cache",Accept:"text/event-stream"},l&&(w.headers["Last-Event-ID"]=l),r){var A=s?zL(r):r;for(var O in A){var E=A[O];E&&(w.headers[O]=E)}}w.rejectUnauthorized=!(e&&!e.rejectUnauthorized),e&&e.createConnection!==void 0&&(w.createConnection=e.createConnection);var M=e&&e.proxy;if(M){var R=sx(e.proxy);v=R.protocol==="https:",w.protocol=v?"https:":"http:",w.path=o,w.headers.Host=w.host,w.hostname=R.hostname,w.host=R.host,w.port=R.port}if(e&&e.https){for(var D in e.https)if($L.indexOf(D)!==-1){var F=e.https[D];F!==void 0&&(w[D]=F)}}e&&e.withCredentials!==void 0&&(w.withCredentials=e.withCredentials),i=(v?RL:OL).request(w,function(V){if(n.connectionInProgress=!1,V.statusCode===500||V.statusCode===502||V.statusCode===503||V.statusCode===504){h("error",new fi("error",{status:V.statusCode,message:V.statusMessage})),a();return}if(V.statusCode===301||V.statusCode===302||V.statusCode===307){var q=V.headers.location;if(!q){h("error",new fi("error",{status:V.statusCode,message:V.statusMessage}));return}var j=new URL(o).origin,z=new URL(q).origin;s=j!==z,V.statusCode===307&&(m=o),o=q,process.nextTick(g);return}if(V.statusCode!==200)return h("error",new fi("error",{status:V.statusCode,message:V.statusMessage})),n.close();t=St.OPEN,V.on("close",function(){V.removeAllListeners("close"),V.removeAllListeners("end"),a()}),V.on("end",function(){V.removeAllListeners("close"),V.removeAllListeners("end"),a()}),h("open",new fi("open"));var Y,pe,De=0,G=-1,se=0,ke=0;V.on("data",function(Qe){Y?(Qe.length>Y.length-ke&&(se=Y.length*2+Qe.length,se>ax&&(se=Y.length+Qe.length+ax),pe=Buffer.alloc(se),Y.copy(pe,0,0,ke),Y=pe),Qe.copy(Y,ke),ke+=Qe.length):(Y=Qe,qL(Y)&&(Y=Y.slice(ix.length)),ke=Y.length);for(var Re=0,ce=ke;Re<ce;){c&&(Y[Re]===nx&&++Re,c=!1);for(var le=-1,W=G,Fe,Ye=De;le<0&&Ye<ce;++Ye)Fe=Y[Ye],Fe===BL?W<0&&(W=Ye-Re):Fe===HL?(c=!0,le=Ye-Re):Fe===nx&&(le=Ye-Re);if(le<0){De=ce-Re,G=W;break}else De=0,G=-1;_(Y,Re,W,le),Re+=le+1}Re===ce?(Y=void 0,ke=0):Re>0&&(Y=Y.slice(Re,ke),ke=Y.length)})}),i.on("error",function(V){n.connectionInProgress=!1,a(V.message)}),i.setNoDelay&&i.setNoDelay(!0),i.end()}g();function h(){n.listeners(arguments[0]).length>0&&n.emit.apply(n,arguments)}this._close=function(){t!==St.CLOSED&&(t=St.CLOSED,i.abort&&i.abort(),i.xhr&&i.xhr.abort&&i.xhr.abort())};function _(w,v,A,O){if(O===0){if(u.length>0){var E=d||"message";h(E,new WL(E,{data:u.slice(0,-1),lastEventId:l,origin:new URL(o).origin})),u=""}d=void 0}else if(A>0){var M=A<0,R=0,D=w.slice(v,v+(M?O:A)).toString();M?R=O:w[v+A+1]!==NL?R=A+1:R=A+2,v+=R;var F=O-R,V=w.slice(v,v+F).toString();if(D==="data")u+=V+`
`;else if(D==="event")d=V;else if(D==="id")l=V;else if(D==="retry"){var q=parseInt(V,10);Number.isNaN(q)||(n.reconnectInterval=q)}}}}lx.exports=St;UL.inherits(St,ML.EventEmitter);St.prototype.constructor=St;["open","error","message"].forEach(function(o){Object.defineProperty(St.prototype,"on"+o,{get:function(){var t=this.listeners(o)[0];return t?t._listener?t._listener:t:void 0},set:function(t){this.removeAllListeners(o),this.addEventListener(o,t)}})});Object.defineProperty(St,"CONNECTING",{enumerable:!0,value:0});Object.defineProperty(St,"OPEN",{enumerable:!0,value:1});Object.defineProperty(St,"CLOSED",{enumerable:!0,value:2});St.prototype.CONNECTING=0;St.prototype.OPEN=1;St.prototype.CLOSED=2;St.prototype.close=function(){this._close()};St.prototype.addEventListener=function(e,t){typeof t=="function"&&(t._listener=t,this.on(e,t))};St.prototype.dispatchEvent=function(e){if(!e.type)throw new Error("UNSPECIFIED_EVENT_TYPE_ERR");this.emit(e.type,e.detail)};St.prototype.removeEventListener=function(e,t){typeof t=="function"&&(t._listener=void 0,this.removeListener(e,t))};function fi(o,e){if(Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0}),e)for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function WL(o,e){Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0});for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function zL(o){var e={};for(var t in o)VL.test(t)||(e[t]=o[t]);return e}});var Qd=Gi((Q8,fa)=>{var ae=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},nt=-1,lt=1,Ne=0;ae.Diff=function(o,e){return[o,e]};ae.prototype.diff_main=function(o,e,t,r){typeof r=="undefined"&&(this.Diff_Timeout<=0?r=Number.MAX_VALUE:r=new Date().getTime()+this.Diff_Timeout*1e3);var s=r;if(o==null||e==null)throw new Error("Null input. (diff_main)");if(o==e)return o?[new ae.Diff(Ne,o)]:[];typeof t=="undefined"&&(t=!0);var n=t,a=this.diff_commonPrefix(o,e),i=o.substring(0,a);o=o.substring(a),e=e.substring(a),a=this.diff_commonSuffix(o,e);var l=o.substring(o.length-a);o=o.substring(0,o.length-a),e=e.substring(0,e.length-a);var c=this.diff_compute_(o,e,n,s);return i&&c.unshift(new ae.Diff(Ne,i)),l&&c.push(new ae.Diff(Ne,l)),this.diff_cleanupMerge(c),c};ae.prototype.diff_compute_=function(o,e,t,r){var s;if(!o)return[new ae.Diff(lt,e)];if(!e)return[new ae.Diff(nt,o)];var n=o.length>e.length?o:e,a=o.length>e.length?e:o,i=n.indexOf(a);if(i!=-1)return s=[new ae.Diff(lt,n.substring(0,i)),new ae.Diff(Ne,a),new ae.Diff(lt,n.substring(i+a.length))],o.length>e.length&&(s[0][0]=s[2][0]=nt),s;if(a.length==1)return[new ae.Diff(nt,o),new ae.Diff(lt,e)];var l=this.diff_halfMatch_(o,e);if(l){var c=l[0],u=l[1],d=l[2],m=l[3],g=l[4],h=this.diff_main(c,d,t,r),_=this.diff_main(u,m,t,r);return h.concat([new ae.Diff(Ne,g)],_)}return t&&o.length>100&&e.length>100?this.diff_lineMode_(o,e,r):this.diff_bisect_(o,e,r)};ae.prototype.diff_lineMode_=function(o,e,t){var r=this.diff_linesToChars_(o,e);o=r.chars1,e=r.chars2;var s=r.lineArray,n=this.diff_main(o,e,!1,t);this.diff_charsToLines_(n,s),this.diff_cleanupSemantic(n),n.push(new ae.Diff(Ne,""));for(var a=0,i=0,l=0,c="",u="";a<n.length;){switch(n[a][0]){case lt:l++,u+=n[a][1];break;case nt:i++,c+=n[a][1];break;case Ne:if(i>=1&&l>=1){n.splice(a-i-l,i+l),a=a-i-l;for(var d=this.diff_main(c,u,!1,t),m=d.length-1;m>=0;m--)n.splice(a,0,d[m]);a=a+d.length}l=0,i=0,c="",u="";break}a++}return n.pop(),n};ae.prototype.diff_bisect_=function(o,e,t){for(var r=o.length,s=e.length,n=Math.ceil((r+s)/2),a=n,i=2*n,l=new Array(i),c=new Array(i),u=0;u<i;u++)l[u]=-1,c[u]=-1;l[a+1]=0,c[a+1]=0;for(var d=r-s,m=d%2!=0,g=0,h=0,_=0,w=0,v=0;v<n&&!(new Date().getTime()>t);v++){for(var A=-v+g;A<=v-h;A+=2){var O=a+A,E;A==-v||A!=v&&l[O-1]<l[O+1]?E=l[O+1]:E=l[O-1]+1;for(var M=E-A;E<r&&M<s&&o.charAt(E)==e.charAt(M);)E++,M++;if(l[O]=E,E>r)h+=2;else if(M>s)g+=2;else if(m){var R=a+d-A;if(R>=0&&R<i&&c[R]!=-1){var D=r-c[R];if(E>=D)return this.diff_bisectSplit_(o,e,E,M,t)}}}for(var F=-v+_;F<=v-w;F+=2){var R=a+F,D;F==-v||F!=v&&c[R-1]<c[R+1]?D=c[R+1]:D=c[R-1]+1;for(var V=D-F;D<r&&V<s&&o.charAt(r-D-1)==e.charAt(s-V-1);)D++,V++;if(c[R]=D,D>r)w+=2;else if(V>s)_+=2;else if(!m){var O=a+d-F;if(O>=0&&O<i&&l[O]!=-1){var E=l[O],M=a+E-O;if(D=r-D,E>=D)return this.diff_bisectSplit_(o,e,E,M,t)}}}}return[new ae.Diff(nt,o),new ae.Diff(lt,e)]};ae.prototype.diff_bisectSplit_=function(o,e,t,r,s){var n=o.substring(0,t),a=e.substring(0,r),i=o.substring(t),l=e.substring(r),c=this.diff_main(n,a,!1,s),u=this.diff_main(i,l,!1,s);return c.concat(u)};ae.prototype.diff_linesToChars_=function(o,e){var t=[],r={};t[0]="";function s(l){for(var c="",u=0,d=-1,m=t.length;d<l.length-1;){d=l.indexOf(`
`,u),d==-1&&(d=l.length-1);var g=l.substring(u,d+1);(r.hasOwnProperty?r.hasOwnProperty(g):r[g]!==void 0)?c+=String.fromCharCode(r[g]):(m==n&&(g=l.substring(u),d=l.length),c+=String.fromCharCode(m),r[g]=m,t[m++]=g),u=d+1}return c}var n=4e4,a=s(o);n=65535;var i=s(e);return{chars1:a,chars2:i,lineArray:t}};ae.prototype.diff_charsToLines_=function(o,e){for(var t=0;t<o.length;t++){for(var r=o[t][1],s=[],n=0;n<r.length;n++)s[n]=e[r.charCodeAt(n)];o[t][1]=s.join("")}};ae.prototype.diff_commonPrefix=function(o,e){if(!o||!e||o.charAt(0)!=e.charAt(0))return 0;for(var t=0,r=Math.min(o.length,e.length),s=r,n=0;t<s;)o.substring(n,s)==e.substring(n,s)?(t=s,n=t):r=s,s=Math.floor((r-t)/2+t);return s};ae.prototype.diff_commonSuffix=function(o,e){if(!o||!e||o.charAt(o.length-1)!=e.charAt(e.length-1))return 0;for(var t=0,r=Math.min(o.length,e.length),s=r,n=0;t<s;)o.substring(o.length-s,o.length-n)==e.substring(e.length-s,e.length-n)?(t=s,n=t):r=s,s=Math.floor((r-t)/2+t);return s};ae.prototype.diff_commonOverlap_=function(o,e){var t=o.length,r=e.length;if(t==0||r==0)return 0;t>r?o=o.substring(t-r):t<r&&(e=e.substring(0,t));var s=Math.min(t,r);if(o==e)return s;for(var n=0,a=1;;){var i=o.substring(s-a),l=e.indexOf(i);if(l==-1)return n;a+=l,(l==0||o.substring(s-a)==e.substring(0,a))&&(n=a,a++)}};ae.prototype.diff_halfMatch_=function(o,e){if(this.Diff_Timeout<=0)return null;var t=o.length>e.length?o:e,r=o.length>e.length?e:o;if(t.length<4||r.length*2<t.length)return null;var s=this;function n(h,_,w){for(var v=h.substring(w,w+Math.floor(h.length/4)),A=-1,O="",E,M,R,D;(A=_.indexOf(v,A+1))!=-1;){var F=s.diff_commonPrefix(h.substring(w),_.substring(A)),V=s.diff_commonSuffix(h.substring(0,w),_.substring(0,A));O.length<V+F&&(O=_.substring(A-V,A)+_.substring(A,A+F),E=h.substring(0,w-V),M=h.substring(w+F),R=_.substring(0,A-V),D=_.substring(A+F))}return O.length*2>=h.length?[E,M,R,D,O]:null}var a=n(t,r,Math.ceil(t.length/4)),i=n(t,r,Math.ceil(t.length/2)),l;if(!a&&!i)return null;i?a?l=a[4].length>i[4].length?a:i:l=i:l=a;var c,u,d,m;o.length>e.length?(c=l[0],u=l[1],d=l[2],m=l[3]):(d=l[0],m=l[1],c=l[2],u=l[3]);var g=l[4];return[c,u,d,m,g]};ae.prototype.diff_cleanupSemantic=function(o){for(var e=!1,t=[],r=0,s=null,n=0,a=0,i=0,l=0,c=0;n<o.length;)o[n][0]==Ne?(t[r++]=n,a=l,i=c,l=0,c=0,s=o[n][1]):(o[n][0]==lt?l+=o[n][1].length:c+=o[n][1].length,s&&s.length<=Math.max(a,i)&&s.length<=Math.max(l,c)&&(o.splice(t[r-1],0,new ae.Diff(nt,s)),o[t[r-1]+1][0]=lt,r--,r--,n=r>0?t[r-1]:-1,a=0,i=0,l=0,c=0,s=null,e=!0)),n++;for(e&&this.diff_cleanupMerge(o),this.diff_cleanupSemanticLossless(o),n=1;n<o.length;){if(o[n-1][0]==nt&&o[n][0]==lt){var u=o[n-1][1],d=o[n][1],m=this.diff_commonOverlap_(u,d),g=this.diff_commonOverlap_(d,u);m>=g?(m>=u.length/2||m>=d.length/2)&&(o.splice(n,0,new ae.Diff(Ne,d.substring(0,m))),o[n-1][1]=u.substring(0,u.length-m),o[n+1][1]=d.substring(m),n++):(g>=u.length/2||g>=d.length/2)&&(o.splice(n,0,new ae.Diff(Ne,u.substring(0,g))),o[n-1][0]=lt,o[n-1][1]=d.substring(0,d.length-g),o[n+1][0]=nt,o[n+1][1]=u.substring(g),n++),n++}n++}};ae.prototype.diff_cleanupSemanticLossless=function(o){function e(g,h){if(!g||!h)return 6;var _=g.charAt(g.length-1),w=h.charAt(0),v=_.match(ae.nonAlphaNumericRegex_),A=w.match(ae.nonAlphaNumericRegex_),O=v&&_.match(ae.whitespaceRegex_),E=A&&w.match(ae.whitespaceRegex_),M=O&&_.match(ae.linebreakRegex_),R=E&&w.match(ae.linebreakRegex_),D=M&&g.match(ae.blanklineEndRegex_),F=R&&h.match(ae.blanklineStartRegex_);return D||F?5:M||R?4:v&&!O&&E?3:O||E?2:v||A?1:0}for(var t=1;t<o.length-1;){if(o[t-1][0]==Ne&&o[t+1][0]==Ne){var r=o[t-1][1],s=o[t][1],n=o[t+1][1],a=this.diff_commonSuffix(r,s);if(a){var i=s.substring(s.length-a);r=r.substring(0,r.length-a),s=i+s.substring(0,s.length-a),n=i+n}for(var l=r,c=s,u=n,d=e(r,s)+e(s,n);s.charAt(0)===n.charAt(0);){r+=s.charAt(0),s=s.substring(1)+n.charAt(0),n=n.substring(1);var m=e(r,s)+e(s,n);m>=d&&(d=m,l=r,c=s,u=n)}o[t-1][1]!=l&&(l?o[t-1][1]=l:(o.splice(t-1,1),t--),o[t][1]=c,u?o[t+1][1]=u:(o.splice(t+1,1),t--))}t++}};ae.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/;ae.whitespaceRegex_=/\s/;ae.linebreakRegex_=/[\r\n]/;ae.blanklineEndRegex_=/\n\r?\n$/;ae.blanklineStartRegex_=/^\r?\n\r?\n/;ae.prototype.diff_cleanupEfficiency=function(o){for(var e=!1,t=[],r=0,s=null,n=0,a=!1,i=!1,l=!1,c=!1;n<o.length;)o[n][0]==Ne?(o[n][1].length<this.Diff_EditCost&&(l||c)?(t[r++]=n,a=l,i=c,s=o[n][1]):(r=0,s=null),l=c=!1):(o[n][0]==nt?c=!0:l=!0,s&&(a&&i&&l&&c||s.length<this.Diff_EditCost/2&&a+i+l+c==3)&&(o.splice(t[r-1],0,new ae.Diff(nt,s)),o[t[r-1]+1][0]=lt,r--,s=null,a&&i?(l=c=!0,r=0):(r--,n=r>0?t[r-1]:-1,l=c=!1),e=!0)),n++;e&&this.diff_cleanupMerge(o)};ae.prototype.diff_cleanupMerge=function(o){o.push(new ae.Diff(Ne,""));for(var e=0,t=0,r=0,s="",n="",a;e<o.length;)switch(o[e][0]){case lt:r++,n+=o[e][1],e++;break;case nt:t++,s+=o[e][1],e++;break;case Ne:t+r>1?(t!==0&&r!==0&&(a=this.diff_commonPrefix(n,s),a!==0&&(e-t-r>0&&o[e-t-r-1][0]==Ne?o[e-t-r-1][1]+=n.substring(0,a):(o.splice(0,0,new ae.Diff(Ne,n.substring(0,a))),e++),n=n.substring(a),s=s.substring(a)),a=this.diff_commonSuffix(n,s),a!==0&&(o[e][1]=n.substring(n.length-a)+o[e][1],n=n.substring(0,n.length-a),s=s.substring(0,s.length-a))),e-=t+r,o.splice(e,t+r),s.length&&(o.splice(e,0,new ae.Diff(nt,s)),e++),n.length&&(o.splice(e,0,new ae.Diff(lt,n)),e++),e++):e!==0&&o[e-1][0]==Ne?(o[e-1][1]+=o[e][1],o.splice(e,1)):e++,r=0,t=0,s="",n="";break}o[o.length-1][1]===""&&o.pop();var i=!1;for(e=1;e<o.length-1;)o[e-1][0]==Ne&&o[e+1][0]==Ne&&(o[e][1].substring(o[e][1].length-o[e-1][1].length)==o[e-1][1]?(o[e][1]=o[e-1][1]+o[e][1].substring(0,o[e][1].length-o[e-1][1].length),o[e+1][1]=o[e-1][1]+o[e+1][1],o.splice(e-1,1),i=!0):o[e][1].substring(0,o[e+1][1].length)==o[e+1][1]&&(o[e-1][1]+=o[e+1][1],o[e][1]=o[e][1].substring(o[e+1][1].length)+o[e+1][1],o.splice(e+1,1),i=!0)),e++;i&&this.diff_cleanupMerge(o)};ae.prototype.diff_xIndex=function(o,e){var t=0,r=0,s=0,n=0,a;for(a=0;a<o.length&&(o[a][0]!==lt&&(t+=o[a][1].length),o[a][0]!==nt&&(r+=o[a][1].length),!(t>e));a++)s=t,n=r;return o.length!=a&&o[a][0]===nt?n:n+(e-s)};ae.prototype.diff_prettyHtml=function(o){for(var e=[],t=/&/g,r=/</g,s=/>/g,n=/\n/g,a=0;a<o.length;a++){var i=o[a][0],l=o[a][1],c=l.replace(t,"&amp;").replace(r,"&lt;").replace(s,"&gt;").replace(n,"&para;<br>");switch(i){case lt:e[a]='<ins style="background:#e6ffe6;">'+c+"</ins>";break;case nt:e[a]='<del style="background:#ffe6e6;">'+c+"</del>";break;case Ne:e[a]="<span>"+c+"</span>";break}}return e.join("")};ae.prototype.diff_text1=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==lt&&(e[t]=o[t][1]);return e.join("")};ae.prototype.diff_text2=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==nt&&(e[t]=o[t][1]);return e.join("")};ae.prototype.diff_levenshtein=function(o){for(var e=0,t=0,r=0,s=0;s<o.length;s++){var n=o[s][0],a=o[s][1];switch(n){case lt:t+=a.length;break;case nt:r+=a.length;break;case Ne:e+=Math.max(t,r),t=0,r=0;break}}return e+=Math.max(t,r),e};ae.prototype.diff_toDelta=function(o){for(var e=[],t=0;t<o.length;t++)switch(o[t][0]){case lt:e[t]="+"+encodeURI(o[t][1]);break;case nt:e[t]="-"+o[t][1].length;break;case Ne:e[t]="="+o[t][1].length;break}return e.join("	").replace(/%20/g," ")};ae.prototype.diff_fromDelta=function(o,e){for(var t=[],r=0,s=0,n=e.split(/\t/g),a=0;a<n.length;a++){var i=n[a].substring(1);switch(n[a].charAt(0)){case"+":try{t[r++]=new ae.Diff(lt,decodeURI(i))}catch(u){throw new Error("Illegal escape in diff_fromDelta: "+i)}break;case"-":case"=":var l=parseInt(i,10);if(isNaN(l)||l<0)throw new Error("Invalid number in diff_fromDelta: "+i);var c=o.substring(s,s+=l);n[a].charAt(0)=="="?t[r++]=new ae.Diff(Ne,c):t[r++]=new ae.Diff(nt,c);break;default:if(n[a])throw new Error("Invalid diff operation in diff_fromDelta: "+n[a])}}if(s!=o.length)throw new Error("Delta length ("+s+") does not equal source text length ("+o.length+").");return t};ae.prototype.match_main=function(o,e,t){if(o==null||e==null||t==null)throw new Error("Null input. (match_main)");return t=Math.max(0,Math.min(t,o.length)),o==e?0:o.length?o.substring(t,t+e.length)==e?t:this.match_bitap_(o,e,t):-1};ae.prototype.match_bitap_=function(o,e,t){if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var r=this.match_alphabet_(e),s=this;function n(E,M){var R=E/e.length,D=Math.abs(t-M);return s.Match_Distance?R+D/s.Match_Distance:D?1:R}var a=this.Match_Threshold,i=o.indexOf(e,t);i!=-1&&(a=Math.min(n(0,i),a),i=o.lastIndexOf(e,t+e.length),i!=-1&&(a=Math.min(n(0,i),a)));var l=1<<e.length-1;i=-1;for(var c,u,d=e.length+o.length,m,g=0;g<e.length;g++){for(c=0,u=d;c<u;)n(g,t+u)<=a?c=u:d=u,u=Math.floor((d-c)/2+c);d=u;var h=Math.max(1,t-u+1),_=Math.min(t+u,o.length)+e.length,w=Array(_+2);w[_+1]=(1<<g)-1;for(var v=_;v>=h;v--){var A=r[o.charAt(v-1)];if(g===0?w[v]=(w[v+1]<<1|1)&A:w[v]=(w[v+1]<<1|1)&A|((m[v+1]|m[v])<<1|1)|m[v+1],w[v]&l){var O=n(g,v-1);if(O<=a)if(a=O,i=v-1,i>t)h=Math.max(1,2*t-i);else break}}if(n(g+1,t)>a)break;m=w}return i};ae.prototype.match_alphabet_=function(o){for(var e={},t=0;t<o.length;t++)e[o.charAt(t)]=0;for(var t=0;t<o.length;t++)e[o.charAt(t)]|=1<<o.length-t-1;return e};ae.prototype.patch_addContext_=function(o,e){if(e.length!=0){if(o.start2===null)throw Error("patch not initialized");for(var t=e.substring(o.start2,o.start2+o.length1),r=0;e.indexOf(t)!=e.lastIndexOf(t)&&t.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,t=e.substring(o.start2-r,o.start2+o.length1+r);r+=this.Patch_Margin;var s=e.substring(o.start2-r,o.start2);s&&o.diffs.unshift(new ae.Diff(Ne,s));var n=e.substring(o.start2+o.length1,o.start2+o.length1+r);n&&o.diffs.push(new ae.Diff(Ne,n)),o.start1-=s.length,o.start2-=s.length,o.length1+=s.length+n.length,o.length2+=s.length+n.length}};ae.prototype.patch_make=function(o,e,t){var r,s;if(typeof o=="string"&&typeof e=="string"&&typeof t=="undefined")r=o,s=this.diff_main(r,e,!0),s.length>2&&(this.diff_cleanupSemantic(s),this.diff_cleanupEfficiency(s));else if(o&&typeof o=="object"&&typeof e=="undefined"&&typeof t=="undefined")s=o,r=this.diff_text1(s);else if(typeof o=="string"&&e&&typeof e=="object"&&typeof t=="undefined")r=o,s=e;else if(typeof o=="string"&&typeof e=="string"&&t&&typeof t=="object")r=o,s=t;else throw new Error("Unknown call format to patch_make.");if(s.length===0)return[];for(var n=[],a=new ae.patch_obj,i=0,l=0,c=0,u=r,d=r,m=0;m<s.length;m++){var g=s[m][0],h=s[m][1];switch(!i&&g!==Ne&&(a.start1=l,a.start2=c),g){case lt:a.diffs[i++]=s[m],a.length2+=h.length,d=d.substring(0,c)+h+d.substring(c);break;case nt:a.length1+=h.length,a.diffs[i++]=s[m],d=d.substring(0,c)+d.substring(c+h.length);break;case Ne:h.length<=2*this.Patch_Margin&&i&&s.length!=m+1?(a.diffs[i++]=s[m],a.length1+=h.length,a.length2+=h.length):h.length>=2*this.Patch_Margin&&i&&(this.patch_addContext_(a,u),n.push(a),a=new ae.patch_obj,i=0,u=d,l=c);break}g!==lt&&(l+=h.length),g!==nt&&(c+=h.length)}return i&&(this.patch_addContext_(a,u),n.push(a)),n};ae.prototype.patch_deepCopy=function(o){for(var e=[],t=0;t<o.length;t++){var r=o[t],s=new ae.patch_obj;s.diffs=[];for(var n=0;n<r.diffs.length;n++)s.diffs[n]=new ae.Diff(r.diffs[n][0],r.diffs[n][1]);s.start1=r.start1,s.start2=r.start2,s.length1=r.length1,s.length2=r.length2,e[t]=s}return e};ae.prototype.patch_apply=function(o,e){if(o.length==0)return[e,[]];o=this.patch_deepCopy(o);var t=this.patch_addPadding(o);e=t+e+t,this.patch_splitMax(o);for(var r=0,s=[],n=0;n<o.length;n++){var a=o[n].start2+r,i=this.diff_text1(o[n].diffs),l,c=-1;if(i.length>this.Match_MaxBits?(l=this.match_main(e,i.substring(0,this.Match_MaxBits),a),l!=-1&&(c=this.match_main(e,i.substring(i.length-this.Match_MaxBits),a+i.length-this.Match_MaxBits),(c==-1||l>=c)&&(l=-1))):l=this.match_main(e,i,a),l==-1)s[n]=!1,r-=o[n].length2-o[n].length1;else{s[n]=!0,r=l-a;var u;if(c==-1?u=e.substring(l,l+i.length):u=e.substring(l,c+this.Match_MaxBits),i==u)e=e.substring(0,l)+this.diff_text2(o[n].diffs)+e.substring(l+i.length);else{var d=this.diff_main(i,u,!1);if(i.length>this.Match_MaxBits&&this.diff_levenshtein(d)/i.length>this.Patch_DeleteThreshold)s[n]=!1;else{this.diff_cleanupSemanticLossless(d);for(var m=0,g,h=0;h<o[n].diffs.length;h++){var _=o[n].diffs[h];_[0]!==Ne&&(g=this.diff_xIndex(d,m)),_[0]===lt?e=e.substring(0,l+g)+_[1]+e.substring(l+g):_[0]===nt&&(e=e.substring(0,l+g)+e.substring(l+this.diff_xIndex(d,m+_[1].length))),_[0]!==nt&&(m+=_[1].length)}}}}}return e=e.substring(t.length,e.length-t.length),[e,s]};ae.prototype.patch_addPadding=function(o){for(var e=this.Patch_Margin,t="",r=1;r<=e;r++)t+=String.fromCharCode(r);for(var r=0;r<o.length;r++)o[r].start1+=e,o[r].start2+=e;var s=o[0],n=s.diffs;if(n.length==0||n[0][0]!=Ne)n.unshift(new ae.Diff(Ne,t)),s.start1-=e,s.start2-=e,s.length1+=e,s.length2+=e;else if(e>n[0][1].length){var a=e-n[0][1].length;n[0][1]=t.substring(n[0][1].length)+n[0][1],s.start1-=a,s.start2-=a,s.length1+=a,s.length2+=a}if(s=o[o.length-1],n=s.diffs,n.length==0||n[n.length-1][0]!=Ne)n.push(new ae.Diff(Ne,t)),s.length1+=e,s.length2+=e;else if(e>n[n.length-1][1].length){var a=e-n[n.length-1][1].length;n[n.length-1][1]+=t.substring(0,a),s.length1+=a,s.length2+=a}return t};ae.prototype.patch_splitMax=function(o){for(var e=this.Match_MaxBits,t=0;t<o.length;t++)if(!(o[t].length1<=e)){var r=o[t];o.splice(t--,1);for(var s=r.start1,n=r.start2,a="";r.diffs.length!==0;){var i=new ae.patch_obj,l=!0;for(i.start1=s-a.length,i.start2=n-a.length,a!==""&&(i.length1=i.length2=a.length,i.diffs.push(new ae.Diff(Ne,a)));r.diffs.length!==0&&i.length1<e-this.Patch_Margin;){var c=r.diffs[0][0],u=r.diffs[0][1];c===lt?(i.length2+=u.length,n+=u.length,i.diffs.push(r.diffs.shift()),l=!1):c===nt&&i.diffs.length==1&&i.diffs[0][0]==Ne&&u.length>2*e?(i.length1+=u.length,s+=u.length,l=!1,i.diffs.push(new ae.Diff(c,u)),r.diffs.shift()):(u=u.substring(0,e-i.length1-this.Patch_Margin),i.length1+=u.length,s+=u.length,c===Ne?(i.length2+=u.length,n+=u.length):l=!1,i.diffs.push(new ae.Diff(c,u)),u==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(u.length))}a=this.diff_text2(i.diffs),a=a.substring(a.length-this.Patch_Margin);var d=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);d!==""&&(i.length1+=d.length,i.length2+=d.length,i.diffs.length!==0&&i.diffs[i.diffs.length-1][0]===Ne?i.diffs[i.diffs.length-1][1]+=d:i.diffs.push(new ae.Diff(Ne,d))),l||o.splice(++t,0,i)}}};ae.prototype.patch_toText=function(o){for(var e=[],t=0;t<o.length;t++)e[t]=o[t];return e.join("")};ae.prototype.patch_fromText=function(o){var e=[];if(!o)return e;for(var t=o.split(`
`),r=0,s=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<t.length;){var n=t[r].match(s);if(!n)throw new Error("Invalid patch string: "+t[r]);var a=new ae.patch_obj;for(e.push(a),a.start1=parseInt(n[1],10),n[2]===""?(a.start1--,a.length1=1):n[2]=="0"?a.length1=0:(a.start1--,a.length1=parseInt(n[2],10)),a.start2=parseInt(n[3],10),n[4]===""?(a.start2--,a.length2=1):n[4]=="0"?a.length2=0:(a.start2--,a.length2=parseInt(n[4],10)),r++;r<t.length;){var i=t[r].charAt(0);try{var l=decodeURI(t[r].substring(1))}catch(c){throw new Error("Illegal escape in patch_fromText: "+l)}if(i=="-")a.diffs.push(new ae.Diff(nt,l));else if(i=="+")a.diffs.push(new ae.Diff(lt,l));else if(i==" ")a.diffs.push(new ae.Diff(Ne,l));else{if(i=="@")break;if(i!=="")throw new Error('Invalid patch mode "'+i+'" in: '+l)}r++}}return e};ae.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0};ae.patch_obj.prototype.toString=function(){var o,e;this.length1===0?o=this.start1+",0":this.length1==1?o=this.start1+1:o=this.start1+1+","+this.length1,this.length2===0?e=this.start2+",0":this.length2==1?e=this.start2+1:e=this.start2+1+","+this.length2;for(var t=["@@ -"+o+" +"+e+` @@
`],r,s=0;s<this.diffs.length;s++){switch(this.diffs[s][0]){case lt:r="+";break;case nt:r="-";break;case Ne:r=" ";break}t[s+1]=r+encodeURI(this.diffs[s][1])+`
`}return t.join("").replace(/%20/g," ")};fa.exports=ae;fa.exports.diff_match_patch=ae;fa.exports.DIFF_DELETE=nt;fa.exports.DIFF_INSERT=lt;fa.exports.DIFF_EQUAL=Ne});var Kb=Gi((am,ya)=>{(function(o,e){typeof am=="object"&&typeof ya!="undefined"?ya.exports=e():typeof define=="function"&&define.amd?define(e):o.moment=e()})(am,function(){"use strict";var o;function e(){return o.apply(null,arguments)}function t(f){o=f}function r(f){return f instanceof Array||Object.prototype.toString.call(f)==="[object Array]"}function s(f){return f!=null&&Object.prototype.toString.call(f)==="[object Object]"}function n(f,p){return Object.prototype.hasOwnProperty.call(f,p)}function a(f){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(f).length===0;var p;for(p in f)if(n(f,p))return!1;return!0}function i(f){return f===void 0}function l(f){return typeof f=="number"||Object.prototype.toString.call(f)==="[object Number]"}function c(f){return f instanceof Date||Object.prototype.toString.call(f)==="[object Date]"}function u(f,p){var y=[],b,L=f.length;for(b=0;b<L;++b)y.push(p(f[b],b));return y}function d(f,p){for(var y in p)n(p,y)&&(f[y]=p[y]);return n(p,"toString")&&(f.toString=p.toString),n(p,"valueOf")&&(f.valueOf=p.valueOf),f}function m(f,p,y,b){return ah(f,p,y,b,!0).utc()}function g(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function h(f){return f._pf==null&&(f._pf=g()),f._pf}var _;Array.prototype.some?_=Array.prototype.some:_=function(f){var p=Object(this),y=p.length>>>0,b;for(b=0;b<y;b++)if(b in p&&f.call(this,p[b],b,p))return!0;return!1};function w(f){if(f._isValid==null){var p=h(f),y=_.call(p.parsedDateParts,function(L){return L!=null}),b=!isNaN(f._d.getTime())&&p.overflow<0&&!p.empty&&!p.invalidEra&&!p.invalidMonth&&!p.invalidWeekday&&!p.weekdayMismatch&&!p.nullInput&&!p.invalidFormat&&!p.userInvalidated&&(!p.meridiem||p.meridiem&&y);if(f._strict&&(b=b&&p.charsLeftOver===0&&p.unusedTokens.length===0&&p.bigHour===void 0),Object.isFrozen==null||!Object.isFrozen(f))f._isValid=b;else return b}return f._isValid}function v(f){var p=m(NaN);return f!=null?d(h(p),f):h(p).userInvalidated=!0,p}var A=e.momentProperties=[],O=!1;function E(f,p){var y,b,L,$=A.length;if(i(p._isAMomentObject)||(f._isAMomentObject=p._isAMomentObject),i(p._i)||(f._i=p._i),i(p._f)||(f._f=p._f),i(p._l)||(f._l=p._l),i(p._strict)||(f._strict=p._strict),i(p._tzm)||(f._tzm=p._tzm),i(p._isUTC)||(f._isUTC=p._isUTC),i(p._offset)||(f._offset=p._offset),i(p._pf)||(f._pf=h(p)),i(p._locale)||(f._locale=p._locale),$>0)for(y=0;y<$;y++)b=A[y],L=p[b],i(L)||(f[b]=L);return f}function M(f){E(this,f),this._d=new Date(f._d!=null?f._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),O===!1&&(O=!0,e.updateOffset(this),O=!1)}function R(f){return f instanceof M||f!=null&&f._isAMomentObject!=null}function D(f){e.suppressDeprecationWarnings===!1&&typeof console!="undefined"&&console.warn&&console.warn("Deprecation warning: "+f)}function F(f,p){var y=!0;return d(function(){if(e.deprecationHandler!=null&&e.deprecationHandler(null,f),y){var b=[],L,$,J,Le=arguments.length;for($=0;$<Le;$++){if(L="",typeof arguments[$]=="object"){L+=`
[`+$+"] ";for(J in arguments[0])n(arguments[0],J)&&(L+=J+": "+arguments[0][J]+", ");L=L.slice(0,-2)}else L=arguments[$];b.push(L)}D(f+`
Arguments: `+Array.prototype.slice.call(b).join("")+`
`+new Error().stack),y=!1}return p.apply(this,arguments)},p)}var V={};function q(f,p){e.deprecationHandler!=null&&e.deprecationHandler(f,p),V[f]||(D(p),V[f]=!0)}e.suppressDeprecationWarnings=!1,e.deprecationHandler=null;function j(f){return typeof Function!="undefined"&&f instanceof Function||Object.prototype.toString.call(f)==="[object Function]"}function z(f){var p,y;for(y in f)n(f,y)&&(p=f[y],j(p)?this[y]=p:this["_"+y]=p);this._config=f,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function Y(f,p){var y=d({},f),b;for(b in p)n(p,b)&&(s(f[b])&&s(p[b])?(y[b]={},d(y[b],f[b]),d(y[b],p[b])):p[b]!=null?y[b]=p[b]:delete y[b]);for(b in f)n(f,b)&&!n(p,b)&&s(f[b])&&(y[b]=d({},y[b]));return y}function pe(f){f!=null&&this.set(f)}var De;Object.keys?De=Object.keys:De=function(f){var p,y=[];for(p in f)n(f,p)&&y.push(p);return y};var G={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function se(f,p,y){var b=this._calendar[f]||this._calendar.sameElse;return j(b)?b.call(p,y):b}function ke(f,p,y){var b=""+Math.abs(f),L=p-b.length,$=f>=0;return($?y?"+":"":"-")+Math.pow(10,Math.max(0,L)).toString().substr(1)+b}var Qe=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Re=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,ce={},le={};function W(f,p,y,b){var L=b;typeof b=="string"&&(L=function(){return this[b]()}),f&&(le[f]=L),p&&(le[p[0]]=function(){return ke(L.apply(this,arguments),p[1],p[2])}),y&&(le[y]=function(){return this.localeData().ordinal(L.apply(this,arguments),f)})}function Fe(f){return f.match(/\[[\s\S]/)?f.replace(/^\[|\]$/g,""):f.replace(/\\/g,"")}function Ye(f){var p=f.match(Qe),y,b;for(y=0,b=p.length;y<b;y++)le[p[y]]?p[y]=le[p[y]]:p[y]=Fe(p[y]);return function(L){var $="",J;for(J=0;J<b;J++)$+=j(p[J])?p[J].call(L,f):p[J];return $}}function vt(f,p){return f.isValid()?(p=mt(p,f.localeData()),ce[p]=ce[p]||Ye(p),ce[p](f)):f.localeData().invalidDate()}function mt(f,p){var y=5;function b(L){return p.longDateFormat(L)||L}for(Re.lastIndex=0;y>=0&&Re.test(f);)f=f.replace(Re,b),Re.lastIndex=0,y-=1;return f}var _t={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function ct(f){var p=this._longDateFormat[f],y=this._longDateFormat[f.toUpperCase()];return p||!y?p:(this._longDateFormat[f]=y.match(Qe).map(function(b){return b==="MMMM"||b==="MM"||b==="DD"||b==="dddd"?b.slice(1):b}).join(""),this._longDateFormat[f])}var yt="Invalid date";function Qt(){return this._invalidDate}var Ms="%d",Io=/\d{1,2}/;function va(f){return this._ordinal.replace("%d",f)}var dn={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function pn(f,p,y,b){var L=this._relativeTime[y];return j(L)?L(f,p,y,b):L.replace(/%d/i,f)}function _a(f,p){var y=this._relativeTime[f>0?"future":"past"];return j(y)?y(p):y.replace(/%s/i,p)}var xr={};function at(f,p){var y=f.toLowerCase();xr[y]=xr[y+"s"]=xr[p]=f}function Xt(f){return typeof f=="string"?xr[f]||xr[f.toLowerCase()]:void 0}function Lo(f){var p={},y,b;for(b in f)n(f,b)&&(y=Xt(b),y&&(p[y]=f[b]));return p}var ns={};function Tt(f,p){ns[f]=p}function Sa(f){var p=[],y;for(y in f)n(f,y)&&p.push({unit:y,priority:ns[y]});return p.sort(function(b,L){return b.priority-L.priority}),p}function as(f){return f%4===0&&f%100!==0||f%400===0}function Yt(f){return f<0?Math.ceil(f)||0:Math.floor(f)}function $e(f){var p=+f,y=0;return p!==0&&isFinite(p)&&(y=Yt(p)),y}function so(f,p){return function(y){return y!=null?(mn(this,f,y),e.updateOffset(this,p),this):is(this,f)}}function is(f,p){return f.isValid()?f._d["get"+(f._isUTC?"UTC":"")+p]():NaN}function mn(f,p,y){f.isValid()&&!isNaN(y)&&(p==="FullYear"&&as(f.year())&&f.month()===1&&f.date()===29?(y=$e(y),f._d["set"+(f._isUTC?"UTC":"")+p](y,f.month(),Ri(y,f.month()))):f._d["set"+(f._isUTC?"UTC":"")+p](y))}function ka(f){return f=Xt(f),j(this[f])?this[f]():this}function Ca(f,p){if(typeof f=="object"){f=Lo(f);var y=Sa(f),b,L=y.length;for(b=0;b<L;b++)this[y[b].unit](f[y[b].unit])}else if(f=Xt(f),j(this[f]))return this[f](p);return this}var hn=/\d/,Vt=/\d\d/,gn=/\d{3}/,Rs=/\d{4}/,Q=/[+-]?\d{6}/,ue=/\d\d?/,ot=/\d\d\d\d?/,Hr=/\d\d\d\d\d\d?/,re=/\d{1,3}/,Oe=/\d{1,4}/,ft=/[+-]?\d{1,6}/,Pt=/\d+/,no=/[+-]?\d+/,rf=/Z|[+-]\d\d:?\d\d/gi,ls=/Z|[+-]\d\d(?::?\d\d)?/gi,d_=/[+-]?\d+(\.\d{1,3})?/,Ia=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,Mi;Mi={};function ve(f,p,y){Mi[f]=j(p)?p:function(b,L){return b&&y?y:p}}function p_(f,p){return n(Mi,f)?Mi[f](p._strict,p._locale):new RegExp(m_(f))}function m_(f){return br(f.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(p,y,b,L,$){return y||b||L||$}))}function br(f){return f.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var of={};function tt(f,p){var y,b=p,L;for(typeof f=="string"&&(f=[f]),l(p)&&(b=function($,J){J[p]=$e($)}),L=f.length,y=0;y<L;y++)of[f[y]]=b}function La(f,p){tt(f,function(y,b,L,$){L._w=L._w||{},p(y,L._w,L,$)})}function h_(f,p,y){p!=null&&n(of,f)&&of[f](p,y._a,y,f)}var Jt=0,To=1,ao=2,Et=3,Vr=4,Po=5,Os=6,g_=7,y_=8;function x_(f,p){return(f%p+p)%p}var kt;Array.prototype.indexOf?kt=Array.prototype.indexOf:kt=function(f){var p;for(p=0;p<this.length;++p)if(this[p]===f)return p;return-1};function Ri(f,p){if(isNaN(f)||isNaN(p))return NaN;var y=x_(p,12);return f+=(p-y)/12,y===1?as(f)?29:28:31-y%7%2}W("M",["MM",2],"Mo",function(){return this.month()+1}),W("MMM",0,0,function(f){return this.localeData().monthsShort(this,f)}),W("MMMM",0,0,function(f){return this.localeData().months(this,f)}),at("month","M"),Tt("month",8),ve("M",ue),ve("MM",ue,Vt),ve("MMM",function(f,p){return p.monthsShortRegex(f)}),ve("MMMM",function(f,p){return p.monthsRegex(f)}),tt(["M","MM"],function(f,p){p[To]=$e(f)-1}),tt(["MMM","MMMM"],function(f,p,y,b){var L=y._locale.monthsParse(f,b,y._strict);L!=null?p[To]=L:h(y).invalidMonth=f});var b_="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),zm="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),Km=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,w_=Ia,v_=Ia;function __(f,p){return f?r(this._months)?this._months[f.month()]:this._months[(this._months.isFormat||Km).test(p)?"format":"standalone"][f.month()]:r(this._months)?this._months:this._months.standalone}function S_(f,p){return f?r(this._monthsShort)?this._monthsShort[f.month()]:this._monthsShort[Km.test(p)?"format":"standalone"][f.month()]:r(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function k_(f,p,y){var b,L,$,J=f.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],b=0;b<12;++b)$=m([2e3,b]),this._shortMonthsParse[b]=this.monthsShort($,"").toLocaleLowerCase(),this._longMonthsParse[b]=this.months($,"").toLocaleLowerCase();return y?p==="MMM"?(L=kt.call(this._shortMonthsParse,J),L!==-1?L:null):(L=kt.call(this._longMonthsParse,J),L!==-1?L:null):p==="MMM"?(L=kt.call(this._shortMonthsParse,J),L!==-1?L:(L=kt.call(this._longMonthsParse,J),L!==-1?L:null)):(L=kt.call(this._longMonthsParse,J),L!==-1?L:(L=kt.call(this._shortMonthsParse,J),L!==-1?L:null))}function C_(f,p,y){var b,L,$;if(this._monthsParseExact)return k_.call(this,f,p,y);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),b=0;b<12;b++){if(L=m([2e3,b]),y&&!this._longMonthsParse[b]&&(this._longMonthsParse[b]=new RegExp("^"+this.months(L,"").replace(".","")+"$","i"),this._shortMonthsParse[b]=new RegExp("^"+this.monthsShort(L,"").replace(".","")+"$","i")),!y&&!this._monthsParse[b]&&($="^"+this.months(L,"")+"|^"+this.monthsShort(L,""),this._monthsParse[b]=new RegExp($.replace(".",""),"i")),y&&p==="MMMM"&&this._longMonthsParse[b].test(f))return b;if(y&&p==="MMM"&&this._shortMonthsParse[b].test(f))return b;if(!y&&this._monthsParse[b].test(f))return b}}function Gm(f,p){var y;if(!f.isValid())return f;if(typeof p=="string"){if(/^\d+$/.test(p))p=$e(p);else if(p=f.localeData().monthsParse(p),!l(p))return f}return y=Math.min(f.date(),Ri(f.year(),p)),f._d["set"+(f._isUTC?"UTC":"")+"Month"](p,y),f}function jm(f){return f!=null?(Gm(this,f),e.updateOffset(this,!0),this):is(this,"Month")}function I_(){return Ri(this.year(),this.month())}function L_(f){return this._monthsParseExact?(n(this,"_monthsRegex")||Ym.call(this),f?this._monthsShortStrictRegex:this._monthsShortRegex):(n(this,"_monthsShortRegex")||(this._monthsShortRegex=w_),this._monthsShortStrictRegex&&f?this._monthsShortStrictRegex:this._monthsShortRegex)}function T_(f){return this._monthsParseExact?(n(this,"_monthsRegex")||Ym.call(this),f?this._monthsStrictRegex:this._monthsRegex):(n(this,"_monthsRegex")||(this._monthsRegex=v_),this._monthsStrictRegex&&f?this._monthsStrictRegex:this._monthsRegex)}function Ym(){function f(J,Le){return Le.length-J.length}var p=[],y=[],b=[],L,$;for(L=0;L<12;L++)$=m([2e3,L]),p.push(this.monthsShort($,"")),y.push(this.months($,"")),b.push(this.months($,"")),b.push(this.monthsShort($,""));for(p.sort(f),y.sort(f),b.sort(f),L=0;L<12;L++)p[L]=br(p[L]),y[L]=br(y[L]);for(L=0;L<24;L++)b[L]=br(b[L]);this._monthsRegex=new RegExp("^("+b.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+y.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+p.join("|")+")","i")}W("Y",0,0,function(){var f=this.year();return f<=9999?ke(f,4):"+"+f}),W(0,["YY",2],0,function(){return this.year()%100}),W(0,["YYYY",4],0,"year"),W(0,["YYYYY",5],0,"year"),W(0,["YYYYYY",6,!0],0,"year"),at("year","y"),Tt("year",1),ve("Y",no),ve("YY",ue,Vt),ve("YYYY",Oe,Rs),ve("YYYYY",ft,Q),ve("YYYYYY",ft,Q),tt(["YYYYY","YYYYYY"],Jt),tt("YYYY",function(f,p){p[Jt]=f.length===2?e.parseTwoDigitYear(f):$e(f)}),tt("YY",function(f,p){p[Jt]=e.parseTwoDigitYear(f)}),tt("Y",function(f,p){p[Jt]=parseInt(f,10)});function Ta(f){return as(f)?366:365}e.parseTwoDigitYear=function(f){return $e(f)+($e(f)>68?1900:2e3)};var Jm=so("FullYear",!0);function P_(){return as(this.year())}function D_(f,p,y,b,L,$,J){var Le;return f<100&&f>=0?(Le=new Date(f+400,p,y,b,L,$,J),isFinite(Le.getFullYear())&&Le.setFullYear(f)):Le=new Date(f,p,y,b,L,$,J),Le}function Pa(f){var p,y;return f<100&&f>=0?(y=Array.prototype.slice.call(arguments),y[0]=f+400,p=new Date(Date.UTC.apply(null,y)),isFinite(p.getUTCFullYear())&&p.setUTCFullYear(f)):p=new Date(Date.UTC.apply(null,arguments)),p}function Oi(f,p,y){var b=7+p-y,L=(7+Pa(f,0,b).getUTCDay()-p)%7;return-L+b-1}function Qm(f,p,y,b,L){var $=(7+y-b)%7,J=Oi(f,b,L),Le=1+7*(p-1)+$+J,He,rt;return Le<=0?(He=f-1,rt=Ta(He)+Le):Le>Ta(f)?(He=f+1,rt=Le-Ta(f)):(He=f,rt=Le),{year:He,dayOfYear:rt}}function Da(f,p,y){var b=Oi(f.year(),p,y),L=Math.floor((f.dayOfYear()-b-1)/7)+1,$,J;return L<1?(J=f.year()-1,$=L+Do(J,p,y)):L>Do(f.year(),p,y)?($=L-Do(f.year(),p,y),J=f.year()+1):(J=f.year(),$=L),{week:$,year:J}}function Do(f,p,y){var b=Oi(f,p,y),L=Oi(f+1,p,y);return(Ta(f)-b+L)/7}W("w",["ww",2],"wo","week"),W("W",["WW",2],"Wo","isoWeek"),at("week","w"),at("isoWeek","W"),Tt("week",5),Tt("isoWeek",5),ve("w",ue),ve("ww",ue,Vt),ve("W",ue),ve("WW",ue,Vt),La(["w","ww","W","WW"],function(f,p,y,b){p[b.substr(0,1)]=$e(f)});function F_(f){return Da(f,this._week.dow,this._week.doy).week}var A_={dow:0,doy:6};function E_(){return this._week.dow}function M_(){return this._week.doy}function R_(f){var p=this.localeData().week(this);return f==null?p:this.add((f-p)*7,"d")}function O_(f){var p=Da(this,1,4).week;return f==null?p:this.add((f-p)*7,"d")}W("d",0,"do","day"),W("dd",0,0,function(f){return this.localeData().weekdaysMin(this,f)}),W("ddd",0,0,function(f){return this.localeData().weekdaysShort(this,f)}),W("dddd",0,0,function(f){return this.localeData().weekdays(this,f)}),W("e",0,0,"weekday"),W("E",0,0,"isoWeekday"),at("day","d"),at("weekday","e"),at("isoWeekday","E"),Tt("day",11),Tt("weekday",11),Tt("isoWeekday",11),ve("d",ue),ve("e",ue),ve("E",ue),ve("dd",function(f,p){return p.weekdaysMinRegex(f)}),ve("ddd",function(f,p){return p.weekdaysShortRegex(f)}),ve("dddd",function(f,p){return p.weekdaysRegex(f)}),La(["dd","ddd","dddd"],function(f,p,y,b){var L=y._locale.weekdaysParse(f,b,y._strict);L!=null?p.d=L:h(y).invalidWeekday=f}),La(["d","e","E"],function(f,p,y,b){p[b]=$e(f)});function U_(f,p){return typeof f!="string"?f:isNaN(f)?(f=p.weekdaysParse(f),typeof f=="number"?f:null):parseInt(f,10)}function $_(f,p){return typeof f=="string"?p.weekdaysParse(f)%7||7:isNaN(f)?null:f}function sf(f,p){return f.slice(p,7).concat(f.slice(0,p))}var B_="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Xm="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),N_="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),H_=Ia,V_=Ia,q_=Ia;function W_(f,p){var y=r(this._weekdays)?this._weekdays:this._weekdays[f&&f!==!0&&this._weekdays.isFormat.test(p)?"format":"standalone"];return f===!0?sf(y,this._week.dow):f?y[f.day()]:y}function z_(f){return f===!0?sf(this._weekdaysShort,this._week.dow):f?this._weekdaysShort[f.day()]:this._weekdaysShort}function K_(f){return f===!0?sf(this._weekdaysMin,this._week.dow):f?this._weekdaysMin[f.day()]:this._weekdaysMin}function G_(f,p,y){var b,L,$,J=f.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],b=0;b<7;++b)$=m([2e3,1]).day(b),this._minWeekdaysParse[b]=this.weekdaysMin($,"").toLocaleLowerCase(),this._shortWeekdaysParse[b]=this.weekdaysShort($,"").toLocaleLowerCase(),this._weekdaysParse[b]=this.weekdays($,"").toLocaleLowerCase();return y?p==="dddd"?(L=kt.call(this._weekdaysParse,J),L!==-1?L:null):p==="ddd"?(L=kt.call(this._shortWeekdaysParse,J),L!==-1?L:null):(L=kt.call(this._minWeekdaysParse,J),L!==-1?L:null):p==="dddd"?(L=kt.call(this._weekdaysParse,J),L!==-1||(L=kt.call(this._shortWeekdaysParse,J),L!==-1)?L:(L=kt.call(this._minWeekdaysParse,J),L!==-1?L:null)):p==="ddd"?(L=kt.call(this._shortWeekdaysParse,J),L!==-1||(L=kt.call(this._weekdaysParse,J),L!==-1)?L:(L=kt.call(this._minWeekdaysParse,J),L!==-1?L:null)):(L=kt.call(this._minWeekdaysParse,J),L!==-1||(L=kt.call(this._weekdaysParse,J),L!==-1)?L:(L=kt.call(this._shortWeekdaysParse,J),L!==-1?L:null))}function j_(f,p,y){var b,L,$;if(this._weekdaysParseExact)return G_.call(this,f,p,y);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),b=0;b<7;b++){if(L=m([2e3,1]).day(b),y&&!this._fullWeekdaysParse[b]&&(this._fullWeekdaysParse[b]=new RegExp("^"+this.weekdays(L,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[b]=new RegExp("^"+this.weekdaysShort(L,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[b]=new RegExp("^"+this.weekdaysMin(L,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[b]||($="^"+this.weekdays(L,"")+"|^"+this.weekdaysShort(L,"")+"|^"+this.weekdaysMin(L,""),this._weekdaysParse[b]=new RegExp($.replace(".",""),"i")),y&&p==="dddd"&&this._fullWeekdaysParse[b].test(f))return b;if(y&&p==="ddd"&&this._shortWeekdaysParse[b].test(f))return b;if(y&&p==="dd"&&this._minWeekdaysParse[b].test(f))return b;if(!y&&this._weekdaysParse[b].test(f))return b}}function Y_(f){if(!this.isValid())return f!=null?this:NaN;var p=this._isUTC?this._d.getUTCDay():this._d.getDay();return f!=null?(f=U_(f,this.localeData()),this.add(f-p,"d")):p}function J_(f){if(!this.isValid())return f!=null?this:NaN;var p=(this.day()+7-this.localeData()._week.dow)%7;return f==null?p:this.add(f-p,"d")}function Q_(f){if(!this.isValid())return f!=null?this:NaN;if(f!=null){var p=$_(f,this.localeData());return this.day(this.day()%7?p:p-7)}else return this.day()||7}function X_(f){return this._weekdaysParseExact?(n(this,"_weekdaysRegex")||nf.call(this),f?this._weekdaysStrictRegex:this._weekdaysRegex):(n(this,"_weekdaysRegex")||(this._weekdaysRegex=H_),this._weekdaysStrictRegex&&f?this._weekdaysStrictRegex:this._weekdaysRegex)}function Z_(f){return this._weekdaysParseExact?(n(this,"_weekdaysRegex")||nf.call(this),f?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(n(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=V_),this._weekdaysShortStrictRegex&&f?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function eS(f){return this._weekdaysParseExact?(n(this,"_weekdaysRegex")||nf.call(this),f?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(n(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=q_),this._weekdaysMinStrictRegex&&f?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function nf(){function f(Zt,Ro){return Ro.length-Zt.length}var p=[],y=[],b=[],L=[],$,J,Le,He,rt;for($=0;$<7;$++)J=m([2e3,1]).day($),Le=br(this.weekdaysMin(J,"")),He=br(this.weekdaysShort(J,"")),rt=br(this.weekdays(J,"")),p.push(Le),y.push(He),b.push(rt),L.push(Le),L.push(He),L.push(rt);p.sort(f),y.sort(f),b.sort(f),L.sort(f),this._weekdaysRegex=new RegExp("^("+L.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+b.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+y.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+p.join("|")+")","i")}function af(){return this.hours()%12||12}function tS(){return this.hours()||24}W("H",["HH",2],0,"hour"),W("h",["hh",2],0,af),W("k",["kk",2],0,tS),W("hmm",0,0,function(){return""+af.apply(this)+ke(this.minutes(),2)}),W("hmmss",0,0,function(){return""+af.apply(this)+ke(this.minutes(),2)+ke(this.seconds(),2)}),W("Hmm",0,0,function(){return""+this.hours()+ke(this.minutes(),2)}),W("Hmmss",0,0,function(){return""+this.hours()+ke(this.minutes(),2)+ke(this.seconds(),2)});function Zm(f,p){W(f,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),p)})}Zm("a",!0),Zm("A",!1),at("hour","h"),Tt("hour",13);function eh(f,p){return p._meridiemParse}ve("a",eh),ve("A",eh),ve("H",ue),ve("h",ue),ve("k",ue),ve("HH",ue,Vt),ve("hh",ue,Vt),ve("kk",ue,Vt),ve("hmm",ot),ve("hmmss",Hr),ve("Hmm",ot),ve("Hmmss",Hr),tt(["H","HH"],Et),tt(["k","kk"],function(f,p,y){var b=$e(f);p[Et]=b===24?0:b}),tt(["a","A"],function(f,p,y){y._isPm=y._locale.isPM(f),y._meridiem=f}),tt(["h","hh"],function(f,p,y){p[Et]=$e(f),h(y).bigHour=!0}),tt("hmm",function(f,p,y){var b=f.length-2;p[Et]=$e(f.substr(0,b)),p[Vr]=$e(f.substr(b)),h(y).bigHour=!0}),tt("hmmss",function(f,p,y){var b=f.length-4,L=f.length-2;p[Et]=$e(f.substr(0,b)),p[Vr]=$e(f.substr(b,2)),p[Po]=$e(f.substr(L)),h(y).bigHour=!0}),tt("Hmm",function(f,p,y){var b=f.length-2;p[Et]=$e(f.substr(0,b)),p[Vr]=$e(f.substr(b))}),tt("Hmmss",function(f,p,y){var b=f.length-4,L=f.length-2;p[Et]=$e(f.substr(0,b)),p[Vr]=$e(f.substr(b,2)),p[Po]=$e(f.substr(L))});function rS(f){return(f+"").toLowerCase().charAt(0)==="p"}var oS=/[ap]\.?m?\.?/i,sS=so("Hours",!0);function nS(f,p,y){return f>11?y?"pm":"PM":y?"am":"AM"}var th={calendar:G,longDateFormat:_t,invalidDate:yt,ordinal:Ms,dayOfMonthOrdinalParse:Io,relativeTime:dn,months:b_,monthsShort:zm,week:A_,weekdays:B_,weekdaysMin:N_,weekdaysShort:Xm,meridiemParse:oS},ht={},Fa={},Aa;function aS(f,p){var y,b=Math.min(f.length,p.length);for(y=0;y<b;y+=1)if(f[y]!==p[y])return y;return b}function rh(f){return f&&f.toLowerCase().replace("_","-")}function iS(f){for(var p=0,y,b,L,$;p<f.length;){for($=rh(f[p]).split("-"),y=$.length,b=rh(f[p+1]),b=b?b.split("-"):null;y>0;){if(L=Ui($.slice(0,y).join("-")),L)return L;if(b&&b.length>=y&&aS($,b)>=y-1)break;y--}p++}return Aa}function lS(f){return f.match("^[^/\\\\]*$")!=null}function Ui(f){var p=null,y;if(ht[f]===void 0&&typeof ya!="undefined"&&ya&&ya.exports&&lS(f))try{p=Aa._abbr,y=require,y("./locale/"+f),cs(p)}catch(b){ht[f]=null}return ht[f]}function cs(f,p){var y;return f&&(i(p)?y=Fo(f):y=lf(f,p),y?Aa=y:typeof console!="undefined"&&console.warn&&console.warn("Locale "+f+" not found. Did you forget to load it?")),Aa._abbr}function lf(f,p){if(p!==null){var y,b=th;if(p.abbr=f,ht[f]!=null)q("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),b=ht[f]._config;else if(p.parentLocale!=null)if(ht[p.parentLocale]!=null)b=ht[p.parentLocale]._config;else if(y=Ui(p.parentLocale),y!=null)b=y._config;else return Fa[p.parentLocale]||(Fa[p.parentLocale]=[]),Fa[p.parentLocale].push({name:f,config:p}),null;return ht[f]=new pe(Y(b,p)),Fa[f]&&Fa[f].forEach(function(L){lf(L.name,L.config)}),cs(f),ht[f]}else return delete ht[f],null}function cS(f,p){if(p!=null){var y,b,L=th;ht[f]!=null&&ht[f].parentLocale!=null?ht[f].set(Y(ht[f]._config,p)):(b=Ui(f),b!=null&&(L=b._config),p=Y(L,p),b==null&&(p.abbr=f),y=new pe(p),y.parentLocale=ht[f],ht[f]=y),cs(f)}else ht[f]!=null&&(ht[f].parentLocale!=null?(ht[f]=ht[f].parentLocale,f===cs()&&cs(f)):ht[f]!=null&&delete ht[f]);return ht[f]}function Fo(f){var p;if(f&&f._locale&&f._locale._abbr&&(f=f._locale._abbr),!f)return Aa;if(!r(f)){if(p=Ui(f),p)return p;f=[f]}return iS(f)}function fS(){return De(ht)}function cf(f){var p,y=f._a;return y&&h(f).overflow===-2&&(p=y[To]<0||y[To]>11?To:y[ao]<1||y[ao]>Ri(y[Jt],y[To])?ao:y[Et]<0||y[Et]>24||y[Et]===24&&(y[Vr]!==0||y[Po]!==0||y[Os]!==0)?Et:y[Vr]<0||y[Vr]>59?Vr:y[Po]<0||y[Po]>59?Po:y[Os]<0||y[Os]>999?Os:-1,h(f)._overflowDayOfYear&&(p<Jt||p>ao)&&(p=ao),h(f)._overflowWeeks&&p===-1&&(p=g_),h(f)._overflowWeekday&&p===-1&&(p=y_),h(f).overflow=p),f}var uS=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,dS=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,pS=/Z|[+-]\d\d(?::?\d\d)?/,$i=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],ff=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],mS=/^\/?Date\((-?\d+)/i,hS=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,gS={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function oh(f){var p,y,b=f._i,L=uS.exec(b)||dS.exec(b),$,J,Le,He,rt=$i.length,Zt=ff.length;if(L){for(h(f).iso=!0,p=0,y=rt;p<y;p++)if($i[p][1].exec(L[1])){J=$i[p][0],$=$i[p][2]!==!1;break}if(J==null){f._isValid=!1;return}if(L[3]){for(p=0,y=Zt;p<y;p++)if(ff[p][1].exec(L[3])){Le=(L[2]||" ")+ff[p][0];break}if(Le==null){f._isValid=!1;return}}if(!$&&Le!=null){f._isValid=!1;return}if(L[4])if(pS.exec(L[4]))He="Z";else{f._isValid=!1;return}f._f=J+(Le||"")+(He||""),df(f)}else f._isValid=!1}function yS(f,p,y,b,L,$){var J=[xS(f),zm.indexOf(p),parseInt(y,10),parseInt(b,10),parseInt(L,10)];return $&&J.push(parseInt($,10)),J}function xS(f){var p=parseInt(f,10);return p<=49?2e3+p:p<=999?1900+p:p}function bS(f){return f.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function wS(f,p,y){if(f){var b=Xm.indexOf(f),L=new Date(p[0],p[1],p[2]).getDay();if(b!==L)return h(y).weekdayMismatch=!0,y._isValid=!1,!1}return!0}function vS(f,p,y){if(f)return gS[f];if(p)return 0;var b=parseInt(y,10),L=b%100,$=(b-L)/100;return $*60+L}function sh(f){var p=hS.exec(bS(f._i)),y;if(p){if(y=yS(p[4],p[3],p[2],p[5],p[6],p[7]),!wS(p[1],y,f))return;f._a=y,f._tzm=vS(p[8],p[9],p[10]),f._d=Pa.apply(null,f._a),f._d.setUTCMinutes(f._d.getUTCMinutes()-f._tzm),h(f).rfc2822=!0}else f._isValid=!1}function _S(f){var p=mS.exec(f._i);if(p!==null){f._d=new Date(+p[1]);return}if(oh(f),f._isValid===!1)delete f._isValid;else return;if(sh(f),f._isValid===!1)delete f._isValid;else return;f._strict?f._isValid=!1:e.createFromInputFallback(f)}e.createFromInputFallback=F("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(f){f._d=new Date(f._i+(f._useUTC?" UTC":""))});function yn(f,p,y){return f!=null?f:p!=null?p:y}function SS(f){var p=new Date(e.now());return f._useUTC?[p.getUTCFullYear(),p.getUTCMonth(),p.getUTCDate()]:[p.getFullYear(),p.getMonth(),p.getDate()]}function uf(f){var p,y,b=[],L,$,J;if(!f._d){for(L=SS(f),f._w&&f._a[ao]==null&&f._a[To]==null&&kS(f),f._dayOfYear!=null&&(J=yn(f._a[Jt],L[Jt]),(f._dayOfYear>Ta(J)||f._dayOfYear===0)&&(h(f)._overflowDayOfYear=!0),y=Pa(J,0,f._dayOfYear),f._a[To]=y.getUTCMonth(),f._a[ao]=y.getUTCDate()),p=0;p<3&&f._a[p]==null;++p)f._a[p]=b[p]=L[p];for(;p<7;p++)f._a[p]=b[p]=f._a[p]==null?p===2?1:0:f._a[p];f._a[Et]===24&&f._a[Vr]===0&&f._a[Po]===0&&f._a[Os]===0&&(f._nextDay=!0,f._a[Et]=0),f._d=(f._useUTC?Pa:D_).apply(null,b),$=f._useUTC?f._d.getUTCDay():f._d.getDay(),f._tzm!=null&&f._d.setUTCMinutes(f._d.getUTCMinutes()-f._tzm),f._nextDay&&(f._a[Et]=24),f._w&&typeof f._w.d!="undefined"&&f._w.d!==$&&(h(f).weekdayMismatch=!0)}}function kS(f){var p,y,b,L,$,J,Le,He,rt;p=f._w,p.GG!=null||p.W!=null||p.E!=null?($=1,J=4,y=yn(p.GG,f._a[Jt],Da(ut(),1,4).year),b=yn(p.W,1),L=yn(p.E,1),(L<1||L>7)&&(He=!0)):($=f._locale._week.dow,J=f._locale._week.doy,rt=Da(ut(),$,J),y=yn(p.gg,f._a[Jt],rt.year),b=yn(p.w,rt.week),p.d!=null?(L=p.d,(L<0||L>6)&&(He=!0)):p.e!=null?(L=p.e+$,(p.e<0||p.e>6)&&(He=!0)):L=$),b<1||b>Do(y,$,J)?h(f)._overflowWeeks=!0:He!=null?h(f)._overflowWeekday=!0:(Le=Qm(y,b,L,$,J),f._a[Jt]=Le.year,f._dayOfYear=Le.dayOfYear)}e.ISO_8601=function(){},e.RFC_2822=function(){};function df(f){if(f._f===e.ISO_8601){oh(f);return}if(f._f===e.RFC_2822){sh(f);return}f._a=[],h(f).empty=!0;var p=""+f._i,y,b,L,$,J,Le=p.length,He=0,rt,Zt;for(L=mt(f._f,f._locale).match(Qe)||[],Zt=L.length,y=0;y<Zt;y++)$=L[y],b=(p.match(p_($,f))||[])[0],b&&(J=p.substr(0,p.indexOf(b)),J.length>0&&h(f).unusedInput.push(J),p=p.slice(p.indexOf(b)+b.length),He+=b.length),le[$]?(b?h(f).empty=!1:h(f).unusedTokens.push($),h_($,b,f)):f._strict&&!b&&h(f).unusedTokens.push($);h(f).charsLeftOver=Le-He,p.length>0&&h(f).unusedInput.push(p),f._a[Et]<=12&&h(f).bigHour===!0&&f._a[Et]>0&&(h(f).bigHour=void 0),h(f).parsedDateParts=f._a.slice(0),h(f).meridiem=f._meridiem,f._a[Et]=CS(f._locale,f._a[Et],f._meridiem),rt=h(f).era,rt!==null&&(f._a[Jt]=f._locale.erasConvertYear(rt,f._a[Jt])),uf(f),cf(f)}function CS(f,p,y){var b;return y==null?p:f.meridiemHour!=null?f.meridiemHour(p,y):(f.isPM!=null&&(b=f.isPM(y),b&&p<12&&(p+=12),!b&&p===12&&(p=0)),p)}function IS(f){var p,y,b,L,$,J,Le=!1,He=f._f.length;if(He===0){h(f).invalidFormat=!0,f._d=new Date(NaN);return}for(L=0;L<He;L++)$=0,J=!1,p=E({},f),f._useUTC!=null&&(p._useUTC=f._useUTC),p._f=f._f[L],df(p),w(p)&&(J=!0),$+=h(p).charsLeftOver,$+=h(p).unusedTokens.length*10,h(p).score=$,Le?$<b&&(b=$,y=p):(b==null||$<b||J)&&(b=$,y=p,J&&(Le=!0));d(f,y||p)}function LS(f){if(!f._d){var p=Lo(f._i),y=p.day===void 0?p.date:p.day;f._a=u([p.year,p.month,y,p.hour,p.minute,p.second,p.millisecond],function(b){return b&&parseInt(b,10)}),uf(f)}}function TS(f){var p=new M(cf(nh(f)));return p._nextDay&&(p.add(1,"d"),p._nextDay=void 0),p}function nh(f){var p=f._i,y=f._f;return f._locale=f._locale||Fo(f._l),p===null||y===void 0&&p===""?v({nullInput:!0}):(typeof p=="string"&&(f._i=p=f._locale.preparse(p)),R(p)?new M(cf(p)):(c(p)?f._d=p:r(y)?IS(f):y?df(f):PS(f),w(f)||(f._d=null),f))}function PS(f){var p=f._i;i(p)?f._d=new Date(e.now()):c(p)?f._d=new Date(p.valueOf()):typeof p=="string"?_S(f):r(p)?(f._a=u(p.slice(0),function(y){return parseInt(y,10)}),uf(f)):s(p)?LS(f):l(p)?f._d=new Date(p):e.createFromInputFallback(f)}function ah(f,p,y,b,L){var $={};return(p===!0||p===!1)&&(b=p,p=void 0),(y===!0||y===!1)&&(b=y,y=void 0),(s(f)&&a(f)||r(f)&&f.length===0)&&(f=void 0),$._isAMomentObject=!0,$._useUTC=$._isUTC=L,$._l=y,$._i=f,$._f=p,$._strict=b,TS($)}function ut(f,p,y,b){return ah(f,p,y,b,!1)}var DS=F("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var f=ut.apply(null,arguments);return this.isValid()&&f.isValid()?f<this?this:f:v()}),FS=F("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var f=ut.apply(null,arguments);return this.isValid()&&f.isValid()?f>this?this:f:v()});function ih(f,p){var y,b;if(p.length===1&&r(p[0])&&(p=p[0]),!p.length)return ut();for(y=p[0],b=1;b<p.length;++b)(!p[b].isValid()||p[b][f](y))&&(y=p[b]);return y}function AS(){var f=[].slice.call(arguments,0);return ih("isBefore",f)}function ES(){var f=[].slice.call(arguments,0);return ih("isAfter",f)}var MS=function(){return Date.now?Date.now():+new Date},Ea=["year","quarter","month","week","day","hour","minute","second","millisecond"];function RS(f){var p,y=!1,b,L=Ea.length;for(p in f)if(n(f,p)&&!(kt.call(Ea,p)!==-1&&(f[p]==null||!isNaN(f[p]))))return!1;for(b=0;b<L;++b)if(f[Ea[b]]){if(y)return!1;parseFloat(f[Ea[b]])!==$e(f[Ea[b]])&&(y=!0)}return!0}function OS(){return this._isValid}function US(){return qr(NaN)}function Bi(f){var p=Lo(f),y=p.year||0,b=p.quarter||0,L=p.month||0,$=p.week||p.isoWeek||0,J=p.day||0,Le=p.hour||0,He=p.minute||0,rt=p.second||0,Zt=p.millisecond||0;this._isValid=RS(p),this._milliseconds=+Zt+rt*1e3+He*6e4+Le*1e3*60*60,this._days=+J+$*7,this._months=+L+b*3+y*12,this._data={},this._locale=Fo(),this._bubble()}function Ni(f){return f instanceof Bi}function pf(f){return f<0?Math.round(-1*f)*-1:Math.round(f)}function $S(f,p,y){var b=Math.min(f.length,p.length),L=Math.abs(f.length-p.length),$=0,J;for(J=0;J<b;J++)(y&&f[J]!==p[J]||!y&&$e(f[J])!==$e(p[J]))&&$++;return $+L}function lh(f,p){W(f,0,0,function(){var y=this.utcOffset(),b="+";return y<0&&(y=-y,b="-"),b+ke(~~(y/60),2)+p+ke(~~y%60,2)})}lh("Z",":"),lh("ZZ",""),ve("Z",ls),ve("ZZ",ls),tt(["Z","ZZ"],function(f,p,y){y._useUTC=!0,y._tzm=mf(ls,f)});var BS=/([\+\-]|\d\d)/gi;function mf(f,p){var y=(p||"").match(f),b,L,$;return y===null?null:(b=y[y.length-1]||[],L=(b+"").match(BS)||["-",0,0],$=+(L[1]*60)+$e(L[2]),$===0?0:L[0]==="+"?$:-$)}function hf(f,p){var y,b;return p._isUTC?(y=p.clone(),b=(R(f)||c(f)?f.valueOf():ut(f).valueOf())-y.valueOf(),y._d.setTime(y._d.valueOf()+b),e.updateOffset(y,!1),y):ut(f).local()}function gf(f){return-Math.round(f._d.getTimezoneOffset())}e.updateOffset=function(){};function NS(f,p,y){var b=this._offset||0,L;if(!this.isValid())return f!=null?this:NaN;if(f!=null){if(typeof f=="string"){if(f=mf(ls,f),f===null)return this}else Math.abs(f)<16&&!y&&(f=f*60);return!this._isUTC&&p&&(L=gf(this)),this._offset=f,this._isUTC=!0,L!=null&&this.add(L,"m"),b!==f&&(!p||this._changeInProgress?dh(this,qr(f-b,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,e.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?b:gf(this)}function HS(f,p){return f!=null?(typeof f!="string"&&(f=-f),this.utcOffset(f,p),this):-this.utcOffset()}function VS(f){return this.utcOffset(0,f)}function qS(f){return this._isUTC&&(this.utcOffset(0,f),this._isUTC=!1,f&&this.subtract(gf(this),"m")),this}function WS(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var f=mf(rf,this._i);f!=null?this.utcOffset(f):this.utcOffset(0,!0)}return this}function zS(f){return this.isValid()?(f=f?ut(f).utcOffset():0,(this.utcOffset()-f)%60===0):!1}function KS(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function GS(){if(!i(this._isDSTShifted))return this._isDSTShifted;var f={},p;return E(f,this),f=nh(f),f._a?(p=f._isUTC?m(f._a):ut(f._a),this._isDSTShifted=this.isValid()&&$S(f._a,p.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function jS(){return this.isValid()?!this._isUTC:!1}function YS(){return this.isValid()?this._isUTC:!1}function ch(){return this.isValid()?this._isUTC&&this._offset===0:!1}var JS=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,QS=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function qr(f,p){var y=f,b=null,L,$,J;return Ni(f)?y={ms:f._milliseconds,d:f._days,M:f._months}:l(f)||!isNaN(+f)?(y={},p?y[p]=+f:y.milliseconds=+f):(b=JS.exec(f))?(L=b[1]==="-"?-1:1,y={y:0,d:$e(b[ao])*L,h:$e(b[Et])*L,m:$e(b[Vr])*L,s:$e(b[Po])*L,ms:$e(pf(b[Os]*1e3))*L}):(b=QS.exec(f))?(L=b[1]==="-"?-1:1,y={y:Us(b[2],L),M:Us(b[3],L),w:Us(b[4],L),d:Us(b[5],L),h:Us(b[6],L),m:Us(b[7],L),s:Us(b[8],L)}):y==null?y={}:typeof y=="object"&&("from"in y||"to"in y)&&(J=XS(ut(y.from),ut(y.to)),y={},y.ms=J.milliseconds,y.M=J.months),$=new Bi(y),Ni(f)&&n(f,"_locale")&&($._locale=f._locale),Ni(f)&&n(f,"_isValid")&&($._isValid=f._isValid),$}qr.fn=Bi.prototype,qr.invalid=US;function Us(f,p){var y=f&&parseFloat(f.replace(",","."));return(isNaN(y)?0:y)*p}function fh(f,p){var y={};return y.months=p.month()-f.month()+(p.year()-f.year())*12,f.clone().add(y.months,"M").isAfter(p)&&--y.months,y.milliseconds=+p-+f.clone().add(y.months,"M"),y}function XS(f,p){var y;return f.isValid()&&p.isValid()?(p=hf(p,f),f.isBefore(p)?y=fh(f,p):(y=fh(p,f),y.milliseconds=-y.milliseconds,y.months=-y.months),y):{milliseconds:0,months:0}}function uh(f,p){return function(y,b){var L,$;return b!==null&&!isNaN(+b)&&(q(p,"moment()."+p+"(period, number) is deprecated. Please use moment()."+p+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),$=y,y=b,b=$),L=qr(y,b),dh(this,L,f),this}}function dh(f,p,y,b){var L=p._milliseconds,$=pf(p._days),J=pf(p._months);f.isValid()&&(b=b==null?!0:b,J&&Gm(f,is(f,"Month")+J*y),$&&mn(f,"Date",is(f,"Date")+$*y),L&&f._d.setTime(f._d.valueOf()+L*y),b&&e.updateOffset(f,$||J))}var ZS=uh(1,"add"),e1=uh(-1,"subtract");function ph(f){return typeof f=="string"||f instanceof String}function t1(f){return R(f)||c(f)||ph(f)||l(f)||o1(f)||r1(f)||f===null||f===void 0}function r1(f){var p=s(f)&&!a(f),y=!1,b=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],L,$,J=b.length;for(L=0;L<J;L+=1)$=b[L],y=y||n(f,$);return p&&y}function o1(f){var p=r(f),y=!1;return p&&(y=f.filter(function(b){return!l(b)&&ph(f)}).length===0),p&&y}function s1(f){var p=s(f)&&!a(f),y=!1,b=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],L,$;for(L=0;L<b.length;L+=1)$=b[L],y=y||n(f,$);return p&&y}function n1(f,p){var y=f.diff(p,"days",!0);return y<-6?"sameElse":y<-1?"lastWeek":y<0?"lastDay":y<1?"sameDay":y<2?"nextDay":y<7?"nextWeek":"sameElse"}function a1(f,p){arguments.length===1&&(arguments[0]?t1(arguments[0])?(f=arguments[0],p=void 0):s1(arguments[0])&&(p=arguments[0],f=void 0):(f=void 0,p=void 0));var y=f||ut(),b=hf(y,this).startOf("day"),L=e.calendarFormat(this,b)||"sameElse",$=p&&(j(p[L])?p[L].call(this,y):p[L]);return this.format($||this.localeData().calendar(L,this,ut(y)))}function i1(){return new M(this)}function l1(f,p){var y=R(f)?f:ut(f);return this.isValid()&&y.isValid()?(p=Xt(p)||"millisecond",p==="millisecond"?this.valueOf()>y.valueOf():y.valueOf()<this.clone().startOf(p).valueOf()):!1}function c1(f,p){var y=R(f)?f:ut(f);return this.isValid()&&y.isValid()?(p=Xt(p)||"millisecond",p==="millisecond"?this.valueOf()<y.valueOf():this.clone().endOf(p).valueOf()<y.valueOf()):!1}function f1(f,p,y,b){var L=R(f)?f:ut(f),$=R(p)?p:ut(p);return this.isValid()&&L.isValid()&&$.isValid()?(b=b||"()",(b[0]==="("?this.isAfter(L,y):!this.isBefore(L,y))&&(b[1]===")"?this.isBefore($,y):!this.isAfter($,y))):!1}function u1(f,p){var y=R(f)?f:ut(f),b;return this.isValid()&&y.isValid()?(p=Xt(p)||"millisecond",p==="millisecond"?this.valueOf()===y.valueOf():(b=y.valueOf(),this.clone().startOf(p).valueOf()<=b&&b<=this.clone().endOf(p).valueOf())):!1}function d1(f,p){return this.isSame(f,p)||this.isAfter(f,p)}function p1(f,p){return this.isSame(f,p)||this.isBefore(f,p)}function m1(f,p,y){var b,L,$;if(!this.isValid())return NaN;if(b=hf(f,this),!b.isValid())return NaN;switch(L=(b.utcOffset()-this.utcOffset())*6e4,p=Xt(p),p){case"year":$=Hi(this,b)/12;break;case"month":$=Hi(this,b);break;case"quarter":$=Hi(this,b)/3;break;case"second":$=(this-b)/1e3;break;case"minute":$=(this-b)/6e4;break;case"hour":$=(this-b)/36e5;break;case"day":$=(this-b-L)/864e5;break;case"week":$=(this-b-L)/6048e5;break;default:$=this-b}return y?$:Yt($)}function Hi(f,p){if(f.date()<p.date())return-Hi(p,f);var y=(p.year()-f.year())*12+(p.month()-f.month()),b=f.clone().add(y,"months"),L,$;return p-b<0?(L=f.clone().add(y-1,"months"),$=(p-b)/(b-L)):(L=f.clone().add(y+1,"months"),$=(p-b)/(L-b)),-(y+$)||0}e.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",e.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function h1(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function g1(f){if(!this.isValid())return null;var p=f!==!0,y=p?this.clone().utc():this;return y.year()<0||y.year()>9999?vt(y,p?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):j(Date.prototype.toISOString)?p?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",vt(y,"Z")):vt(y,p?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function y1(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var f="moment",p="",y,b,L,$;return this.isLocal()||(f=this.utcOffset()===0?"moment.utc":"moment.parseZone",p="Z"),y="["+f+'("]',b=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",L="-MM-DD[T]HH:mm:ss.SSS",$=p+'[")]',this.format(y+b+L+$)}function x1(f){f||(f=this.isUtc()?e.defaultFormatUtc:e.defaultFormat);var p=vt(this,f);return this.localeData().postformat(p)}function b1(f,p){return this.isValid()&&(R(f)&&f.isValid()||ut(f).isValid())?qr({to:this,from:f}).locale(this.locale()).humanize(!p):this.localeData().invalidDate()}function w1(f){return this.from(ut(),f)}function v1(f,p){return this.isValid()&&(R(f)&&f.isValid()||ut(f).isValid())?qr({from:this,to:f}).locale(this.locale()).humanize(!p):this.localeData().invalidDate()}function _1(f){return this.to(ut(),f)}function mh(f){var p;return f===void 0?this._locale._abbr:(p=Fo(f),p!=null&&(this._locale=p),this)}var hh=F("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(f){return f===void 0?this.localeData():this.locale(f)});function gh(){return this._locale}var Vi=1e3,xn=60*Vi,qi=60*xn,yh=(365*400+97)*24*qi;function bn(f,p){return(f%p+p)%p}function xh(f,p,y){return f<100&&f>=0?new Date(f+400,p,y)-yh:new Date(f,p,y).valueOf()}function bh(f,p,y){return f<100&&f>=0?Date.UTC(f+400,p,y)-yh:Date.UTC(f,p,y)}function S1(f){var p,y;if(f=Xt(f),f===void 0||f==="millisecond"||!this.isValid())return this;switch(y=this._isUTC?bh:xh,f){case"year":p=y(this.year(),0,1);break;case"quarter":p=y(this.year(),this.month()-this.month()%3,1);break;case"month":p=y(this.year(),this.month(),1);break;case"week":p=y(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":p=y(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":p=y(this.year(),this.month(),this.date());break;case"hour":p=this._d.valueOf(),p-=bn(p+(this._isUTC?0:this.utcOffset()*xn),qi);break;case"minute":p=this._d.valueOf(),p-=bn(p,xn);break;case"second":p=this._d.valueOf(),p-=bn(p,Vi);break}return this._d.setTime(p),e.updateOffset(this,!0),this}function k1(f){var p,y;if(f=Xt(f),f===void 0||f==="millisecond"||!this.isValid())return this;switch(y=this._isUTC?bh:xh,f){case"year":p=y(this.year()+1,0,1)-1;break;case"quarter":p=y(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":p=y(this.year(),this.month()+1,1)-1;break;case"week":p=y(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":p=y(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":p=y(this.year(),this.month(),this.date()+1)-1;break;case"hour":p=this._d.valueOf(),p+=qi-bn(p+(this._isUTC?0:this.utcOffset()*xn),qi)-1;break;case"minute":p=this._d.valueOf(),p+=xn-bn(p,xn)-1;break;case"second":p=this._d.valueOf(),p+=Vi-bn(p,Vi)-1;break}return this._d.setTime(p),e.updateOffset(this,!0),this}function C1(){return this._d.valueOf()-(this._offset||0)*6e4}function I1(){return Math.floor(this.valueOf()/1e3)}function L1(){return new Date(this.valueOf())}function T1(){var f=this;return[f.year(),f.month(),f.date(),f.hour(),f.minute(),f.second(),f.millisecond()]}function P1(){var f=this;return{years:f.year(),months:f.month(),date:f.date(),hours:f.hours(),minutes:f.minutes(),seconds:f.seconds(),milliseconds:f.milliseconds()}}function D1(){return this.isValid()?this.toISOString():null}function F1(){return w(this)}function A1(){return d({},h(this))}function E1(){return h(this).overflow}function M1(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}W("N",0,0,"eraAbbr"),W("NN",0,0,"eraAbbr"),W("NNN",0,0,"eraAbbr"),W("NNNN",0,0,"eraName"),W("NNNNN",0,0,"eraNarrow"),W("y",["y",1],"yo","eraYear"),W("y",["yy",2],0,"eraYear"),W("y",["yyy",3],0,"eraYear"),W("y",["yyyy",4],0,"eraYear"),ve("N",yf),ve("NN",yf),ve("NNN",yf),ve("NNNN",z1),ve("NNNNN",K1),tt(["N","NN","NNN","NNNN","NNNNN"],function(f,p,y,b){var L=y._locale.erasParse(f,b,y._strict);L?h(y).era=L:h(y).invalidEra=f}),ve("y",Pt),ve("yy",Pt),ve("yyy",Pt),ve("yyyy",Pt),ve("yo",G1),tt(["y","yy","yyy","yyyy"],Jt),tt(["yo"],function(f,p,y,b){var L;y._locale._eraYearOrdinalRegex&&(L=f.match(y._locale._eraYearOrdinalRegex)),y._locale.eraYearOrdinalParse?p[Jt]=y._locale.eraYearOrdinalParse(f,L):p[Jt]=parseInt(f,10)});function R1(f,p){var y,b,L,$=this._eras||Fo("en")._eras;for(y=0,b=$.length;y<b;++y){switch(typeof $[y].since){case"string":L=e($[y].since).startOf("day"),$[y].since=L.valueOf();break}switch(typeof $[y].until){case"undefined":$[y].until=1/0;break;case"string":L=e($[y].until).startOf("day").valueOf(),$[y].until=L.valueOf();break}}return $}function O1(f,p,y){var b,L,$=this.eras(),J,Le,He;for(f=f.toUpperCase(),b=0,L=$.length;b<L;++b)if(J=$[b].name.toUpperCase(),Le=$[b].abbr.toUpperCase(),He=$[b].narrow.toUpperCase(),y)switch(p){case"N":case"NN":case"NNN":if(Le===f)return $[b];break;case"NNNN":if(J===f)return $[b];break;case"NNNNN":if(He===f)return $[b];break}else if([J,Le,He].indexOf(f)>=0)return $[b]}function U1(f,p){var y=f.since<=f.until?1:-1;return p===void 0?e(f.since).year():e(f.since).year()+(p-f.offset)*y}function $1(){var f,p,y,b=this.localeData().eras();for(f=0,p=b.length;f<p;++f)if(y=this.clone().startOf("day").valueOf(),b[f].since<=y&&y<=b[f].until||b[f].until<=y&&y<=b[f].since)return b[f].name;return""}function B1(){var f,p,y,b=this.localeData().eras();for(f=0,p=b.length;f<p;++f)if(y=this.clone().startOf("day").valueOf(),b[f].since<=y&&y<=b[f].until||b[f].until<=y&&y<=b[f].since)return b[f].narrow;return""}function N1(){var f,p,y,b=this.localeData().eras();for(f=0,p=b.length;f<p;++f)if(y=this.clone().startOf("day").valueOf(),b[f].since<=y&&y<=b[f].until||b[f].until<=y&&y<=b[f].since)return b[f].abbr;return""}function H1(){var f,p,y,b,L=this.localeData().eras();for(f=0,p=L.length;f<p;++f)if(y=L[f].since<=L[f].until?1:-1,b=this.clone().startOf("day").valueOf(),L[f].since<=b&&b<=L[f].until||L[f].until<=b&&b<=L[f].since)return(this.year()-e(L[f].since).year())*y+L[f].offset;return this.year()}function V1(f){return n(this,"_erasNameRegex")||xf.call(this),f?this._erasNameRegex:this._erasRegex}function q1(f){return n(this,"_erasAbbrRegex")||xf.call(this),f?this._erasAbbrRegex:this._erasRegex}function W1(f){return n(this,"_erasNarrowRegex")||xf.call(this),f?this._erasNarrowRegex:this._erasRegex}function yf(f,p){return p.erasAbbrRegex(f)}function z1(f,p){return p.erasNameRegex(f)}function K1(f,p){return p.erasNarrowRegex(f)}function G1(f,p){return p._eraYearOrdinalRegex||Pt}function xf(){var f=[],p=[],y=[],b=[],L,$,J=this.eras();for(L=0,$=J.length;L<$;++L)p.push(br(J[L].name)),f.push(br(J[L].abbr)),y.push(br(J[L].narrow)),b.push(br(J[L].name)),b.push(br(J[L].abbr)),b.push(br(J[L].narrow));this._erasRegex=new RegExp("^("+b.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+p.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+f.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+y.join("|")+")","i")}W(0,["gg",2],0,function(){return this.weekYear()%100}),W(0,["GG",2],0,function(){return this.isoWeekYear()%100});function Wi(f,p){W(0,[f,f.length],0,p)}Wi("gggg","weekYear"),Wi("ggggg","weekYear"),Wi("GGGG","isoWeekYear"),Wi("GGGGG","isoWeekYear"),at("weekYear","gg"),at("isoWeekYear","GG"),Tt("weekYear",1),Tt("isoWeekYear",1),ve("G",no),ve("g",no),ve("GG",ue,Vt),ve("gg",ue,Vt),ve("GGGG",Oe,Rs),ve("gggg",Oe,Rs),ve("GGGGG",ft,Q),ve("ggggg",ft,Q),La(["gggg","ggggg","GGGG","GGGGG"],function(f,p,y,b){p[b.substr(0,2)]=$e(f)}),La(["gg","GG"],function(f,p,y,b){p[b]=e.parseTwoDigitYear(f)});function j1(f){return wh.call(this,f,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function Y1(f){return wh.call(this,f,this.isoWeek(),this.isoWeekday(),1,4)}function J1(){return Do(this.year(),1,4)}function Q1(){return Do(this.isoWeekYear(),1,4)}function X1(){var f=this.localeData()._week;return Do(this.year(),f.dow,f.doy)}function Z1(){var f=this.localeData()._week;return Do(this.weekYear(),f.dow,f.doy)}function wh(f,p,y,b,L){var $;return f==null?Da(this,b,L).year:($=Do(f,b,L),p>$&&(p=$),e0.call(this,f,p,y,b,L))}function e0(f,p,y,b,L){var $=Qm(f,p,y,b,L),J=Pa($.year,0,$.dayOfYear);return this.year(J.getUTCFullYear()),this.month(J.getUTCMonth()),this.date(J.getUTCDate()),this}W("Q",0,"Qo","quarter"),at("quarter","Q"),Tt("quarter",7),ve("Q",hn),tt("Q",function(f,p){p[To]=($e(f)-1)*3});function t0(f){return f==null?Math.ceil((this.month()+1)/3):this.month((f-1)*3+this.month()%3)}W("D",["DD",2],"Do","date"),at("date","D"),Tt("date",9),ve("D",ue),ve("DD",ue,Vt),ve("Do",function(f,p){return f?p._dayOfMonthOrdinalParse||p._ordinalParse:p._dayOfMonthOrdinalParseLenient}),tt(["D","DD"],ao),tt("Do",function(f,p){p[ao]=$e(f.match(ue)[0])});var vh=so("Date",!0);W("DDD",["DDDD",3],"DDDo","dayOfYear"),at("dayOfYear","DDD"),Tt("dayOfYear",4),ve("DDD",re),ve("DDDD",gn),tt(["DDD","DDDD"],function(f,p,y){y._dayOfYear=$e(f)});function r0(f){var p=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return f==null?p:this.add(f-p,"d")}W("m",["mm",2],0,"minute"),at("minute","m"),Tt("minute",14),ve("m",ue),ve("mm",ue,Vt),tt(["m","mm"],Vr);var o0=so("Minutes",!1);W("s",["ss",2],0,"second"),at("second","s"),Tt("second",15),ve("s",ue),ve("ss",ue,Vt),tt(["s","ss"],Po);var s0=so("Seconds",!1);W("S",0,0,function(){return~~(this.millisecond()/100)}),W(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),W(0,["SSS",3],0,"millisecond"),W(0,["SSSS",4],0,function(){return this.millisecond()*10}),W(0,["SSSSS",5],0,function(){return this.millisecond()*100}),W(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3}),W(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4}),W(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5}),W(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6}),at("millisecond","ms"),Tt("millisecond",16),ve("S",re,hn),ve("SS",re,Vt),ve("SSS",re,gn);var fs,_h;for(fs="SSSS";fs.length<=9;fs+="S")ve(fs,Pt);function n0(f,p){p[Os]=$e(("0."+f)*1e3)}for(fs="S";fs.length<=9;fs+="S")tt(fs,n0);_h=so("Milliseconds",!1),W("z",0,0,"zoneAbbr"),W("zz",0,0,"zoneName");function a0(){return this._isUTC?"UTC":""}function i0(){return this._isUTC?"Coordinated Universal Time":""}var ie=M.prototype;ie.add=ZS,ie.calendar=a1,ie.clone=i1,ie.diff=m1,ie.endOf=k1,ie.format=x1,ie.from=b1,ie.fromNow=w1,ie.to=v1,ie.toNow=_1,ie.get=ka,ie.invalidAt=E1,ie.isAfter=l1,ie.isBefore=c1,ie.isBetween=f1,ie.isSame=u1,ie.isSameOrAfter=d1,ie.isSameOrBefore=p1,ie.isValid=F1,ie.lang=hh,ie.locale=mh,ie.localeData=gh,ie.max=FS,ie.min=DS,ie.parsingFlags=A1,ie.set=Ca,ie.startOf=S1,ie.subtract=e1,ie.toArray=T1,ie.toObject=P1,ie.toDate=L1,ie.toISOString=g1,ie.inspect=y1,typeof Symbol!="undefined"&&Symbol.for!=null&&(ie[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),ie.toJSON=D1,ie.toString=h1,ie.unix=I1,ie.valueOf=C1,ie.creationData=M1,ie.eraName=$1,ie.eraNarrow=B1,ie.eraAbbr=N1,ie.eraYear=H1,ie.year=Jm,ie.isLeapYear=P_,ie.weekYear=j1,ie.isoWeekYear=Y1,ie.quarter=ie.quarters=t0,ie.month=jm,ie.daysInMonth=I_,ie.week=ie.weeks=R_,ie.isoWeek=ie.isoWeeks=O_,ie.weeksInYear=X1,ie.weeksInWeekYear=Z1,ie.isoWeeksInYear=J1,ie.isoWeeksInISOWeekYear=Q1,ie.date=vh,ie.day=ie.days=Y_,ie.weekday=J_,ie.isoWeekday=Q_,ie.dayOfYear=r0,ie.hour=ie.hours=sS,ie.minute=ie.minutes=o0,ie.second=ie.seconds=s0,ie.millisecond=ie.milliseconds=_h,ie.utcOffset=NS,ie.utc=VS,ie.local=qS,ie.parseZone=WS,ie.hasAlignedHourOffset=zS,ie.isDST=KS,ie.isLocal=jS,ie.isUtcOffset=YS,ie.isUtc=ch,ie.isUTC=ch,ie.zoneAbbr=a0,ie.zoneName=i0,ie.dates=F("dates accessor is deprecated. Use date instead.",vh),ie.months=F("months accessor is deprecated. Use month instead",jm),ie.years=F("years accessor is deprecated. Use year instead",Jm),ie.zone=F("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",HS),ie.isDSTShifted=F("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",GS);function l0(f){return ut(f*1e3)}function c0(){return ut.apply(null,arguments).parseZone()}function Sh(f){return f}var Xe=pe.prototype;Xe.calendar=se,Xe.longDateFormat=ct,Xe.invalidDate=Qt,Xe.ordinal=va,Xe.preparse=Sh,Xe.postformat=Sh,Xe.relativeTime=pn,Xe.pastFuture=_a,Xe.set=z,Xe.eras=R1,Xe.erasParse=O1,Xe.erasConvertYear=U1,Xe.erasAbbrRegex=q1,Xe.erasNameRegex=V1,Xe.erasNarrowRegex=W1,Xe.months=__,Xe.monthsShort=S_,Xe.monthsParse=C_,Xe.monthsRegex=T_,Xe.monthsShortRegex=L_,Xe.week=F_,Xe.firstDayOfYear=M_,Xe.firstDayOfWeek=E_,Xe.weekdays=W_,Xe.weekdaysMin=K_,Xe.weekdaysShort=z_,Xe.weekdaysParse=j_,Xe.weekdaysRegex=X_,Xe.weekdaysShortRegex=Z_,Xe.weekdaysMinRegex=eS,Xe.isPM=rS,Xe.meridiem=nS;function zi(f,p,y,b){var L=Fo(),$=m().set(b,p);return L[y]($,f)}function kh(f,p,y){if(l(f)&&(p=f,f=void 0),f=f||"",p!=null)return zi(f,p,y,"month");var b,L=[];for(b=0;b<12;b++)L[b]=zi(f,b,y,"month");return L}function bf(f,p,y,b){typeof f=="boolean"?(l(p)&&(y=p,p=void 0),p=p||""):(p=f,y=p,f=!1,l(p)&&(y=p,p=void 0),p=p||"");var L=Fo(),$=f?L._week.dow:0,J,Le=[];if(y!=null)return zi(p,(y+$)%7,b,"day");for(J=0;J<7;J++)Le[J]=zi(p,(J+$)%7,b,"day");return Le}function f0(f,p){return kh(f,p,"months")}function u0(f,p){return kh(f,p,"monthsShort")}function d0(f,p,y){return bf(f,p,y,"weekdays")}function p0(f,p,y){return bf(f,p,y,"weekdaysShort")}function m0(f,p,y){return bf(f,p,y,"weekdaysMin")}cs("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(f){var p=f%10,y=$e(f%100/10)===1?"th":p===1?"st":p===2?"nd":p===3?"rd":"th";return f+y}}),e.lang=F("moment.lang is deprecated. Use moment.locale instead.",cs),e.langData=F("moment.langData is deprecated. Use moment.localeData instead.",Fo);var Ao=Math.abs;function h0(){var f=this._data;return this._milliseconds=Ao(this._milliseconds),this._days=Ao(this._days),this._months=Ao(this._months),f.milliseconds=Ao(f.milliseconds),f.seconds=Ao(f.seconds),f.minutes=Ao(f.minutes),f.hours=Ao(f.hours),f.months=Ao(f.months),f.years=Ao(f.years),this}function Ch(f,p,y,b){var L=qr(p,y);return f._milliseconds+=b*L._milliseconds,f._days+=b*L._days,f._months+=b*L._months,f._bubble()}function g0(f,p){return Ch(this,f,p,1)}function y0(f,p){return Ch(this,f,p,-1)}function Ih(f){return f<0?Math.floor(f):Math.ceil(f)}function x0(){var f=this._milliseconds,p=this._days,y=this._months,b=this._data,L,$,J,Le,He;return f>=0&&p>=0&&y>=0||f<=0&&p<=0&&y<=0||(f+=Ih(wf(y)+p)*864e5,p=0,y=0),b.milliseconds=f%1e3,L=Yt(f/1e3),b.seconds=L%60,$=Yt(L/60),b.minutes=$%60,J=Yt($/60),b.hours=J%24,p+=Yt(J/24),He=Yt(Lh(p)),y+=He,p-=Ih(wf(He)),Le=Yt(y/12),y%=12,b.days=p,b.months=y,b.years=Le,this}function Lh(f){return f*4800/146097}function wf(f){return f*146097/4800}function b0(f){if(!this.isValid())return NaN;var p,y,b=this._milliseconds;if(f=Xt(f),f==="month"||f==="quarter"||f==="year")switch(p=this._days+b/864e5,y=this._months+Lh(p),f){case"month":return y;case"quarter":return y/3;case"year":return y/12}else switch(p=this._days+Math.round(wf(this._months)),f){case"week":return p/7+b/6048e5;case"day":return p+b/864e5;case"hour":return p*24+b/36e5;case"minute":return p*1440+b/6e4;case"second":return p*86400+b/1e3;case"millisecond":return Math.floor(p*864e5)+b;default:throw new Error("Unknown unit "+f)}}function w0(){return this.isValid()?this._milliseconds+this._days*864e5+this._months%12*2592e6+$e(this._months/12)*31536e6:NaN}function Eo(f){return function(){return this.as(f)}}var v0=Eo("ms"),_0=Eo("s"),S0=Eo("m"),k0=Eo("h"),C0=Eo("d"),I0=Eo("w"),L0=Eo("M"),T0=Eo("Q"),P0=Eo("y");function D0(){return qr(this)}function F0(f){return f=Xt(f),this.isValid()?this[f+"s"]():NaN}function $s(f){return function(){return this.isValid()?this._data[f]:NaN}}var A0=$s("milliseconds"),E0=$s("seconds"),M0=$s("minutes"),R0=$s("hours"),O0=$s("days"),U0=$s("months"),$0=$s("years");function B0(){return Yt(this.days()/7)}var Mo=Math.round,wn={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function N0(f,p,y,b,L){return L.relativeTime(p||1,!!y,f,b)}function H0(f,p,y,b){var L=qr(f).abs(),$=Mo(L.as("s")),J=Mo(L.as("m")),Le=Mo(L.as("h")),He=Mo(L.as("d")),rt=Mo(L.as("M")),Zt=Mo(L.as("w")),Ro=Mo(L.as("y")),us=$<=y.ss&&["s",$]||$<y.s&&["ss",$]||J<=1&&["m"]||J<y.m&&["mm",J]||Le<=1&&["h"]||Le<y.h&&["hh",Le]||He<=1&&["d"]||He<y.d&&["dd",He];return y.w!=null&&(us=us||Zt<=1&&["w"]||Zt<y.w&&["ww",Zt]),us=us||rt<=1&&["M"]||rt<y.M&&["MM",rt]||Ro<=1&&["y"]||["yy",Ro],us[2]=p,us[3]=+f>0,us[4]=b,N0.apply(null,us)}function V0(f){return f===void 0?Mo:typeof f=="function"?(Mo=f,!0):!1}function q0(f,p){return wn[f]===void 0?!1:p===void 0?wn[f]:(wn[f]=p,f==="s"&&(wn.ss=p-1),!0)}function W0(f,p){if(!this.isValid())return this.localeData().invalidDate();var y=!1,b=wn,L,$;return typeof f=="object"&&(p=f,f=!1),typeof f=="boolean"&&(y=f),typeof p=="object"&&(b=Object.assign({},wn,p),p.s!=null&&p.ss==null&&(b.ss=p.s-1)),L=this.localeData(),$=H0(this,!y,b,L),y&&($=L.pastFuture(+this,$)),L.postformat($)}var vf=Math.abs;function vn(f){return(f>0)-(f<0)||+f}function Ki(){if(!this.isValid())return this.localeData().invalidDate();var f=vf(this._milliseconds)/1e3,p=vf(this._days),y=vf(this._months),b,L,$,J,Le=this.asSeconds(),He,rt,Zt,Ro;return Le?(b=Yt(f/60),L=Yt(b/60),f%=60,b%=60,$=Yt(y/12),y%=12,J=f?f.toFixed(3).replace(/\.?0+$/,""):"",He=Le<0?"-":"",rt=vn(this._months)!==vn(Le)?"-":"",Zt=vn(this._days)!==vn(Le)?"-":"",Ro=vn(this._milliseconds)!==vn(Le)?"-":"",He+"P"+($?rt+$+"Y":"")+(y?rt+y+"M":"")+(p?Zt+p+"D":"")+(L||b||f?"T":"")+(L?Ro+L+"H":"")+(b?Ro+b+"M":"")+(f?Ro+J+"S":"")):"P0D"}var je=Bi.prototype;je.isValid=OS,je.abs=h0,je.add=g0,je.subtract=y0,je.as=b0,je.asMilliseconds=v0,je.asSeconds=_0,je.asMinutes=S0,je.asHours=k0,je.asDays=C0,je.asWeeks=I0,je.asMonths=L0,je.asQuarters=T0,je.asYears=P0,je.valueOf=w0,je._bubble=x0,je.clone=D0,je.get=F0,je.milliseconds=A0,je.seconds=E0,je.minutes=M0,je.hours=R0,je.days=O0,je.weeks=B0,je.months=U0,je.years=$0,je.humanize=W0,je.toISOString=Ki,je.toString=Ki,je.toJSON=Ki,je.locale=mh,je.localeData=gh,je.toIsoString=F("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Ki),je.lang=hh,W("X",0,0,"unix"),W("x",0,0,"valueOf"),ve("x",no),ve("X",d_),tt("X",function(f,p,y){y._d=new Date(parseFloat(f)*1e3)}),tt("x",function(f,p,y){y._d=new Date($e(f))});return e.version="2.29.4",t(ut),e.fn=ie,e.min=AS,e.max=ES,e.now=MS,e.utc=m,e.unix=l0,e.months=f0,e.isDate=c,e.locale=cs,e.invalid=v,e.duration=qr,e.isMoment=R,e.weekdays=d0,e.parseZone=c0,e.localeData=Fo,e.isDuration=Ni,e.monthsShort=u0,e.weekdaysMin=m0,e.defineLocale=lf,e.updateLocale=cS,e.locales=fS,e.weekdaysShort=p0,e.normalizeUnits=Xt,e.relativeTimeRounding=V0,e.relativeTimeThreshold=q0,e.calendarFormat=n1,e.prototype=ie,e.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},e})});var PM={};_f(PM,{default:()=>tf});module.exports=Q0(PM);var jt=require("obsidian"),c_=require("obsidian"),f_=Bs(Ra());var it=require("obsidian");var Ot=()=>new Map,ji=o=>{let e=Ot();return o.forEach((t,r)=>{e.set(r,t)}),e},Wr=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},Fh=(o,e)=>{let t=[];for(let[r,s]of o)t.push(e(s,r));return t},Ah=(o,e)=>{for(let[t,r]of o)if(e(r,t))return!0;return!1};var lo=()=>new Set;var Yi=o=>o[o.length-1];var Eh=(o,e)=>{for(let t=0;t<e.length;t++)o.push(e[t])},zr=Array.from;var kf=Array.isArray;var Ji=class{constructor(){this._observers=Ot()}on(e,t){return Wr(this._observers,e,lo).add(t),t}once(e,t){let r=(...s)=>{this.off(e,r),t(...s)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return zr((this._observers.get(e)||Ot()).values()).forEach(r=>r(...t))}destroy(){this._observers=Ot()}},Sn=class{constructor(){this._observers=Ot()}on(e,t){Wr(this._observers,e,lo).add(t)}once(e,t){let r=(...s)=>{this.off(e,r),t(...s)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return zr((this._observers.get(e)||Ot()).values()).forEach(r=>r(...t))}destroy(){this._observers=Ot()}};var ur=Math.floor;var kn=Math.abs;var Cn=(o,e)=>o<e?o:e,Kr=(o,e)=>o>e?o:e,EM=Number.isNaN;var Qi=o=>o!==0?o<0:1/o<0;var If=Number.MAX_SAFE_INTEGER,MM=Number.MIN_SAFE_INTEGER,RM=1<<31;var Mh=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&ur(o)===o),OM=Number.isNaN,UM=Number.parseInt;var Z0=String.fromCharCode,$M=String.fromCodePoint,BM=Z0(65535),ek=o=>o.toLowerCase(),tk=/^\s*/g,rk=o=>o.replace(tk,""),ok=/([A-Z])/g,Lf=(o,e)=>rk(o.replace(ok,t=>`${e}${ek(t)}`));var sk=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.codePointAt(s);return r},Tn=typeof TextEncoder!="undefined"?new TextEncoder:null,nk=o=>Tn.encode(o),Oh=Tn?nk:sk;var Ln=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Ln&&Ln.decode(new Uint8Array).length===1&&(Ln=null);var Ns=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},Vs=()=>new Ns;var ak=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e};var wr=o=>{let e=new Uint8Array(ak(o)),t=0;for(let r=0;r<o.bufs.length;r++){let s=o.bufs[r];e.set(s,t),t+=s.length}return e.set(new Uint8Array(o.cbuf.buffer,0,o.cpos),t),e},ik=(o,e)=>{let t=o.cbuf.length;t-o.cpos<e&&(o.bufs.push(new Uint8Array(o.cbuf.buffer,0,o.cpos)),o.cbuf=new Uint8Array(Kr(t,e)*2),o.cpos=0)},Ut=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e};var Zi=Ut;var Me=(o,e)=>{for(;e>127;)Ut(o,128|127&e),e=ur(e/128);Ut(o,127&e)},el=(o,e)=>{let t=Qi(e);for(t&&(e=-e),Ut(o,(e>63?128:0)|(t?64:0)|63&e),e=ur(e/64);e>0;)Ut(o,(e>127?128:0)|127&e),e=ur(e/128)},Pf=new Uint8Array(3e4),lk=Pf.length/3,ck=(o,e)=>{if(e.length<lk){let t=Tn.encodeInto(e,Pf).written||0;Me(o,t);for(let r=0;r<t;r++)Ut(o,Pf[r])}else $t(o,Oh(e))},fk=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;Me(o,r);for(let s=0;s<r;s++)Ut(o,t.codePointAt(s))},Oo=Tn&&Tn.encodeInto?ck:fk;var $a=(o,e)=>{let t=o.cbuf.length,r=o.cpos,s=Cn(t-r,e.length),n=e.length-s;o.cbuf.set(e.subarray(0,s),r),o.cpos+=s,n>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(Kr(t*2,n)),o.cbuf.set(e.subarray(s)),o.cpos=n)},$t=(o,e)=>{Me(o,e.byteLength),$a(o,e)},Df=(o,e)=>{ik(o,e);let t=new DataView(o.cbuf.buffer,o.cpos,e);return o.cpos+=e,t},uk=(o,e)=>Df(o,4).setFloat32(0,e,!1),dk=(o,e)=>Df(o,8).setFloat64(0,e,!1),pk=(o,e)=>Df(o,8).setBigInt64(0,e,!1);var $h=new DataView(new ArrayBuffer(4)),mk=o=>($h.setFloat32(0,o),$h.getFloat32(0)===o),Dn=(o,e)=>{switch(typeof e){case"string":Ut(o,119),Oo(o,e);break;case"number":Mh(e)&&kn(e)<=2147483647?(Ut(o,125),el(o,e)):mk(e)?(Ut(o,124),uk(o,e)):(Ut(o,123),dk(o,e));break;case"bigint":Ut(o,122),pk(o,e);break;case"object":if(e===null)Ut(o,126);else if(kf(e)){Ut(o,117),Me(o,e.length);for(let t=0;t<e.length;t++)Dn(o,e[t])}else if(e instanceof Uint8Array)Ut(o,116),$t(o,e);else{Ut(o,118);let t=Object.keys(e);Me(o,t.length);for(let r=0;r<t.length;r++){let s=t[r];Oo(o,s),Dn(o,e[s])}}break;case"boolean":Ut(o,e?120:121);break;default:Ut(o,127)}},Ua=class extends Ns{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Me(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}};var Bh=o=>{o.count>0&&(el(o.encoder,o.count===1?o.s:-o.s),o.count>1&&Me(o.encoder,o.count-2))},Hs=class{constructor(){this.encoder=new Ns,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Bh(this),this.count=1,this.s=e)}toUint8Array(){return Bh(this),wr(this.encoder)}};var Nh=o=>{if(o.count>0){let e=o.diff*2+(o.count===1?0:1);el(o.encoder,e),o.count>1&&Me(o.encoder,o.count-2)}},Fn=class{constructor(){this.encoder=new Ns,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Nh(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Nh(this),wr(this.encoder)}},Xi=class{constructor(){this.sarr=[],this.s="",this.lensE=new Hs}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){let e=new Ns;return this.sarr.push(this.s),this.s="",Oo(e,this.sarr.join("")),$a(e,this.lensE.toUint8Array()),wr(e)}};var Fr=o=>new Error(o),Gr=()=>{throw Fr("Method unimplemented")},Ar=()=>{throw Fr("Unexpected case")};var Hh=Fr("Unexpected end of array"),Vh=Fr("Integer out of Range"),An=class{constructor(e){this.arr=e,this.pos=0}},Yr=o=>new An(o),qh=o=>o.pos!==o.arr.length;var hk=(o,e)=>{let t=new Uint8Array(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},qt=o=>hk(o,Ee(o));var qs=o=>o.arr[o.pos++];var Ee=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let s=o.arr[o.pos++];if(e=e+(s&127)*t,t*=128,s<128)return e;if(e>If)throw Vh}throw Hh},rl=o=>{let e=o.arr[o.pos++],t=e&63,r=64,s=(e&64)>0?-1:1;if(!(e&128))return s*t;let n=o.arr.length;for(;o.pos<n;){if(e=o.arr[o.pos++],t=t+(e&127)*r,r*=128,e<128)return s*t;if(t>If)throw Vh}throw Hh};var gk=o=>{let e=Ee(o);if(e===0)return"";{let t=String.fromCodePoint(qs(o));if(--e<100)for(;e--;)t+=String.fromCodePoint(qs(o));else for(;e>0;){let r=e<1e4?e:1e4,s=o.arr.subarray(o.pos,o.pos+r);o.pos+=r,t+=String.fromCodePoint.apply(null,s),e-=r}return decodeURIComponent(escape(t))}},yk=o=>Ln.decode(qt(o)),jr=Ln?yk:gk;var Ef=(o,e)=>{let t=new DataView(o.arr.buffer,o.arr.byteOffset+o.pos,e);return o.pos+=e,t},xk=o=>Ef(o,4).getFloat32(0,!1),bk=o=>Ef(o,8).getFloat64(0,!1),wk=o=>Ef(o,8).getBigInt64(0,!1);var vk=[o=>{},o=>null,rl,xk,bk,wk,o=>!1,o=>!0,jr,o=>{let e=Ee(o),t={};for(let r=0;r<e;r++){let s=jr(o);t[s]=En(o)}return t},o=>{let e=Ee(o),t=[];for(let r=0;r<e;r++)t.push(En(o));return t},qt],En=o=>vk[127-qs(o)](o),Ba=class extends An{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),qh(this)?this.count=Ee(this)+1:this.count=-1),this.count--,this.s}};var Ws=class extends An{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=rl(this);let e=Qi(this.s);this.count=1,e&&(this.s=-this.s,this.count=Ee(this)+2)}return this.count--,this.s}};var Mn=class extends An{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let e=rl(this),t=e&1;this.diff=ur(e/2),this.count=1,t&&(this.count=Ee(this)+2)}return this.s+=this.diff,this.count--,this.s}},tl=class{constructor(e){this.decoder=new Ws(e),this.str=jr(this.decoder),this.spos=0}read(){let e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}};var VM=crypto.subtle,Wh=crypto.getRandomValues.bind(crypto);var Na=()=>Wh(new Uint32Array(1))[0];var _k=[1e7]+-1e3+-4e3+-8e3+-1e11,Rn=()=>_k.replace(/[018]/g,o=>(o^Na()&15>>o/4).toString(16));var zs=Date.now;var Uo=o=>new Promise(o);var Sk=Promise.all.bind(Promise);var Rf=o=>o===void 0?null:o;var Of=class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},Gh=new Of,Ck=!0;try{typeof localStorage!="undefined"&&localStorage&&(Gh=localStorage,Ck=!1)}catch(o){}var jh=Gh;var Yh=Object.assign,Lk=Object.keys,Jh=(o,e)=>{for(let t in o)e(o[t],t)};var Ha=o=>Lk(o).length;var Qh=o=>{for(let e in o)return!1;return!0},Tk=(o,e)=>{for(let t in o)if(!e(o[t],t))return!1;return!0},Uf=(o,e)=>Object.prototype.hasOwnProperty.call(o,e),$f=(o,e)=>o===e||Ha(o)===Ha(e)&&Tk(o,(t,r)=>(t!==void 0||Uf(e,r))&&e[r]===t);var Va=(o,e,t=0)=>{try{for(;t<o.length;t++)o[t](...e)}finally{t<o.length&&Va(o,e,t+1)}};var Zh=o=>o,Pk=(o,e)=>o===e;var On=(o,e)=>{if(o==null||e==null)return Pk(o,e);if(o.constructor!==e.constructor)return!1;if(o===e)return!0;switch(o.constructor){case ArrayBuffer:o=new Uint8Array(o),e=new Uint8Array(e);case Uint8Array:{if(o.byteLength!==e.byteLength)return!1;for(let t=0;t<o.length;t++)if(o[t]!==e[t])return!1;break}case Set:{if(o.size!==e.size)return!1;for(let t of o)if(!e.has(t))return!1;break}case Map:{if(o.size!==e.size)return!1;for(let t of o.keys())if(!e.has(t)||!On(o.get(t),e.get(t)))return!1;break}case Object:if(Ha(o)!==Ha(e))return!1;for(let t in o)if(!Uf(o,t)||!On(o[t],e[t]))return!1;break;case Array:if(o.length!==e.length)return!1;for(let t=0;t<o.length;t++)if(!On(o[t],e[t]))return!1;break;default:return!1}return!0},eg=(o,e)=>e.includes(o);var qa=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]";var zM=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,co,Dk=[],Fk=()=>{if(co===void 0)if(qa){co=Ot();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&co.set(e,""),e=r):e!==null?(co.set(e,r),e=null):Dk.push(r)}e!==null&&co.set(e,"")}else typeof location=="object"?(co=Ot(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");co.set(`--${Lf(e,"-")}`,t),co.set(`-${Lf(e,"-")}`,t)}})):co=Ot();return co},Nf=o=>Fk().has(o);var Hf=o=>qa?Rf(process.env[o.toUpperCase().replaceAll("-","_")]):Rf(jh.getItem(o));var Ak=o=>Nf("--"+o)||Hf(o)!==null,KM=Ak("production"),tg=qa&&eg(process.env.FORCE_COLOR,["true","1","2"]),rg=!Nf("no-colors")&&(!qa||process.stdout.isTTY||tg)&&(!qa||Nf("color")||tg||Hf("COLORTERM")!==null||(Hf("TERM")||"").includes("color"));var Mk=o=>new Uint8Array(o);var og=o=>{let e=Mk(o.byteLength);return e.set(o),e};var Vf=class{constructor(e,t){this.left=e,this.right=t}},er=(o,e)=>new Vf(o,e);var sg=(o,e)=>o.forEach(t=>e(t.left,t.right));var fo=typeof document!="undefined"?document:{},Ok=o=>fo.createElement(o),Uk=()=>fo.createDocumentFragment(),$k=o=>fo.createTextNode(o),GM=typeof DOMParser!="undefined"?new DOMParser:null;var Bk=(o,e)=>(sg(e,(t,r)=>{r===!1?o.removeAttribute(t):r===!0?o.setAttribute(t,""):o.setAttribute(t,r)}),o);var Nk=o=>{let e=Uk();for(let t=0;t<o.length;t++)ig(e,o[t]);return e},ng=(o,e)=>(ig(o,Nk(e)),o);var Wa=(o,e=[],t=[])=>ng(Bk(Ok(o),e),t);var Un=$k;var ag=o=>Fh(o,(e,t)=>`${t}:${e};`).join("");var ig=(o,e)=>o.appendChild(e),jM=fo.ELEMENT_NODE,YM=fo.TEXT_NODE,JM=fo.CDATA_SECTION_NODE,QM=fo.COMMENT_NODE,XM=fo.DOCUMENT_NODE,ZM=fo.DOCUMENT_TYPE_NODE,eR=fo.DOCUMENT_FRAGMENT_NODE;var uo=Symbol;var za=uo(),Ka=uo(),Wf=uo(),zf=uo(),Kf=uo(),Ga=uo(),Gf=uo(),ja=uo(),jf=uo(),cg=o=>{var s;o.length===1&&((s=o[0])==null?void 0:s.constructor)===Function&&(o=o[0]());let e=[],t=[],r=0;for(;r<o.length;r++){let n=o[r];n===void 0?e.push("undefined"):n.constructor===String||n.constructor===Number?e.push(n):n.constructor===Object&&t.push(JSON.stringify(n))}return t};var tR=zs();var qk={[za]:er("font-weight","bold"),[Ka]:er("font-weight","normal"),[Wf]:er("color","blue"),[Kf]:er("color","green"),[zf]:er("color","grey"),[Ga]:er("color","red"),[Gf]:er("color","purple"),[ja]:er("color","orange"),[jf]:er("color","black")},Wk=o=>{var a;o.length===1&&((a=o[0])==null?void 0:a.constructor)===Function&&(o=o[0]());let e=[],t=[],r=Ot(),s=[],n=0;for(;n<o.length;n++){let i=o[n],l=qk[i];if(l!==void 0)r.set(l.left,l.right);else{if(i===void 0)break;if(i.constructor===String||i.constructor===Number){let c=ag(r);n>0||c.length>0?(e.push("%c"+i),t.push(c)):e.push(i)}else break}}for(n>0&&(s=t,s.unshift(e.join("")));n<o.length;n++){let i=o[n];i instanceof Symbol||s.push(i)}return s},zk=rg?Wk:cg,fg=(...o)=>{console.log(...zk(o)),Kk.forEach(e=>e.print(o))};var Kk=lo();var ug=o=>({[Symbol.iterator](){return this},next:o}),dg=(o,e)=>ug(()=>{let t;do t=o.next();while(!t.done&&!e(t.value));return t}),sl=(o,e)=>ug(()=>{let{done:t,value:r}=o.next();return{done:t,value:t?void 0:e(r)}});var Ja=class{constructor(e,t){this.clock=e,this.len=t}},Ks=class{constructor(){this.clients=new Map}},Lg=(o,e,t)=>e.clients.forEach((r,s)=>{let n=o.doc.store.clients.get(s);for(let a=0;a<r.length;a++){let i=r[a];Og(o,n,i.clock,i.len,t)}}),Qk=(o,e)=>{let t=0,r=o.length-1;for(;t<=r;){let s=ur((t+r)/2),n=o[s],a=n.clock;if(a<=e){if(e<a+n.len)return s;t=s+1}else r=s-1}return null},fu=(o,e)=>{let t=o.clients.get(e.client);return t!==void 0&&Qk(t,e.clock)!==null},uu=o=>{o.clients.forEach(e=>{e.sort((s,n)=>s.clock-n.clock);let t,r;for(t=1,r=1;t<e.length;t++){let s=e[r-1],n=e[t];s.clock+s.len>=n.clock?s.len=Kr(s.len,n.clock+n.len-s.clock):(r<t&&(e[r]=n),r++)}e.length=r})},Jf=o=>{let e=new Ks;for(let t=0;t<o.length;t++)o[t].clients.forEach((r,s)=>{if(!e.clients.has(s)){let n=r.slice();for(let a=t+1;a<o.length;a++)Eh(n,o[a].clients.get(s)||[]);e.clients.set(s,n)}});return uu(e),e},ul=(o,e,t,r)=>{Wr(o.clients,e,()=>[]).push(new Ja(t,r))},du=()=>new Ks,Xk=o=>{let e=du();return o.clients.forEach((t,r)=>{let s=[];for(let n=0;n<t.length;n++){let a=t[n];if(a.deleted){let i=a.id.clock,l=a.length;if(n+1<t.length)for(let c=t[n+1];n+1<t.length&&c.deleted;c=t[++n+1])l+=c.length;s.push(new Ja(i,l))}}s.length>0&&e.clients.set(r,s)}),e},gs=(o,e)=>{Me(o.restEncoder,e.clients.size),zr(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{o.resetDsCurVal(),Me(o.restEncoder,t);let s=r.length;Me(o.restEncoder,s);for(let n=0;n<s;n++){let a=r[n];o.writeDsClock(a.clock),o.writeDsLen(a.len)}})},Qa=o=>{let e=new Ks,t=Ee(o.restDecoder);for(let r=0;r<t;r++){o.resetDsCurVal();let s=Ee(o.restDecoder),n=Ee(o.restDecoder);if(n>0){let a=Wr(e.clients,s,()=>[]);for(let i=0;i<n;i++)a.push(new Ja(o.readDsClock(),o.readDsLen()))}}return e},hg=(o,e,t)=>{let r=new Ks,s=Ee(o.restDecoder);for(let n=0;n<s;n++){o.resetDsCurVal();let a=Ee(o.restDecoder),i=Ee(o.restDecoder),l=t.clients.get(a)||[],c=Dt(t,a);for(let u=0;u<i;u++){let d=o.readDsClock(),m=d+o.readDsLen();if(d<c){c<m&&ul(r,a,c,m-c);let g=mo(l,d),h=l[g];for(!h.deleted&&h.id.clock<d&&(l.splice(g+1,0,wl(e,h,d-h.id.clock)),g++);g<l.length&&(h=l[g++],h.id.clock<m);)h.deleted||(m<h.id.clock+h.length&&l.splice(g,0,wl(e,h,m-h.id.clock)),h.delete(e))}else ul(r,a,d,m-d)}}if(r.clients.size>0){let n=new $o;return Me(n.restEncoder,0),gs(n,r),n.toUint8Array()}return null};var Tg=Na,vr=class extends Ji{constructor({guid:e=Rn(),collectionid:t=null,gc:r=!0,gcFilter:s=()=>!0,meta:n=null,autoLoad:a=!1,shouldLoad:i=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=Tg(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new gl,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=i,this.autoLoad=a,this.meta=n,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Uo(c=>{this.on("load",()=>{this.isLoaded=!0,c(this)})});let l=()=>Uo(c=>{let u=d=>{(d===void 0||d===!0)&&(this.off("sync",u),c())};this.on("sync",u)});this.on("sync",c=>{c===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=c===void 0||c===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){let e=this._item;e!==null&&!this.shouldLoad&&et(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(zr(this.subdocs).map(e=>e.guid))}transact(e,t=null){return et(this,e,t)}get(e,t=Mt){let r=Wr(this.share,e,()=>{let n=new t;return n._integrate(this,null),n}),s=r.constructor;if(t!==Mt&&s!==t)if(s===Mt){let n=new t;n._map=r._map,r._map.forEach(a=>{for(;a!==null;a=a.left)a.parent=n}),n._start=r._start;for(let a=n._start;a!==null;a=a.right)a.parent=n;return n._length=r._length,this.share.set(e,n),n._integrate(this,null),n}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,po)}getText(e=""){return this.get(e,bs)}getMap(e=""){return this.get(e,Bo)}getXmlElement(e=""){return this.get(e,ws)}getXmlFragment(e=""){return this.get(e,No)}toJSON(){let e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){zr(this.subdocs).forEach(t=>t.destroy());let e=this._item;if(e!==null){this._item=null;let t=e.content;t.doc=new vr({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,et(e.parent.doc,r=>{let s=t.doc;e.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}},Nn=class{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Ee(this.restDecoder)}readDsLen(){return Ee(this.restDecoder)}},dl=class extends Nn{readLeftID(){return Ve(Ee(this.restDecoder),Ee(this.restDecoder))}readRightID(){return Ve(Ee(this.restDecoder),Ee(this.restDecoder))}readClient(){return Ee(this.restDecoder)}readInfo(){return qs(this.restDecoder)}readString(){return jr(this.restDecoder)}readParentInfo(){return Ee(this.restDecoder)===1}readTypeRef(){return Ee(this.restDecoder)}readLen(){return Ee(this.restDecoder)}readAny(){return En(this.restDecoder)}readBuf(){return og(qt(this.restDecoder))}readJSON(){return JSON.parse(jr(this.restDecoder))}readKey(){return jr(this.restDecoder)}},Qf=class{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Ee(this.restDecoder),this.dsCurrVal}readDsLen(){let e=Ee(this.restDecoder)+1;return this.dsCurrVal+=e,e}},ys=class extends Qf{constructor(e){super(e),this.keys=[],Ee(e),this.keyClockDecoder=new Mn(qt(e)),this.clientDecoder=new Ws(qt(e)),this.leftClockDecoder=new Mn(qt(e)),this.rightClockDecoder=new Mn(qt(e)),this.infoDecoder=new Ba(qt(e),qs),this.stringDecoder=new tl(qt(e)),this.parentInfoDecoder=new Ba(qt(e),qs),this.typeRefDecoder=new Ws(qt(e)),this.lenDecoder=new Ws(qt(e))}readLeftID(){return new hs(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new hs(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return En(this.restDecoder)}readBuf(){return qt(this.restDecoder)}readJSON(){return En(this.restDecoder)}readKey(){let e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{let t=this.stringDecoder.read();return this.keys.push(t),t}}},Hn=class{constructor(){this.restEncoder=Vs()}toUint8Array(){return wr(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Me(this.restEncoder,e)}writeDsLen(e){Me(this.restEncoder,e)}},Gs=class extends Hn{writeLeftID(e){Me(this.restEncoder,e.client),Me(this.restEncoder,e.clock)}writeRightID(e){Me(this.restEncoder,e.client),Me(this.restEncoder,e.clock)}writeClient(e){Me(this.restEncoder,e)}writeInfo(e){Zi(this.restEncoder,e)}writeString(e){Oo(this.restEncoder,e)}writeParentInfo(e){Me(this.restEncoder,e?1:0)}writeTypeRef(e){Me(this.restEncoder,e)}writeLen(e){Me(this.restEncoder,e)}writeAny(e){Dn(this.restEncoder,e)}writeBuf(e){$t(this.restEncoder,e)}writeJSON(e){Oo(this.restEncoder,JSON.stringify(e))}writeKey(e){Oo(this.restEncoder,e)}},pl=class{constructor(){this.restEncoder=Vs(),this.dsCurrVal=0}toUint8Array(){return wr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){let t=e-this.dsCurrVal;this.dsCurrVal=e,Me(this.restEncoder,t)}writeDsLen(e){e===0&&Ar(),Me(this.restEncoder,e-1),this.dsCurrVal+=e}},$o=class extends pl{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Fn,this.clientEncoder=new Hs,this.leftClockEncoder=new Fn,this.rightClockEncoder=new Fn,this.infoEncoder=new Ua(Zi),this.stringEncoder=new Xi,this.parentInfoEncoder=new Ua(Zi),this.typeRefEncoder=new Hs,this.lenEncoder=new Hs}toUint8Array(){let e=Vs();return Me(e,0),$t(e,this.keyClockEncoder.toUint8Array()),$t(e,this.clientEncoder.toUint8Array()),$t(e,this.leftClockEncoder.toUint8Array()),$t(e,this.rightClockEncoder.toUint8Array()),$t(e,wr(this.infoEncoder)),$t(e,this.stringEncoder.toUint8Array()),$t(e,wr(this.parentInfoEncoder)),$t(e,this.typeRefEncoder.toUint8Array()),$t(e,this.lenEncoder.toUint8Array()),$a(e,wr(this.restEncoder)),wr(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Dn(this.restEncoder,e)}writeBuf(e){$t(this.restEncoder,e)}writeJSON(e){Dn(this.restEncoder,e)}writeKey(e){let t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}},Zk=(o,e,t,r)=>{r=Kr(r,e[0].id.clock);let s=mo(e,r);Me(o.restEncoder,e.length-s),o.writeClient(t),Me(o.restEncoder,r);let n=e[s];n.write(o,r-n.id.clock);for(let a=s+1;a<e.length;a++)e[a].write(o,0)},pu=(o,e,t)=>{let r=new Map;t.forEach((s,n)=>{Dt(e,n)>s&&r.set(n,s)}),vl(e).forEach((s,n)=>{t.has(n)||r.set(n,0)}),Me(o.restEncoder,r.size),zr(r.entries()).sort((s,n)=>n[0]-s[0]).forEach(([s,n])=>{Zk(o,e.clients.get(s),s,n)})},eC=(o,e)=>{let t=Ot(),r=Ee(o.restDecoder);for(let s=0;s<r;s++){let n=Ee(o.restDecoder),a=new Array(n),i=o.readClient(),l=Ee(o.restDecoder);t.set(i,{i:0,refs:a});for(let c=0;c<n;c++){let u=o.readInfo();switch(31&u){case 0:{let d=o.readLen();a[c]=new dr(Ve(i,l),d),l+=d;break}case 10:{let d=Ee(o.restDecoder);a[c]=new pr(Ve(i,l),d),l+=d;break}default:{let d=(u&192)===0,m=new gt(Ve(i,l),null,(u&128)===128?o.readLeftID():null,null,(u&64)===64?o.readRightID():null,d?o.readParentInfo()?e.get(o.readString()):o.readLeftID():null,d&&(u&32)===32?o.readString():null,ty(o,u));a[c]=m,l+=m.length}}}}return t},tC=(o,e,t)=>{let r=[],s=zr(t.keys()).sort((g,h)=>g-h);if(s.length===0)return null;let n=()=>{if(s.length===0)return null;let g=t.get(s[s.length-1]);for(;g.refs.length===g.i;)if(s.pop(),s.length>0)g=t.get(s[s.length-1]);else return null;return g},a=n();if(a===null)return null;let i=new gl,l=new Map,c=(g,h)=>{let _=l.get(g);(_==null||_>h)&&l.set(g,h)},u=a.refs[a.i++],d=new Map,m=()=>{for(let g of r){let h=g.id.client,_=t.get(h);_?(_.i--,i.clients.set(h,_.refs.slice(_.i)),t.delete(h),_.i=0,_.refs=[]):i.clients.set(h,[g]),s=s.filter(w=>w!==h)}r.length=0};for(;;){if(u.constructor!==pr){let h=Wr(d,u.id.client,()=>Dt(e,u.id.client))-u.id.clock;if(h<0)r.push(u),c(u.id.client,u.id.clock-1),m();else{let _=u.getMissing(o,e);if(_!==null){r.push(u);let w=t.get(_)||{refs:[],i:0};if(w.refs.length===w.i)c(_,Dt(e,_)),m();else{u=w.refs[w.i++];continue}}else(h===0||h<u.length)&&(u.integrate(o,h),d.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(a!==null&&a.i<a.refs.length)u=a.refs[a.i++];else{if(a=n(),a===null)break;u=a.refs[a.i++]}}if(i.clients.size>0){let g=new $o;return pu(g,i,new Map),Me(g.restEncoder,0),{missing:l,update:g.toUint8Array()}}return null},rC=(o,e)=>pu(o,e.doc.store,e.beforeState),oC=(o,e,t,r=new ys(o))=>et(e,s=>{s.local=!1;let n=!1,a=s.doc,i=a.store,l=eC(r,a),c=tC(s,i,l),u=i.pendingStructs;if(u){for(let[m,g]of u.missing)if(g<Dt(i,m)){n=!0;break}if(c){for(let[m,g]of c.missing){let h=u.missing.get(m);(h==null||h>g)&&u.missing.set(m,g)}u.update=yl([u.update,c.update])}}else i.pendingStructs=c;let d=hg(r,s,i);if(i.pendingDs){let m=new ys(Yr(i.pendingDs));Ee(m.restDecoder);let g=hg(m,s,i);d&&g?i.pendingDs=yl([d,g]):i.pendingDs=d||g}else i.pendingDs=d;if(n){let m=i.pendingStructs.update;i.pendingStructs=null,Pg(s.doc,m)}},t,!1);var Pg=(o,e,t,r=ys)=>{let s=Yr(e);oC(s,o,t,new r(s))},ho=(o,e,t)=>Pg(o,e,t,dl),sC=(o,e,t=new Map)=>{pu(o,e.store,t),gs(o,Xk(e.store))},nC=(o,e=new Uint8Array([0]),t=new $o)=>{let r=Dg(e);sC(t,o,r);let s=[t.toUint8Array()];if(o.store.pendingDs&&s.push(o.store.pendingDs),o.store.pendingStructs&&s.push(xC(o.store.pendingStructs.update,e)),s.length>1){if(t.constructor===Gs)return gC(s.map((n,a)=>a===0?n:wC(n)));if(t.constructor===$o)return yl(s)}return s[0]},Qs=(o,e)=>nC(o,e,new Gs),aC=o=>{let e=new Map,t=Ee(o.restDecoder);for(let r=0;r<t;r++){let s=Ee(o.restDecoder),n=Ee(o.restDecoder);e.set(s,n)}return e},Dg=o=>aC(new Nn(Yr(o))),Fg=(o,e)=>(Me(o.restEncoder,e.size),zr(e.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{Me(o.restEncoder,t),Me(o.restEncoder,r)}),o),iC=(o,e)=>Fg(o,vl(e.store)),lC=(o,e=new pl)=>(o instanceof Map?Fg(e,o):iC(e,o),e.toUint8Array()),Ag=o=>lC(o,new Hn),Xf=class{constructor(){this.l=[]}},gg=()=>new Xf,yg=(o,e)=>o.l.push(e),xg=(o,e)=>{let t=o.l,r=t.length;o.l=t.filter(s=>e!==s),r===o.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Eg=(o,e,t)=>Va(o.l,[e,t]),hs=class{constructor(e,t){this.client=e,this.clock=t}},Bn=(o,e)=>o===e||o!==null&&e!==null&&o.client===e.client&&o.clock===e.clock,Ve=(o,e)=>new hs(o,e);var Mg=o=>{for(let[e,t]of o.doc.share.entries())if(t===o)return e;throw Ar()};var ml=class{constructor(e,t=e.getMap("users")){let r=new Map;this.yusers=t,this.doc=e,this.clients=new Map,this.dss=r;let s=(n,a)=>{let i=n.get("ds"),l=n.get("ids"),c=u=>this.clients.set(u,a);i.observe(u=>{u.changes.added.forEach(d=>{d.content.getContent().forEach(m=>{m instanceof Uint8Array&&this.dss.set(a,Jf([this.dss.get(a)||du(),Qa(new Nn(Yr(m)))]))})})}),this.dss.set(a,Jf(i.map(u=>Qa(new Nn(Yr(u)))))),l.observe(u=>u.changes.added.forEach(d=>d.content.getContent().forEach(c))),l.forEach(c)};t.observe(n=>{n.keysChanged.forEach(a=>s(t.get(a),a))}),t.forEach(s)}setUserMapping(e,t,r,{filter:s=()=>!0}={}){let n=this.yusers,a=n.get(r);a||(a=new Bo,a.set("ids",new po),a.set("ds",new po),n.set(r,a)),a.get("ids").push([t]),n.observe(i=>{setTimeout(()=>{let l=n.get(r);if(l!==a){a=l,this.clients.forEach((d,m)=>{r===d&&a.get("ids").push([m])});let c=new Hn,u=this.dss.get(r);u&&(gs(c,u),a.get("ds").push([c.toUint8Array()]))}},0)}),e.on("afterTransaction",i=>{setTimeout(()=>{let l=a.get("ds"),c=i.deleteSet;if(i.local&&c.clients.size>0&&s(i,c)){let u=new Hn;gs(u,c),l.push([u.toUint8Array()])}})})}getUserByClientId(e){return this.clients.get(e)||null}getUserByDeletedId(e){for(let[t,r]of this.dss.entries())if(fu(r,e))return t;return null}},hl=class{constructor(e,t,r,s=0){this.type=e,this.tname=t,this.item=r,this.assoc=s}};var mu=o=>new hl(o.type==null?null:Ve(o.type.client,o.type.clock),o.tname||null,o.item==null?null:Ve(o.item.client,o.item.clock),o.assoc==null?0:o.assoc),Zf=class{constructor(e,t,r=0){this.type=e,this.index=t,this.assoc=r}},cC=(o,e,t=0)=>new Zf(o,e,t),nl=(o,e,t)=>{let r=null,s=null;return o._item===null?s=Mg(o):r=Ve(o._item.id.client,o._item.id.clock),new hl(r,s,e,t)},hu=(o,e,t=0)=>{let r=o._start;if(t<0){if(e===0)return nl(o,null,t);e--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>e)return nl(o,Ve(r.id.client,r.id.clock+e),t);e-=r.length}if(r.right===null&&t<0)return nl(o,r.lastId,t);r=r.right}return nl(o,null,t)};var gu=(o,e)=>{let t=e.store,r=o.item,s=o.type,n=o.tname,a=o.assoc,i=null,l=0;if(r!==null){if(Dt(t,r.client)<=r.clock)return null;let c=Ig(t,r),u=c.item;if(!(u instanceof gt))return null;if(i=u.parent,i._item===null||!i._item.deleted){l=u.deleted||!u.countable?0:c.diff+(a>=0?0:1);let d=u.left;for(;d!==null;)!d.deleted&&d.countable&&(l+=d.length),d=d.left}}else{if(n!==null)i=e.get(n);else if(s!==null){if(Dt(t,s.client)<=s.clock)return null;let{item:c}=Ig(t,s);if(c instanceof gt&&c.content instanceof Mr)i=c.content.type;else return null}else throw Ar();a>=0?l=i._length:l=0}return cC(i,l,o.assoc)},yu=(o,e)=>o===e||o!==null&&e!==null&&o.tname===e.tname&&Bn(o.item,e.item)&&Bn(o.type,e.type)&&o.assoc===e.assoc,eu=class{constructor(e,t){this.ds=e,this.sv=t}};var fC=(o,e)=>new eu(o,e),uR=fC(du(),new Map);var $n=(o,e)=>e===void 0?!o.deleted:e.sv.has(o.id.client)&&(e.sv.get(o.id.client)||0)>o.id.clock&&!fu(e.ds,o.id),tu=(o,e)=>{let t=Wr(o.meta,tu,lo),r=o.doc.store;t.has(e)||(e.sv.forEach((s,n)=>{s<Dt(r,n)&&xs(o,Ve(n,s))}),Lg(o,e.ds,s=>{}),t.add(e))};var gl=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},vl=o=>{let e=new Map;return o.clients.forEach((t,r)=>{let s=t[t.length-1];e.set(r,s.id.clock+s.length)}),e},Dt=(o,e)=>{let t=o.clients.get(e);if(t===void 0)return 0;let r=t[t.length-1];return r.id.clock+r.length},Rg=(o,e)=>{let t=o.clients.get(e.id.client);if(t===void 0)t=[],o.clients.set(e.id.client,t);else{let r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw Ar()}t.push(e)},mo=(o,e)=>{let t=0,r=o.length-1,s=o[r],n=s.id.clock;if(n===e)return r;let a=ur(e/(n+s.length-1)*r);for(;t<=r;){if(s=o[a],n=s.id.clock,n<=e){if(e<n+s.length)return a;t=a+1}else r=a-1;a=ur((t+r)/2)}throw Ar()},uC=(o,e)=>{let t=o.clients.get(e.client);return t[mo(t,e.clock)]},ll=uC,ru=(o,e,t)=>{let r=mo(e,t),s=e[r];return s.id.clock<t&&s instanceof gt?(e.splice(r+1,0,wl(o,s,t-s.id.clock)),r+1):r},xs=(o,e)=>{let t=o.doc.store.clients.get(e.client);return t[ru(o,t,e.clock)]},bg=(o,e,t)=>{let r=e.clients.get(t.client),s=mo(r,t.clock),n=r[s];return t.clock!==n.id.clock+n.length-1&&n.constructor!==dr&&r.splice(s+1,0,wl(o,n,t.clock-n.id.clock+1)),n},dC=(o,e,t)=>{let r=o.clients.get(e.id.client);r[mo(r,e.id.clock)]=t},Og=(o,e,t,r,s)=>{if(r===0)return;let n=t+r,a=ru(o,e,t),i;do i=e[a++],n<i.id.clock+i.length&&ru(o,e,n),s(i);while(a<e.length&&e[a].id.clock<n)},ou=class{constructor(e,t,r){this.doc=e,this.deleteSet=new Ks,this.beforeState=vl(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}},wg=(o,e)=>e.deleteSet.clients.size===0&&!Ah(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(uu(e.deleteSet),rC(o,e),gs(o,e.deleteSet),!0),vg=(o,e,t)=>{let r=e._item;(r===null||r.id.clock<(o.beforeState.get(r.id.client)||0)&&!r.deleted)&&Wr(o.changed,e,lo).add(t)},cl=(o,e)=>{let t=o[e],r=o[e-1],s=e;for(;s>0;t=r,r=o[--s-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof gt&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}let n=e-s;return n&&o.splice(e+1-n,n),n},pC=(o,e,t)=>{for(let[r,s]of o.clients.entries()){let n=e.clients.get(r);for(let a=s.length-1;a>=0;a--){let i=s[a],l=i.clock+i.len;for(let c=mo(n,i.clock),u=n[c];c<n.length&&u.id.clock<l;u=n[++c]){let d=n[c];if(i.clock+i.len<=d.id.clock)break;d instanceof gt&&d.deleted&&!d.keep&&t(d)&&d.gc(e,!1)}}}},mC=(o,e)=>{o.clients.forEach((t,r)=>{let s=e.clients.get(r);for(let n=t.length-1;n>=0;n--){let a=t[n],i=Cn(s.length-1,1+mo(s,a.clock+a.len-1));for(let l=i,c=s[l];l>0&&c.id.clock>=a.clock;c=s[l])l-=1+cl(s,l)}})};var Ug=(o,e)=>{if(e<o.length){let t=o[e],r=t.doc,s=r.store,n=t.deleteSet,a=t._mergeStructs;try{uu(n),t.afterState=vl(t.doc.store),r.emit("beforeObserverCalls",[t,r]);let i=[];t.changed.forEach((l,c)=>i.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(t,l)})),i.push(()=>{t.changedParentTypes.forEach((l,c)=>{c._dEH.l.length>0&&(c._item===null||!c._item.deleted)&&(l=l.filter(u=>u.target._item===null||!u.target._item.deleted),l.forEach(u=>{u.currentTarget=c,u._path=null}),l.sort((u,d)=>u.path.length-d.path.length),Eg(c._dEH,l,t))})}),i.push(()=>r.emit("afterTransaction",[t,r])),Va(i,[]),t._needFormattingCleanup&&FC(t)}finally{r.gc&&pC(n,s,r.gcFilter),mC(n,s),t.afterState.forEach((u,d)=>{let m=t.beforeState.get(d)||0;if(m!==u){let g=s.clients.get(d),h=Kr(mo(g,m),1);for(let _=g.length-1;_>=h;)_-=1+cl(g,_)}});for(let u=a.length-1;u>=0;u--){let{client:d,clock:m}=a[u].id,g=s.clients.get(d),h=mo(g,m);h+1<g.length&&cl(g,h+1)>1||h>0&&cl(g,h)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(fg(ja,za,"[yjs] ",Ka,Ga,"Changed the client-id because another client seems to be using it."),r.clientID=Tg()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){let u=new Gs;wg(u,t)&&r.emit("update",[u.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){let u=new $o;wg(u,t)&&r.emit("updateV2",[u.toUint8Array(),t.origin,r,t])}let{subdocsAdded:i,subdocsLoaded:l,subdocsRemoved:c}=t;(i.size>0||c.size>0||l.size>0)&&(i.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),c.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:l,added:i,removed:c},r,t]),c.forEach(u=>u.destroy())),o.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,o])):Ug(o,e+1)}}},et=(o,e,t=null,r=!0)=>{let s=o._transactionCleanups,n=!1,a=null;o._transaction===null&&(n=!0,o._transaction=new ou(o,t,r),s.push(o._transaction),s.length===1&&o.emit("beforeAllTransactions",[o]),o.emit("beforeTransaction",[o._transaction,o]));try{a=e(o._transaction)}finally{if(n){let i=o._transaction===s[0];o._transaction=null,i&&Ug(s,0)}}return a};function*hC(o){let e=Ee(o.restDecoder);for(let t=0;t<e;t++){let r=Ee(o.restDecoder),s=o.readClient(),n=Ee(o.restDecoder);for(let a=0;a<r;a++){let i=o.readInfo();if(i===10){let l=Ee(o.restDecoder);yield new pr(Ve(s,n),l),n+=l}else if(31&i){let l=(i&192)===0,c=new gt(Ve(s,n),null,(i&128)===128?o.readLeftID():null,null,(i&64)===64?o.readRightID():null,l?o.readParentInfo()?o.readString():o.readLeftID():null,l&&(i&32)===32?o.readString():null,ty(o,i));yield c,n+=c.length}else{let l=o.readLen();yield new dr(Ve(s,n),l),n+=l}}}}var Xa=class{constructor(e,t){this.gen=hC(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===pr);return this.curr}};var Za=class{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}},gC=o=>yl(o,dl,Gs);var yC=(o,e)=>{if(o.constructor===dr){let{client:t,clock:r}=o.id;return new dr(Ve(t,r+e),o.length-e)}else if(o.constructor===pr){let{client:t,clock:r}=o.id;return new pr(Ve(t,r+e),o.length-e)}else{let t=o,{client:r,clock:s}=t.id;return new gt(Ve(r,s+e),null,Ve(r,s+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},yl=(o,e=ys,t=$o)=>{if(o.length===1)return o[0];let r=o.map(u=>new e(Yr(u))),s=r.map(u=>new Xa(u,!0)),n=null,a=new t,i=new Za(a);for(;s=s.filter(m=>m.curr!==null),s.sort((m,g)=>{if(m.curr.id.client===g.curr.id.client){let h=m.curr.id.clock-g.curr.id.clock;return h===0?m.curr.constructor===g.curr.constructor?0:m.curr.constructor===pr?1:-1:h}else return g.curr.id.client-m.curr.id.client}),s.length!==0;){let u=s[0],d=u.curr.id.client;if(n!==null){let m=u.curr,g=!1;for(;m!==null&&m.id.clock+m.length<=n.struct.id.clock+n.struct.length&&m.id.client>=n.struct.id.client;)m=u.next(),g=!0;if(m===null||m.id.client!==d||g&&m.id.clock>n.struct.id.clock+n.struct.length)continue;if(d!==n.struct.id.client)ps(i,n.struct,n.offset),n={struct:m,offset:0},u.next();else if(n.struct.id.clock+n.struct.length<m.id.clock)if(n.struct.constructor===pr)n.struct.length=m.id.clock+m.length-n.struct.id.clock;else{ps(i,n.struct,n.offset);let h=m.id.clock-n.struct.id.clock-n.struct.length;n={struct:new pr(Ve(d,n.struct.id.clock+n.struct.length),h),offset:0}}else{let h=n.struct.id.clock+n.struct.length-m.id.clock;h>0&&(n.struct.constructor===pr?n.struct.length-=h:m=yC(m,h)),n.struct.mergeWith(m)||(ps(i,n.struct,n.offset),n={struct:m,offset:0},u.next())}}else n={struct:u.curr,offset:0},u.next();for(let m=u.curr;m!==null&&m.id.client===d&&m.id.clock===n.struct.id.clock+n.struct.length&&m.constructor!==pr;m=u.next())ps(i,n.struct,n.offset),n={struct:m,offset:0}}n!==null&&(ps(i,n.struct,n.offset),n=null),xu(i);let l=r.map(u=>Qa(u)),c=Jf(l);return gs(a,c),a.toUint8Array()},xC=(o,e,t=ys,r=$o)=>{let s=Dg(e),n=new r,a=new Za(n),i=new t(Yr(o)),l=new Xa(i,!1);for(;l.curr;){let u=l.curr,d=u.id.client,m=s.get(d)||0;if(l.curr.constructor===pr){l.next();continue}if(u.id.clock+u.length>m)for(ps(a,u,Kr(m-u.id.clock,0)),l.next();l.curr&&l.curr.id.client===d;)ps(a,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===d&&l.curr.id.clock+l.curr.length<=m;)l.next()}xu(a);let c=Qa(i);return gs(n,c),n.toUint8Array()};var $g=o=>{o.written>0&&(o.clientStructs.push({written:o.written,restEncoder:wr(o.encoder.restEncoder)}),o.encoder.restEncoder=Vs(),o.written=0)},ps=(o,e,t)=>{o.written>0&&o.currClient!==e.id.client&&$g(o),o.written===0&&(o.currClient=e.id.client,o.encoder.writeClient(e.id.client),Me(o.encoder.restEncoder,e.id.clock+t)),e.write(o.encoder,t),o.written++},xu=o=>{$g(o);let e=o.encoder.restEncoder;Me(e,o.clientStructs.length);for(let t=0;t<o.clientStructs.length;t++){let r=o.clientStructs[t];Me(e,r.written),$a(e,r.restEncoder)}},bC=(o,e,t,r)=>{let s=new t(Yr(o)),n=new Xa(s,!1),a=new r,i=new Za(a);for(let c=n.curr;c!==null;c=n.next())ps(i,e(c),0);xu(i);let l=Qa(s);return gs(a,l),a.toUint8Array()};var wC=o=>bC(o,Zh,ys,Gs),_g="You must not compute changes after the event-handler fired.",Vn=class{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=vC(this.currentTarget,this.target))}deletes(e){return fu(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Fr(_g);let e=new Map,t=this.target;this.transaction.changed.get(t).forEach(s=>{if(s!==null){let n=t._map.get(s),a,i;if(this.adds(n)){let l=n.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(n))if(l!==null&&this.deletes(l))a="delete",i=Yi(l.content.getContent());else return;else l!==null&&this.deletes(l)?(a="update",i=Yi(l.content.getContent())):(a="add",i=void 0)}else if(this.deletes(n))a="delete",i=Yi(n.content.getContent());else return;e.set(s,{action:a,oldValue:i})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Fr(_g);let t=this.target,r=lo(),s=lo(),n=[];if(e={added:r,deleted:s,delta:n,keys:this.keys},this.transaction.changed.get(t).has(null)){let i=null,l=()=>{i&&n.push(i)};for(let c=t._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((i===null||i.delete===void 0)&&(l(),i={delete:0}),i.delete+=c.length,s.add(c)):this.adds(c)?((i===null||i.insert===void 0)&&(l(),i={insert:[]}),i.insert=i.insert.concat(c.content.getContent()),r.add(c)):((i===null||i.retain===void 0)&&(l(),i={retain:0}),i.retain+=c.length);i!==null&&i.retain===void 0&&l()}this._changes=e}return e}},vC=(o,e)=>{let t=[];for(;e._item!==null&&e!==o;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,s=e._item.parent._start;for(;s!==e._item&&s!==null;)s.deleted||r++,s=s.right;t.unshift(r)}e=e._item.parent}return t},Bg=80,bu=0,su=class{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=bu++}},_C=o=>{o.timestamp=bu++},Ng=(o,e,t)=>{o.p.marker=!1,o.p=e,e.marker=!0,o.index=t,o.timestamp=bu++},SC=(o,e,t)=>{if(o.length>=Bg){let r=o.reduce((s,n)=>s.timestamp<n.timestamp?s:n);return Ng(r,e,t),r}else{let r=new su(e,t);return o.push(r),r}},_l=(o,e)=>{if(o._start===null||e===0||o._searchMarker===null)return null;let t=o._searchMarker.length===0?null:o._searchMarker.reduce((n,a)=>kn(e-n.index)<kn(e-a.index)?n:a),r=o._start,s=0;for(t!==null&&(r=t.p,s=t.index,_C(t));r.right!==null&&s<e;){if(!r.deleted&&r.countable){if(e<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>e;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return t!==null&&kn(t.index-s)<r.parent.length/Bg?(Ng(t,r,s),t):SC(o._searchMarker,r,s)},ei=(o,e,t)=>{for(let r=o.length-1;r>=0;r--){let s=o[r];if(t>0){let n=s.p;for(n.marker=!1;n&&(n.deleted||!n.countable);)n=n.left,n&&!n.deleted&&n.countable&&(s.index-=n.length);if(n===null||n.marker===!0){o.splice(r,1);continue}s.p=n,n.marker=!0}(e<s.index||t>0&&e===s.index)&&(s.index=Kr(e,s.index+t))}};var Sl=(o,e,t)=>{let r=o,s=e.changedParentTypes;for(;Wr(s,o,()=>[]).push(t),o._item!==null;)o=o._item.parent;Eg(r._eH,t,e)},Mt=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=gg(),this._dEH=gg(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw Gr()}clone(){throw Gr()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){yg(this._eH,e)}observeDeep(e){yg(this._dEH,e)}unobserve(e){xg(this._eH,e)}unobserveDeep(e){xg(this._dEH,e)}toJSON(){}},Hg=(o,e,t)=>{e<0&&(e=o._length+e),t<0&&(t=o._length+t);let r=t-e,s=[],n=o._start;for(;n!==null&&r>0;){if(n.countable&&!n.deleted){let a=n.content.getContent();if(a.length<=e)e-=a.length;else{for(let i=e;i<a.length&&r>0;i++)s.push(a[i]),r--;e=0}}n=n.right}return s},Vg=o=>{let e=[],t=o._start;for(;t!==null;){if(t.countable&&!t.deleted){let r=t.content.getContent();for(let s=0;s<r.length;s++)e.push(r[s])}t=t.right}return e};var ti=(o,e)=>{let t=0,r=o._start;for(;r!==null;){if(r.countable&&!r.deleted){let s=r.content.getContent();for(let n=0;n<s.length;n++)e(s[n],t++,o)}r=r.right}},qg=(o,e)=>{let t=[];return ti(o,(r,s)=>{t.push(e(r,s,o))}),t},kC=o=>{let e=o._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}let s=t[r++];return t.length<=r&&(t=null),{done:!1,value:s}}}},Wg=(o,e)=>{let t=_l(o,e),r=o._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},xl=(o,e,t,r)=>{let s=t,n=o.doc,a=n.clientID,i=n.store,l=t===null?e._start:t.right,c=[],u=()=>{c.length>0&&(s=new gt(Ve(a,Dt(i,a)),s,s&&s.lastId,l,l&&l.id,e,null,new Vo(c)),s.integrate(o,0),c=[])};r.forEach(d=>{if(d===null)c.push(d);else switch(d.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(d);break;default:switch(u(),d.constructor){case Uint8Array:case ArrayBuffer:s=new gt(Ve(a,Dt(i,a)),s,s&&s.lastId,l,l&&l.id,e,null,new js(new Uint8Array(d))),s.integrate(o,0);break;case vr:s=new gt(Ve(a,Dt(i,a)),s,s&&s.lastId,l,l&&l.id,e,null,new Js(d)),s.integrate(o,0);break;default:if(d instanceof Mt)s=new gt(Ve(a,Dt(i,a)),s,s&&s.lastId,l,l&&l.id,e,null,new Mr(d)),s.integrate(o,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},zg=()=>Fr("Length exceeded!"),Kg=(o,e,t,r)=>{if(t>e._length)throw zg();if(t===0)return e._searchMarker&&ei(e._searchMarker,t,r.length),xl(o,e,null,r);let s=t,n=_l(e,t),a=e._start;for(n!==null&&(a=n.p,t-=n.index,t===0&&(a=a.prev,t+=a&&a.countable&&!a.deleted?a.length:0));a!==null;a=a.right)if(!a.deleted&&a.countable){if(t<=a.length){t<a.length&&xs(o,Ve(a.id.client,a.id.clock+t));break}t-=a.length}return e._searchMarker&&ei(e._searchMarker,s,r.length),xl(o,e,a,r)},CC=(o,e,t)=>{let s=(e._searchMarker||[]).reduce((n,a)=>a.index>n.index?a:n,{index:0,p:e._start}).p;if(s)for(;s.right;)s=s.right;return xl(o,e,s,t)},Gg=(o,e,t,r)=>{if(r===0)return;let s=t,n=r,a=_l(e,t),i=e._start;for(a!==null&&(i=a.p,t-=a.index);i!==null&&t>0;i=i.right)!i.deleted&&i.countable&&(t<i.length&&xs(o,Ve(i.id.client,i.id.clock+t)),t-=i.length);for(;r>0&&i!==null;)i.deleted||(r<i.length&&xs(o,Ve(i.id.client,i.id.clock+r)),i.delete(o),r-=i.length),i=i.right;if(r>0)throw zg();e._searchMarker&&ei(e._searchMarker,s,-n+r)},bl=(o,e,t)=>{let r=e._map.get(t);r!==void 0&&r.delete(o)},wu=(o,e,t,r)=>{let s=e._map.get(t)||null,n=o.doc,a=n.clientID,i;if(r==null)i=new Vo([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:i=new Vo([r]);break;case Uint8Array:i=new js(r);break;case vr:i=new Js(r);break;default:if(r instanceof Mt)i=new Mr(r);else throw new Error("Unexpected content type")}new gt(Ve(a,Dt(n.store,a)),s,s&&s.lastId,null,null,e,t,i).integrate(o,0)},vu=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},jg=o=>{let e={};return o._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},Yg=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted};var IC=(o,e)=>{let t={};return o._map.forEach((r,s)=>{let n=r;for(;n!==null&&(!e.sv.has(n.id.client)||n.id.clock>=(e.sv.get(n.id.client)||0));)n=n.left;n!==null&&$n(n,e)&&(t[s]=n.content.getContent()[n.length-1])}),t},al=o=>dg(o.entries(),e=>!e[1].deleted),nu=class extends Vn{constructor(e,t){super(e,t),this._transaction=t}},po=class extends Mt{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){let t=new po;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new po}clone(){let e=new po;return e.insert(0,this.toArray().map(t=>t instanceof Mt?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),Sl(this,e,new nu(this,e))}insert(e,t){this.doc!==null?et(this.doc,r=>{Kg(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?et(this.doc,t=>{CC(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?et(this.doc,r=>{Gg(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return Wg(this,e)}toArray(){return Vg(this)}slice(e=0,t=this.length){return Hg(this,e,t)}toJSON(){return this.map(e=>e instanceof Mt?e.toJSON():e)}map(e){return qg(this,e)}forEach(e){ti(this,e)}[Symbol.iterator](){return kC(this)}_write(e){e.writeTypeRef(GC)}},LC=o=>new po,au=class extends Vn{constructor(e,t,r){super(e,t),this.keysChanged=r}},Bo=class extends Mt{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new Bo}clone(){let e=new Bo;return this.forEach((t,r)=>{e.set(r,t instanceof Mt?t.clone():t)}),e}_callObserver(e,t){Sl(this,e,new au(this,e,t))}toJSON(){let e={};return this._map.forEach((t,r)=>{if(!t.deleted){let s=t.content.getContent()[t.length-1];e[r]=s instanceof Mt?s.toJSON():s}}),e}get size(){return[...al(this._map)].length}keys(){return sl(al(this._map),e=>e[0])}values(){return sl(al(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return sl(al(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?et(this.doc,t=>{bl(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?et(this.doc,r=>{wu(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return vu(this,e)}has(e){return Yg(this,e)}clear(){this.doc!==null?et(this.doc,e=>{this.forEach(function(t,r,s){bl(e,s,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(jC)}},TC=o=>new Bo,ms=(o,e)=>o===e||typeof o=="object"&&typeof e=="object"&&o&&e&&$f(o,e),ri=class{constructor(e,t,r,s){this.left=e,this.right=t,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&Ar(),this.right.content.constructor){case Ct:this.right.deleted||Kn(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},Sg=(o,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case Ct:e.right.deleted||Kn(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&xs(o,Ve(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},il=(o,e,t,r)=>{let s=new Map,n=r?_l(e,t):null;if(n){let a=new ri(n.p.left,n.p,n.index,s);return Sg(o,a,t-n.index)}else{let a=new ri(null,e._start,0,s);return Sg(o,a,t)}},Jg=(o,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===Ct&&ms(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();let s=o.doc,n=s.clientID;r.forEach((a,i)=>{let l=t.left,c=t.right,u=new gt(Ve(n,Dt(s.store,n)),l,l&&l.lastId,c,c&&c.id,e,null,new Ct(i,a));u.integrate(o,0),t.right=u,t.forward()})},Kn=(o,e)=>{let{key:t,value:r}=e;r===null?o.delete(t):o.set(t,r)},Qg=(o,e)=>{var t;for(;o.right!==null;){if(!(o.right.deleted||o.right.content.constructor===Ct&&ms((t=e[o.right.content.key])!=null?t:null,o.right.content.value)))break;o.forward()}},Xg=(o,e,t,r)=>{var i;let s=o.doc,n=s.clientID,a=new Map;for(let l in r){let c=r[l],u=(i=t.currentAttributes.get(l))!=null?i:null;if(!ms(u,c)){a.set(l,u);let{left:d,right:m}=t;t.right=new gt(Ve(n,Dt(s.store,n)),d,d&&d.lastId,m,m&&m.id,e,null,new Ct(l,c)),t.right.integrate(o,0),t.forward()}}return a},Yf=(o,e,t,r,s)=>{t.currentAttributes.forEach((m,g)=>{s[g]===void 0&&(s[g]=null)});let n=o.doc,a=n.clientID;Qg(t,s);let i=Xg(o,e,t,s),l=r.constructor===String?new Er(r):r instanceof Mt?new Mr(r):new Ho(r),{left:c,right:u,index:d}=t;e._searchMarker&&ei(e._searchMarker,t.index,l.getLength()),u=new gt(Ve(a,Dt(n.store,a)),c,c&&c.lastId,u,u&&u.id,e,null,l),u.integrate(o,0),t.right=u,t.index=d,t.forward(),Jg(o,e,t,i)},kg=(o,e,t,r,s)=>{let n=o.doc,a=n.clientID;Qg(t,s);let i=Xg(o,e,t,s);e:for(;t.right!==null&&(r>0||i.size>0&&(t.right.deleted||t.right.content.constructor===Ct));){if(!t.right.deleted)switch(t.right.content.constructor){case Ct:{let{key:l,value:c}=t.right.content,u=s[l];if(u!==void 0){if(ms(u,c))i.delete(l);else{if(r===0)break e;i.set(l,c)}t.right.delete(o)}else t.currentAttributes.set(l,c);break}default:r<t.right.length&&xs(o,Ve(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;t.right=new gt(Ve(a,Dt(n.store,a)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new Er(l)),t.right.integrate(o,0),t.forward()}Jg(o,e,t,i)},Zg=(o,e,t,r,s)=>{var c,u;let n=e,a=Ot();for(;n&&(!n.countable||n.deleted);){if(!n.deleted&&n.content.constructor===Ct){let d=n.content;a.set(d.key,d)}n=n.right}let i=0,l=!1;for(;e!==n;){if(t===e&&(l=!0),!e.deleted){let d=e.content;switch(d.constructor){case Ct:{let{key:m,value:g}=d,h=(c=r.get(m))!=null?c:null;(a.get(m)!==d||h===g)&&(e.delete(o),i++,!l&&((u=s.get(m))!=null?u:null)===g&&h!==g&&(h===null?s.delete(m):s.set(m,h))),!l&&!e.deleted&&Kn(s,d);break}}}e=e.right}return i},PC=(o,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;let t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Ct){let r=e.content.key;t.has(r)?e.delete(o):t.add(r)}e=e.left}},DC=o=>{let e=0;return et(o.doc,t=>{let r=o._start,s=o._start,n=Ot(),a=ji(n);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case Ct:Kn(a,s.content);break;default:e+=Zg(t,r,s,n,a),n=ji(a),r=s;break}s=s.right}}),e},FC=o=>{let e=new Set,t=o.doc;for(let[r,s]of o.afterState.entries()){let n=o.beforeState.get(r)||0;s!==n&&Og(o,t.store.clients.get(r),n,s,a=>{!a.deleted&&a.content.constructor===Ct&&a.constructor!==dr&&e.add(a.parent)})}et(t,r=>{Lg(o,o.deleteSet,s=>{if(s instanceof dr||!s.parent._hasFormatting||e.has(s.parent))return;let n=s.parent;s.content.constructor===Ct?e.add(n):PC(r,s)});for(let s of e)DC(s)})},Cg=(o,e,t)=>{let r=t,s=ji(e.currentAttributes),n=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case Mr:case Ho:case Er:t<e.right.length&&xs(o,Ve(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(o);break}e.forward()}n&&Zg(o,n,e.right,s,e.currentAttributes);let a=(e.left||e.right).parent;return a._searchMarker&&ei(a._searchMarker,e.index,-r+t),e},iu=class extends Vn{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){let e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){let e=this.target.doc,t=[];et(e,r=>{var g,h,_;let s=new Map,n=new Map,a=this.target._start,i=null,l={},c="",u=0,d=0,m=()=>{if(i!==null){let w=null;switch(i){case"delete":d>0&&(w={delete:d}),d=0;break;case"insert":(typeof c=="object"||c.length>0)&&(w={insert:c},s.size>0&&(w.attributes={},s.forEach((v,A)=>{v!==null&&(w.attributes[A]=v)}))),c="";break;case"retain":u>0&&(w={retain:u},Qh(l)||(w.attributes=Yh({},l))),u=0;break}w&&t.push(w),i=null}};for(;a!==null;){switch(a.content.constructor){case Mr:case Ho:this.adds(a)?this.deletes(a)||(m(),i="insert",c=a.content.getContent()[0],m()):this.deletes(a)?(i!=="delete"&&(m(),i="delete"),d+=1):a.deleted||(i!=="retain"&&(m(),i="retain"),u+=1);break;case Er:this.adds(a)?this.deletes(a)||(i!=="insert"&&(m(),i="insert"),c+=a.content.str):this.deletes(a)?(i!=="delete"&&(m(),i="delete"),d+=a.length):a.deleted||(i!=="retain"&&(m(),i="retain"),u+=a.length);break;case Ct:{let{key:w,value:v}=a.content;if(this.adds(a)){if(!this.deletes(a)){let A=(g=s.get(w))!=null?g:null;ms(A,v)?v!==null&&a.delete(r):(i==="retain"&&m(),ms(v,(h=n.get(w))!=null?h:null)?delete l[w]:l[w]=v)}}else if(this.deletes(a)){n.set(w,v);let A=(_=s.get(w))!=null?_:null;ms(A,v)||(i==="retain"&&m(),l[w]=A)}else if(!a.deleted){n.set(w,v);let A=l[w];A!==void 0&&(ms(A,v)?A!==null&&a.delete(r):(i==="retain"&&m(),v===null?delete l[w]:l[w]=v))}a.deleted||(i==="insert"&&m(),Kn(s,a.content));break}}a=a.right}for(m();t.length>0;){let w=t[t.length-1];if(w.retain!==void 0&&w.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}},bs=class extends Mt{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new bs}clone(){let e=new bs;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);let r=new iu(this,e,t);Sl(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===Er&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?et(this.doc,r=>{let s=new ri(null,this._start,0,new Map);for(let n=0;n<e.length;n++){let a=e[n];if(a.insert!==void 0){let i=!t&&typeof a.insert=="string"&&n===e.length-1&&s.right===null&&a.insert.slice(-1)===`
`?a.insert.slice(0,-1):a.insert;(typeof i!="string"||i.length>0)&&Yf(r,this,s,i,a.attributes||{})}else a.retain!==void 0?kg(r,this,s,a.retain,a.attributes||{}):a.delete!==void 0&&Cg(r,s,a.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){let s=[],n=new Map,a=this.doc,i="",l=this._start;function c(){if(i.length>0){let d={},m=!1;n.forEach((h,_)=>{m=!0,d[_]=h});let g={insert:i};m&&(g.attributes=d),s.push(g),i=""}}let u=()=>{for(;l!==null;){if($n(l,e)||t!==void 0&&$n(l,t))switch(l.content.constructor){case Er:{let d=n.get("ychange");e!==void 0&&!$n(l,e)?(d===void 0||d.user!==l.id.client||d.type!=="removed")&&(c(),n.set("ychange",r?r("removed",l.id):{type:"removed"})):t!==void 0&&!$n(l,t)?(d===void 0||d.user!==l.id.client||d.type!=="added")&&(c(),n.set("ychange",r?r("added",l.id):{type:"added"})):d!==void 0&&(c(),n.delete("ychange")),i+=l.content.str;break}case Mr:case Ho:{c();let d={insert:l.content.getContent()[0]};if(n.size>0){let m={};d.attributes=m,n.forEach((g,h)=>{m[h]=g})}s.push(d);break}case Ct:$n(l,e)&&(c(),Kn(n,l.content));break}l=l.right}c()};return e||t?et(a,d=>{e&&tu(d,e),t&&tu(d,t),u()},"cleanup"):u(),s}insert(e,t,r){if(t.length<=0)return;let s=this.doc;s!==null?et(s,n=>{let a=il(n,this,e,!r);r||(r={},a.currentAttributes.forEach((i,l)=>{r[l]=i})),Yf(n,this,a,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){let s=this.doc;s!==null?et(s,n=>{let a=il(n,this,e,!r);Yf(n,this,a,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;let r=this.doc;r!==null?et(r,s=>{Cg(s,il(s,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;let s=this.doc;s!==null?et(s,n=>{let a=il(n,this,e,!1);a.right!==null&&kg(n,this,a,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?et(this.doc,t=>{bl(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?et(this.doc,r=>{wu(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return vu(this,e)}getAttributes(){return jg(this)}_write(e){e.writeTypeRef(YC)}},AC=o=>new bs,Ya=class{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===ws||t.constructor===No)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}},No=class extends Mt{constructor(){super(),this._prelimContent=[]}get firstChild(){let e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new No}clone(){let e=new No;return e.insert(0,this.toArray().map(t=>t instanceof Mt?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Ya(this,e)}querySelector(e){e=e.toUpperCase();let r=new Ya(this,s=>s.nodeName&&s.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),zr(new Ya(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){Sl(this,e,new lu(this,t,e))}toString(){return qg(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){let s=e.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),ti(this,n=>{s.insertBefore(n.toDOM(e,t,r),null)}),s}insert(e,t){this.doc!==null?et(this.doc,r=>{Kg(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)et(this.doc,r=>{let s=e&&e instanceof Mt?e._item:e;xl(r,this,s,t)});else{let r=this._prelimContent,s=e===null?0:r.findIndex(n=>n===e)+1;if(s===0&&e!==null)throw Fr("Reference item not found");r.splice(s,0,...t)}}delete(e,t=1){this.doc!==null?et(this.doc,r=>{Gg(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return Vg(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return Wg(this,e)}slice(e=0,t=this.length){return Hg(this,e,t)}forEach(e){ti(this,e)}_write(e){e.writeTypeRef(QC)}},EC=o=>new No,ws=class extends No{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new ws(this.nodeName)}clone(){let e=new ws(this.nodeName),t=this.getAttributes();return Jh(t,(r,s)=>{typeof r=="string"&&e.setAttribute(s,r)}),e.insert(0,this.toArray().map(r=>r instanceof Mt?r.clone():r)),e}toString(){let e=this.getAttributes(),t=[],r=[];for(let i in e)r.push(i);r.sort();let s=r.length;for(let i=0;i<s;i++){let l=r[i];t.push(l+'="'+e[l]+'"')}let n=this.nodeName.toLocaleLowerCase(),a=t.length>0?" "+t.join(" "):"";return`<${n}${a}>${super.toString()}</${n}>`}removeAttribute(e){this.doc!==null?et(this.doc,t=>{bl(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?et(this.doc,r=>{wu(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return vu(this,e)}hasAttribute(e){return Yg(this,e)}getAttributes(e){return e?IC(this,e):jg(this)}toDOM(e=document,t={},r){let s=e.createElement(this.nodeName),n=this.getAttributes();for(let a in n){let i=n[a];typeof i=="string"&&s.setAttribute(a,i)}return ti(this,a=>{s.appendChild(a.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(JC),e.writeKey(this.nodeName)}},MC=o=>new ws(o.readKey()),lu=class extends Vn{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}},qn=class extends Bo{constructor(e){super(),this.hookName=e}_copy(){return new qn(this.hookName)}clone(){let e=new qn(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){let s=t[this.hookName],n;return s!==void 0?n=s.createDom(this):n=document.createElement(this.hookName),n.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(n,this),n}_write(e){e.writeTypeRef(XC),e.writeKey(this.hookName)}},RC=o=>new qn(o.readKey()),Wn=class extends bs{get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new Wn}clone(){let e=new Wn;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){let s=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(e=>{let t=[];for(let s in e.attributes){let n=[];for(let a in e.attributes[s])n.push({key:a,value:e.attributes[s][a]});n.sort((a,i)=>a.key<i.key?-1:1),t.push({nodeName:s,attrs:n})}t.sort((s,n)=>s.nodeName<n.nodeName?-1:1);let r="";for(let s=0;s<t.length;s++){let n=t[s];r+=`<${n.nodeName}`;for(let a=0;a<n.attrs.length;a++){let i=n.attrs[a];r+=` ${i.key}="${i.value}"`}r+=">"}r+=e.insert;for(let s=t.length-1;s>=0;s--)r+=`</${t[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(ZC)}},OC=o=>new Wn,oi=class{constructor(e,t){this.id=e,this.length=t}get deleted(){throw Gr()}mergeWith(e){return!1}write(e,t,r){throw Gr()}integrate(e,t){throw Gr()}},UC=0,dr=class extends oi{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),Rg(e.doc.store,this)}write(e,t){e.writeInfo(UC),e.writeLen(this.length-t)}getMissing(e,t){return null}},js=class{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new js(this.content)}splice(e){throw Gr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}},$C=o=>new js(o.readBuf()),Ys=class{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Ys(this.len)}splice(e){let t=new Ys(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){ul(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}},BC=o=>new Ys(o.readLen()),ey=(o,e)=>new vr({guid:o,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1}),Js=class{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;let t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Js(ey(this.doc.guid,this.opts))}splice(e){throw Gr()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}},NC=o=>new Js(ey(o.readString(),o.readAny())),Ho=class{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Ho(this.embed)}splice(e){throw Gr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}},HC=o=>new Ho(o.readJSON()),Ct=class{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Ct(this.key,this.value)}splice(e){throw Gr()}mergeWith(e){return!1}integrate(e,t){let r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}},VC=o=>new Ct(o.readKey(),o.readJSON()),zn=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new zn(this.arr)}splice(e){let t=new zn(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let s=t;s<r;s++){let n=this.arr[s];e.writeString(n===void 0?"undefined":JSON.stringify(n))}}getRef(){return 2}},qC=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++){let s=o.readString();s==="undefined"?t.push(void 0):t.push(JSON.parse(s))}return new zn(t)},Vo=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Vo(this.arr)}splice(e){let t=new Vo(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let s=t;s<r;s++){let n=this.arr[s];e.writeAny(n)}}getRef(){return 8}},WC=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++)t.push(o.readAny());return new Vo(t)},Er=class{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Er(this.str)}splice(e){let t=new Er(this.str.slice(e));this.str=this.str.slice(0,e);let r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"\uFFFD",t.str="\uFFFD"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}},zC=o=>new Er(o.readString()),KC=[LC,TC,AC,MC,EC,RC,OC],GC=0,jC=1,YC=2,JC=3,QC=4,XC=5,ZC=6,Mr=class{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Mr(this.type._copy())}splice(e){throw Gr()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}},eI=o=>new Mr(KC[o.readTypeRef()](o)),Ig=(o,e)=>{let t=e,r=0,s;do r>0&&(t=Ve(t.client,t.clock+r)),s=ll(o,t),r=t.clock-s.id.clock,t=s.redone;while(t!==null&&s instanceof gt);return{item:s,diff:r}};var wl=(o,e,t)=>{let{client:r,clock:s}=e.id,n=new gt(Ve(r,s+t),e,Ve(r,s+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&n.markDeleted(),e.keep&&(n.keep=!0),e.redone!==null&&(n.redone=Ve(e.redone.client,e.redone.clock+t)),e.right=n,n.right!==null&&(n.right.left=n),o._mergeStructs.push(n),n.parentSub!==null&&n.right===null&&n.parent._map.set(n.parentSub,n),e.length=t,n};var gt=class extends oi{constructor(e,t,r,s,n,a,i,l){super(e,l.getLength()),this.origin=r,this.left=t,this.right=s,this.rightOrigin=n,this.parent=a,this.parentSub=i,this.redone=null,this.content=l,this.info=this.content.isCountable()?2:0}set marker(e){(this.info&8)>0!==e&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Dt(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Dt(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===hs&&this.id.client!==this.parent.client&&this.parent.clock>=Dt(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=bg(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=xs(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===dr||this.right&&this.right.constructor===dr)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===gt&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===gt&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===hs){let r=ll(t,this.parent);r.constructor===dr?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=bg(e,e.doc.store,Ve(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;let n=new Set,a=new Set;for(;s!==null&&s!==this.right;){if(a.add(s),n.add(s),Bn(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,n.clear();else if(Bn(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&a.has(ll(e.doc.store,s.origin)))n.has(ll(e.doc.store,s.origin))||(r=s,n.clear());else break;s=s.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Rg(e.doc.store,this),this.content.integrate(e,this),vg(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new dr(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Ve(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Bn(e.origin,this.lastId)&&this.right===e&&Bn(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){let t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){let t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),ul(e.deleteSet,this.id.client,this.id.clock,this.length),vg(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw Ar();this.content.gc(e),t?dC(e,this,new dr(this.id,this.length)):this.content=new Ys(this.length)}write(e,t){let r=t>0?Ve(this.id.client,this.id.clock+t-1):this.origin,s=this.rightOrigin,n=this.parentSub,a=this.content.getRef()&31|(r===null?0:128)|(s===null?0:64)|(n===null?0:32);if(e.writeInfo(a),r!==null&&e.writeLeftID(r),s!==null&&e.writeRightID(s),r===null&&s===null){let i=this.parent;if(i._item!==void 0){let l=i._item;if(l===null){let c=Mg(i);e.writeParentInfo(!0),e.writeString(c)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else i.constructor===String?(e.writeParentInfo(!0),e.writeString(i)):i.constructor===hs?(e.writeParentInfo(!1),e.writeLeftID(i)):Ar();n!==null&&e.writeString(n)}this.content.write(e,t)}},ty=(o,e)=>tI[e&31](o),tI=[()=>{Ar()},BC,qC,$C,zC,HC,VC,eI,WC,NC,()=>{Ar()}],rI=10,pr=class extends oi{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){Ar()}write(e,t){e.writeInfo(rI),Me(e.restEncoder,this.length-t)}getMissing(e,t){return null}},ry=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:{},oy="__ $YJS$ __";ry[oy]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");ry[oy]=!0;var Xs=o=>Uo((e,t)=>{o.onerror=r=>t(new Error(r.target.error)),o.onsuccess=r=>e(r.target.result)}),sy=(o,e)=>Uo((t,r)=>{let s=indexedDB.open(o);s.onupgradeneeded=n=>e(n.target.result),s.onerror=n=>r(Fr(n.target.error)),s.onsuccess=n=>{let a=n.target.result;a.onversionchange=()=>{a.close()},t(a)}}),ny=o=>Xs(indexedDB.deleteDatabase(o)),ay=(o,e)=>e.forEach(t=>o.createObjectStore.apply(o,t)),Rr=(o,e,t="readwrite")=>{let r=o.transaction(e,t);return e.map(s=>aI(r,s))},qo=(o,e)=>Xs(o.count(e)),iy=(o,e)=>Xs(o.get(e)),_u=(o,e)=>Xs(o.delete(e)),ly=(o,e,t)=>Xs(o.put(e,t));var kl=(o,e)=>Xs(o.add(e)),cy=(o,e,t)=>Xs(o.getAll(e,t));var oI=(o,e,t)=>{let r=null;return nI(o,e,s=>(r=s,!1),t).then(()=>r)},fy=(o,e=null)=>oI(o,e,"prev");var sI=(o,e)=>Uo((t,r)=>{o.onerror=r,o.onsuccess=async s=>{let n=s.target.result;if(n===null||await e(n)===!1)return t();n.continue()}});var nI=(o,e,t,r="next")=>sI(o.openKeyCursor(e,r),s=>t(s.key)),aI=(o,e)=>o.objectStore(e);var uy=(o,e)=>IDBKeyRange.upperBound(o,e),dy=(o,e)=>IDBKeyRange.lowerBound(o,e);var Su="custom",py="updates",my=500,hy=(o,e=()=>{},t=()=>{})=>{let[r]=Rr(o.db,[py]);return cy(r,dy(o._dbref,!1)).then(s=>{o._destroyed||(e(r),et(o.doc,()=>{s.forEach(n=>ho(o.doc,n))},o,!1),t(r))}).then(()=>fy(r).then(s=>{o._dbref=s+1})).then(()=>qo(r).then(s=>{o._dbsize=s})).then(()=>r)},iI=(o,e=!0)=>hy(o).then(t=>{(e||o._dbsize>=my)&&kl(t,Qs(o.doc)).then(()=>_u(t,uy(o._dbref,!0))).then(()=>qo(t).then(r=>{o._dbsize=r}))});var vs=class extends Sn{constructor(e,t){super(),this.doc=t,this.name=e,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=sy(e,r=>ay(r,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=Uo(r=>this.on("synced",()=>r(this))),this._db.then(r=>{this.db=r,hy(this,a=>kl(a,Qs(t)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(r,s)=>{if(this.db&&s!==this){let[n]=Rr(this.db,[py]);kl(n,r),++this._dbsize>=my&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{iI(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},t.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),t.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(e=>{e.close()})}clearData(){return this.destroy().then(()=>{ny(this.name)})}get(e){return this._db.then(t=>{let[r]=Rr(t,[Su],"readonly");return iy(r,e)})}set(e,t){return this._db.then(r=>{let[s]=Rr(r,[Su]);return ly(s,t,e)})}del(e){return this._db.then(t=>{let[r]=Rr(t,[Su]);return _u(r,e)})}};var Ir=Bs(Ra());var gy=0,Il=1,yy=2,Ll=(o,e)=>{Me(o,gy);let t=Ag(e);$t(o,t)},ku=(o,e,t)=>{Me(o,Il),$t(o,Qs(e,t))},lI=(o,e,t)=>ku(e,t,qt(o)),xy=(o,e,t)=>{try{ho(e,qt(o),t)}catch(r){console.error("Caught error while handling a Yjs update",r)}},by=(o,e)=>{Me(o,yy),$t(o,e)},cI=xy,wy=(o,e,t,r)=>{let s=Ee(o);switch(s){case gy:lI(o,e,t);break;case Il:xy(o,t,r);break;case yy:cI(o,t,r);break;default:throw new Error("Unknown message type")}return s};var uI=0;var vy=(o,e,t)=>{switch(Ee(o)){case uI:t(e,jr(o))}};var Cu=3e4,Tl=class extends Sn{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let t=zs();this.getLocalState()!==null&&Cu/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let r=[];this.meta.forEach((s,n)=>{n!==this.clientID&&Cu<=t-s.lastUpdated&&this.states.has(n)&&r.push(n)}),r.length>0&&Pl(this,r,"timeout")},ur(Cu/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,r=this.meta.get(t),s=r===void 0?0:r.clock+1,n=this.states.get(t);e===null?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:s,lastUpdated:zs()});let a=[],i=[],l=[],c=[];e===null?c.push(t):n==null?e!=null&&a.push(t):(i.push(t),On(n,e)||l.push(t)),(a.length>0||l.length>0||c.length>0)&&this.emit("change",[{added:a,updated:l,removed:c},"local"]),this.emit("update",[{added:a,updated:i,removed:c},"local"])}setLocalStateField(e,t){let r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}},Pl=(o,e,t)=>{let r=[];for(let s=0;s<e.length;s++){let n=e[s];if(o.states.has(n)){if(o.states.delete(n),n===o.clientID){let a=o.meta.get(n);o.meta.set(n,{clock:a.clock+1,lastUpdated:zs()})}r.push(n)}}r.length>0&&(o.emit("change",[{added:[],updated:[],removed:r},t]),o.emit("update",[{added:[],updated:[],removed:r},t]))},jn=(o,e,t=o.states)=>{let r=e.length,s=Vs();Me(s,r);for(let n=0;n<r;n++){let a=e[n],i=t.get(a)||null,l=o.meta.get(a).clock;Me(s,a),Me(s,l),Oo(s,JSON.stringify(i))}return wr(s)};var _y=(o,e,t)=>{let r=Yr(e),s=zs(),n=[],a=[],i=[],l=[],c=Ee(r);for(let u=0;u<c;u++){let d=Ee(r),m=Ee(r),g=JSON.parse(jr(r)),h=o.meta.get(d),_=o.states.get(d),w=h===void 0?0:h.clock;(w<m||w===m&&g===null&&o.states.has(d))&&(g===null?d===o.clientID&&o.getLocalState()!=null?m++:o.states.delete(d):o.states.set(d,g),o.meta.set(d,{clock:m,lastUpdated:s}),h===void 0&&g!==null?n.push(d):h!==void 0&&g===null?l.push(d):g!==null&&(On(g,_)||i.push(d),a.push(d)))}(n.length>0||i.length>0||l.length>0)&&o.emit("change",[{added:n,updated:i,removed:l},t]),(n.length>0||a.length>0||l.length>0)&&o.emit("update",[{added:n,updated:a,removed:l},t])};var Jn=()=>new Map,Ly=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},Ty=()=>new Set,mI=Array.from,hR=Array.isArray,Py=String.fromCharCode,gR=String.fromCodePoint,yR=Py(65535),hI=o=>o.toLowerCase(),gI=/^\s*/g,yI=o=>o.replace(gI,""),xI=/([A-Z])/g,Sy=(o,e)=>yI(o.replace(xI,t=>`${e}${hI(t)}`)),bI=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.codePointAt(s);return r},si=typeof TextEncoder!="undefined"?new TextEncoder:null,wI=o=>si.encode(o),vI=si?wI:bI,Iu=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Iu&&Iu.decode(new Uint8Array).length===1&&(Iu=null);var ky=o=>o===void 0?null:o,_I=class{constructor(){this.map=new Map}setItem(o,e){this.map.set(o,e)}getItem(o){return this.map.get(o)}},Dy=new _I,Au=!0;try{typeof localStorage!="undefined"&&(Dy=localStorage,Au=!1)}catch(o){}var Fy=Dy,SI=o=>Au||addEventListener("storage",o),kI=o=>Au||removeEventListener("storage",o),CI=(o,e)=>{let t=[];for(let r in o)t.push(e(o[r],r));return t},II=(o,e)=>e.includes(o),Zn=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name),Ay=typeof window!="undefined"&&typeof document!="undefined"&&!Zn,xR=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,go,LI=[],TI=()=>{if(go===void 0)if(Zn){go=Jn();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&go.set(e,""),e=r):e!==null?(go.set(e,r),e=null):LI.push(r)}e!==null&&go.set(e,"")}else typeof location=="object"?(go=Jn(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");go.set(`--${Sy(e,"-")}`,t),go.set(`-${Sy(e,"-")}`,t)}})):go=Jn();return go},Tu=o=>TI().has(o),Pu=o=>ky(Zn?process.env[o.toUpperCase()]:Fy.getItem(o)),PI=o=>Tu("--"+o)||Pu(o)!==null,bR=PI("production"),Cy=Zn&&II(process.env.FORCE_COLOR,["true","1","2"]),wR=!Tu("no-colors")&&(!Zn||process.stdout.isTTY||Cy)&&(!Zn||Tu("color")||Cy||Pu("COLORTERM")!==null||(Pu("TERM")||"").includes("color")),Ey=Math.floor,My=(o,e)=>o<e?o:e,DI=(o,e)=>o>e?o:e,vR=Number.isNaN,FI=Math.pow,Ry=128,AI=1<<17,EI=1<<18,MI=1<<19,RI=1<<20,OI=1<<21,UI=1<<22,$I=1<<23,BI=1<<24,NI=1<<25,HI=1<<26,VI=1<<27,qI=1<<28,WI=1<<29,zI=1<<30,_R=1<<31,Dl=127,SR=AI-1,kR=EI-1,CR=MI-1,IR=RI-1,LR=OI-1,TR=UI-1,PR=$I-1,DR=BI-1,FR=NI-1,AR=HI-1,ER=VI-1,MR=qI-1,RR=WI-1,OR=zI-1,KI=Number.MAX_SAFE_INTEGER,UR=Number.MIN_SAFE_INTEGER,$R=1<<31,BR=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&Ey(o)===o),NR=Number.isNaN,HR=Number.parseInt,GI=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},Jr=()=>new GI,Eu=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e},Or=o=>{let e=new Uint8Array(Eu(o)),t=0;for(let r=0;r<o.bufs.length;r++){let s=o.bufs[r];e.set(s,t),t+=s.length}return e.set($y(o.cbuf.buffer,0,o.cpos),t),e},Fl=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e},tr=(o,e)=>{for(;e>Dl;)Fl(o,Ry|Dl&e),e=Ey(e/128);Fl(o,Dl&e)},Du=new Uint8Array(3e4),jI=Du.length/3,YI=(o,e)=>{if(e.length<jI){let t=si.encodeInto(e,Du).written||0;tr(o,t);for(let r=0;r<t;r++)Fl(o,Du[r])}else Qn(o,vI(e))},JI=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;tr(o,r);for(let s=0;s<r;s++)Fl(o,t.codePointAt(s))},VR=si&&si.encodeInto?YI:JI,QI=(o,e)=>{let t=o.cbuf.length,r=o.cpos,s=My(t-r,e.length),n=e.length-s;o.cbuf.set(e.subarray(0,s),r),o.cpos+=s,n>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(DI(t*2,n)),o.cbuf.set(e.subarray(s)),o.cpos=n)},Qn=(o,e)=>{tr(o,e.byteLength),QI(o,e)},qR=new DataView(new ArrayBuffer(4)),Oy=o=>new Error(o),XI=Oy("Unexpected end of array"),ZI=Oy("Integer out of Range"),eL=class{constructor(o){this.arr=o,this.pos=0}},tL=o=>new eL(o),rL=(o,e)=>{let t=$y(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},oL=o=>rL(o,Uy(o)),Uy=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let s=o.arr[o.pos++];if(e=e+(s&Dl)*t,t*=128,s<Ry)return e;if(e>KI)throw ZI}throw XI},sL=o=>new Uint8Array(o),$y=(o,e,t)=>new Uint8Array(o,e,t),nL=o=>new Uint8Array(o),aL=o=>{let e="";for(let t=0;t<o.byteLength;t++)e+=Py(o[t]);return btoa(e)},iL=o=>Buffer.from(o.buffer,o.byteOffset,o.byteLength).toString("base64"),lL=o=>{let e=atob(o),t=sL(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},cL=o=>{let e=Buffer.from(o,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},fL=Ay?aL:iL,uL=Ay?lL:cL,By=new Map,dL=class{constructor(o){this.room=o,this.onmessage=null,this._onChange=e=>e.key===o&&this.onmessage!==null&&this.onmessage({data:uL(e.newValue||"")}),SI(this._onChange)}postMessage(o){Fy.setItem(this.room,fL(nL(o)))}close(){kI(this._onChange)}},pL=typeof BroadcastChannel=="undefined"?dL:BroadcastChannel,Mu=o=>Ly(By,o,()=>{let e=Ty(),t=new pL(o);return t.onmessage=r=>e.forEach(s=>s(r.data,"broadcastchannel")),{bc:t,subs:e}}),mL=(o,e)=>(Mu(o).subs.add(e),e),hL=(o,e)=>{let t=Mu(o),r=t.subs.delete(e);return r&&t.subs.size===0&&(t.bc.close(),By.delete(o)),r},Yn=(o,e,t=null)=>{let r=Mu(o);r.bc.postMessage(e),r.subs.forEach(s=>s(e,t))},Fu=Date.now,gL=class{constructor(){this._observers=Jn()}on(o,e){Ly(this._observers,o,Ty).add(e)}once(o,e){let t=(...r)=>{this.off(o,t),e(...r)};this.on(o,t)}off(o,e){let t=this._observers.get(o);t!==void 0&&(t.delete(e),t.size===0&&this._observers.delete(o))}emit(o,e){return mI((this._observers.get(o)||Jn()).values()).forEach(t=>t(...e))}destroy(){this._observers=Jn()}},yL=o=>CI(o,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&"),Zs=0,Ny=3,Xn=1,xL=2,ni=[];ni[Zs]=(o,e,t,r,s)=>{tr(o,Zs);let n=wy(e,o,t.doc,t);r&&n===Il&&!t.synced&&(t.synced=!0)};ni[Ny]=(o,e,t,r,s)=>{tr(o,Xn),Qn(o,jn(t.awareness,Array.from(t.awareness.getStates().keys())))};ni[Xn]=(o,e,t,r,s)=>{_y(t.awareness,oL(e),t)};ni[xL]=(o,e,t,r,s)=>{vy(e,t.doc,(n,a)=>bL(t,a))};var Iy=3e4,bL=(o,e)=>console.warn(`Permission denied to access ${o.url}.
${e}`),Hy=(o,e,t)=>{let r=tL(e),s=Jr(),n=Uy(r),a=o.messageHandlers[n];return a?a(s,r,o,t,n):console.error("Unable to compute message"),s},Vy=o=>{if(o.shouldConnect&&o.ws===null){let e=new o._WS(o.url);e.binaryType="arraybuffer",o.ws=e,o.wsconnecting=!0,o.wsconnected=!1,o.synced=!1,e.onmessage=t=>{o.wsLastMessageReceived=Fu();let r=Hy(o,new Uint8Array(t.data),!0);Eu(r)>1&&e.send(Or(r))},e.onerror=t=>{o.emit("connection-error",[t,o])},e.onclose=t=>{o.emit("connection-close",[t,o]),o.ws=null,o.wsconnecting=!1,o.wsconnected?(o.wsconnected=!1,o.synced=!1,Pl(o.awareness,Array.from(o.awareness.getStates().keys()).filter(r=>r!==o.doc.clientID),o),o.emit("status",[{status:"disconnected"}])):o.wsUnsuccessfulReconnects++,setTimeout(Vy,My(FI(2,o.wsUnsuccessfulReconnects)*100,o.maxBackoffTime),o)},e.onopen=()=>{o.wsLastMessageReceived=Fu(),o.wsconnecting=!1,o.wsconnected=!0,o.wsUnsuccessfulReconnects=0,o.emit("status",[{status:"connected"}]);let t=Jr();if(tr(t,Zs),Ll(t,o.doc),e.send(Or(t)),o.awareness.getLocalState()!==null){let r=Jr();tr(r,Xn),Qn(r,jn(o.awareness,[o.doc.clientID])),e.send(Or(r))}},o.emit("status",[{status:"connecting"}])}},Lu=(o,e)=>{let t=o.ws;o.wsconnected&&t&&t.readyState===t.OPEN&&t.send(e),o.bcconnected&&Yn(o.bcChannel,e,o)},qy=class extends gL{constructor(o,e,t,{connect:r=!0,awareness:s=new Tl(t),params:n={},WebSocketPolyfill:a=WebSocket,resyncInterval:i=-1,maxBackoffTime:l=2500,disableBc:c=!1}={}){for(super();o[o.length-1]==="/";)o=o.slice(0,o.length-1);let u=yL(n);this.maxBackoffTime=l,this.bcChannel=o+"/"+e,this.url=o+"/"+e+(u.length===0?"":"?"+u),this.roomname=e,this.doc=t,this._WS=a,this.awareness=s,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=c,this.wsUnsuccessfulReconnects=0,this.messageHandlers=ni.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=r,this._resyncInterval=0,i>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){let d=Jr();tr(d,Zs),Ll(d,t),this.ws.send(Or(d))}},i)),this._bcSubscriber=(d,m)=>{if(m!==this){let g=Hy(this,new Uint8Array(d),!1);Eu(g)>1&&Yn(this.bcChannel,Or(g),this)}},this._updateHandler=(d,m)=>{if(m!==this){let g=Jr();tr(g,Zs),by(g,d),Lu(this,Or(g))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:d,updated:m,removed:g},h)=>{let _=d.concat(m).concat(g),w=Jr();tr(w,Xn),Qn(w,jn(s,_)),Lu(this,Or(w))},this._unloadHandler=()=>{Pl(this.awareness,[t.clientID],"window unload")},typeof window!="undefined"?window.addEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.on("exit",this._unloadHandler),s.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{var d;this.wsconnected&&Iy<Fu()-this.wsLastMessageReceived&&((d=this.ws)==null||d.close())},Iy/10),r&&this.connect()}get synced(){return this._synced}set synced(o){this._synced!==o&&(this._synced=o,this.emit("synced",[o]),this.emit("sync",[o]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),typeof window!="undefined"?window.removeEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.off("exit",this._unloadHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(mL(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);let o=Jr();tr(o,Zs),Ll(o,this.doc),Yn(this.bcChannel,Or(o),this);let e=Jr();tr(e,Zs),ku(e,this.doc),Yn(this.bcChannel,Or(e),this);let t=Jr();tr(t,Ny),Yn(this.bcChannel,Or(t),this);let r=Jr();tr(r,Xn),Qn(r,jn(this.awareness,[this.doc.clientID])),Yn(this.bcChannel,Or(r),this)}disconnectBc(){let o=Jr();tr(o,Xn),Qn(o,jn(this.awareness,[this.doc.clientID],new Map)),Lu(this,Or(o)),this.bcconnected&&(hL(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(Vy(this),this.connectBc())}};var Bt=new WeakMap,Wy=!1;function El(o){Wy=o}var Qr={maxFileSize:1024*1024,maxBackups:5,disableConsole:!1,batchInterval:1e3,maxRetries:3},rr,or,Al=[];function zy(o,e,t,r){or=o,rr=t,r&&(Qr={...Qr,...r}),e.setInterval(Ru,Qr.batchInterval)}async function Ru(){if(Al.length===0)return;let o=[...Al];Al.length=0;for(let e=0;e<Qr.maxRetries;e++)try{await wL();let t=o.map(Ky).join(`
`)+`
`;await or.append(rr,t);return}catch(t){console.error(`Failed to write logs (attempt ${e+1}):`,t),e===Qr.maxRetries-1&&console.error("Max retries reached. Discarding log entries.")}}async function wL(){let o=await or.stat(rr);if(o&&o.size>Qr.maxFileSize){for(let e=Qr.maxBackups;e>0;e--){let t=`${rr}.${e}`,r=`${rr}.${e+1}`;await or.exists(t)&&(e===Qr.maxBackups?await or.remove(t):await or.rename(t,r))}await or.exists(rr)&&await or.rename(rr,`${rr}.1`),await or.write(rr,"")}}function Ky(o){return`[${o.timestamp}] [${o.level.toUpperCase()}] ${o.message}
    at ${o.callerInfo}`}function vL(o,e){return e?t=>(o.notify(t.name+`
`+t.message),t):t=>(o.notify(t.name+`:
An error has occurred, please reload Obsidian.`),t)}var _L=["token","authorization","email","key"];function SL(o){if(typeof o=="object"&&o!==null){let e=new WeakSet;try{return JSON.stringify(o,(t,r)=>{var s;if(typeof r=="object"&&r!==null){if(e.has(r))return"[Circular]";e.add(r)}return typeof t=="string"&&_L.some(n=>t.toLowerCase().includes(n.toLowerCase()))?"[REDACTED]":r instanceof Error?{name:r.name,message:r.message,stack:(s=r.stack)==null?void 0:s.split(`
`).map(n=>n.trim()).join(" ")}:r},2)}catch(t){return t instanceof Error?t instanceof RangeError?`[Complex Object: ${Object.prototype.toString.call(o)}]`:`[Unserializable: ${t.message}]`:"[Unknown Error]"}}return String(o)}function Te(o,e="log"){return(...t)=>{if(Wy){let r=new Date().toISOString(),s=new Error().stack,n=s?s.split(`
`)[2].trim():"",a=t.map(SL).join(" "),i={timestamp:r,level:e,message:`${o}: ${a}`,callerInfo:n};Qr.disableConsole||console[e](Ky(i)),Al.push(i)}}}async function Ml(){let o=[];await or.exists(rr)&&o.push(rr);for(let e=1;e<=Qr.maxBackups;e++){let t=`${rr}.${e}`;await or.exists(t)&&o.push(t)}return o}async function Gy(){let o=[];if(await or.exists(rr)){let e=await or.read(rr);o.push(e)}for(let e=1;e<=Qr.maxBackups;e++){let t=`${rr}.${e}`;if(await or.exists(t)){let r=await or.read(t);o.push(r)}}return o.reverse().join(`
`)}var Ft=class{constructor(e){let t=e||this.constructor.name;this.debug=Te(`[${t}]`,"debug"),this.log=Te(`[${t}]`,"log"),this.warn=Te(`[${t}]`,"warn"),this.error=Te(`[${t}]`,"error")}setLoggers(e){this.debug=Te(`[${e}]`,"debug"),this.log=Te(`[${e}]`,"log"),this.warn=Te(`[${e}]`,"warn"),this.error=Te(`[${e}]`,"error")}},kL=!1;function jy(o){return vL(o,kL)}var Ou=class{constructor(){this.platform="s3rn";this.product="relay"}},Uu=class{constructor(e){this.relayId=e;this.platform="s3rn";this.product="relay"}},Wo=class{constructor(e,t){this.relayId=e;this.folderId=t;this.platform="s3rn";this.product="relay"}},Ur=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.documentId=r;this.platform="s3rn";this.product="relay"}},sr=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.canvasId=r;this.platform="s3rn";this.product="relay"}},zo=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.fileId=r;this.platform="s3rn";this.product="relay"}},$u=class{constructor(e,t,r,s,n,a){this.relayId=e;this.folderId=t;this.fileId=r;this.hash=s;this.contentType=n;this.contentLength=a;this.platform="s3rn";this.product="relay"}},$r=class{constructor(e){this.folderId=e;this.platform="s3rn";this.product="relay"}},Ko=class{constructor(e,t){this.folderId=e;this.documentId=t;this.platform="s3rn";this.product="relay"}},en=class{constructor(e,t){this.folderId=e;this.canvasId=t;this.platform="s3rn";this.product="relay"}},ai=class{constructor(e,t){this.folderId=e;this.fileId=t;this.platform="s3rn";this.product="relay"}},bt=class{static validateUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}static encode(e){let t=`${e.platform}:${e.product}`;if("relayId"in e){if(!this.validateUUID(e.relayId))throw new Error("Invalid relay UUID");t+=`:relay:${e.relayId}`}if("folderId"in e){if(!this.validateUUID(e.folderId))throw new Error("Invalid folder UUID");t+=`:folder:${e.folderId}`}if("documentId"in e){if(!this.validateUUID(e.documentId))throw new Error("Invalid document UUID");t+=`:doc:${e.documentId}`}if("canvasId"in e){if(!this.validateUUID(e.canvasId))throw new Error("Invalid document UUID");t+=`:canvas:${e.canvasId}`}if("fileId"in e){if(!this.validateUUID(e.fileId))throw new Error("Invalid document UUID");if(t+=`:file:${e.fileId}`,"hash"in e&&e.hash&&"contentType"in e&&"contentLength"in e){if(!this.validateUUID(e.fileId))throw new Error("Invalid document UUID");t+=`:sha256:${e.hash}`,t+=`:contentType:${e.contentType}`,t+=`:contentLength:${e.contentLength}`}}return t}static decode(e){let t=e.split(":");if(t.length<3)throw new Error("Invalid s3rn format");let[,r,s,n,a,i,l,c,u,d,m,g,h,_]=t;if(!this.validateUUID(n))throw new Error("Invalid UUID");if(i&&!this.validateUUID(i))throw new Error("Invalid UUID");if(c&&!this.validateUUID(c))throw new Error("Invalid UUID");if(r==="relay"&&s==="relay"&&a==="folder"&&l==="doc")return new Ur(n,i,c);if(r==="relay"&&s==="relay"&&a==="folder"&&l==="canvas")return new sr(n,i,c);if(r==="relay"&&s==="relay"&&a==="folder"&&l==="file"&&u==="hash"&&m==="contentType"&&h==="contentLength")return new $u(n,i,c,d,g,_);if(r==="relay"&&s==="relay"&&a==="folder"&&l==="file")return new zo(n,i,c);if(r==="relay"&&s==="relay"&&a=="folder")return new Wo(n,i);if(r==="relay"&&s==="folder"&&a==="document")return new Ko(n,i);if(r==="relay"&&s==="folder"&&a==="canvas")return new en(n,i);if(r==="relay"&&s==="folder")return new $r(n);if(r==="relay"&&s==="relay")return new Uu(n);if(s===void 0)return new Ou;throw new Error("Invalid s3rn format for the given product type")}};function CL(o){if(typeof window!="undefined"&&window.btoa)return window.btoa(o);if(typeof Buffer!="undefined")return Buffer.from(o).toString("base64");throw new Error("Unable to encode to Base64")}function Yy(o){let e=JSON.stringify(o),t=CL(e);return t=t.replace("+","-").replace("/","_").replace(/=+$/,""),t}var Rl={enableUpdateYDocFromDiskBuffer:!1,enableDocumentStatus:!1,enableNewLinkFormat:!1,enableDeltaLogging:!1,enableHTTPSync:!1,enableSyncMenu:!0,enableDocumentServer:!1,enableDocumentHistory:!1,enableEditorTweens:!1,enableSyncModal:!1,enableDesyncPill:!1,enableAutomaticUpdatesOption:!1,enableAttachmentSync:!0,enableNetworkLogging:!1,enableCanvasSync:!1};function IL(){return new Proxy({},{get:(o,e)=>e})}var yo=IL();var ea=class{constructor(){this.timeouts=[],this.intervals=[]}getTime(){return Date.now()}setInterval(e,t){let r=window.setInterval(e,t);return this.intervals.push(r),r}clearInterval(e){window.clearInterval(e)}setTimeout(e,t){let r=window.setTimeout(()=>{this.timeouts.remove(r),e()},t);return this.timeouts.push(r),r}clearTimeout(e){window.clearTimeout(e)}destroy(){for(let e of this.timeouts)this.clearTimeout(e);this.timeouts=[];for(let e of this.intervals)this.clearInterval(e);this.intervals=[]}debounce(e,t=500){let r;return(...s)=>{r&&clearTimeout(r),r=setTimeout(()=>{e(...s)},t)}}};var Wt=class{constructor(e,t=20){this.timeProvider=e;this.deliveryWindow=t;this.mailboxes=new Map;this.allMailLog=[];this.deliveredMailLog=[];this.isDelivering=!1;this.deliveryInterval=null;this.currentTransactionId=0;this.isInTransaction=!1}static getInstance(){if(this._destroyed)throw new Error("tried to access postie during teardown");return Wt.instance||(Wt.instance=new Wt(new ea),Bt.set(this.instance,"postie")),Wt.instance}beginTransaction(){this.isInTransaction=!0,this.currentTransactionId++}commitTransaction(){this.isInTransaction=!1,this.isDelivering||this.scheduleDelivery()}send(e,t,r=!1){let s={sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)};this.allMailLog.push(s),this.mailboxes.has(t)||this.mailboxes.set(t,new Set),this.mailboxes.get(t).add(e),r?this.deliverImmediate(e,t):!this.isInTransaction&&!this.isDelivering&&this.scheduleDelivery()}deliverImmediate(e,t){t(e),this.deliveredMailLog.push({sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)})}scheduleDelivery(){this.isDelivering=!0,this.deliveryInterval=this.timeProvider.setTimeout(()=>{this.deliver(),this.deliveryInterval=null,this.isDelivering=!1,this.mailboxes.size>0&&!this.isInTransaction&&this.scheduleDelivery()},this.deliveryWindow)}deliver(){let e=Te("[postie]","debug");for(let[t,r]of this.mailboxes){for(let s of r)t(s),e("send",s.constructor.name,t),this.deliveredMailLog.push({sender:s,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)});r.clear()}}getAllMailLog(){return[...this.allMailLog]}getDeliveredMailLog(){return[...this.deliveredMailLog]}prettyPrintAllMailLog(){Te("[postie]","warn")("All Mail Log:"),this.prettyPrintMailLog(this.allMailLog)}prettyPrintDeliveredMailLog(){Te("[postie]","warn")("Delivered Mail Log:"),this.prettyPrintMailLog(this.deliveredMailLog)}prettyPrintMailLog(e){let t=Te("[postie]","warn");e.forEach((r,s)=>{t(`Mail #${s+1}:`),t(`  Timestamp: ${new Date(r.timestamp).toISOString()}`),t(`  Transaction ID: ${r.transactionId}`),t(`  Sender: ${r.sender.observableName||r.sender.constructor.name}`),t(`  Recipient: ${r.recipient.name||"Anonymous function"}`),t(`  Recipient Origin: ${r.recipientOrigin||"Unknown"}`),t("---")})}getFunctionOrigin(e){if(e.name)return e.name;let t=e.toString(),r=t.match(/^(function|class)?\s*([^\s(]*)/);if(r&&r[2])return r[2];let s=200,n=t.replace(/\s+/g," ").slice(0,s);return n.length===s&&(n+="..."),`AnonymousFunction(${n})`}static destroy(){Wt.instance&&(Wt.instance.mailboxes=null,Wt.instance.allMailLog=[],Wt.instance.deliveredMailLog=[],Wt.instance.timeProvider.destroy(),Wt.instance.timeProvider=null,Wt.instance.isDelivering=!1,Wt.instance.isInTransaction=!1,Wt.instance.currentTransactionId=0,Wt._destroyed=!0,Wt.instance=void 0)}},Br=Wt;Br._destroyed=!1;var Bu=new Map;function Jy(){for(let[,o]of Bu)o();Bu.clear()}var dt=class extends Ft{constructor(t){super();this.observableName=t;this.destroyed=!1;Bu.set(this,()=>{this._listeners&&this._listeners.size>0&&this.warn(`Missing tear down of ${this._listeners.size} listeners on ${this.observableName}`)}),this._listeners=new Set,this.unsubscribes=[]}notifyListeners(){for(let t of this._listeners)Br.getInstance().send(this,t)}on(t){return this._listeners.add(t),()=>{this.off(t)}}subscribe(t){return this._listeners.add(t),Br.getInstance().send(this,t,!0),()=>{this.unsubscribe(t)}}off(t){this._listeners.delete(t)}unsubscribe(t){this._listeners&&this._listeners.delete(t)}destroy(){var t;this.destroyed=!0,this.unsubscribes&&this.unsubscribes.forEach(r=>{r()}),(t=this._listeners)==null||t.clear(),this._listeners=null}};function Ge(){return{...Nt.getInstance().flags}}function Go(o,e,t=()=>{}){Nt.getInstance().flags[o]?e():t()}function Qy(o,e,t=()=>{}){o.forEach(r=>{if(Nt.getInstance().flags[r]){e();return}}),t()}var Nt=class extends dt{constructor(){super();this.flags=Rl}async applyServerFlags(t){if(!this.settings)return;let s=t.filter(n=>n.override).reduce((n,a)=>(n[a.name]=a.value,n),{});this.log("applying server flags",s),await this.settings.update(n=>({...n,...s}),!0)}static getInstance(){return Nt.instance||(Nt.instance=new Nt),Nt.instance}setSettings(t){this.settings=t,this.settings.subscribe(r=>{this.flags={...this.flags,...r},this.notifyListeners()})}getFlag(t){return this.flags[t]}setFlag(t,r){this.settings&&this.settings.update(s=>({...s,[t]:r}))}static destroy(){Nt.instance=null}};var LL={3:"disconnected",2:"disconnected",1:"connected",0:"connecting"};function Xy(o,e,t){let r={token:o.token},s=new qy(o.url,o.docId,e,{connect:!1,params:r,disableBc:!0});return t&&s.awareness.setLocalStateField("user",{name:t.name,color:t.color.color,colorLight:t.color.light}),s}var jo=class extends Ft{constructor(t,r,s,n){var c;super();this.guid=t;this._s3rn=r;this.tokenStore=s;this.loginManager=n;this._providerSynced=!1;this.PROVIDER_MAX_ERRORS=3;this.listeners=new Map,this.loginManager=n;let a=(c=this.loginManager)==null?void 0:c.user;this.ydoc=new vr,Ge().enableDocumentHistory&&(this.ydoc.gc=!1),a&&new ml(this.ydoc).setUserMapping(this.ydoc,this.ydoc.clientID,a.id),this.tokenStore=s,this.clientToken=this.tokenStore.getTokenSync(bt.encode(this.s3rn))||{token:"",url:"",docId:"-",expiryTime:0},this._provider=Xy(this.clientToken,this.ydoc,a);let i=this.providerConnectionErrorSubscription(u=>{this.log(`[${this.path}] disconnection event`,u);let d=this._provider.url&&this._provider.shouldConnect&&this._provider.wsUnsuccessfulReconnects<this.PROVIDER_MAX_ERRORS;this.disconnect(),d&&this.connect()});i.on(),this._offConnectionError=i.off;let l=this.providerStateSubscription(u=>{this.notifyListeners()});l.on(),this._offState=l.off}get s3rn(){return this._s3rn}set s3rn(t){this._s3rn=t,this.refreshProvider(this.clientToken)}get debuggerUrl(){return`https://debugger.y-sweet.dev/?payload=${Yy(this.clientToken)}`}notifyListeners(){this.debug("[Provider State]",this.path,this.state),this.listeners.forEach(t=>{t(this.state)})}subscribe(t,r){return this.listeners.set(t,r),()=>{this.unsubscribe(t)}}unsubscribe(t){this.listeners.delete(t)}async getProviderToken(){return this.log("get provider token"),this.tokenStore.getToken(bt.encode(this.s3rn),this.path||"unknown",this.refreshProvider.bind(this))}providerActive(){var t;if(this.clientToken){let r=this._provider.url==this.clientToken.url,s=Date.now()>(((t=this.clientToken)==null?void 0:t.expiryTime)||0);return r&&!s}return!1}refreshProvider(t){var a;this.clientToken=t;let r=new vr,s=Xy(t,r),n=s.url;if(this._provider){if(this._provider.url!==n){this._provider.url=n,this._provider.wsUnsuccessfulReconnects=0;let i=this._provider.url.replace(/token=[^&]+/,"token=[REDACTED]");this.log(`Token Refreshed: setting new provider url, ${i}`),(a=this._provider.ws)==null||a.close()}}else throw new Error("missing provider!");s.awareness.destroy(),s.destroy(),r.destroy()}get connected(){return this.state.status==="connected"}connect(){return this.connected?Promise.resolve(!0):this.getProviderToken().then(t=>(this.refreshProvider(t),this._provider.connect(),this.notifyListeners(),!0)).catch(t=>!1)}get state(){var t;return{status:LL[((t=this._provider.ws)==null?void 0:t.readyState)||3],intent:this.intent}}get intent(){return this._provider.shouldConnect?"connected":"disconnected"}get synced(){return this._providerSynced}disconnect(){var t;this._provider.shouldConnect=!1,(t=this._provider.ws)==null||t.close(),this._provider.ws=null,this.tokenStore.removeFromRefreshQueue(this.guid),this.notifyListeners()}withActiveProvider(){return this.providerActive()?new Promise(t=>{t(this)}):this.getProviderToken().then(t=>this)}onceConnected(){return new Promise(t=>{let r=s=>{s.status==="connected"&&t()};this._provider.on("status",r)})}onceProviderSynced(){return this.synced?new Promise(t=>{t()}):new Promise(t=>{this._provider.once("synced",()=>{this._providerSynced=!0,t()})})}reset(){this.disconnect(),this.clientToken={token:"",url:"",docId:"-",expiryTime:0}}_injectIntent(t){return s=>{t({status:s.status,intent:this.intent})}}providerConnectionErrorSubscription(t){return{on:()=>{this._provider.on("connection-error",t)},off:()=>{this._provider.off("connection-error",t)}}}providerStateSubscription(t){return{on:()=>{this._provider.on("status",this._injectIntent(t))},off:()=>{this._provider.off("status",this._injectIntent(t))}}}destroy(){this._offConnectionError&&this._offConnectionError(),this._offState&&this._offState(),this._provider&&(this._provider.disconnect(),this._provider.awareness.destroy(),this._provider._observers.clear(),this._provider.destroy(),window.clearInterval(this._provider.awareness._checkInterval)),this.loginManager=null}};var _s=class{constructor(e,t,r){this.vault=e;this.contents=r;this.parent=null;this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.stat={ctime:Date.now(),mtime:Date.now(),size:0}}delete(){return Promise.resolve()}rename(e){return this.path=e,this.name=e.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),Promise.resolve()}getBasePath(){return this.path.substring(0,this.path.lastIndexOf("/"))}},Ol=class{constructor(){this.dbName="RelayDiskBuffer";this.storeName="diskBuffers";this.dbPromise=null}async getDB(){return this.dbPromise||(this.dbPromise=this.openDB()),this.dbPromise}async openDB(){return new Promise((e,t)=>{let r=indexedDB.open(this.dbName,1);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=s=>{s.target.result.createObjectStore(this.storeName,{keyPath:"guid"})}})}async saveDiskBuffer(e,t){let r=await this.getDB();return new Promise((s,n)=>{try{let l=r.transaction(this.storeName,"readwrite").objectStore(this.storeName).put({guid:e,contents:t});l.onerror=()=>n(l.error),l.onsuccess=()=>s()}catch(a){n(a)}})}async loadDiskBuffer(e){let t=await this.getDB();return new Promise((r,s)=>{try{let i=t.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e);i.onerror=()=>s(i.error),i.onsuccess=()=>r(i.result?i.result.contents:null)}catch(n){s(n)}})}async removeDiskBuffer(e){let t=await this.getDB();return new Promise((r,s)=>{try{let i=t.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);i.onerror=()=>s(i.error),i.onsuccess=()=>r()}catch(n){s(n)}})}};var Xr=class{constructor(e,t){this.currentPromise=null;this.promiseFunction=e,this.checkFunction=t}getPromise(){let[e,t]=this.checkFunction(),r=s=>{if(this.currentPromise&&this.resolver){let n=this.resolver;n(s),this.timeoutId&&clearTimeout(this.timeoutId),this.resolver=void 0}return this.currentPromise};if(e){let s=r(t);if(s)return s}return this.currentPromise||(this.currentPromise=new Promise((s,n)=>{this.resolver=s,this.timeoutId=window.setTimeout(()=>{Te("[Promise]","debug")("Dependency stuck after 3s. Checking.",this.promiseFunction.toString());let[a,i]=this.checkFunction();a&&r(i)},3e3),this.promiseFunction().then(a=>{this.timeoutId&&clearTimeout(this.timeoutId),s(a)},a=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,n(a)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null,this.resolver=void 0}},Ul=class{constructor(e){this.currentPromise=null;this.promiseFunction=e}getPromise(){return this.currentPromise||(this.currentPromise=new Promise((e,t)=>{this.timeoutId=window.setTimeout(()=>{Te("[Promise]","error")("SharedPromise stuck after 3s:",this.promiseFunction.toString())},3e3),this.promiseFunction().then(r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,e(r)},r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,t(r)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null}};function ii(o,...e){return new Promise((t,r)=>{let s=window.setTimeout(()=>{Te("[Promise]","error")("Promise stuck after 3s:",...e)},3e3);o.then(n=>{clearTimeout(s),t(n)},n=>{clearTimeout(s),r(n)})})}var TL={md:"text/markdown",txt:"text/plain",json:"application/json",js:"application/javascript",ts:"application/typescript",html:"text/html",css:"text/css",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",svg:"image/svg+xml",pdf:"application/pdf",canvas:"application/canvas+json",webp:"image/webp",avif:"image/avif",bmp:"image/bmp",mp3:"audio/mpeg",wav:"audio/wav",m4a:"audio/x-m4a",flac:"audio/flac",ogg:"audio/ogg",oga:"audio/ogg",opus:"audio/opus",mp4:"video/mp4",webm:"video/webm",ogv:"video/ogg",mov:"video/quicktime",mkv:"video/x-matroska","3gp":"video/3gpp"};function Ss(o){var t;let e=((t=o.split(".").pop())==null?void 0:t.toLowerCase())||"";return TL[e]||"application/octet-stream"}function Zr(o){return o instanceof At}var At=class extends jo{constructor(t,r,s,n){let a=n.relayId?new Ur(n.relayId,n.guid,r):new Ko(n.guid,r);super(r,a,n.tokenStore,s);this.whenSyncedPromise=null;this.persistenceSynced=!1;this.userLock=!1;this.unsubscribes=[];this._parent=n,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this._diskBufferStore=this.sharedFolder.diskBufferStore,this.unsubscribes.push(this._parent.subscribe(this.path,i=>{i.intent==="disconnected"&&this.disconnect()})),this.setLoggers(`[SharedDoc](${this.path})`);try{let i=`${this.sharedFolder.appId}-relay-doc-${this.guid}`;this._persistence=new vs(i,this.ydoc)}catch(i){throw this.warn("Unable to open persistence.",this.guid),console.error(i),i}this.whenSynced().then(()=>{let i=l=>{let c=l.transaction.origin;l.changes.keys.size!==0&&c!=this&&this.updateStats()};this.ytext.observe(i),this.unsubscribes.push(()=>{var l;(l=this.ytext)==null||l.unobserve(i)}),this.updateStats();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.sharedFolder.relayId||""),this._persistence.set("appId",this.sharedFolder.appId),this._persistence.set("s3rn",bt.encode(this.s3rn))}catch(l){}(async()=>(await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()),this.sharedFolder.markUploaded(this)))()}),Go(yo.enableDeltaLogging,()=>{let i=l=>{var u,d;let c="";c+=`Transaction origin: ${l.transaction.origin} ${(d=(u=l.transaction.origin)==null?void 0:u.constructor)==null?void 0:d.name}
`;for(let m of l.changes.delta)c+=`insert: ${m.insert}

retain: ${m.retain}

delete: ${m.delete}
`;this.debug(c)};this.ytext.observe(i),this.unsubscribes.push(()=>{this.ytext.unobserve(i)})}),this._tfile=null}move(t){this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}get tfile(){return this._tfile||(this._tfile=this._parent.getTFile(this)),this._tfile}get ytext(){return this.ydoc.getText("contents")}get text(){return this.ytext?this.ytext.toString():""}async diskBuffer(t=!1){if(t||this._diskBuffer===void 0){let r;try{let s=await this._parent.diskBufferStore.loadDiskBuffer(this.guid).catch(n=>null);return s!==null&&s!==""?r=s:r=await this._parent.read(this),this.setDiskBuffer(r.replace(`\r
`,`
`))}catch(s){throw console.error(s),s}}return this._diskBuffer}setDiskBuffer(t){return this._diskBuffer?this._diskBuffer.contents=t:this._diskBuffer=new _s(this._parent.vault,"local disk",t),this._parent.diskBufferStore.saveDiskBuffer(this.guid,t).catch(r=>{}),this._diskBuffer}async clearDiskBuffer(){this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),await this._parent.diskBufferStore.removeDiskBuffer(this.guid).catch(t=>{})}async checkStale(){await this.whenSynced();let r=(await this.diskBuffer(!0)).contents,s=this.text!==r;return s||this.clearDiskBuffer(),s}async connect(){return this.sharedFolder.s3rn instanceof $r?!1:(this.s3rn instanceof Ko&&(this.sharedFolder.relayId?this.s3rn=new Ur(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new Ko(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}get ready(){return this._persistence.synced&&(this.synced||!!this._serverSynced||this._origin==="local")}hasLocalDB(){return!!this._serverSynced||this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),await this.getServerSynced(),this._awaitingUpdates?(this._awaitingUpdates=!this.hasLocalDB(),this._awaitingUpdates):!1}async whenReady(){let t=async()=>await this.awaitingUpdates()?(this.log("awaiting updates"),this.connect(),await this.onceConnected(),this.log("connected"),await this.onceProviderSynced(),this.log("synced"),this):this;return this.readyPromise=this.readyPromise||new Xr(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>(await this.sharedFolder.whenSynced(),this._persistence.synced&&!this.persistenceSynced?(await this.count(),this.persistenceSynced=!0,Promise.resolve()):new Promise(r=>{this.persistenceSynced&&r(),this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})}));return this.whenSyncedPromise=this.whenSyncedPromise||new Xr(t,()=>[this.persistenceSynced,void 0]),this.whenSyncedPromise.getPromise()}async hasKnownPeers(){return await this.whenSynced(),this.hasLocalDB()}get mimetype(){return Ss(this.path)}async markOrigin(t){this._origin=t,await this._persistence.set("origin",t)}async getOrigin(){return this._origin!==void 0?this._origin:(this._origin=await this._persistence.get("origin"),this._origin)}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}async count(){if(this._persistence.db===null)throw new Error("database not ready yet");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=Rr(this._persistence.db,["updates"],"readonly"),r=await qo(t);return this._dbsize=r,this._dbsize}get dbsize(){if(!this._dbsize)throw new Error("dbsize accessed before count");return this._persistence._dbsize===0&&this._dbsize?this._dbsize:this._persistence._dbsize}static checkExtension(t){return t.endsWith(".md")}destroy(){var t,r;this.unsubscribes.forEach(s=>{s()}),super.destroy(),this.ydoc.destroy(),this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),this._diskBufferStore=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null}async read(){return this.text}async rename(t){this.move(t)}async cleanup(){var t;(t=this._diskBufferStore)==null||t.removeDiskBuffer(this.guid)}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.text.length}async write(t){this.ytext.delete(0,this.ytext.length),this.ytext.insert(0,t),this.updateStats()}async append(t){this.ytext.insert(this.ytext.length,t),this.updateStats()}};var ks=class extends dt{constructor(){super();this._set=new Set}add(t){return this._set.add(t),this.notifyListeners(),this}delete(t){let r=this._set.delete(t);return r&&this.notifyListeners(),r}clear(){this._set.clear(),this.notifyListeners()}has(t){return this._set.has(t)}items(){return[...this._set]}get size(){return this._set.size}map(t){return this.items().map(t)}forEach(t){this.items().forEach(t)}find(t){return this.items().find(t)}some(t){for(let r of this._set)if(t(r))return!0;return!1}filter(t){let r=[];for(let s of this._set)t(s)&&r.push(s);return r}};var Yo=class{constructor(e){this.seperator="/";this.namespace=e}fullKey(e){return`${this.namespace}${this.seperator}${e}`}get size(){return Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).length}clear(){Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).forEach(e=>localStorage.removeItem(e))}delete(e){let t=this.fullKey(e),r=localStorage.getItem(t)!==null;return localStorage.removeItem(t),r}forEach(e,t){Object.keys(localStorage).filter(r=>r.startsWith(this.namespace+this.seperator)).forEach(r=>{let s=r.split(`${this.namespace}${this.seperator}`)[1],n=this.get(s);e.call(t,n,s,this)})}get(e){let t=this.fullKey(e),r=localStorage.getItem(t);return r?JSON.parse(r):void 0}has(e){let t=this.fullKey(e);return localStorage.getItem(t)!==null}set(e,t){let r=this.fullKey(e);return localStorage.setItem(r,JSON.stringify(t)),this}keys(){return Object.keys(localStorage).filter(t=>t.startsWith(this.namespace+this.seperator)).map(t=>t.split(`${this.namespace}${this.seperator}`)[1]).values()}values(){return Array.from(this.keys()).map(t=>this.get(t)).values()}entries(){return Array.from(this.keys()).map(t=>[t,this.get(t)]).values()}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return"LocalStorage"}};var Nu=require("obsidian");function Hu(o){return o instanceof _r}var _r=class extends Ft{constructor(t,r,s,n){super();this.path=t;this.guid=r;this.relayManager=s;this._tfolder=null;this.ready=!1;this.createPromise=null;this.connected=!0;this._parent=n,this.name=this.path.split("/").pop()||"",this.vault=this._parent.vault;let a=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(t));a instanceof Nu.TFolder?(this._tfolder=a,this.ready=!0):(this.createPromise=this.vault.createFolder(this.sharedFolder.getPath(t)),this.createPromise.then(i=>{this._tfolder=i,this.ready=!0})),this.synctime=0,this.setLoggers(`[SyncFolder](${this.path})`),this.offFolderStatusListener=this._parent.subscribe(this.path,i=>{i.intent==="disconnected"&&this.disconnect()}),(async()=>(this.createPromise&&await this.createPromise,n.markUploaded(this)))(),this.log("created")}static fromTFolder(t,r,s){return console.log("virtualpath for new syncfolder",r.getVirtualPath(s.path)),new _r(r.getVirtualPath(s.path),Rn(),t,r)}disconnect(){this.connected=!1}move(t){t!==this.path&&(this.log("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.setLoggers(`[SharedFolder](${this.path})`))}static checkPath(t){var s;return!((s=t.split("/").pop())==null?void 0:s.includes("."))}get tfolder(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof Nu.TFolder)return t;throw new Error("TFolder API used before file existed")}get parent(){var t;return((t=this.tfolder)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected))}async rename(t){this.move(t)}async delete(){return this.vault.delete(this.tfolder)}cleanup(){}destroy(){var t;(t=this.offFolderStatusListener)==null||t.call(this),this.offFolderStatusListener=null,this._parent=null,this.relayManager=null,this._tfolder=null}};var xo=Bs(Ra());var $l,PL=new Uint8Array(16);function Vu(){if(!$l&&($l=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!$l))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return $l(PL)}var zt=[];for(let o=0;o<256;++o)zt.push((o+256).toString(16).slice(1));function Zy(o,e=0){return zt[o[e+0]]+zt[o[e+1]]+zt[o[e+2]]+zt[o[e+3]]+"-"+zt[o[e+4]]+zt[o[e+5]]+"-"+zt[o[e+6]]+zt[o[e+7]]+"-"+zt[o[e+8]]+zt[o[e+9]]+"-"+zt[o[e+10]]+zt[o[e+11]]+zt[o[e+12]]+zt[o[e+13]]+zt[o[e+14]]+zt[o[e+15]]}var DL=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),qu={randomUUID:DL};function FL(o,e,t){if(qu.randomUUID&&!e&&!o)return qu.randomUUID();o=o||{};let r=o.random||(o.rng||Vu)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=r[s];return e}return Zy(r)}var ta=FL;var AL={images:"image",audio:"audio",videos:"video",pdfs:"pdf",otherTypes:"file"};function Wu(o){return(o==null?void 0:o.type)==="markdown"}function ex(o){return(o==null?void 0:o.type)==="folder"}function ci(o){return{version:0,id:o,type:"markdown"}}function tx(o){return{version:0,id:o,type:"canvas"}}function Bl(o){return{version:0,id:o,type:"folder"}}function rx(o,e,t,r,s){return s||(s=Date.now()),{version:0,id:e,type:o,mimetype:t,synctime:s,hash:r}}var zu=class extends dt{constructor(t,r){super();this.syncSettings=t;this.configs=r;this.protocols=new Map;r=r||zu.defaults,r.forEach(([s,n])=>this.protocols.set(s,n)),this.unsubscribes.push(t.subscribe(s=>{this.updateFromSettings(s)}))}setEnabled(t,r){let s=this.protocols.get(t);s&&this.protocols.set(t,{...s,enabled:r})}canSync(t,r){var a,i;if(t.endsWith(".md")||Ge().enableCanvasSync&&t.endsWith(".canvas")||!((a=t.split("/").pop())==null?void 0:a.includes(".")))return!0;if(!Ge().enableAttachmentSync)return!1;if(r){let l=this.protocols.get(r.type);return l?l.enabled&&r.version<=l.maxVersion:!1}let n=this.getTypeForPath(t);return!!((i=this.protocols.get(n))!=null&&i.enabled)}updateFromSettings(t){Object.entries(AL).forEach(([r,s])=>{this.setEnabled(s,t[r])})}getEnabledFileSyncTypes(){if(!Ge().enableAttachmentSync)return["markdown","canvas"];let t=[];return this.protocols.forEach((r,s)=>{r!=null&&r.enabled&&s!=="folder"&&t.push(s)}),t}getTypeForPath(t){let r=Ss(t);for(let[s,n]of this.protocols)if(n.mimetypes.includes(r))return!Ge().enableCanvasSync&&s==="canvas"?"file":s;return"file"}},li=zu;li.defaults=[["folder",{maxVersion:0,mimetypes:[],enabled:!0}],["markdown",{maxVersion:0,mimetypes:["text/markdown"],enabled:!0}],["image",{maxVersion:0,mimetypes:["image/png","image/jpeg","image/gif","image/svg+xml","image/webp","image/avif","image/bmp"],enabled:!0}],["pdf",{maxVersion:0,mimetypes:["application/pdf"],enabled:!0}],["audio",{maxVersion:0,mimetypes:["audio/mpeg","audio/wav","audio/flac","audio/mp4","audio/x-m4a","audio/ogg","audio/opus"],enabled:!0}],["video",{maxVersion:0,mimetypes:["video/mp4","video/webm","video/ogg","video/quicktime","video/x-matroska"],enabled:!0}],["canvas",{maxVersion:0,mimetypes:["application/canvas+json"],enabled:!0}],["file",{maxVersion:0,mimetypes:["application/octet-stream"],enabled:!1}]];var Nl=class extends dt{constructor(t,r,s,n){super();this.ydoc=t;this.namespace=r;this.pendingUpload=s;this.syncSettingsManager=n;this.legacyIds=this.ydoc.getMap("docs"),this.meta=this.ydoc.getMap("filemeta_v0"),this.overlay=new Map,this.renames=new Map,this.deleteSet=new Set,this.typeRegistry=new li(this.syncSettingsManager)}assertVPath(t){if(t.startsWith(this.namespace+xo.sep))throw new Error("Expected virtual path"+t)}print(){this.log("files",Array.from(this.meta.entries()).map(([t,r])=>({path:t,...r}))),this.log("pending...",Array.from(this.pendingUpload.entries()).map(([t,r])=>({path:t,guid:r})))}canSync(t){let r=this.getMeta(t);return this.typeRegistry.canSync(t,r)}resolveMove(t){this.log("resolving alias",t),this.renames.delete(t)}resolveAll(){this.renames.clear()}move(t,r){this.log("moving file",t,"to",r),this.assertVPath(t),this.assertVPath(r),this.renames.set(t,r);let s=this.pendingUpload.get(t);s&&(this.pendingUpload.set(r,s),this.pendingUpload.delete(t)),this.deleteSet.has(t)&&(this.deleteSet.add(r),this.deleteSet.delete(t));let n=this.overlay.get(t);n&&(this.overlay.set(r,n),this.overlay.delete(t));let a=this.meta.get(t);ex(a)?this.moveFolder(t,r):a&&(this.set(r,a),this.delete(t))}new(t){this.assertVPath(t);let r=ta();return this.pendingUpload.set(t,r),r}forEach(t){this.meta.forEach((r,s)=>{this.deleteSet.has(s)||t(r,s)}),this.overlay.forEach((r,s)=>{this.deleteSet.has(s)||t(r,s)})}has(t){return this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t)?!1:this.meta.has(t)||this.legacyIds.has(t)||this.overlay.has(t)||this.pendingUpload.has(t)}set(t,r){this.assertVPath(t),Wu(r)&&this.legacyIds.get(t)!==r.id&&this.legacyIds.set(t,r.id);let s=this.meta.get(t);s&&s.id===r.id&&s.mimetype==r.mimetype&&s.type===r.type&&s.hash===r.hash||(this.log("metadata write (path, existing, meta)",t,s,r),this.meta.set(t,r),this.pendingUpload.has(t)&&this.pendingUpload.delete(t))}processFolderOperation(t){let r=new Map,s=new Map;t.changes.keys.forEach((n,a)=>{if(n.action==="delete"){let i=n.oldValue;(i==null?void 0:i.type)==="folder"&&r.set(i.id,a)}else if(n.action==="add"||n.action==="update"){let i=this.meta.get(a);(i==null?void 0:i.type)==="folder"&&s.set(i.id,a)}}),r.forEach((n,a)=>{let i=s.get(a);if(i&&n!==i){this.log(`Detected folder move from ${n} to ${i}`);let l=new Map;this.meta.forEach((c,u)=>{u.startsWith(i+xo.sep)&&l.set(u,c)}),this.renames.set(n,i),this.log("setting alias",n,i),this.log("paths to move",l),l.forEach((c,u)=>{let d=u.slice(i.length),m=n+d;this.renames.set(m,u),this.log("setting alias",m,u)})}})}start(){Go(yo.enableDeltaLogging,()=>{let s=n=>{var i,l;let a="";a+=`Transaction origin: ${n.transaction.origin}${(l=(i=n.transaction.origin)==null?void 0:i.constructor)==null?void 0:l.name}
`,n.changes.keys.forEach((c,u)=>{c.action==="add"&&(a+=`Added ${u}: ${this.get(u)}
`),c.action==="update"&&(a+=`Updated ${u}: ${this.get(u)}
`),c.action==="delete"&&(a+=`Deleted ${u}
`)}),this.debug(a)};this.legacyIds.observe(s),this.meta.observe(s),this.unsubscribes.push(()=>{this.legacyIds.unobserve(s)}),this.unsubscribes.push(()=>{this.meta.unobserve(s)})});let t=async s=>{if(s.changes.keys.size===0){this.log("no changes detected");return}s.transaction.origin!=this&&(this.processFolderOperation(s),this.notifyListeners())},r=async s=>{this.migrateUp(),this.notifyListeners()};this.legacyIds.observe(r),this.meta.observe(t),this.unsubscribes.push(()=>{this.legacyIds.unobserve(r)}),this.unsubscribes.push(()=>{this.meta.unobserve(t)}),this.unsubscribes.push(this.typeRegistry.subscribe(()=>{this.log("type registry change"),this.notifyListeners()}))}get(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.pendingUpload.get(t);if(r)return r;let s=this.getMeta(t);if(s)return s.id}getMeta(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.meta.get(t)||this.overlay.get(t),s=this.legacyIds.has(t);if(!r&&this.legacyIds.has(t)){let n=this.legacyIds.get(t),a=ci(n);return this.overlay.set(t,a),a}if(r){if(Wu(r)&&!s){this.deleteSet.add(t);return}return r}}delete(t){return this.assertVPath(t),this.legacyIds.delete(t),this.pendingUpload.delete(t),this.meta.delete(t)}get remoteIds(){let t=new Set;return this.forEach(r=>{t.add(r.id)}),t}commit(){this.overlay.size>0&&this.log("committing overlay",[...this.overlay.keys()]),this.overlay.forEach((t,r)=>{this.set(r,t),t.type==="markdown"&&this.legacyIds.get(r)!==t.id&&this.legacyIds.set(r,t.id)}),this.overlay=new Map,this.deleteSet.size>0&&this.log("committing deleteSet",[...this.deleteSet]),this.deleteSet.forEach(t=>this.delete(t)),this.deleteSet=new Set}detectFolderMoves(){let t=new Map,r=new Set;this.legacyIds.forEach((n,a)=>{let i;if(this.meta.forEach((l,c)=>{l.type==="markdown"&&l.id===n&&c!==a&&(i=c)}),i){let l=(0,xo.dirname)(i),c=(0,xo.dirname)(a);l!==c&&t.set(l,c)}}),Array.from(t.entries()).sort(([n],[a])=>a.length-n.length).forEach(([n,a])=>{r.has(n)||(this.moveFolder(n,a),r.add(n))})}moveFolder(t,r){this.log("moving folder",t,"to",r);let s=new Map;this.meta.forEach((a,i)=>{(i===t||i.startsWith(t+xo.sep))&&s.set(i,a)}),this.overlay.forEach((a,i)=>{(i===t||i.startsWith(t+xo.sep))&&s.set(i,a)});let n=this.meta.get(t);n&&(this.meta.set(r,n),this.meta.delete(t)),s.forEach((a,i)=>{if(i===t)return;let l=i.slice(t.length),c=r+l;this.move(i,c)})}markUploaded(t,r){if(!this.has(t))throw new Error(`unexpected vpath ${t} marked uploaded`);this.set(t,r)}migrateFile(t,r){var i;if(this.assertVPath(r),((i=this.meta.get(r))==null?void 0:i.id)===t)return;let s=new Set,n=r.split(xo.sep),a="";for(let l=0;l<n.length-1;l++)a=n.slice(0,l+1).join(xo.sep),s.add(a);this.meta.has(r)||this.overlay.has(r)||r.endsWith(".md")&&(this.warn(`migrated legacy key on ${r}`),this.overlay.set(r,ci(t))),s.forEach(l=>{if(l&&!(this.meta.has(l)||this.overlay.has(l))){let c=ta();console.log("creating folder path",l,c),this.overlay.set(l,Bl(c))}})}migrateUp(){this.detectFolderMoves(),this.legacyIds.forEach((t,r)=>{this.migrateFile(t,r)})}destroy(){super.destroy(),this.overlay.clear(),this.deleteSet.clear(),this.renames.clear(),this.legacyIds=null,this.meta=null}};function ox(o,e,t=(r,s)=>r.substring(s.length).replace(/^\/+/,"")){return new Proxy(o,{get(r,s){let n=r[s];return typeof n=="function"?function(...a){return a.length>0&&typeof a[0]=="string"&&(a[0]=t(a[0],e)),n.apply(r,a)}:n}})}var fx=require("obsidian"),ux=require("obsidian");if(globalThis.Response===void 0||globalThis.Headers===void 0)try{if(console.warn("[Relay] Polyfilling Fetch API (Electron Bug: https://github.com/electron/electron/pull/42419)"),globalThis.blinkfetch){globalThis.fetch=globalThis.blinkFetch;let o=["fetch","Response","FormData","Request","Headers"];for(let e of o)globalThis[e]=globalThis[`blink${e}`]}}catch(o){console.error(o)}globalThis.EventSource===void 0&&(ux.Platform.isMobile?console.warn("[Relay] Polyfilling EventSource API required, but unable to polyfill on Mobile"):(console.warn("[Relay] Polyfilling EventSource API"),globalThis.EventSource=cx()));var Rt=async(o,e)=>{let t=o instanceof URL?o.toString():o,r=(e==null?void 0:e.method)||"GET",s=Object.assign({},e==null?void 0:e.headers,{"Relay-Version":"0.5.4"}),n={url:t,method:r,body:e==null?void 0:e.body,headers:s,throw:!1},a;if(a=await(0,fx.requestUrl)(n),!a.arrayBuffer.byteLength)return new Response(null,{status:a.status,statusText:a.status.toString(),headers:new Headers(a.headers)});let i=new Response(a.arrayBuffer,{status:a.status,statusText:a.status.toString(),headers:new Headers(a.headers)});if(Object.defineProperty(i,"json",{value:async()=>JSON.parse(a.text)}),Ge().enableNetworkLogging){let c=a.status>=500?"error":a.status>=400?"warn":"debug",u=a.text,d;if((a.headers["content-type"]||"").includes("application/json"))try{d=JSON.parse(u)}catch(g){}Te("[CustomFetch]",c)(a.status.toString(),r,t,d||u)}if(a.status>=500)throw new Error(a.text);return i};var nr=class extends Error{constructor(e){var t,r,s,n;super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,nr.prototype),e!==null&&typeof e=="object"&&(this.url=typeof e.url=="string"?e.url:"",this.status=typeof e.status=="number"?e.status:0,this.isAbort=!!e.isAbort,this.originalError=e.originalError,e.response!==null&&typeof e.response=="object"?this.response=e.response:e.data!==null&&typeof e.data=="object"?this.response=e.data:this.response={}),this.originalError||e instanceof nr||(this.originalError=e),typeof DOMException!="undefined"&&e instanceof DOMException&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=(t=this.response)==null?void 0:t.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":(n=(s=(r=this.originalError)==null?void 0:r.cause)==null?void 0:s.message)!=null&&n.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong while processing your request.")}get data(){return this.response}toJSON(){return{...this}}},Hl=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function KL(o,e){let t={};if(typeof o!="string")return t;let r=Object.assign({},e||{}).decode||GL,s=0;for(;s<o.length;){let n=o.indexOf("=",s);if(n===-1)break;let a=o.indexOf(";",s);if(a===-1)a=o.length;else if(a<n){s=o.lastIndexOf(";",n-1)+1;continue}let i=o.slice(s,n).trim();if(t[i]===void 0){let l=o.slice(n+1,a).trim();l.charCodeAt(0)===34&&(l=l.slice(1,-1));try{t[i]=r(l)}catch(c){t[i]=l}}s=a+1}return t}function dx(o,e,t){let r=Object.assign({},t||{}),s=r.encode||jL;if(!Hl.test(o))throw new TypeError("argument name is invalid");let n=s(e);if(n&&!Hl.test(n))throw new TypeError("argument val is invalid");let a=o+"="+n;if(r.maxAge!=null){let i=r.maxAge-0;if(isNaN(i)||!isFinite(i))throw new TypeError("option maxAge is invalid");a+="; Max-Age="+Math.floor(i)}if(r.domain){if(!Hl.test(r.domain))throw new TypeError("option domain is invalid");a+="; Domain="+r.domain}if(r.path){if(!Hl.test(r.path))throw new TypeError("option path is invalid");a+="; Path="+r.path}if(r.expires){if(!function(l){return Object.prototype.toString.call(l)==="[object Date]"||l instanceof Date}(r.expires)||isNaN(r.expires.valueOf()))throw new TypeError("option expires is invalid");a+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(a+="; HttpOnly"),r.secure&&(a+="; Secure"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():r.priority){case"low":a+="; Priority=Low";break;case"medium":a+="; Priority=Medium";break;case"high":a+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:a+="; SameSite=Strict";break;case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;case"none":a+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return a}function GL(o){return o.indexOf("%")!==-1?decodeURIComponent(o):o}function jL(o){return encodeURIComponent(o)}var hx;function Vl(o){if(o)try{let e=decodeURIComponent(hx(o.split(".")[1]).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(e)||{}}catch(e){}return{}}function gx(o,e=0){let t=Vl(o);return!(Object.keys(t).length>0&&(!t.exp||t.exp-e>Date.now()/1e3))}hx=typeof atob=="function"?atob:o=>{let e=String(o).replace(/=+$/,"");if(e.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,s=0,n=0,a="";r=e.charAt(n++);~r&&(t=s%4?64*t+r:r,s++%4)?a+=String.fromCharCode(255&t>>(-2*s&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return a};var px="pb_auth",ui=class{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get model(){return this.baseModel}get isValid(){return!gx(this.token)}get isAdmin(){return Vl(this.token).type==="admin"}get isAuthRecord(){return Vl(this.token).type==="authRecord"}save(e,t){this.baseToken=e||"",this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=px){let r=KL(e||"")[t]||"",s={};try{s=JSON.parse(r),(typeof s===null||typeof s!="object"||Array.isArray(s))&&(s={})}catch(n){}this.save(s.token||"",s.model||null)}exportToCookie(e,t=px){var l,c;let r={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},s=Vl(this.token);r.expires=s!=null&&s.exp?new Date(1e3*s.exp):new Date("1970-01-01"),e=Object.assign({},r,e);let n={token:this.token,model:this.model?JSON.parse(JSON.stringify(this.model)):null},a=dx(t,JSON.stringify(n),e),i=typeof Blob!="undefined"?new Blob([a]).size:a.length;if(n.model&&i>4096){n.model={id:(l=n==null?void 0:n.model)==null?void 0:l.id,email:(c=n==null?void 0:n.model)==null?void 0:c.email};let u=["collectionId","username","verified"];for(let d in this.model)u.includes(d)&&(n.model[d]=this.model[d]);a=dx(t,JSON.stringify(n),e)}return a}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.model),()=>{for(let r=this._onChangeCallbacks.length-1;r>=0;r--)if(this._onChangeCallbacks[r]==e)return delete this._onChangeCallbacks[r],void this._onChangeCallbacks.splice(r,1)}}triggerChange(){for(let e of this._onChangeCallbacks)e&&e(this.token,this.model)}},Gu=class extends ui{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(e,t){this._storageSet(this.storageKey,{token:e,model:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch(r){return t}}return this.storageFallback[e]}_storageSet(e,t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=t;typeof t!="string"&&(r=JSON.stringify(t)),window.localStorage.setItem(e,r)}else this.storageFallback[e]=t}_storageRemove(e){var t;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((t=window.localStorage)==null||t.removeItem(e)),delete this.storageFallback[e]}_bindStorageEvent(){typeof window!="undefined"&&(window!=null&&window.localStorage)&&window.addEventListener&&window.addEventListener("storage",e=>{if(e.key!=this.storageKey)return;let t=this._storageGet(this.storageKey)||{};super.save(t.token||"",t.model||null)})}},Jo=class{constructor(e){this.client=e}},ju=class extends Jo{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,t){return t=Object.assign({method:"PATCH",body:e},t),this.client.send("/api/settings",t)}async testS3(e="storage",t){return t=Object.assign({method:"POST",body:{filesystem:e}},t),this.client.send("/api/settings/test/s3",t).then(()=>!0)}async testEmail(e,t,r){return r=Object.assign({method:"POST",body:{email:e,template:t}},r),this.client.send("/api/settings/test/email",r).then(()=>!0)}async generateAppleClientSecret(e,t,r,s,n,a){return a=Object.assign({method:"POST",body:{clientId:e,teamId:t,keyId:r,privateKey:s,duration:n}},a),this.client.send("/api/settings/apple/generate-client-secret",a)}},di=class extends Jo{decode(e){return e}async getFullList(e,t){if(typeof e=="number")return this._getFullList(e,t);let r=500;return(t=Object.assign({},e,t)).batch&&(r=t.batch,delete t.batch),this._getFullList(r,t)}async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send(this.baseCrudPath,r).then(s=>{var n;return s.items=((n=s.items)==null?void 0:n.map(a=>this.decode(a)))||[],s})}async getFirstListItem(e,t){return(t=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then(r=>{var s;if(!((s=r==null?void 0:r.items)!=null&&s.length))throw new nr({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return r.items[0]})}async getOne(e,t){if(!e)throw new nr({url:this.client.buildUrl(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(r=>this.decode(r))}async create(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send(this.baseCrudPath,t).then(r=>this.decode(r))}async update(e,t,r){return r=Object.assign({method:"PATCH",body:t},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),r).then(s=>this.decode(s))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(()=>!0)}_getFullList(e=500,t){(t=t||{}).query=Object.assign({skipTotal:1},t.query);let r=[],s=async n=>this.getList(n,e||500,t).then(a=>{let i=a.items;return r=r.concat(i),i.length==a.perPage?s(n+1):r});return s(1)}};function Sr(o,e,t,r){let s=r!==void 0;return s||t!==void 0?s?(console.warn(o),e.body=Object.assign({},e.body,t),e.query=Object.assign({},e.query,r),e):Object.assign(e,t):e}function Ku(o){var e;(e=o._resetAutoRefresh)==null||e.call(o)}var Yu=class extends di{get baseCrudPath(){return"/api/admins"}async update(e,t,r){return super.update(e,t,r).then(s=>{var n,a;return((n=this.client.authStore.model)==null?void 0:n.id)===s.id&&((a=this.client.authStore.model)==null?void 0:a.collectionId)===void 0&&this.client.authStore.save(this.client.authStore.token,s),s})}async delete(e,t){return super.delete(e,t).then(r=>{var s,n;return r&&((s=this.client.authStore.model)==null?void 0:s.id)===e&&((n=this.client.authStore.model)==null?void 0:n.collectionId)===void 0&&this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.admin)||{});return e!=null&&e.token&&(e!=null&&e.admin)&&this.client.authStore.save(e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",admin:t})}async authWithPassword(e,t,r,s){let n={method:"POST",body:{identity:e,password:t}};n=Sr("This form of authWithPassword(email, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(email, pass, options?).",n,r,s);let a=n.autoRefreshThreshold;delete n.autoRefreshThreshold,n.autoRefresh||Ku(this.client);let i=await this.client.send(this.baseCrudPath+"/auth-with-password",n);return i=this.authResponse(i),a&&function(c,u,d,m){Ku(c);let g=c.beforeSend,h=c.authStore.model,_=c.authStore.onChange((w,v)=>{(!w||(v==null?void 0:v.id)!=(h==null?void 0:h.id)||(v!=null&&v.collectionId||h!=null&&h.collectionId)&&(v==null?void 0:v.collectionId)!=(h==null?void 0:h.collectionId))&&Ku(c)});c._resetAutoRefresh=function(){_(),c.beforeSend=g,delete c._resetAutoRefresh},c.beforeSend=async(w,v)=>{var M;let A=c.authStore.token;if((M=v.query)!=null&&M.autoRefresh)return g?g(w,v):{url:w,sendOptions:v};let O=c.authStore.isValid;if(O&&gx(c.authStore.token,u))try{await d()}catch(R){O=!1}O||await m();let E=v.headers||{};for(let R in E)if(R.toLowerCase()=="authorization"&&A==E[R]&&c.authStore.token){E[R]=c.authStore.token;break}return v.headers=E,g?g(w,v):{url:w,sendOptions:v}}}(this.client,a,()=>this.authRefresh({autoRefresh:!0}),()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},n))),i}async authRefresh(e,t){let r={method:"POST"};return r=Sr("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCrudPath+"/auth-refresh",r).then(this.authResponse.bind(this))}async requestPasswordReset(e,t,r){let s={method:"POST",body:{email:e}};return s=Sr("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",s,t,r),this.client.send(this.baseCrudPath+"/request-password-reset",s).then(()=>!0)}async confirmPasswordReset(e,t,r,s,n){let a={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return a=Sr("This form of confirmPasswordReset(resetToken, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(resetToken, password, passwordConfirm, options?).",a,s,n),this.client.send(this.baseCrudPath+"/confirm-password-reset",a).then(()=>!0)}},YL=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function yx(o){if(o){o.query=o.query||{};for(let e in o)YL.includes(e)||(o.query[e]=o[e],delete o[e])}}var ql=class extends Jo{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,r){var a;if(!e)throw new Error("topic must be set.");let s=e;if(r){yx(r);let i="options="+encodeURIComponent(JSON.stringify({query:r.query,headers:r.headers}));s+=(s.includes("?")?"&":"?")+i}let n=function(i){let l=i,c;try{c=JSON.parse(l==null?void 0:l.data)}catch(u){}t(c||{})};return this.subscriptions[s]||(this.subscriptions[s]=[]),this.subscriptions[s].push(n),this.isConnected?this.subscriptions[s].length===1?await this.submitSubscriptions():(a=this.eventSource)==null||a.addEventListener(s,n):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,n)}async unsubscribe(e){var r;let t=!1;if(e){let s=this.getSubscriptionsByTopic(e);for(let n in s)if(this.hasSubscriptionListeners(n)){for(let a of this.subscriptions[n])(r=this.eventSource)==null||r.removeEventListener(n,a);delete this.subscriptions[n],t||(t=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){var r;let t=!1;for(let s in this.subscriptions)if((s+"?").startsWith(e)){t=!0;for(let n of this.subscriptions[s])(r=this.eventSource)==null||r.removeEventListener(s,n);delete this.subscriptions[s]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){var n;let r=!1,s=this.getSubscriptionsByTopic(e);for(let a in s){if(!Array.isArray(this.subscriptions[a])||!this.subscriptions[a].length)continue;let i=!1;for(let l=this.subscriptions[a].length-1;l>=0;l--)this.subscriptions[a][l]===t&&(i=!0,delete this.subscriptions[a][l],this.subscriptions[a].splice(l,1),(n=this.eventSource)==null||n.removeEventListener(a,t));i&&(this.subscriptions[a].length||delete this.subscriptions[a],r||this.hasSubscriptionListeners(a)||(r=!0))}this.hasSubscriptionListeners()?r&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){var t,r;if(this.subscriptions=this.subscriptions||{},e)return!!((t=this.subscriptions[e])!=null&&t.length);for(let s in this.subscriptions)if((r=this.subscriptions[s])!=null&&r.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch(e=>{if(!(e!=null&&e.isAbort))throw e})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){let t={};e=e.includes("?")?e:e+"?";for(let r in this.subscriptions)(r+"?").startsWith(e)&&(t[r]=this.subscriptions[r]);return t}getNonEmptySubscriptionKeys(){let e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildUrl("/api/realtime")),this.eventSource.onerror=e=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",e=>{let t=e;this.clientId=t==null?void 0:t.lastEventId,this.submitSubscriptions().then(async()=>{let r=3;for(;this.hasUnsentSubscriptions()&&r>0;)r--,await this.submitSubscriptions()}).then(()=>{for(let s of this.pendingConnects)s.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);let r=this.getSubscriptionsByTopic("PB_CONNECT");for(let s in r)for(let n of r[s])n(e)}).catch(r=>{this.clientId="",this.connectErrorHandler(r)})})}hasUnsentSubscriptions(){let e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(let t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let r of this.pendingConnects)r.reject(new nr(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);let t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},t)}disconnect(e=!1){var t;if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),(t=this.eventSource)==null||t.close(),this.eventSource=null,this.clientId="",!e){this.reconnectAttempts=0;for(let r of this.pendingConnects)r.resolve();this.pendingConnects=[]}}},Ju=class extends di{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}async subscribe(e,t,r){if(!e)throw new Error("Missing topic.");if(!t)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,t,r)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if(typeof e=="number")return super.getFullList(e,t);let r=Object.assign({},e,t);return super.getFullList(r)}async getList(e=1,t=30,r){return super.getList(e,t,r)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,r){return super.update(e,t,r).then(s=>{var n,a,i;return((n=this.client.authStore.model)==null?void 0:n.id)!==(s==null?void 0:s.id)||((a=this.client.authStore.model)==null?void 0:a.collectionId)!==this.collectionIdOrName&&((i=this.client.authStore.model)==null?void 0:i.collectionName)!==this.collectionIdOrName||this.client.authStore.save(this.client.authStore.token,s),s})}async delete(e,t){return super.delete(e,t).then(r=>{var s,n,a;return!r||((s=this.client.authStore.model)==null?void 0:s.id)!==e||((n=this.client.authStore.model)==null?void 0:n.collectionId)!==this.collectionIdOrName&&((a=this.client.authStore.model)==null?void 0:a.collectionName)!==this.collectionIdOrName||this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.record)||{});return this.client.authStore.save(e==null?void 0:e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",record:t})}async listAuthMethods(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e).then(t=>Object.assign({},t,{usernamePassword:!!(t!=null&&t.usernamePassword),emailPassword:!!(t!=null&&t.emailPassword),authProviders:Array.isArray(t==null?void 0:t.authProviders)?t==null?void 0:t.authProviders:[]}))}async authWithPassword(e,t,r,s){let n={method:"POST",body:{identity:e,password:t}};return n=Sr("This form of authWithPassword(usernameOrEmail, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(usernameOrEmail, pass, options?).",n,r,s),this.client.send(this.baseCollectionPath+"/auth-with-password",n).then(a=>this.authResponse(a))}async authWithOAuth2Code(e,t,r,s,n,a,i){let l={method:"POST",body:{provider:e,code:t,codeVerifier:r,redirectUrl:s,createData:n}};return l=Sr("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, options?).",l,a,i),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",l).then(c=>this.authResponse(c))}async authWithOAuth2(...e){if(e.length>1||typeof(e==null?void 0:e[0])=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code((e==null?void 0:e[0])||"",(e==null?void 0:e[1])||"",(e==null?void 0:e[2])||"",(e==null?void 0:e[3])||"",(e==null?void 0:e[4])||{},(e==null?void 0:e[5])||{},(e==null?void 0:e[6])||{});let t=(e==null?void 0:e[0])||{},r=(await this.listAuthMethods()).authProviders.find(l=>l.name===t.provider);if(!r)throw new nr(new Error(`Missing or invalid provider "${t.provider}".`));let s=this.client.buildUrl("/api/oauth2-redirect"),n=new ql(this.client),a=null;function i(){a==null||a.close(),n.unsubscribe()}return t.urlCallback||(a=mx(void 0)),new Promise(async(l,c)=>{var u;try{await n.subscribe("@oauth2",async h=>{let _=n.clientId;try{if(!h.state||_!==h.state)throw new Error("State parameters don't match.");let w=Object.assign({},t);delete w.provider,delete w.scopes,delete w.createData,delete w.urlCallback;let v=await this.authWithOAuth2Code(r.name,h.code,r.codeVerifier,s,t.createData,w);l(v)}catch(w){c(new nr(w))}i()});let d={state:n.clientId};(u=t.scopes)!=null&&u.length&&(d.scope=t.scopes.join(" "));let m=this._replaceQueryParams(r.authUrl+s,d);await(t.urlCallback||function(h){a?a.location.href=h:a=mx(h)})(m)}catch(d){i(),c(new nr(d))}})}async authRefresh(e,t){let r={method:"POST"};return r=Sr("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCollectionPath+"/auth-refresh",r).then(s=>this.authResponse(s))}async requestPasswordReset(e,t,r){let s={method:"POST",body:{email:e}};return s=Sr("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/request-password-reset",s).then(()=>!0)}async confirmPasswordReset(e,t,r,s,n){let a={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return a=Sr("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",a,s,n),this.client.send(this.baseCollectionPath+"/confirm-password-reset",a).then(()=>!0)}async requestVerification(e,t,r){let s={method:"POST",body:{email:e}};return s=Sr("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/request-verification",s).then(()=>!0)}async confirmVerification(e,t,r){let s={method:"POST",body:{token:e}};return s=Sr("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/confirm-verification",s).then(()=>!0)}async requestEmailChange(e,t,r){let s={method:"POST",body:{newEmail:e}};return s=Sr("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/request-email-change",s).then(()=>!0)}async confirmEmailChange(e,t,r,s){let n={method:"POST",body:{token:e,password:t}};return n=Sr("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",n,r,s),this.client.send(this.baseCollectionPath+"/confirm-email-change",n).then(()=>!0)}async listExternalAuths(e,t){return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths",t)}async unlinkExternalAuth(e,t,r){return r=Object.assign({method:"DELETE"},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths/"+encodeURIComponent(t),r).then(()=>!0)}_replaceQueryParams(e,t={}){let r=e,s="";e.indexOf("?")>=0&&(r=e.substring(0,e.indexOf("?")),s=e.substring(e.indexOf("?")+1));let n={},a=s.split("&");for(let i of a){if(i=="")continue;let l=i.split("=");n[decodeURIComponent(l[0].replace(/\+/g," "))]=decodeURIComponent((l[1]||"").replace(/\+/g," "))}for(let i in t)t.hasOwnProperty(i)&&(t[i]==null?delete n[i]:n[i]=t[i]);s="";for(let i in n)n.hasOwnProperty(i)&&(s!=""&&(s+="&"),s+=encodeURIComponent(i.replace(/%20/g,"+"))+"="+encodeURIComponent(n[i].replace(/%20/g,"+")));return s!=""?r+"?"+s:r}};function mx(o){if(typeof window=="undefined"||!(window!=null&&window.open))throw new nr(new Error("Not in a browser context - please pass a custom urlCallback function."));let e=1024,t=768,r=window.innerWidth,s=window.innerHeight;e=e>r?r:e,t=t>s?s:t;let n=r/2-e/2,a=s/2-t/2;return window.open(o,"popup_window","width="+e+",height="+t+",top="+a+",left="+n+",resizable,menubar=no")}var Qu=class extends di{get baseCrudPath(){return"/api/collections"}async import(e,t=!1,r){return r=Object.assign({method:"PUT",body:{collections:e,deleteMissing:t}},r),this.client.send(this.baseCrudPath+"/import",r).then(()=>!0)}},Xu=class extends Jo{async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send("/api/logs",r)}async getOne(e,t){if(!e)throw new nr({url:this.client.buildUrl("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/"+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}},Zu=class extends Jo{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}},ed=class extends Jo{getUrl(e,t,r={}){if(!t||!(e!=null&&e.id)||!(e!=null&&e.collectionId)&&!(e!=null&&e.collectionName))return"";let s=[];s.push("api"),s.push("files"),s.push(encodeURIComponent(e.collectionId||e.collectionName)),s.push(encodeURIComponent(e.id)),s.push(encodeURIComponent(t));let n=this.client.buildUrl(s.join("/"));if(Object.keys(r).length){r.download===!1&&delete r.download;let a=new URLSearchParams(r);n+=(n.includes("?")?"&":"?")+a}return n}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then(t=>(t==null?void 0:t.token)||"")}},td=class extends Jo{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,t){return t=Object.assign({method:"POST",body:{name:e}},t),this.client.send("/api/backups",t).then(()=>!0)}async upload(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send("/api/backups/upload",t).then(()=>!0)}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then(()=>!0)}async restore(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then(()=>!0)}getDownloadUrl(e,t){return this.client.buildUrl(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}},ra=class{constructor(e="/",t,r="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseUrl=e,this.lang=r,this.authStore=t||new Gu,this.admins=new Yu(this),this.collections=new Qu(this),this.files=new ed(this),this.logs=new Xu(this),this.settings=new ju(this),this.realtime=new ql(this),this.health=new Zu(this),this.backups=new td(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new Ju(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let r in t){let s=t[r];switch(typeof s){case"boolean":case"number":s=""+s;break;case"string":s="'"+s.replace(/'/g,"\\'")+"'";break;default:s=s===null?"null":s instanceof Date?"'"+s.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(s).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+r+"}",s)}return e}getFileUrl(e,t,r={}){return this.files.getUrl(e,t,r)}buildUrl(e){var r;let t=this.baseUrl;return typeof window=="undefined"||!window.location||t.startsWith("https://")||t.startsWith("http://")||(t=(r=window.location.origin)!=null&&r.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseUrl.startsWith("/")||(t+=window.location.pathname||"/",t+=t.endsWith("/")?"":"/"),t+=this.baseUrl),e&&(t+=t.endsWith("/")?"":"/",t+=e.startsWith("/")?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let r=this.buildUrl(e);if(this.beforeSend){let s=Object.assign({},await this.beforeSend(r,t));s.url!==void 0||s.options!==void 0?(r=s.url||r,t=s.options||t):Object.keys(s).length&&(t=s,console!=null&&console.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(t.query!==void 0){let s=this.serializeQueryParams(t.query);s&&(r+=(r.includes("?")?"&":"?")+s),delete t.query}return this.getHeader(t.headers,"Content-Type")=="application/json"&&t.body&&typeof t.body!="string"&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(r,t).then(async s=>{let n={};try{n=await s.json()}catch(a){}if(this.afterSend&&(n=await this.afterSend(s,n)),s.status>=400)throw new nr({url:s.url,status:s.status,data:n});return n}).catch(s=>{throw new nr(s)})}initSendOptions(e,t){if((t=Object.assign({method:"GET"},t)).body=this.convertToFormDataIfNeeded(t.body),yx(t),t.query=Object.assign({},t.params,t.query),t.requestKey===void 0&&(t.$autoCancel===!1||t.query.$autoCancel===!1?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,this.getHeader(t.headers,"Content-Type")!==null||this.isFormData(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":"application/json"})),this.getHeader(t.headers,"Accept-Language")===null&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(t.headers,"Authorization")===null&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&t.requestKey!==null){let r=t.requestKey||(t.method||"GET")+e;delete t.requestKey,this.cancelRequest(r);let s=new AbortController;this.cancelControllers[r]=s,t.signal=s.signal}return t}convertToFormDataIfNeeded(e){if(typeof FormData=="undefined"||e===void 0||typeof e!="object"||e===null||this.isFormData(e)||!this.hasBlobField(e))return e;let t=new FormData;for(let r in e){let s=this.normalizeFormDataValue(e[r]),n=Array.isArray(s)?s:[s];if(n.length)for(let a of n)t.append(r,a);else t.append(r,"")}return t}normalizeFormDataValue(e){return e===null||typeof e!="object"||e instanceof Date||this.hasBlobField({data:e})||Array.isArray(e)&&!e.filter(t=>typeof t!="string").length?e:JSON.stringify(e)}hasBlobField(e){for(let t in e){let r=Array.isArray(e[t])?e[t]:[e[t]];for(let s of r)if(typeof Blob!="undefined"&&s instanceof Blob||typeof File!="undefined"&&s instanceof File)return!0}return!1}getHeader(e,t){e=e||{},t=t.toLowerCase();for(let r in e)if(r.toLowerCase()==t)return e[r];return null}isFormData(e){return e&&(e.constructor.name==="FormData"||typeof FormData!="undefined"&&e instanceof FormData)}serializeQueryParams(e){let t=[];for(let r in e){if(e[r]===null)continue;let s=e[r],n=encodeURIComponent(r);if(Array.isArray(s))for(let a of s)t.push(n+"="+encodeURIComponent(a));else s instanceof Date?t.push(n+"="+encodeURIComponent(s.toISOString())):typeof s!==null&&typeof s=="object"?t.push(n+"="+encodeURIComponent(JSON.stringify(s))):t.push(n+"="+encodeURIComponent(s))}return t.join("&")}};var Wl=class extends Ft{constructor(t){super();this.pb=new ra("https://auth.system3.md",t.loginManager.authStore),this.tokenStore=t.tokenStore}async readFile(t){if(!t.meta)throw new Error("cannot pull file with missing hash");let r=t.meta.hash,s=await this.tokenStore.getFileToken(bt.encode(t.s3rn),r,t.mimetype,0),i=(await(await Rt(s.baseUrl+"/download-url",{method:"GET",headers:{Authorization:`Bearer ${s.token}`}})).json()).downloadUrl;return(await Rt(i)).arrayBuffer()}async writeFile(t){let r=await t.caf.read(),s=await t.caf.hash();if(this.log("writeFile",s),!(r&&s))throw new Error("invalid caf");let n=await this.tokenStore.getFileToken(bt.encode(t.s3rn),s,t.mimetype,r.byteLength),a=await Rt(n.baseUrl+"/upload-url",{method:"POST",headers:{Authorization:`Bearer ${n.token}`}}),i=await a.json();if(a.status!==200)throw new Error(i.error);let l=i.uploadUrl;await Rt(l,{method:"PUT",headers:{"Content-Type":t.mimetype},body:r})}destroy(){this.pb.cancelAllRequests(),this.pb=null,this.tokenStore=null}};var mr=class extends Error{constructor(t,r){super(t);this.path=r;this.name="SettingsError"}};var zl=class extends dt{constructor(t,r){super();this.storage=t;this.defaults=r;this._loaded=!1;this.data={...r}}async load(){let t=await this.storage.loadData();this.data={...this.defaults,...t||{}},this._loaded=!0,this.log("Loaded settings from disk:",this.data)}async save(){if(!this._loaded){this.warn("Attempted to save before loading settings from disk");return}this.log("Saving settings to disk:",this.data),await this.storage.saveData(this.data)}get(){return this.data}async update(t){if(!this._loaded){this.warn("Attempted to update before loading settings from disk");return}let r=t(this.data),s=await this.storage.loadData();if(JSON.stringify(r)===JSON.stringify(s)){this.debug("updated matches disk, no change");return}this.data=r,await this.save(),this.notifyListeners()}notifyListeners(){for(let t of this._listeners)t(this.data)}},kr=class extends dt{constructor(t,r){super();this.settings=t;this.patterns=[];this.validatePath(r),[this.path,this.basePath,this.patterns]=this.processPath(r),this.lastKnown=this.getNestedValue(this.settings.get()),this.setupSubscription()}isWildcardPattern(t){return t.type==="wildcard"}validatePath(t){if(!t)throw new mr("Path cannot be empty");if(t.startsWith("/")||t.endsWith("/"))throw new mr(`Invalid path format: ${t}`)}createPatternRegex(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace("\\*",".*")}setupSubscription(){this.unsub=this.settings.subscribe(()=>{let t=this.getNestedValue(this.settings.get());this.lastKnown===void 0&&t===void 0||JSON.stringify(this.lastKnown)!==JSON.stringify(t)&&(this.lastKnown=t,this.notifyListeners())})}hasArrayPatterns(){return this.patterns.some(t=>t.type==="arrayMatch")}destroy(){this.destroyed||(this.unsub&&(this.unsub(),this.unsub=void 0),this._listeners.clear(),this.destroyed=!0)}get(){if(this.destroyed)throw new mr("Cannot use destroyed settings",this.getPath());let t=this.settings.get();if(!t)return{};let r=this.patterns.find(this.isWildcardPattern);if(r&&this.path.length===1){let n=new RegExp(`^${r.wildcardPattern}$`);return Object.entries(t).filter(([i])=>n.test(i)).reduce((i,[l,c])=>(i[l]=c,i),{})}let s=this.getNestedValue(t);return s===void 0?{}:s}async set(t){if(this.destroyed)throw new mr("Cannot use destroyed settings",this.getPath());if(t===void 0)throw new mr("Cannot set undefined value",this.getPath());try{await this.settings.update(r=>{let s=this.patterns.find(this.isWildcardPattern);if(s){if(this.path.length===1){let l=new RegExp(`^${s.wildcardPattern}$`),c={...r};return Object.entries(t).forEach(([u,d])=>{l.test(u)&&(c[u]=d)}),c}let n={...r},a=n;this.path.forEach(l=>{a[l]=a[l]||{},a=a[l]});let i=new RegExp(`^${s.wildcardPattern}$`);return Object.entries(t).forEach(([l,c])=>{i.test(l)&&(a[l]=c)}),n}return this.setNestedValue(r,t)})}catch(r){let s=r instanceof Error?r.message:"Unknown error";throw new mr(`Failed to set value at path ${this.getPath()}: ${s}`,this.getPath())}}async update(t,r=!1){if(this.destroyed)throw new mr("Cannot use destroyed settings",this.getPath());let s=this.get(),n=t(s);!r&&JSON.stringify(s)===JSON.stringify(n)||await this.set(n)}async flush(){if(this.destroyed)throw new mr("Cannot use destroyed settings",this.getPath());await this.update(t=>t,!0)}processPath(t){let r=t.split("/").filter(i=>i),s=[],n=[],a=[];return r.forEach((i,l)=>{let c=i.match(/^\[(\w+)=(.+)\]$/),u=i.match(/^\((.+?)\)$/);if(c){let[,d,m]=c,g=l>0?n[l-1]:i.split("[")[0];a.push({type:"arrayMatch",key:d,value:m,level:l}),s.push(i),n.push(g)}else if(u){let[,d]=u;a.push({type:"wildcard",wildcardPattern:this.createPatternRegex(d),level:l}),s.push(i),n.push(i)}else s.push(i),n.push(i)}),[s,n,a]}getNestedValue(t){let r=t,s=this.patterns.find(this.isWildcardPattern);if(s&&this.path.length===1){let a=new RegExp(`^${s.wildcardPattern}$`);return Object.entries(r).filter(([l])=>a.test(l)).reduce((l,[c,u])=>(l[c]=u,l),{})}let n=this.patterns[0];if((n==null?void 0:n.type)==="arrayMatch"){let a=this.basePath[0];if(!Array.isArray(r[a]))return;let i=r[a].find(c=>c[n.key]===n.value);if(!i)return;let l=this.basePath.slice(n.level+1);if(l.length>0){let c=i;for(let u of l){if(!c||typeof c!="object")return;c=c[u]}return c}return i}for(let a=0;a<this.basePath.length;a++){if(!r)return;r=r[this.basePath[a]]}return r}setNestedValue(t,r){let s={...t},n=this.patterns.find(l=>l.type==="arrayMatch");if(n){let l=this.basePath[0];s[l]||(s[l]=[]);let c=s[l].findIndex(d=>d[n.key]===n.value),u=this.basePath.slice(n.level+1);if(c>=0)if(u.length>0){let d=s[l][c];for(let g=0;g<u.length-1;g++){let h=u[g];d[h]=d[h]||{},d=d[h]}let m=u[u.length-1];d[m]=r}else s[l][c]={...s[l][c],...r,[n.key]:n.value};else if(u.length>0){let d={[n.key]:n.value},m=d;for(let h=0;h<u.length-1;h++){let _=u[h];m[_]={},m=m[_]}let g=u[u.length-1];m[g]=r,s[l].push(d)}else s[l].push({...r,[n.key]:n.value});return s}let a=s;for(let l=0;l<this.basePath.length-1;l++){let c=this.basePath[l];a[c]=a[c]||{},a=a[c]}let i=this.basePath[this.basePath.length-1];return a[i]=r,s}getParent(){if(this.destroyed)throw new mr("Cannot use destroyed settings",this.getPath());let t=this.path.slice(0,-1).join("/");return new kr(this.settings,t)}getChild(t,r){let s=[...this.path,t].join("/");return r?r(this.settings,s):(this.log("getChild",this.path,t,s,this.patterns),new kr(this.settings,s))}getPath(){return this.path.join("/")}exists(){if(this.destroyed)throw new mr("Cannot use destroyed settings",this.getPath());let t=this.settings.get();return this.getNestedValue(t)!==void 0}async delete(){if(this.destroyed)throw new mr("Cannot use destroyed settings",this.getPath());await this.settings.update(t=>{let r={...t},s=this.patterns.find(l=>l.type==="arrayMatch");if(s){let l=this.basePath[0];return Array.isArray(r[l])&&(r[l]=r[l].filter(c=>c[s.key]!==s.value),r[l].length===0&&delete r[l]),r}let n=r,a=this.basePath.slice(0,-1);for(let l of a){if(!n[l])return r;n=n[l]}let i=this.basePath[this.basePath.length-1];return delete n[i],r})}subscribe(t){if(this.destroyed)throw new mr("Cannot use destroyed settings",this.getPath());return this._listeners.add(t),t(this.get()),()=>{this._listeners.delete(t)}}notifyListeners(){if(this.destroyed)return;let t=this.get();for(let r of this._listeners)r(t)}};var Cs=class extends kr{constructor(t,r,s=!0){super(t,r);this.enabled=s}isExtensionEnabled(t){var n,a;let s=(t.split(".").pop()||"").toLowerCase();if(s==="md"||Ge().enableCanvasSync&&s==="canvas")return!0;if(!this.enabled||!Ge().enableAttachmentSync)return!1;for(let[i,l]of Object.entries(Cs.schema)){let c=i;if(((n=this.get()[c])!=null?n:l.defaultEnabled)&&l.extensions.includes(s))return!0}return(a=this.get().otherTypes)!=null?a:Cs.schema.otherTypes.defaultEnabled}getCategory(t){var n;let r=Cs.schema[t];return{enabled:(n=this.get()[t])!=null?n:r.defaultEnabled,name:r.name,description:r.description,extensions:r.extensions}}getCategories(){return Object.keys(Cs.schema).reduce((t,r)=>(t[r]=this.getCategory(r),t),{})}async toggleCategory(t,r){await this.update(s=>({...s,[t]:r})),this.log(`setting ${t} to ${r}`),this.notifyListeners()}async resetToDefault(){await this.update(()=>({...Cs.defaultFlags}))}},Is=Cs;Is.schema={images:{name:"Images",description:"Sync image files (.bmp, .png, .jpg, .jpeg, .gif, .svg, .webp, .avif)",extensions:["bmp","png","jpg","jpeg","gif","svg","webp","avif"],defaultEnabled:!0},audio:{name:"Audio",description:"Sync audio files (.mp3, .wav, .m4a, .3gp, .flac, .ogg, .oga, .opus)",extensions:["mp3","wav","m4a","3gp","flac","ogg","oga","opus"],defaultEnabled:!0},videos:{name:"Videos",description:"Sync video files (.mp4, .webm, .ogv, .mov, .mkv)",extensions:["mp4","webm","ogv","mov","mkv"],defaultEnabled:!0},pdfs:{name:"PDFs",description:"Sync PDF files (.pdf)",extensions:["pdf"],defaultEnabled:!0},otherTypes:{name:"Other files",description:"Sync unsupported file types",extensions:[],defaultEnabled:!1}},Is.defaultFlags=Object.fromEntries(Object.entries(Cs.schema).map(([t,r])=>[t,r.defaultEnabled]));var pi=require("obsidian");async function xx(o){let e=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(e)).map(r=>r.toString(16).padStart(2,"0")).join("")}function Qo(o){return!!o&&o instanceof mi}var Kl=class extends Ft{constructor(t){super();this.db=null;this.setLoggers("[ContentAddressedFileStore]"),this.dbName=`${t}-relay-hashes`,this.ready=this.openDB()}async openDB(){return new Promise((t,r)=>{let s=indexedDB.open(this.dbName,1);s.onupgradeneeded=n=>{let a=s.result;a.objectStoreNames.contains("files")||a.createObjectStore("files",{keyPath:"path"})},s.onsuccess=n=>{this.db=s.result,t()},s.onerror=n=>{this.error("Error opening ContentAddressedFile database:",s.error),r(s.error)}})}async saveHash(t,r,s){if(await this.ready,!!this.db)return new Promise((n,a)=>{if(!this.db)return;let c=this.db.transaction(["files"],"readwrite").objectStore("files").put({path:t,hash:r,modifiedAt:s});c.onsuccess=()=>n(),c.onerror=()=>{this.error("Error saving hash:",c.error),a(c.error)}})}async getHash(t){return await this.ready,this.db?new Promise((r,s)=>{if(!this.db)return null;let i=this.db.transaction(["files"],"readonly").objectStore("files").get(t);i.onsuccess=()=>{r(i.result||null)},i.onerror=()=>{this.error("Error retrieving hash:",i.error),s(i.error)}}):null}async removeHash(t){if(await this.ready,!!this.db)return new Promise((r,s)=>{if(!this.db)return null;let i=this.db.transaction(["files"],"readwrite").objectStore("files").delete(t);i.onsuccess=()=>r(),i.onerror=()=>{this.error("Error removing hash:",i.error),s(i.error)}})}destroy(){this.db&&(this.db.close(),this.db=null)}},rd=class extends Ft{constructor(t,r,s,n){super();this.vault=t;this.path=r;this.metadataCache=s;this.store=n;this.content=null;this._tfile=null;let a=this.vault.getAbstractFileByPath(r);a&&a instanceof pi.TFile&&(this._tfile=a)}get tfile(){if(!this._tfile){let t=this.vault.getAbstractFileByPath(this.path);if(t&&t instanceof pi.TFile)this._tfile=t;else throw new Error("missing tfile")}return this._tfile}async loadHashFromStore(){try{let t=await this.store.getHash(this.path);if(t&&t.modifiedAt===this.tfile.stat.mtime)return t.hash}catch(t){this.warn("Failed to load hash from store:",t)}}get modifiedAt(){if(!this.tfile)throw new Error("missing tfile");return this.tfile.stat.mtime}async read(){this.log("reading content from disk");let t=this.tfile.stat.mtime,r=await this.vault.readBinary(this.tfile),s=await xx(r);try{await this.store.saveHash(this.path,s,t)}catch(n){this.warn("Failed to save hash to store:",n)}return r}exists(){if(this._tfile)return!0;let t=this.vault.getAbstractFileByPath(this.path);return t&&t instanceof pi.TFile?(this._tfile=t,!0):!1}async clear(){this._tfile=null,this.store.removeHash(this.path).catch(t=>{this.warn("Failed to remove hash from store:",t)})}async hash(){let t=await this.loadHashFromStore();if(t)return t;if(await this.read(),t=await this.loadHashFromStore(),!t)throw new Error("missing hash");return t}destroy(){this.vault=null,this._tfile=null,this.metadataCache=null}},mi=class extends dt{constructor(t,r,s,n,a){super();this.path=t;this.guid=r;this.metadataCache=s;this.hashStore=n;this.ready=!1;this.connected=!0;this.offFileInfo=()=>{};this.uploadError=void 0;this.s3rn=a.relayId?new zo(a.relayId,a.guid,r):new ai(a.guid,r),this._parent=a,this.setLoggers(`[SharedFile](${this.path})`),this.name=this.path.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault;let i=this.sharedFolder.syncStore.typeRegistry.getTypeForPath(t);if(!i)throw new Error("unexpected synctype");this.type=i,this.caf=new rd(this.vault,this.sharedFolder.getPath(t),this.metadataCache,this.hashStore),this.log("created")}get mimetype(){return Ss(this.path)}disconnect(){}get inMeta(){return!!this.sharedFolder.syncStore.getMeta(this.path)}move(t){t!==this.path&&(this.debug("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.setLoggers(`[SharedFile](${this.path})`))}get lastModified(){return this.stat.mtime}async push(){if(this.log("push"),!this.sharedFolder.connected)return this.log("skipping push -- folder is disconnected"),"";if(!this.sharedFolder.syncStore.canSync(this.path))return this.log("skipping push -- filetype is disabled"),"";let t=await this.caf.hash(),r=this.sharedFolder.syncStore.getMeta(this.path);if(!r||t&&r.hash!==t)try{await this.sharedFolder.cas.writeFile(this),this.sharedFolder.markUploaded(this),this.uploadError=void 0,this.notifyListeners()}catch(s){let n="Failed to push file";try{n=s.toString().slice(7)}catch(a){}this.uploadError=n,this.notifyListeners()}return await this.caf.hash()}async sync(){var r;this.log("sync");let t=this.sharedFolder.syncStore.getMeta(this.path);t?await this.caf.hash()!==t.hash&&(t.synctime>this.stat.mtime?(this.warn("synctime",t.synctime,(r=this.meta)==null?void 0:r.synctime,this.stat.mtime),await this.pull()):await this.push()):await this.push()}shouldPull(t){return!this.tfile||t.synctime>this.stat.mtime}async pull(){this.log("pull");let t=this.sharedFolder.syncStore.getMeta(this.path);if(t?this.meta=t:this.warn("meta fail",t),!this.meta)throw new Error("cannot pull without meta");if(this.caf.exists()&&await this.caf.hash()===this.meta.hash)return;let r=await this.sharedFolder.cas.readFile(this);await this.vault.adapter.writeBinary(this.sharedFolder.getPath(this.path),r),await this.caf.hash()}get tfile(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof pi.TFile)return t;throw new Error("TFile API used before file existed")}get stat(){return this.tfile.stat}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.s3rn instanceof $r?!1:(this.s3rn instanceof Ko&&(this.sharedFolder.relayId?this.s3rn=new zo(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new ai(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected)))}async read(){return this.vault.read(this.tfile)}async rename(t){this.move(t)}async delete(){return await this.caf.clear(),this.vault.delete(this.tfile)}async write(t){this.vault.adapter.write(this.tfile.path,t),await this.caf.hash()}async append(t){this.vault.append(this.tfile,t),await this.caf.hash()}cleanup(){}destroy(){var t;(t=this.offFileInfo)==null||t.call(this),this.offFileInfo=null,this._parent=null,this.metadataCache=null,this.caf.destroy()}};function bo(o,e){if(!o||!e)return!1;for(let t in o)if(typeof o[t]=="object"&&o[t]!==null){if(!bo(o[t],e[t]))return!1}else if(o[t]!==e[t])return!1;for(let t in e)if(!(t in o))return!1;return!0}function Cr(o){return o instanceof wt}var wt=class extends jo{constructor(t,r,s,n){let a=n.relayId?new sr(n.relayId,n.guid,r):new en(n.guid,r);super(r,a,n.tokenStore,s);this.whenSyncedPromise=null;this.persistenceSynced=!1;this.userLock=!1;this.unsubscribes=[];this._parent=n,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this.unsubscribes.push(this._parent.subscribe(this.path,i=>{i.intent==="disconnected"&&this.disconnect()})),this.setLoggers(`[Canvas](${this.path})`);try{let i=`${this.sharedFolder.appId}-relay-canvas-${this.guid}`;this._persistence=new vs(i,this.ydoc)}catch(i){throw this.warn("Unable to open persistence.",this.guid),console.error(i),i}this.whenSynced().then(()=>{this.updateStats();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.sharedFolder.relayId||""),this._persistence.set("appId",this.sharedFolder.appId),this._persistence.set("s3rn",bt.encode(this.s3rn))}catch(i){}(async()=>(await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()),this.sharedFolder.markUploaded(this)))()}),this._tfile=null}get yedges(){return this.ydoc.getMap("edges")}get ynodes(){return this.ydoc.getMap("nodes")}textNode(t){let r=this.ydoc.getText(t.id);return r.toString()===""&&r.insert(0,t.text),r}static exportCanvasData(t){let r=t.getMap("edges"),s=t.getMap("nodes"),n=[],a=[];for(let[,i]of r.entries())n.push({...i});for(let[,i]of s.entries()){let l=t.getText(i.id);a.push({...i,text:l.toString()||i.text})}return{edges:n,nodes:a}}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}async connect(){return this.sharedFolder.s3rn instanceof $r?!1:(this.s3rn instanceof en&&(this.sharedFolder.relayId?this.s3rn=new sr(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new en(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}async count(){if(this._persistence.db===null)throw new Error("database not ready yet");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=Rr(this._persistence.db,["updates"],"readonly"),r=await qo(t);return this._dbsize=r,this._dbsize}get dbsize(){if(!this._dbsize)throw new Error("dbsize accessed before count");return this._persistence._dbsize===0&&this._dbsize?this._dbsize:this._persistence._dbsize}get ready(){return this._persistence.synced&&(this.synced||!!this._serverSynced||this._origin==="local")}hasLocalDB(){return!!this._serverSynced||this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),await this.getServerSynced(),this._awaitingUpdates?(this._awaitingUpdates=!this.hasLocalDB(),this._awaitingUpdates):!1}async whenReady(){let t=async()=>await this.awaitingUpdates()?(this.log("awaiting updates"),this.connect(),await this.onceConnected(),this.log("connected"),await this.onceProviderSynced(),this.log("synced"),this):this;return this.readyPromise=this.readyPromise||new Xr(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>(await this.sharedFolder.whenSynced(),this._persistence.synced&&!this.persistenceSynced?(await this.count(),this.persistenceSynced=!0,Promise.resolve()):new Promise(r=>{this.persistenceSynced&&r(),this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})}));return this.whenSyncedPromise=this.whenSyncedPromise||new Xr(t,()=>[this.persistenceSynced,void 0]),this.whenSyncedPromise.getPromise()}get sharedFolder(){return this._parent}static checkExtension(t){return t.endsWith(".canvas")&&Ge().enableCanvasSync}async markOrigin(t){this._origin=t,await this._persistence.set("origin",t)}async getOrigin(){return this._origin!==void 0?this._origin:(this._origin=await this._persistence.get("origin"),this._origin)}async applyJSON(t){let r=JSON.parse(t);return await this.applyData(r)}async importFromView(t){if(t.file&&this.sharedFolder.getVirtualPath(t.file.path)===this.path)return await this.applyData(t.canvas.getData());console.warn("tried to apply updates from another file",this.path)}async applyData(t){let r=this.yedges,s=this.ynodes,n=new Set,a=new Map,i=new Set,l=new Map,c=new Set;t.nodes.forEach(u=>{n.add(u.id);let d=s.get(u.id);d?bo(d,u)||a.set(u.id,u):(a.set(u.id,u),this.textNode(u))});for(let u of s.keys())n.has(u)||i.add(u);t.edges.forEach(u=>{n.add(u.id);let d=r.get(u.id);d&&bo(d,u)||l.set(u.id,u)});for(let u of r.keys())n.has(u)||c.add(u);(a.size>0||i.size>0||l.size>0||c.size>0)&&et(this.ydoc,()=>{for(let u of a.values())this.ynodes.set(u.id,u);for(let u of i)this.ynodes.delete(u);for(let u of l.values())this.yedges.set(u.id,u);for(let u of c)this.yedges.delete(u)},this)}move(t){this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}get mimetype(){return Ss(this.path)}get json(){let t=wt.exportCanvasData(this.ydoc);return JSON.stringify(t)}async cleanup(){}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.json.length}destroy(){var t,r;this.unsubscribes.forEach(s=>{s()}),super.destroy(),this.ydoc.destroy(),(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null}};var od=class extends ks{constructor(){super(...arguments);this.notifyListeners=(0,it.debounce)(super.notifyListeners,100)}update(){this.notifyListeners()}add(t,r=!0){let s=this.find(n=>n.guid===t.guid);return s&&s!==t&&(this.error("duplicate guid",s,t),this._set.delete(s)),this._set.add(t),r&&this.notifyListeners(),this}},Gl=class extends jo{constructor(t,r,s,n,a,i,l,c,u,d,m,g,h,_=!0){var v;let w=h?new Wo(h,r):new $r(r);super(r,w,l,n);this.appId=t;this.metadataCache=u;this.hashStore=d;this.backgroundSync=m;this._settings=g;this.destroyed=!1;this.readyPromise=null;this.whenSyncedPromise=null;this.persistenceSynced=!1;this.syncFileTreePromise=null;this.syncRequestedDuringSync=!1;this.unsubscribes=[];this.addLocalDocs=()=>{let t=this.getSyncFiles(),r=[],s=this.placeHold(t);t.forEach(n=>{let a=this.getVirtualPath(n.path),i=s.contains(a);if(_r.checkPath(a)){let l=this.getSyncFolder(a,!1);r.push(l)}else if(At.checkExtension(a))if(i){let l=this.uploadDoc(a,!1);r.push(l)}else{let l=this.getDoc(a,!1);r.push(l)}else if(wt.checkExtension(a))if(i){let l=this.uploadCanvas(a,!1);r.push(l)}else{let l=this.getCanvas(a,!1);r.push(l)}else if(this.syncStore.canSync(a))if(i){let l=this.uploadSyncFile(a,!1);r.push(l)}else{let l=this.downloadSyncFile(a,!1);r.push(l)}}),r.length>0&&this.fset.update()};this.path=s,this.setLoggers(`[SharedFile](${this.path})`),this.fileManager=i,this.vault=a,this.files=new Map,this.fset=new od,this.pendingUpload=new Yo(`${t}-system3-relay/folders/${this.guid}/pendingUploads`),this.relayManager=c,this.relayId=h,this.diskBufferStore=new Ol,this._shouldConnect=(v=this.settings.connect)!=null?v:!0,this.authoritative=!_,this.syncSettingsManager=this._settings.getChild("sync",(A,O)=>new Is(A,O)),this.syncStore=new Nl(this.ydoc,this.path,this.pendingUpload,this.syncSettingsManager),this.syncStore.on(async()=>{await this.syncFileTree(this.syncStore)}),this.unsubscribes.push(this.relayManager.remoteFolders.subscribe(A=>{this.remote=A.find(O=>O.guid==this.guid)})),this.proxy=ox(this,this.path,A=>this.getVirtualPath(A));try{this._persistence=new vs(this.guid,this.ydoc)}catch(A){throw this.warn("Unable to open persistence.",this.guid),console.error(A),A}n.loggedIn&&this.connect(),this.cas=new Wl(this),this.whenReady().then(()=>{this.destroyed||(this.addLocalDocs(),this.syncFileTree(this.syncStore))}),this.whenSynced().then(async()=>{this.syncStore.start();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.relayId||""),this._persistence.set("appId",this.appId),this._persistence.set("s3rn",bt.encode(this.s3rn))}catch(A){}}),(async()=>await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()))(),Bt.set(this,this.path)}get server(){return this._server}set server(t){if(t===this._server)return;this.warn("server changed -- reinitializing all connections");let r=this.shouldConnect;this.reset();let s=[];this.fset.forEach(n=>{n instanceof jo&&(n.connected&&s.push(n),n.reset())}),this.tokenStore.clear(n=>{var a;return!!(this.relayId&&((a=n.token)!=null&&a.docId.startsWith(this.relayId)))}),r&&(this.connect(),s.forEach(n=>{n.connect()})),this._server=t}get tfolder(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof it.TFolder))throw new Error("tfolder is not a folder");return t}isSyncableTFile(t){let r=this.checkPath(t.path);if(t instanceof it.TFolder&&!_r.checkPath)throw new Error("logical error");let s=this.getVirtualPath(t.path),n=this.syncStore.canSync(s),a=this.syncSettingsManager.isExtensionEnabled(s);return r&&n&&a}getSyncFiles(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof it.TFolder))throw new Error(`Could not find shared folders on file system at ${this.path}`);let r=[];return it.Vault.recurseChildren(t,s=>{s!==t&&r.push(s)}),r.filter(s=>this.isSyncableTFile(s))}get shouldConnect(){return this._shouldConnect}set shouldConnect(t){this._settings.update(r=>({...r,connect:t})),this._shouldConnect=t}async netSync(){await this.whenReady(),this.addLocalDocs(),await this.syncFileTree(this.syncStore),this.backgroundSync.enqueueSharedFolderSync(this)}get settings(){return this._settings.get()}async sync(){await this.syncFileTree(this.syncStore)}connect(){return this.s3rn instanceof Wo&&(this.connected||this.shouldConnect)?super.connect():Promise.resolve(!1)}get name(){return this.path.split("/").pop()||""}get location(){return this.path.split("/").slice(0,-1).join("/")}get remote(){var t;try{(t=this._remote)==null||t.relay}catch(r){return}return this._remote}set remote(t){var r;this._remote!==t&&(this._remote=t,this.relayId=(r=t==null?void 0:t.relay)==null?void 0:r.guid,this.s3rn=this.relayId?new Wo(this.relayId,this.guid):new $r(this.guid),this._settings.update(s=>({...s,relay:this.relayId})),t&&(this._server=t.relay.provider,this.unsubscribes.push(t.relay.subscribe(s=>{s.guid===this.relayId&&(this.server=s.provider)}))),this.server=t==null?void 0:t.relay.provider,this.notifyListeners())}get ready(){return this.persistenceSynced&&(this.authoritative||this._serverSynced||this.synced)}async count(){if(this._persistence.db===null)throw new Error("unexpected missing database");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=Rr(this._persistence.db,["updates"],"readonly"),r=await qo(t);return this._dbsize=r,this._dbsize}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}hasLocalDB(){return this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),this.authoritative||await this.getServerSynced()?!1:!this.hasLocalDB()}whenReady(){let t=async()=>await this.awaitingUpdates()?(this.connect(),await this.onceConnected(),await this.onceProviderSynced(),this):this;return this.readyPromise=this.readyPromise||new Xr(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>{if(this._persistence.synced){await this.count(),this.persistenceSynced=!0;return}return new Promise(r=>{this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})})};return this.whenSyncedPromise=this.whenSyncedPromise||new Xr(t,()=>(this._persistence.synced&&this._dbsize&&(this.persistenceSynced=!0),[this.persistenceSynced,void 0])),this.whenSyncedPromise.getPromise()}get intent(){return this.shouldConnect?"connected":"disconnected"}async _handleServerRename(t,r,s,n){if(n==null||n.push(`${s.path} was renamed to ${this.getPath(r)}`),s instanceof it.TFile){let a=(0,Ir.dirname)(r);this.existsSync(a)||(await this.mkdir(a),n==null||n.push(`creating directory ${a}`))}await this.fileManager.renameFile(s,(0,it.normalizePath)(this.getPath(r))).then(()=>{t.move(r)})}async _handleServerCreate(t,r){let s=(0,Ir.dirname)(t);if(this.existsSync(s)||(await this.mkdir(s),r==null||r.push(`creating directory ${s}`)),At.checkExtension(t))return r==null||r.push(`created local file for remotely added doc ${t}`),await this.downloadDoc(t,!1);if(wt.checkExtension(t))return r==null||r.push(`created local file for remotely added canvas ${t}`),await this.downloadCanvas(t,!1);if(_r.checkPath(t))return this.getSyncFolder(t,!1);if(this.syncStore.canSync(t))return this.downloadSyncFile(t,!1);throw new Error("unexpected file")}_assertNamespacing(t){try{this.assertPath(this.path+t)}catch(r){this.error("Deleting doc (somehow moved outside of shared folder)",t),this.syncStore.delete(t);return}}applyRemoteState(t,r,s,n){let a=this.files.get(t),i=this.syncStore.getMeta(r);if(!i)return this.warn("unknown sync type",r),{op:"noop",path:r,promise:Promise.resolve()};if(this.existsSync(r))return a&&Qo(a)&&a.shouldPull(i)?{op:"update",path:r,promise:a.pull()}:{op:"noop",path:r,promise:Promise.resolve()};if(s.has(t)&&a){let c=this.getPath(a.path),u=this.vault.getAbstractFileByPath(c);if(u){let d=this._handleServerRename(a,r,u,n);return{op:"rename",path:r,from:c,to:r,promise:d}}}let l=this._handleServerCreate(r,n);return{op:"create",path:r,promise:l}}cleanupExtraLocalFiles(t,r){let s=this.getSyncFiles(),n=[],a=s.filter(c=>c instanceof it.TFolder),i=s.filter(c=>c instanceof it.TFile),l=c=>{var w,v;let u=this.isSyncableTFile(c),d=this.checkPath(c.path),m=t.contains(c.path.slice(this.path.length)),g=this.pendingUpload.has(this.getVirtualPath(c.path)),h=this.getVirtualPath(c.path),_=((w=this._provider)==null?void 0:w.synced)&&((v=this._persistence)==null?void 0:v.synced);if(d&&u&&!m&&!g&&_){r.push(`deleted local file ${h} for remotely deleted doc`);let A=this.vault.adapter.trashLocal(c.path);n.push({op:"delete",path:h,promise:A})}};return i.forEach(l),a.forEach(l),n}syncByType(t,r,s,n){t.forEach((a,i)=>{this._assertNamespacing(i),n.contains(a.type)&&(this._assertNamespacing(i),s.push(this.applyRemoteState(a.id,i,t.remoteIds,r)))})}syncFileTree(t){if(this.syncFileTreePromise){this.syncRequestedDuringSync=!0;let s=this.syncFileTreePromise.getPromise();return s.then(()=>{if(this.syncRequestedDuringSync)return this.syncRequestedDuringSync=!1,this.syncFileTree(t)}),s}let r=async()=>{try{let s=[],n=[];this.ydoc.transact(async()=>{this.syncStore.migrateUp(),this.syncByType(t,n,s,["folder"])},this),await Promise.all(s.map(u=>u.promise)),this.ydoc.transact(async()=>{this.syncByType(t,n,s,this.syncStore.typeRegistry.getEnabledFileSyncTypes()),this.syncStore.commit()},this);let a=s.filter(u=>u.op==="create"),i=s.filter(u=>u.op==="rename"),l=s.map(u=>u.path);await Promise.all([...a,...i].map(u=>ii(u.promise,u)));let c=this.cleanupExtraLocalFiles(l,n);[...s,...c].every(u=>u.op==="noop")?this.debug("sync: noop"):(this.log("remote paths",l),this.log("operations",[...s,...c])),(i.length>0||a.length>0||c.length>0)&&this.fset.update(),n.length>0&&this.log(`syncFileTree diff:
`+n.join(`
`))}finally{this.syncFileTreePromise=null}};return this.syncFileTreePromise=new Ul(r),this.syncFileTreePromise.getPromise()}move(t){this.path=t,this.setLoggers(`[SharedFile](${this.path})`),this._settings.update(r=>({...r,path:t}))}read(t){let r=(0,Ir.join)(this.path,t.path);return this.vault.adapter.read((0,it.normalizePath)(r))}existsSync(t){let r=(0,it.normalizePath)((0,Ir.join)(this.path,t));return this.vault.getAbstractFileByPath(r)!==null}exists(t){let r=(0,Ir.join)(this.path,t.path);return this.vault.adapter.exists((0,it.normalizePath)(r))}flush(t,r){let s=(0,Ir.join)(this.path,t.path);return this.log("writing to ",(0,it.normalizePath)(s)),this.vault.adapter.write((0,it.normalizePath)(s),r)}getPath(t){return(0,Ir.join)(this.path,t)}assertPath(t){if(!this.checkPath(t))throw new Error("Path is not in shared folder: "+t)}mkdir(t){let r=(0,Ir.join)(this.path,t);return this.vault.adapter.mkdir((0,it.normalizePath)(r))}checkPath(t){return t.startsWith(this.path+Ir.sep)}getVirtualPath(t){return this.assertPath(t),t.slice(this.path.length)}getTFile(t){let r=this.vault.getAbstractFileByPath(this.getPath(t.path));return r instanceof it.TFile?r:null}getDoc(t,r=!0){let s=this.syncStore.get(t);if(s!==void 0){let n=this.files.get(s);if(n!==void 0){if(n.move(t),!Zr(n))throw new Error("unexpected ifile type");return n}else return this.log("[getDoc]: creating doc for shared ID"),this.createDoc(t,r)}else{this.warn("[getDoc]: creating new shared ID for existing tfile");let n=this.vault.getAbstractFileByPath(this.getPath(t));if(!(n instanceof it.TFile))throw new Error("unexpectedly missing tfile or got tfolder");return this.placeHold([n]).length>0?this.uploadDoc(t):this.createDoc(t,r)}}getCanvas(t,r=!0){let s=this.syncStore.get(t);if(s!==void 0){let n=this.files.get(s);if(n!==void 0){if(n.move(t),!Cr(n))throw new Error("unexpected ifile type");return n}else return this.log("[getCanvas]: creating canvas for shared ID"),this.createCanvas(t,r)}else{this.warn("[getCanvas]: creating new shared ID for existing tfile");let n=this.vault.getAbstractFileByPath(this.getPath(t));if(!(n instanceof it.TFile))throw new Error("unexpectedly missing tfile or got tfolder");return this.placeHold([n]).length>0?this.uploadCanvas(t):this.createCanvas(t,r)}}async markUploaded(t){if(Zr(t)){let r=ci(t.guid);this.ydoc.transact(()=>{this.syncStore.markUploaded(t.path,r)},this);return}if(Cr(t)){let r=tx(t.guid);this.ydoc.transact(()=>{this.syncStore.markUploaded(t.path,r)},this);return}if(Hu(t)){let r=Bl(t.guid);this.ydoc.transact(()=>{this.syncStore.markUploaded(t.path,r)},this);return}if(Qo(t)){let r=this.syncStore.typeRegistry.getTypeForPath(t.path);if(!r)throw new Error("unexpected sync type");let s=await t.caf.hash();if(!s)throw new Error("file hash not yet computed");let n=this.syncStore.getMeta(this.path);if(n&&t.caf.value===n.hash)return;let a=rx(r,t.guid,t.mimetype,s,t.stat.mtime);this.log("new meta",a),this.ydoc.transact(()=>{this.syncStore.markUploaded(t.path,a)},this);return}}getFile(t,r=!0){let s=this.syncStore.get(t);if(s){let n=this.files.get(s);if(n)return n}return At.checkExtension(t)?this.getDoc(t):wt.checkExtension(t)?this.getCanvas(t):_r.checkPath(t)?this.getSyncFolder(t,r):this.syncStore.canSync(t)?this.getSyncFile(t,r):null}placeHold(t){let r=[];return this.ydoc.transact(()=>{t.forEach(s=>{let n=this.getVirtualPath(s.path);this.syncStore.has(n)||(this.log("place hold new",n),this.syncStore.new(n),r.push(n))})},this),r}getOrCreateCanvas(t,r){let s=this.files.get(t)||new wt(r,t,this.loginManager,this);if(!Cr(s))throw new Error("unexpected ifile type");return s.move(r),s}async downloadCanvas(t,r=!0){if(!wt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error(`called download on item that is not in ids ${t}`);let n=this.getOrCreateCanvas(s,t);return n.markOrigin("remote"),ii(this.backgroundSync.enqueueCanvasDownload(n),n.path),this.files.set(s,n),this.fset.add(n,r),n}uploadCanvas(t,r=!0){if(!wt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("expected guid");let n=this.getOrCreateCanvas(s,t),a=n.getOrigin(),i=this.awaitingUpdates();return(async()=>{if(!await this.exists(n))throw new Error(`Upload failed, doc does not exist at ${t}`);let[c,u,d]=await Promise.all([this.read(n),a,i]);!d&&u===void 0&&(this.log(`[${n.path}] No Known Peers: Syncing file into ytext.`),this.ydoc.transact(()=>{try{n.applyJSON(c)}catch(m){throw console.warn(c),m}},this._persistence),n.markOrigin("local"),this.log(`[${n.path}] Uploading file`),await this.backgroundSync.enqueueSync(n),this.markUploaded(n))})(),this.files.set(s,n),this.fset.add(n,r),n}createCanvas(t,r){if(!wt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("expected guid");let n=this.getOrCreateCanvas(s,t);return(async()=>this.whenReady().then(async()=>{let a=await n.getServerSynced();n.stat.size===0&&!a?this.backgroundSync.enqueueCanvasDownload(n):this.pendingUpload.get(n.path)&&this.backgroundSync.enqueueSync(n)}))(),this.files.set(s,n),this.fset.add(n,r),n}viewDoc(t){let r=this.syncStore.get(t);if(!r)return;let s=this.files.get(r);if(!Zr(s))throw new Error("unexpected ifile type");return s}viewSyncFile(t){let r=this.syncStore.get(t);if(!r)return;let s=this.files.get(r);if(!Qo(s))throw new Error("unexpected ifile type");return s}getOrCreateDoc(t,r){let s=this.files.get(t)||new At(r,t,this.loginManager,this);if(!Zr(s))throw new Error("unexpected ifile type");return s.move(r),s}async downloadDoc(t,r=!0){if(!At.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error(`called download on item that is not in ids ${t}`);let n=this.getOrCreateDoc(s,t);return n.markOrigin("remote"),ii(this.backgroundSync.enqueueDownload(n),n.path),this.files.set(s,n),this.fset.add(n,r),n}uploadDoc(t,r=!0){if(!At.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("missing guid");let n=this.getOrCreateDoc(s,t),a=n.getOrigin(),i=this.awaitingUpdates();return(async()=>{if(!await this.exists(n))throw new Error(`Upload failed, doc does not exist at ${t}`);let[c,u,d]=await Promise.all([this.read(n),a,i]),m=n.ydoc.getText("contents");!d&&u===void 0&&(this.log(`[${n.path}] No Known Peers: Syncing file into ytext.`),this.ydoc.transact(()=>{m.insert(0,c)},this._persistence),n.markOrigin("local"),this.log(`[${n.path}] Uploading file`),await this.backgroundSync.enqueueSync(n),this.markUploaded(n))})(),this.files.set(s,n),this.fset.add(n,r),n}createDoc(t,r=!0){if(!At.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("expected guid");let n=this.getOrCreateDoc(s,t);return(async()=>this.whenReady().then(async()=>{var i;let a=await n.getServerSynced();((i=n.tfile)==null?void 0:i.stat.size)===0&&!a?this.backgroundSync.enqueueDownload(n):this.pendingUpload.get(n.path)&&this.backgroundSync.enqueueSync(n)}))(),this.files.set(s,n),this.fset.add(n,r),n}getOrCreateSyncFolder(t,r){let s=this.files.get(t)||new _r(r,t,this.relayManager,this);if(!Hu(s))throw new Error("unexpected ifile type");return s.move(r),s}getSyncFolder(t,r){if(this.log("[getSyncFolder]","getting syncfolder"),!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("expected guid");let n=this.getOrCreateSyncFolder(s,t);return this.files.set(s,n),this.fset.add(n,r),n}getOrCreateSyncFile(t,r,s){let n=this.files.get(t)||new mi(r,t,this.metadataCache,this.hashStore,this);if(!Qo(n))throw new Error("unexpected ifile type");return n.move(r),this.files.set(t,n),n}downloadSyncFile(t,r){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error(`called download on item that is not in ids ${t}`);let n=this.syncStore.getMeta(t);if(!n||!n.hash)return this.uploadSyncFile(t,r);let a=this.getOrCreateSyncFile(s,t,n.hash);return ii(a.pull()),this.files.set(s,a),this.fset.add(a,r),a}uploadSyncFile(t,r=!0){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("missing guid");let n=this.vault.getAbstractFileByPath(this.getPath(t));if(!n)throw new Error(`Upload failed, file does not exist at ${t}`);if(!(n instanceof it.TFile))throw new Error(`Upload failed, expected file at ${t}`);let a=this.getOrCreateSyncFile(s,t,n);return(async()=>{if(!this.existsSync(t))throw new Error(`Upload failed, file does not exist at ${t}`);await a.push()})(),this.fset.add(a,r),a}getSyncFile(t,r=!0){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("missing guid");let n=this.vault.getAbstractFileByPath(this.getPath(t));if(!n)throw new Error(`Upload failed, file does not exist at ${t}`);if(!(n instanceof it.TFile))throw new Error(`Upload failed, expected file at ${t}`);let a=this.getOrCreateSyncFile(s,t,n);return this.syncStore.getMeta(t)?a.pull():(this.log("get syncfile missing meta"),a.push()),this.files.set(s,a),this.fset.add(a,r),a}uploadFile(t,r=!0){if(At.checkExtension(t))return this.uploadDoc(t,r);if(wt.checkExtension(t))return this.uploadCanvas(t,r);if(_r.checkPath(t))return this.getSyncFolder(t,r);if(this.syncStore.canSync(t))return this.uploadSyncFile(t,r);throw new Error("unexpectedly unable to upload")}deleteFile(t){let r=this.syncStore.get(t);r&&this.ydoc.transact(()=>{this.syncStore.delete(t);let s=this.files.get(r);s&&(s.cleanup(),this.fset.delete(s)),this.files.delete(r)},this)}renameFile(t,r){let s=t.path,n="",a="";try{n=this.getVirtualPath(s)}catch(i){this.log("Moving out of shared folder")}try{a=this.getVirtualPath(r)}catch(i){this.log("Moving in from outside of shared folder")}if(!(!n&&!a))if(a){let i=this.syncStore.get(a);if(!i)return;let l=this.files.get(i);if(!n)this.ydoc.transact(()=>{this.syncStore.delete(a)},this),l&&(l.cleanup(),l.destroy(),this.fset.delete(l)),this.files.delete(i);else{if(!this.syncStore.get(a))return;let u=[];l instanceof _r&&this.syncStore.forEach((d,m)=>{if(m.startsWith(a+Ir.sep)){let g=m.replace(a,n);u.push([d.id,m,g])}}),this.ydoc.transact(()=>{this.syncStore.move(a,n),l&&l.move(n),u.forEach(d=>{let[m,g,h]=d;this.syncStore.move(g,h);let _=this.files.get(m);_&&_.move(h)})},this),this.syncStore.resolveMove(a)}}else{if(this.assertPath(s),!this.syncStore.canSync(n))return;this.placeHold([t]),this.uploadFile(n)}}destroy(){var t,r,s;this.destroyed=!0,this.unsubscribes.forEach(n=>{n()}),this.files.forEach(n=>{n.destroy(),this.files.delete(n.guid)}),this.syncStore.destroy(),this.syncSettingsManager.destroy(),super.destroy(),this.ydoc.destroy(),this.fset.clear(),this._settings.destroy(),this._settings=null,this.diskBufferStore=null,this.relayManager=null,this.backgroundSync=null,this.loginManager=null,this.tokenStore=null,this.fileManager=null,this.syncStore=null,this.syncSettingsManager=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null,(s=this.syncFileTreePromise)==null||s.destroy(),this.syncFileTreePromise=null}},jl=class extends ks{constructor(t,r,s,n){super();this.relayManager=t;this.vault=r;this.settings=n;this.update=(0,it.debounce)(this.notifyListeners,100);this.folderBuilder=s,this._offRemoteUpdates||(this._offRemoteUpdates=this.relayManager.remoteFolders.subscribe(a=>{let i=!1;this.items().forEach(l=>{let c=a.find(u=>u.guid==l.guid);l.remote!=c&&(i=!0),l.remote=c}),i&&this.update()}))}delete(t){t==null||t.destroy();let r=super.delete(t);return this.settings.update(s=>s.filter(n=>n.guid!==t.guid)),r}lookup(t){let r=this.find(s=>s.checkPath(t));return r||null}destroy(){this.items().forEach(t=>{t.destroy()}),this.clear(),this._offRemoteUpdates&&this._offRemoteUpdates(),this.unsubscribes.forEach(t=>{t()}),this.relayManager=null,this.folderBuilder=null}load(){this._load(this.settings.get())}_load(t){let r=!1;t.forEach(s=>{if(!this.vault.getFolderByPath(s.path)){this.warn(`Invalid settings, ${s.path} does not exist`);return}this._new(s.path,s.guid,s==null?void 0:s.relay),r=!0}),r&&this.notifyListeners()}_new(t,r,s,n){let a=this.find(u=>u.path==t&&u.guid==r);if(a)return a;let i=this.find(u=>u.guid==r);if(i)throw new Error(`This folder is already mounted at ${i.path}.`);if(this.find(u=>u.path==t))throw new Error("Conflict: Tracked folder exists at this location.");let c=this.folderBuilder(t,r,s,n);return this._set.add(c),c}new(t,r,s,n){let a=this._new(t,r,s,n);return this.notifyListeners(),a}};var hc=require("@codemirror/state"),ma=require("obsidian");function X(){}function fe(o,e){for(let t in e)o[t]=e[t];return o}function bx(o){return!!o&&(typeof o=="object"||typeof o=="function")&&typeof o.then=="function"}function sd(o){return o()}function Jl(){return Object.create(null)}function Ce(o){o.forEach(sd)}function pt(o){return typeof o=="function"}function Z(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}var Yl;function nd(o,e){return o===e?!0:(Yl||(Yl=document.createElement("a")),Yl.href=e,o===Yl.href)}function wx(o){return Object.keys(o).length===0}function ar(o,...e){if(o==null){for(let r of e)r(void 0);return X}let t=o.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function me(o,e,t){o.$$.on_destroy.push(ar(e,t))}function ye(o,e,t,r){if(o){let s=vx(o,e,t,r);return o[0](s)}}function vx(o,e,t,r){return o[1]&&r?fe(t.ctx.slice(),o[1](r(e))):t.ctx}function xe(o,e,t,r){if(o[2]&&r){let s=o[2](r(t));if(e.dirty===void 0)return s;if(typeof s=="object"){let n=[],a=Math.max(e.dirty.length,s.length);for(let i=0;i<a;i+=1)n[i]=e.dirty[i]|s[i];return n}return e.dirty|s}return e.dirty}function be(o,e,t,r,s,n){if(s){let a=vx(e,t,r,n);o.p(a,s)}}function we(o){if(o.ctx.length>32){let e=[],t=o.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function Se(o){let e={};for(let t in o)t[0]!=="$"&&(e[t]=o[t]);return e}function ad(o,e){let t={};e=new Set(e);for(let r in o)!e.has(r)&&r[0]!=="$"&&(t[r]=o[r]);return t}function oa(o){return o==null?"":o}function _x(o,e,t){return o.set(t),e}function Ql(o){return o&&pt(o.destroy)?o.destroy:X}var tn=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;var sa=class{constructor(e){xt(this,"_listeners","WeakMap"in tn?new WeakMap:void 0);xt(this,"_observer");xt(this,"options");this.options=e}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!=null?e:this._observer=new ResizeObserver(t=>{var r;for(let s of t)sa.entries.set(s.target,s),(r=this._listeners.get(s.target))==null||r(s)})}};sa.entries="WeakMap"in tn?new WeakMap:void 0;var Sx=!1;function kx(){Sx=!0}function Cx(){Sx=!1}function k(o,e){o.appendChild(e)}function Pe(o,e,t){let r=Ix(o);if(!r.getElementById(e)){let s=T("style");s.id=e,s.textContent=t,XL(r,s)}}function Ix(o){if(!o)return document;let e=o.getRootNode?o.getRootNode():o.ownerDocument;return e&&e.host?e:o.ownerDocument}function XL(o,e){return k(o.head||o,e),e.sheet}function I(o,e,t){o.insertBefore(e,t||null)}function C(o){o.parentNode&&o.parentNode.removeChild(o)}function st(o,e){for(let t=0;t<o.length;t+=1)o[t]&&o[t].d(e)}function T(o){return document.createElement(o)}function eo(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function K(o){return document.createTextNode(o)}function U(){return K(" ")}function Ie(){return K("")}function te(o,e,t,r){return o.addEventListener(e,t,r),()=>o.removeEventListener(e,t,r)}function Lx(o){return function(e){return e.stopPropagation(),o.call(this,e)}}function x(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function hi(o,e){for(let t in e)x(o,t,e[t])}function Tx(o){return Array.from(o.childNodes)}function ne(o,e){e=""+e,o.data!==e&&(o.data=e)}function ir(o,e){o.value=e==null?"":e}function de(o,e,t,r){t==null?o.style.removeProperty(e):o.style.setProperty(e,t,r?"important":"")}function Be(o,e,t){o.classList.toggle(e,!!t)}function Xl(o,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:r})}var na=class{constructor(e=!1){xt(this,"is_svg",!1);xt(this,"e");xt(this,"n");xt(this,"t");xt(this,"a");this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,r=null){this.e||(this.is_svg?this.e=eo(t.nodeName):this.e=T(t.nodeType===11?"TEMPLATE":t.nodeName),this.t=t.tagName!=="TEMPLATE"?t:t.content,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)I(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(C)}};function Px(o){let e={};return o.childNodes.forEach(t=>{e[t.slot||"default"]=!0}),e}function aa(o,e){return new o(e)}var Ls;function Lr(o){Ls=o}function gi(){if(!Ls)throw new Error("Function called outside component initialization");return Ls}function lr(o){gi().$$.on_mount.push(o)}function id(o){gi().$$.on_destroy.push(o)}function Kt(){let o=gi();return(e,t,{cancelable:r=!1}={})=>{let s=o.$$.callbacks[e];if(s){let n=Xl(e,t,{cancelable:r});return s.slice().forEach(a=>{a.call(o,n)}),!n.defaultPrevented}return!0}}function to(o,e){let t=o.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}var rn=[];var Nr=[],la=[],Dx=[],s2=Promise.resolve(),cd=!1;function Fx(){cd||(cd=!0,s2.then(xi))}function yi(o){la.push(o)}var ld=new Set,ia=0;function xi(){if(ia!==0)return;let o=Ls;do{try{for(;ia<rn.length;){let e=rn[ia];ia++,Lr(e),n2(e.$$)}}catch(e){throw rn.length=0,ia=0,e}for(Lr(null),rn.length=0,ia=0;Nr.length;)Nr.pop()();for(let e=0;e<la.length;e+=1){let t=la[e];ld.has(t)||(ld.add(t),t())}la.length=0}while(rn.length);for(;Dx.length;)Dx.pop()();cd=!1,ld.clear(),Lr(o)}function n2(o){if(o.fragment!==null){o.update(),Ce(o.before_update);let e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(yi)}}function Ax(o){let e=[],t=[];la.forEach(r=>o.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),la=e}var Zl=new Set,on;function he(){on={r:0,c:[],p:on}}function ge(){on.r||Ce(on.c),on=on.p}function S(o,e){o&&o.i&&(Zl.delete(o),o.i(e))}function P(o,e,t,r){if(o&&o.o){if(Zl.has(o))return;Zl.add(o),on.c.push(()=>{Zl.delete(o),r&&(t&&o.d(1),r())}),o.o(e)}else r&&r()}function ca(o,e){let t=e.token={};function r(s,n,a,i){if(e.token!==t)return;e.resolved=i;let l=e.ctx;a!==void 0&&(l=l.slice(),l[a]=i);let c=s&&(e.current=s)(l),u=!1;e.block&&(e.blocks?e.blocks.forEach((d,m)=>{m!==n&&d&&(he(),P(d,1,1,()=>{e.blocks[m]===d&&(e.blocks[m]=null)}),ge())}):e.block.d(1),c.c(),S(c,1),c.m(e.mount(),e.anchor),u=!0),e.block=c,e.blocks&&(e.blocks[n]=c),u&&xi()}if(bx(o)){let s=gi();if(o.then(n=>{Lr(s),r(e.then,1,e.value,n),Lr(null)},n=>{if(Lr(s),r(e.catch,2,e.error,n),Lr(null),!e.hasCatch)throw n}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,o),!0;e.resolved=o}}function ec(o,e,t){let r=e.slice(),{resolved:s}=o;o.current===o.then&&(r[o.value]=s),o.current===o.catch&&(r[o.error]=s),o.block.p(r,t)}function Ae(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function Ex(o,e){P(o,1,1,()=>{e.delete(o.key)})}function Mx(o,e,t,r,s,n,a,i,l,c,u,d){let m=o.length,g=n.length,h=m,_={};for(;h--;)_[o[h].key]=h;let w=[],v=new Map,A=new Map,O=[];for(h=g;h--;){let D=d(s,n,h),F=t(D),V=a.get(F);V?r&&O.push(()=>V.p(D,e)):(V=c(F,D),V.c()),v.set(F,w[h]=V),F in _&&A.set(F,Math.abs(h-_[F]))}let E=new Set,M=new Set;function R(D){S(D,1),D.m(i,u),a.set(D.key,D),u=D.first,g--}for(;m&&g;){let D=w[g-1],F=o[m-1],V=D.key,q=F.key;D===F?(u=D.first,m--,g--):v.has(q)?!a.has(V)||E.has(V)?R(D):M.has(q)?m--:A.get(V)>A.get(q)?(M.add(V),R(D)):(E.add(q),m--):(l(F,a),m--)}for(;m--;){let D=o[m];v.has(D.key)||l(D,a)}for(;g;)R(w[g-1]);return Ce(O),w}function Ue(o,e){let t={},r={},s={$$scope:1},n=o.length;for(;n--;){let a=o[n],i=e[n];if(i){for(let l in a)l in i||(r[l]=1);for(let l in i)s[l]||(t[l]=i[l],s[l]=1);o[n]=i}else for(let l in a)s[l]=1}for(let a in r)a in t||(t[a]=void 0);return t}function qe(o){return typeof o=="object"&&o!==null?o:{}}var a2=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],i2=new Set([...a2]);function H(o){o&&o.c()}function B(o,e,t){let{fragment:r,after_update:s}=o.$$;r&&r.m(e,t),yi(()=>{let n=o.$$.on_mount.map(sd).filter(pt);o.$$.on_destroy?o.$$.on_destroy.push(...n):Ce(n),o.$$.on_mount=[]}),s.forEach(yi)}function N(o,e){let t=o.$$;t.fragment!==null&&(Ax(t.after_update),Ce(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function c2(o,e){o.$$.dirty[0]===-1&&(rn.push(o),Fx(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function oe(o,e,t,r,s,n,a=null,i=[-1]){let l=Ls;Lr(o);let c=o.$$={fragment:null,ctx:[],props:n,update:X,not_equal:s,bound:Jl(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:Jl(),dirty:i,skip_bound:!1,root:e.target||l.$$.root};a&&a(c.root);let u=!1;if(c.ctx=t?t(o,e.props||{},(d,m,...g)=>{let h=g.length?g[0]:m;return c.ctx&&s(c.ctx[d],c.ctx[d]=h)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](h),u&&c2(o,d)),m}):[],c.update(),u=!0,Ce(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){kx();let d=Tx(e.target);c.fragment&&c.fragment.l(d),d.forEach(C)}else c.fragment&&c.fragment.c();e.intro&&S(o.$$.fragment),B(o,e.target,e.anchor),Cx(),xi()}Lr(l)}var f2;typeof HTMLElement=="function"&&(f2=class extends HTMLElement{constructor(e,t,r){super();xt(this,"$$ctor");xt(this,"$$s");xt(this,"$$c");xt(this,"$$cn",!1);xt(this,"$$d",{});xt(this,"$$r",!1);xt(this,"$$p_d",{});xt(this,"$$l",{});xt(this,"$$l_u",new Map);this.$$ctor=e,this.$$s=t,r&&this.attachShadow({mode:"open"})}addEventListener(e,t,r){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let s=this.$$c.$on(e,t);this.$$l_u.set(t,s)}super.addEventListener(e,t,r)}removeEventListener(e,t,r){if(super.removeEventListener(e,t,r),this.$$c){let s=this.$$l_u.get(t);s&&(s(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(n){return()=>{let a;return{c:function(){a=T("slot"),n!=="default"&&x(a,"name",n)},m:function(c,u){I(c,a,u)},d:function(c){c&&C(a)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},r=Px(this);for(let n of this.$$s)n in r&&(t[n]=[e(n)]);for(let n of this.attributes){let a=this.$$g_p(n.name);a in this.$$d||(this.$$d[a]=fd(a,n.value,this.$$p_d,"toProp"))}for(let n in this.$$p_d)!(n in this.$$d)&&this[n]!==void 0&&(this.$$d[n]=this[n],delete this[n]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let s=()=>{this.$$r=!0;for(let n in this.$$p_d)if(this.$$d[n]=this.$$c.$$.ctx[this.$$c.$$.props[n]],this.$$p_d[n].reflect){let a=fd(n,this.$$d[n],this.$$p_d,"toAttribute");a==null?this.removeAttribute(this.$$p_d[n].attribute||n):this.setAttribute(this.$$p_d[n].attribute||n,a)}this.$$r=!1};this.$$c.$$.after_update.push(s),s();for(let n in this.$$l)for(let a of this.$$l[n]){let i=this.$$c.$on(n,a);this.$$l_u.set(a,i)}this.$$l={}}}attributeChangedCallback(e,t,r){var s;this.$$r||(e=this.$$g_p(e),this.$$d[e]=fd(e,r,this.$$p_d,"toProp"),(s=this.$$c)==null||s.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function fd(o,e,t,r){var n;let s=(n=t[o])==null?void 0:n.type;if(e=s==="Boolean"&&typeof e!="boolean"?e!=null:e,!r||!t[o])return e;if(r==="toAttribute")switch(s){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e==null?null:e;default:return e}else switch(s){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var ee=class{constructor(){xt(this,"$$");xt(this,"$$set")}$destroy(){N(this,1),this.$destroy=X}$on(e,t){if(!pt(t))return X;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{let s=r.indexOf(t);s!==-1&&r.splice(s,1)}}$set(e){this.$$set&&!wx(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var Rx="4";typeof window!="undefined"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Rx);var u2={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},ud=u2;function Ox(o,e,t){let r=o.slice();return r[11]=e[t][0],r[12]=e[t][1],r}function dd(o){let e,t=[o[12]],r={};for(let s=0;s<t.length;s+=1)r=fe(r,t[s]);return{c(){e=eo(o[11]),hi(e,r)},m(s,n){I(s,e,n)},p(s,n){hi(e,r=Ue(t,[n&32&&s[12]]))},d(s){s&&C(e)}}}function Ux(o){let e=o[11],t,r=o[11]&&dd(o);return{c(){r&&r.c(),t=Ie()},m(s,n){r&&r.m(s,n),I(s,t,n)},p(s,n){s[11]?e?Z(e,s[11])?(r.d(1),r=dd(s),e=s[11],r.c(),r.m(t.parentNode,t)):r.p(s,n):(r=dd(s),e=s[11],r.c(),r.m(t.parentNode,t)):e&&(r.d(1),r=null,e=s[11])},d(s){s&&C(t),r&&r.d(s)}}}function d2(o){let e,t,r,s,n,a=Ae(o[5]),i=[];for(let m=0;m<a.length;m+=1)i[m]=Ux(Ox(o,a,m));let l=o[10].default,c=ye(l,o,o[9],null),u=[ud,o[7],{width:o[2]},{height:o[2]},{stroke:o[1]},{"stroke-width":r=o[4]?Number(o[3])*24/Number(o[2]):o[3]},{class:s=o[6]("lucide-icon","lucide",o[0]?`lucide-${o[0]}`:"",o[8].class)}],d={};for(let m=0;m<u.length;m+=1)d=fe(d,u[m]);return{c(){e=eo("svg");for(let m=0;m<i.length;m+=1)i[m].c();t=Ie(),c&&c.c(),hi(e,d)},m(m,g){I(m,e,g);for(let h=0;h<i.length;h+=1)i[h]&&i[h].m(e,null);k(e,t),c&&c.m(e,null),n=!0},p(m,[g]){if(g&32){a=Ae(m[5]);let h;for(h=0;h<a.length;h+=1){let _=Ox(m,a,h);i[h]?i[h].p(_,g):(i[h]=Ux(_),i[h].c(),i[h].m(e,t))}for(;h<i.length;h+=1)i[h].d(1);i.length=a.length}c&&c.p&&(!n||g&512)&&be(c,l,m,m[9],n?xe(l,m[9],g,null):we(m[9]),null),hi(e,d=Ue(u,[ud,g&128&&m[7],(!n||g&4)&&{width:m[2]},(!n||g&4)&&{height:m[2]},(!n||g&2)&&{stroke:m[1]},(!n||g&28&&r!==(r=m[4]?Number(m[3])*24/Number(m[2]):m[3]))&&{"stroke-width":r},(!n||g&257&&s!==(s=m[6]("lucide-icon","lucide",m[0]?`lucide-${m[0]}`:"",m[8].class)))&&{class:s}]))},i(m){n||(S(c,m),n=!0)},o(m){P(c,m),n=!1},d(m){m&&C(e),st(i,m),c&&c.d(m)}}}function p2(o,e,t){let r=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode","mergeClasses"],s=ad(e,r),{$$slots:n={},$$scope:a}=e,{name:i=void 0}=e,{color:l="currentColor"}=e,{size:c=24}=e,{strokeWidth:u=2}=e,{absoluteStrokeWidth:d=!1}=e,{iconNode:m}=e,g=(...h)=>h.filter((_,w,v)=>Boolean(_)&&v.indexOf(_)===w).join(" ");return o.$$set=h=>{t(8,e=fe(fe({},e),Se(h))),t(7,s=ad(e,r)),"name"in h&&t(0,i=h.name),"color"in h&&t(1,l=h.color),"size"in h&&t(2,c=h.size),"strokeWidth"in h&&t(3,u=h.strokeWidth),"absoluteStrokeWidth"in h&&t(4,d=h.absoluteStrokeWidth),"iconNode"in h&&t(5,m=h.iconNode),"$$scope"in h&&t(9,a=h.$$scope)},e=Se(e),[i,l,c,u,d,m,g,s,e,a,n]}var pd=class extends ee{constructor(e){super(),oe(this,e,p2,d2,Z,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5,mergeClasses:6})}get mergeClasses(){return this.$$.ctx[6]}},We=pd;function m2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):we(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function h2(o){let e,t,r=[{name:"arrow-right-left"},o[1],{iconNode:o[0]}],s={$$slots:{default:[m2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new We({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function g2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m16 3 4 4-4 4"}],["path",{d:"M20 7H4"}],["path",{d:"m8 21-4-4 4-4"}],["path",{d:"M4 17h16"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var md=class extends ee{constructor(e){super(),oe(this,e,g2,h2,Z,{})}},hd=md;function y2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):we(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function x2(o){let e,t,r=[{name:"arrow-up-down"},o[1],{iconNode:o[0]}],s={$$slots:{default:[y2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new We({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function b2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m21 16-4 4-4-4"}],["path",{d:"M17 20V4"}],["path",{d:"m3 8 4-4 4 4"}],["path",{d:"M7 4v16"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var gd=class extends ee{constructor(e){super(),oe(this,e,b2,x2,Z,{})}},yd=gd;function w2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):we(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function v2(o){let e,t,r=[{name:"chevron-left"},o[1],{iconNode:o[0]}],s={$$slots:{default:[w2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new We({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function _2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m15 18-6-6 6-6"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var xd=class extends ee{constructor(e){super(),oe(this,e,_2,v2,Z,{})}},bd=xd;function S2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):we(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function k2(o){let e,t,r=[{name:"chevron-right"},o[1],{iconNode:o[0]}],s={$$slots:{default:[S2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new We({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function C2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m9 18 6-6-6-6"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var wd=class extends ee{constructor(e){super(),oe(this,e,C2,k2,Z,{})}},vd=wd;function I2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):we(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function L2(o){let e,t,r=[{name:"circle-check-big"},o[1],{iconNode:o[0]}],s={$$slots:{default:[I2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new We({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function T2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}],["path",{d:"m9 11 3 3L22 4"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var _d=class extends ee{constructor(e){super(),oe(this,e,T2,L2,Z,{})}},Sd=_d;function P2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):we(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function D2(o){let e,t,r=[{name:"circle-help"},o[1],{iconNode:o[0]}],s={$$slots:{default:[P2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new We({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function F2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var kd=class extends ee{constructor(e){super(),oe(this,e,F2,D2,Z,{})}},bi=kd;function A2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):we(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function E2(o){let e,t,r=[{name:"clock"},o[1],{iconNode:o[0]}],s={$$slots:{default:[A2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new We({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function M2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["circle",{cx:"12",cy:"12",r:"10"}],["polyline",{points:"12 6 12 12 16 14"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Cd=class extends ee{constructor(e){super(),oe(this,e,M2,E2,Z,{})}},wi=Cd;function R2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):we(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function O2(o){let e,t,r=[{name:"download"},o[1],{iconNode:o[0]}],s={$$slots:{default:[R2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new We({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function U2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"7 10 12 15 17 10"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Id=class extends ee{constructor(e){super(),oe(this,e,U2,O2,Z,{})}},Ld=Id;function $2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):we(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function B2(o){let e,t,r=[{name:"folder"},o[1],{iconNode:o[0]}],s={$$slots:{default:[$2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new We({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function N2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Td=class extends ee{constructor(e){super(),oe(this,e,N2,B2,Z,{})}},Pd=Td;function H2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):we(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function V2(o){let e,t,r=[{name:"info"},o[1],{iconNode:o[0]}],s={$$slots:{default:[H2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new We({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function q2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 16v-4"}],["path",{d:"M12 8h.01"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Dd=class extends ee{constructor(e){super(),oe(this,e,q2,V2,Z,{})}},Fd=Dd;function W2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):we(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function z2(o){let e,t,r=[{name:"layers"},o[1],{iconNode:o[0]}],s={$$slots:{default:[W2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new We({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function K2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Ad=class extends ee{constructor(e){super(),oe(this,e,K2,z2,Z,{})}},Xo=Ad;function G2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):we(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function j2(o){let e,t,r=[{name:"lock"},o[1],{iconNode:o[0]}],s={$$slots:{default:[G2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new We({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function Y2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Ed=class extends ee{constructor(e){super(),oe(this,e,Y2,j2,Z,{})}},Md=Ed;function J2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):we(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function Q2(o){let e,t,r=[{name:"message-square-heart"},o[1],{iconNode:o[0]}],s={$$slots:{default:[J2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new We({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function X2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}],["path",{d:"M14.8 7.5a1.84 1.84 0 0 0-2.6 0l-.2.3-.3-.3a1.84 1.84 0 1 0-2.4 2.8L12 13l2.7-2.7c.9-.9.8-2.1.1-2.8"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Rd=class extends ee{constructor(e){super(),oe(this,e,X2,Q2,Z,{})}},Od=Rd;function Z2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):we(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function eT(o){let e,t,r=[{name:"pause"},o[1],{iconNode:o[0]}],s={$$slots:{default:[Z2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new We({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function tT(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Ud=class extends ee{constructor(e){super(),oe(this,e,tT,eT,Z,{})}},$d=Ud;function rT(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):we(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function oT(o){let e,t,r=[{name:"play"},o[1],{iconNode:o[0]}],s={$$slots:{default:[rT]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new We({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function sT(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["polygon",{points:"6 3 20 12 6 21 6 3"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Bd=class extends ee{constructor(e){super(),oe(this,e,sT,oT,Z,{})}},Nd=Bd;function nT(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):we(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function aT(o){let e,t,r=[{name:"refresh-cw"},o[1],{iconNode:o[0]}],s={$$slots:{default:[nT]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new We({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function iT(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}],["path",{d:"M21 3v5h-5"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}],["path",{d:"M8 16H3v5"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Hd=class extends ee{constructor(e){super(),oe(this,e,iT,aT,Z,{})}},Vd=Hd;function lT(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):we(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function cT(o){let e,t,r=[{name:"satellite"},o[1],{iconNode:o[0]}],s={$$slots:{default:[lT]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new We({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function fT(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M13 7 9 3 5 7l4 4"}],["path",{d:"m17 11 4 4-4 4-4-4"}],["path",{d:"m8 12 4 4 6-6-4-4Z"}],["path",{d:"m16 8 3-3"}],["path",{d:"M9 21a6 6 0 0 0-6-6"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var qd=class extends ee{constructor(e){super(),oe(this,e,fT,cT,Z,{})}},sn=qd;function uT(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):we(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function dT(o){let e,t,r=[{name:"settings"},o[1],{iconNode:o[0]}],s={$$slots:{default:[uT]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new We({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function pT(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Wd=class extends ee{constructor(e){super(),oe(this,e,pT,dT,Z,{})}},zd=Wd;function mT(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):we(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function hT(o){let e,t,r=[{name:"triangle-alert"},o[1],{iconNode:o[0]}],s={$$slots:{default:[mT]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new We({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function gT(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"}],["path",{d:"M12 9v4"}],["path",{d:"M12 17h.01"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Kd=class extends ee{constructor(e){super(),oe(this,e,gT,hT,Z,{})}},vi=Kd;function yT(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):we(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function xT(o){let e,t,r=[{name:"upload"},o[1],{iconNode:o[0]}],s={$$slots:{default:[yT]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new We({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function bT(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"17 8 12 3 7 8"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Gd=class extends ee{constructor(e){super(),oe(this,e,bT,xT,Z,{})}},jd=Gd;function wT(o){Pe(o,"svelte-1gxdage","button.notebook.svelte-1gxdage{color:var(--color-base-30);background-color:transparent}button.notebook-synced.svelte-1gxdage{color:var(--color-accent)}button.system3-connected.svelte-1gxdage{color:var(--color-accent)}button.system3-disconnected.svelte-1gxdage{color:var(--color-base-40)}")}function vT(o){let e,t,r,s,n,a;return t=new Xo({props:{class:"svg-icon inline-icon"}}),{c(){var i;e=T("button"),H(t.$$.fragment),x(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),x(e,"aria-label",s=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),x(e,"tabindex","0"),x(e,"data-filename",n=(i=o[0].view.file)==null?void 0:i.name)},m(i,l){I(i,e,l),B(t,e,null),a=!0},p(i,l){var c;(!a||l&1&&r!==(r="clickable-icon view-action system3-view-action "+(i[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&x(e,"class",r),(!a||l&1&&s!==(s=i[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&x(e,"aria-label",s),(!a||l&1&&n!==(n=(c=i[0].view.file)==null?void 0:c.name))&&x(e,"data-filename",n)},i(i){a||(S(t.$$.fragment,i),a=!0)},o(i){P(t.$$.fragment,i),a=!1},d(i){i&&C(e),N(t)}}}function _T(o){let e,t,r,s,n,a,i,l,c,u,d,m,g;return t=new Xo({props:{class:"svg-icon inline-icon"}}),l=new sn({props:{class:"svg-icon inline-icon"}}),{c(){var h;e=T("button"),H(t.$$.fragment),a=U(),i=T("button"),H(l.$$.fragment),x(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),x(e,"aria-label",s=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),x(e,"tabindex","0"),x(e,"data-filename",n=(h=o[0].view.file)==null?void 0:h.name),x(i,"class",c="system3-"+o[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"),x(i,"aria-label",u=`${o[2].relay.name} (${o[1].status})`),x(i,"tabindex","0")},m(h,_){I(h,e,_),B(t,e,null),I(h,a,_),I(h,i,_),B(l,i,null),d=!0,m||(g=[te(i,"click",o[3]),te(i,"keypress",o[4])],m=!0)},p(h,_){var w;(!d||_&1&&r!==(r="clickable-icon view-action system3-view-action "+(h[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&x(e,"class",r),(!d||_&1&&s!==(s=h[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&x(e,"aria-label",s),(!d||_&1&&n!==(n=(w=h[0].view.file)==null?void 0:w.name))&&x(e,"data-filename",n),(!d||_&2&&c!==(c="system3-"+h[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"))&&x(i,"class",c),(!d||_&6&&u!==(u=`${h[2].relay.name} (${h[1].status})`))&&x(i,"aria-label",u)},i(h){d||(S(t.$$.fragment,h),S(l.$$.fragment,h),d=!0)},o(h){P(t.$$.fragment,h),P(l.$$.fragment,h),d=!1},d(h){h&&(C(e),C(a),C(i)),N(t),N(l),m=!1,Ce(g)}}}function ST(o){let e,t,r,s,n=[_T,vT],a=[];function i(l,c){return l[2]?0:1}return e=i(o,-1),t=a[e]=n[e](o),{c(){t.c(),r=Ie()},m(l,c){a[e].m(l,c),I(l,r,c),s=!0},p(l,[c]){let u=e;e=i(l,c),e===u?a[e].p(l,c):(he(),P(a[u],1,1,()=>{a[u]=null}),ge(),t=a[e],t?t.p(l,c):(t=a[e]=n[e](l),t.c()),S(t,1),t.m(r.parentNode,r))},i(l){s||(S(t),s=!0)},o(l){P(t),s=!1},d(l){l&&C(r),a[e].d(l)}}}function kT(o,e,t){let{view:r}=e,{state:s}=e,{remote:n}=e,a={connected:"connected: click to go offline",connecting:"connecting...",disconnected:"disconnected: click to go online",unknown:"unknown status"},i=()=>{r.toggleConnection()},l=c=>{c.key==="Enter"&&i()};return o.$$set=c=>{"view"in c&&t(0,r=c.view),"state"in c&&t(1,s=c.state),"remote"in c&&t(2,n=c.remote)},[r,s,n,i,l]}var Yd=class extends ee{constructor(e){super(),oe(this,e,kT,ST,Z,{view:0,state:1,remote:2},wT)}},Jd=Yd;var nn=class{constructor(e,t,r){this.view=e,this.text=t,this.onClick=r,this.display()}display(){if(!this.view)return!0;let e=this.view.containerEl,t=this.view.containerEl.querySelector(".view-content");if(!e)return;let r=e.querySelector(".system3-banner-box");r||(r=document.createElement("div"),r.classList.add("system3-banner-box"),e.insertBefore(r,t));let s=e.querySelector(".system3-banner");if(!s){s=document.createElement("div"),s.classList.add("system3-banner");let n=s.createSpan();n.setText(this.text),s.appendChild(n),r.appendChild(s);let a=async()=>{await this.onClick()&&this.destroy()};s.addEventListener("click",a)}return!0}destroy(){let e=this.view.containerEl;if(!e)return;let t=e.querySelector(".system3-banner-box");return t&&t.replaceChildren(),!0}};var tc=require("@codemirror/state"),$x=require("@codemirror/view");function an(o,e){let t=Object.keys(e).map(r=>CT(o,r,e[r]));return t.length===1?t[0]:function(){t.forEach(r=>r())}}function CT(o,e,t){let r=o[e],s=o.hasOwnProperty(e),n=s?r:function(){return Object.getPrototypeOf(o)[e].apply(this,arguments)},a=t(n);return r&&Object.setPrototypeOf(a,r),Object.setPrototypeOf(i,a),o[e]=i,l;function i(...c){return a===n&&o[e]===i&&l(),a.apply(this,c)}function l(){o[e]===i&&(s?o[e]=n:delete o[e]),a!==n&&(a=n,Object.setPrototypeOf(i,r||Function))}}var Bx=Bs(Qd());var IT=25,a6=tc.Facet.define({combine(o){return o[o.length-1]}}),Xd=tc.Annotation.define(),Zd=class{constructor(e){this.initialSet=!1;this.destroyed=!1;this.keyFrameCounter=0;this.debug=(...e)=>{};this.log=(...e)=>{};this.warn=(...e)=>{};var r,s,n,a;if(this.editor=e,this.connectionManager=this.editor.state.field(vo),this.view=(r=this.connectionManager)==null?void 0:r.findView(e),!this.view||(this.log=Te(`[LiveCMPluginValue][${(s=this.view.view.file)==null?void 0:s.path}]`,"log"),this.warn=Te(`[LiveCMPluginValue][${(n=this.view.view.file)==null?void 0:n.path}]`,"warn"),this.debug=Te(`[LiveCMPluginValue][${(a=this.view.view.file)==null?void 0:a.path}]`,"debug"),this.debug("created"),!this.view.document))return;let t=this;this.uninstallMonkeyPatch=an(this.view.view,{setViewData(i){return function(l,c){return c&&(wo(t.view)&&t.view.document.text===l&&(t.view.tracking=!0),t.resync()),i.call(this,l,c)}}}),this.view.document.connected?this.resync():this.view.document.onceConnected().then(()=>{this.resync()}),this._observer=async(i,l)=>{if(!wo(this.view)){this.debug("Recived yjs event against a non-live view");return}if(this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}if(l.origin!==this){let c=i.delta,u=[],d=0;for(let m=0;m<c.length;m++){let g=c[m];g.insert!=null?u.push({from:d,to:d,insert:g.insert}):g.delete!=null?(u.push({from:d,to:d+g.delete,insert:""}),d+=g.delete):g.retain!=null&&(d+=g.retain)}!this.view.tracking||Ge().enableEditorTweens&&this.keyFrameCounter>IT?(this.keyFrameCounter=0,u=await this.getKeyFrame(!0),this.debug("dispatch (full)")):(this.keyFrameCounter+=1,this.debug(`dispatch (incremental + ${this.keyFrameCounter})`)),wo(this.view)&&(e.dispatch({changes:u,annotations:[Xd.of(this.editor)]}),this.view.tracking=!0)}},this.observer=(i,l)=>{var c;try{(c=this._observer)==null||c.call(this,i,l)}catch(u){u instanceof RangeError&&wo(this.view)&&(this.view.tracking=!1)}},this._ytext=this.view.document.ytext,this._ytext.observe(this.observer)}incrementalBufferChange(e){let t=this.editor.state.doc.toString(),r=new Bx.default,s=r.diff_main(t,e);r.diff_cleanupSemantic(s);let n=[],a=0;for(let[i,l]of s)switch(i){case 0:a+=l.length;break;case 1:n.push({from:a,to:a,insert:l}),a+=l.length;break;case-1:n.push({from:a,to:a+l.length,insert:""});break}return n}getBufferChange(e,t=!1){return t?this.incrementalBufferChange(e):[{from:0,to:this.editor.state.doc.length,insert:e}]}async resync(){if(wo(this.view)&&!this.view.tracking&&!this.destroyed){await this.view.document.whenSynced();let e=await this.getKeyFrame();wo(this.view)&&!this.view.tracking&&!this.destroyed&&this.editor.dispatch({changes:e,annotations:[Xd.of(this.editor)]})}}async getKeyFrame(e=!1){return!wo(this.view)||this.destroyed?[]:this.view.document.text===this.view.view.getViewData()?(this.view.tracking=!0,[]):(this.warn(`|${this.view.document.text}|
|${this.view.view.getViewData()}|`),this.warn("ytext and editor buffer need syncing"),!this.view.document.hasLocalDB()&&this.view.document.text===""?(this.warn("local db missing, not setting buffer"),[]):(this.view.tracking||this.view.checkStale(),wo(this.view)&&!this.destroyed?[this.getBufferChange(this.view.document.text,e)]:[]))}update(e){var s,n,a,i;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(Xd)===this.editor)return;let t=e.view;this.view=(s=this.connectionManager)==null?void 0:s.findView(t);let r=(a=(n=this.view)==null?void 0:n.document)==null?void 0:a.ytext;r&&((i=r.doc)==null||i.transact(()=>{let l=0;e.changes.iterChanges((c,u,d,m,g)=>{let h=g.sliceString(0,g.length,`
`);c!==u&&r.delete(c+l,u-c),h.length>0&&r.insert(c+l,h),l+=h.length-(u-c)})},this))}destroy(){var e;this.destroyed=!0,this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.uninstallMonkeyPatch&&(this.uninstallMonkeyPatch(),this.uninstallMonkeyPatch=void 0),this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},Nx=$x.ViewPlugin.fromClass(Zd);var rc=require("@codemirror/state"),hr=require("@codemirror/view");var Hx=hr.EditorView.baseTheme({".cm-ySelection":{},".cm-yLineSelection":{padding:0,margin:"0px 2px 0px 4px"},".cm-ySelectionCaret":{position:"relative",borderLeft:"1px solid black",borderRight:"1px solid black",marginLeft:"-1px",marginRight:"-1px",boxSizing:"border-box",display:"inline"},".cm-ySelectionCaretDot":{borderRadius:"50%",position:"absolute",width:".4em",height:".4em",top:"-.2em",left:"-.2em",backgroundColor:"inherit",transition:"transform .3s ease-in-out",boxSizing:"border-box"},".cm-ySelectionCaret:hover > .cm-ySelectionCaretDot":{transformOrigin:"bottom center",transform:"scale(0)"},".cm-ySelectionInfo":{position:"absolute",top:"-1.05em",left:"-1px",fontSize:".75em",fontFamily:"serif",fontStyle:"normal",fontWeight:"normal",lineHeight:"normal",userSelect:"none",color:"white",paddingLeft:"2px",paddingRight:"2px",zIndex:101,transition:"opacity .3s ease-in-out",backgroundColor:"inherit",opacity:0,transitionDelay:"0s",whiteSpace:"nowrap"},".cm-ySelectionCaret:hover > .cm-ySelectionInfo":{opacity:1,transitionDelay:"0s"}}),LT=rc.Annotation.define(),ep=class extends hr.WidgetType{constructor(t,r){super();this.color=t,this.name=r}toDOM(t){return Wa("span",[er("class","cm-ySelectionCaret"),er("style",`background-color: ${this.color}; border-color: ${this.color}`)],[Un("\u2060"),Wa("div",[er("class","cm-ySelectionCaretDot")]),Un("\u2060"),Wa("div",[er("class","cm-ySelectionInfo")],[Un(this.name)]),Un("\u2060")])}eq(t){return t.color===this.color}compare(t){return t.color===this.color}updateDOM(){return!1}get estimatedHeight(){return-1}ignoreEvent(){return!0}},tp=class{constructor(e){var r,s;this.editor=e,this.decorations=rc.RangeSet.of([]),this.connectionManager=this.editor.state.field(vo);let t=(r=this.connectionManager)==null?void 0:r.findView(e);if(t&&t instanceof Ts){this.view=t;let n=(s=this.view.document)==null?void 0:s._provider;this._listener=({added:a,updated:i,removed:l},c,u)=>{a.concat(i).concat(l).findIndex(m=>{var g;return m!==((g=this._awareness)==null?void 0:g.doc.clientID)})>=0&&e.dispatch({annotations:[LT.of([])]})},n&&(this._awareness=n.awareness,this._awareness.on("change",this._listener))}}destroy(){var e;this._listener&&((e=this._awareness)==null||e.off("change",this._listener),this._listener=void 0),this.connectionManager=null,this.view=null,this.editor=null}update(e){var c,u,d,m;let t=e.view;this.view=(c=this.connectionManager)==null?void 0:c.findView(t);let r=(d=(u=this.view)==null?void 0:u.document)==null?void 0:d.ytext;if(!(this.view&&r&&r.doc))return;let s=(m=this.view.document)==null?void 0:m._provider;if(!s)return;this._awareness=s.awareness;let n=this._awareness,a=r.doc,i=[],l=this._awareness.getLocalState();if(l!=null){let g=e.view.hasFocus&&e.view.dom.ownerDocument.hasFocus(),h=g?e.state.selection.main:null,_=l.cursor==null?null:mu(l.cursor.anchor),w=l.cursor==null?null:mu(l.cursor.head);if(h!=null){let v=hu(r,h.anchor),A=hu(r,h.head);(l.cursor==null||!yu(_,v)||!yu(w,A))&&n.setLocalStateField("cursor",{anchor:v,head:A})}else l.cursor!=null&&g&&n.setLocalStateField("cursor",null)}n.getStates().forEach((g,h)=>{if(h===n.doc.clientID)return;let _=g.cursor;if(_==null||_.anchor==null||_.head==null)return;let w=gu(_.anchor,a),v=gu(_.head,a);if(w==null||v==null||w.type!==r||v.type!==r)return;if(w.index>e.state.doc.length||v.index>e.state.doc.length){Te("[RemoteSelections]","warn")(`cursor positions (${w.index}, ${v.index}) out of range of document length: ${e.state.doc.length}`),this.decorations=hr.Decoration.none;return}let{color:A="#30bced",name:O="Anonymous"}=g.user||{},E=g.user&&g.user.colorLight||A+"33",M=Cn(w.index,v.index),R=Kr(w.index,v.index),D=e.view.state.doc.lineAt(M),F=e.view.state.doc.lineAt(R);if(D.number===F.number)i.push({from:M,to:R,value:hr.Decoration.mark({attributes:{style:`background-color: ${E}`},class:"cm-ySelection"})});else{i.push({from:M,to:D.from+D.length,value:hr.Decoration.mark({attributes:{style:`background-color: ${E}`},class:"cm-ySelection"})}),i.push({from:F.from,to:R,value:hr.Decoration.mark({attributes:{style:`background-color: ${E}`},class:"cm-ySelection"})});for(let V=D.number+1;V<F.number;V++){let q=e.view.state.doc.line(V).from;i.push({from:q,to:q,value:hr.Decoration.line({attributes:{style:`background-color: ${E}`,class:"cm-yLineSelection"}})})}}i.push({from:v.index,to:v.index,value:hr.Decoration.widget({side:v.index-w.index>0?-1:1,block:!1,widget:new ep(A,O)})})}),this.decorations=hr.Decoration.set(i,!0)}},Vx=hr.ViewPlugin.fromClass(tp,{decorations:o=>o.decorations});var oc=require("@codemirror/state"),Zo=require("@codemirror/view"),qx=require("@codemirror/view");var w6=oc.Annotation.define(),op=class extends qx.WidgetType{toDOM(){let e=document.createElement("span");return e.style.display="inline-flex",e.addClass("invalid-link"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-warning"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>',e.title="This link points outside the shared folder and may not be accessible to other users.",e}},rp=oc.StateEffect.define(),sp=class{constructor(e){this.log=e=>{};var t;if(this.editor=e,this.connectionManager=this.editor.state.field(vo),this.decorations=Zo.Decoration.none,this.decorationAnchors=[],this.metadata=new Map,this.cb=(r,s)=>{this.updateFromMetadata(s),this.editor.dispatch({effects:rp.of(null)})},!this.connectionManager){Te("[InvalidLinkPluginValue]","warn")("ConnectionManager not found in InvalidLinkPlugin");return}this.app=this.connectionManager.app,this.view=this.connectionManager.findView(e),this.view&&(this.log=Te(`[InvalidLinkPluginValue][${(t=this.view.view.file)==null?void 0:t.path}]`,"debug"),this.log("created"),this.view.document&&this.view.document.whenSynced().then(()=>{var r,s;if(this.connectionManager&&this.app&&((s=(r=this.view)==null?void 0:r.document)!=null&&s.tfile)){this.connectionManager.onMeta(this.view.document.tfile,this.cb);let n=this.app.metadataCache.getFileCache(this.view.document.tfile);n&&(this.updateFromMetadata(n),this.editor.dispatch({effects:rp.of(null)}))}else this.log("unable to subscribe to metadata updates")}))}findInternalLinks(e){let t=[];return e.state.facet(Zo.EditorView.decorations).forEach(s=>{(typeof s=="function"?s(e):s).between(0,e.state.doc.length,(a,i,l)=>{var d;(((d=l.spec)==null?void 0:d.class)||"").contains("cm-formatting-link-end")&&t.push({from:a,to:i})})}),t}updateFromMetadata(e){var r,s,n,a;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((s=(r=this.view)==null?void 0:r.document)!=null&&s.sharedFolder)||!((a=(n=this.view)==null?void 0:n.document)!=null&&a.tfile))return;let t=new Map;for(let i of(e==null?void 0:e.links)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(i.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(i.position.start.offset,{from:i.position.start.offset,to:i.position.end.offset,link:i.link,original:i.original})}for(let i of(e==null?void 0:e.embeds)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(i.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(i.position.start.offset,{from:i.position.start.offset,to:i.position.end.offset,link:i.link,original:i.original})}this.metadata=t}updateMetadataPositions(e){for(let[t,r]of this.metadata)try{this.metadata.set(t,{from:e.changes.mapPos(r.from),to:e.changes.mapPos(r.to),link:r.link,original:r.original})}catch(s){this.metadata.delete(t)}}updateFromEditor(e){var n,a,i,l;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((a=(n=this.view)==null?void 0:n.document)!=null&&a.sharedFolder)||!((l=(i=this.view)==null?void 0:i.document)!=null&&l.tfile))return;let t=[],r=new Map(this.metadata),s=this.findInternalLinks(this.editor);for(let c of s){let u=null;for(let[g,h]of r)if(c.from<=h.to&&c.to>=h.from){u=h,r.delete(g);break}if(!u)continue;let d=this.app.metadataCache.getFirstLinkpathDest(u.link,this.view.document.path);d&&!this.view.document.sharedFolder.checkPath(d.path)&&t.push(c.from)}t.filter(c=>c<=e.state.doc.length),this.decorationAnchors=t}updateDecorations(){this.decorationAnchors.sort();let e=this.decorationAnchors.map(t=>Zo.Decoration.widget({widget:new op,side:1}).range(t));e.length>0?this.decorations=Zo.Decoration.set(e,!0):this.decorations=Zo.Decoration.none}update(e){let t=!1;return e.transactions.forEach(r=>{r.effects.some(s=>s.is(rp))&&(t=!0)}),(e.docChanged||e.viewportChanged||t)&&(t||this.updateMetadataPositions(e),this.updateFromEditor(e),this.updateDecorations()),this.decorations}destroy(){var e,t;this.connectionManager&&((t=(e=this.view)==null?void 0:e.document)!=null&&t.tfile)&&this.connectionManager.offMeta(this.view.document.tfile),this.connectionManager=null,this.view=void 0,this.metadata.clear(),this.metadata=null,this.editor=null}},Wx=Zo.ViewPlugin.fromClass(sp,{decorations:o=>o.decorations});function es(){}es.prototype={diff:function(e,t){var r,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=s.callback;typeof s=="function"&&(n=s,s={}),this.options=s;var a=this;function i(E){return n?(setTimeout(function(){n(void 0,E)},0),!0):E}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e)),t=this.removeEmpty(this.tokenize(t));var l=t.length,c=e.length,u=1,d=l+c;s.maxEditLength&&(d=Math.min(d,s.maxEditLength));var m=(r=s.timeout)!==null&&r!==void 0?r:1/0,g=Date.now()+m,h=[{oldPos:-1,lastComponent:void 0}],_=this.extractCommon(h[0],t,e,0);if(h[0].oldPos+1>=c&&_+1>=l)return i([{value:this.join(t),count:t.length}]);var w=-1/0,v=1/0;function A(){for(var E=Math.max(w,-u);E<=Math.min(v,u);E+=2){var M=void 0,R=h[E-1],D=h[E+1];R&&(h[E-1]=void 0);var F=!1;if(D){var V=D.oldPos-E;F=D&&0<=V&&V<l}var q=R&&R.oldPos+1<c;if(!F&&!q){h[E]=void 0;continue}if(!q||F&&R.oldPos+1<D.oldPos?M=a.addToPath(D,!0,void 0,0):M=a.addToPath(R,void 0,!0,1),_=a.extractCommon(M,t,e,E),M.oldPos+1>=c&&_+1>=l)return i(TT(a,M.lastComponent,t,e,a.useLongestToken));h[E]=M,M.oldPos+1>=c&&(v=Math.min(v,E-1)),_+1>=l&&(w=Math.max(w,E+1))}u++}if(n)(function E(){setTimeout(function(){if(u>d||Date.now()>g)return n();A()||E()},0)})();else for(;u<=d&&Date.now()<=g;){var O=A();if(O)return O}},addToPath:function(e,t,r,s){var n=e.lastComponent;return n&&n.added===t&&n.removed===r?{oldPos:e.oldPos+s,lastComponent:{count:n.count+1,added:t,removed:r,previousComponent:n.previousComponent}}:{oldPos:e.oldPos+s,lastComponent:{count:1,added:t,removed:r,previousComponent:n}}},extractCommon:function(e,t,r,s){for(var n=t.length,a=r.length,i=e.oldPos,l=i-s,c=0;l+1<n&&i+1<a&&this.equals(t[l+1],r[i+1]);)l++,i++,c++;return c&&(e.lastComponent={count:c,previousComponent:e.lastComponent}),e.oldPos=i,l},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function TT(o,e,t,r,s){for(var n=[],a;e;)n.push(e),a=e.previousComponent,delete e.previousComponent,e=a;n.reverse();for(var i=0,l=n.length,c=0,u=0;i<l;i++){var d=n[i];if(d.removed){if(d.value=o.join(r.slice(u,u+d.count)),u+=d.count,i&&n[i-1].added){var g=n[i-1];n[i-1]=n[i],n[i]=g}}else{if(!d.added&&s){var m=t.slice(c,c+d.count);m=m.map(function(_,w){var v=r[u+w];return v.length>_.length?v:_}),d.value=o.join(m)}else d.value=o.join(t.slice(c,c+d.count));c+=d.count,d.added||(u+=d.count)}}var h=n[l-1];return l>1&&typeof h.value=="string"&&(h.added||h.removed)&&o.equals("",h.value)&&(n[l-2].value+=h.value,n.pop()),n}var _6=new es;function PT(o,e){if(typeof o=="function")e.callback=o;else if(o)for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t]);return e}var zx=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,Kx=/\S/,cp=new es;cp.equals=function(o,e){return this.options.ignoreCase&&(o=o.toLowerCase(),e=e.toLowerCase()),o===e||this.options.ignoreWhitespace&&!Kx.test(o)&&!Kx.test(e)};cp.tokenize=function(o){for(var e=o.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<e.length-1;t++)!e[t+1]&&e[t+2]&&zx.test(e[t])&&zx.test(e[t+2])&&(e[t]+=e[t+2],e.splice(t+1,2),t--);return e};function Gx(o,e,t){return t=PT(t,{ignoreWhitespace:!0}),cp.diff(o,e,t)}var fp=new es;fp.tokenize=function(o){this.options.stripTrailingCr&&(o=o.replace(/\r\n/g,`
`));var e=[],t=o.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var r=0;r<t.length;r++){var s=t[r];r%2&&!this.options.newlineIsToken?e[e.length-1]+=s:(this.options.ignoreWhitespace&&(s=s.trim()),e.push(s))}return e};function DT(o,e,t){return fp.diff(o,e,t)}var FT=new es;FT.tokenize=function(o){return o.split(/(\S.+?[.!?])(?=\s+|$)/)};var AT=new es;AT.tokenize=function(o){return o.split(/([{}:;,]|\s+)/)};function sc(o){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?sc=function(e){return typeof e}:sc=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sc(o)}function np(o){return ET(o)||MT(o)||RT(o)||OT()}function ET(o){if(Array.isArray(o))return ap(o)}function MT(o){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(o))return Array.from(o)}function RT(o,e){if(o){if(typeof o=="string")return ap(o,e);var t=Object.prototype.toString.call(o).slice(8,-1);if(t==="Object"&&o.constructor&&(t=o.constructor.name),t==="Map"||t==="Set")return Array.from(o);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ap(o,e)}}function ap(o,e){(e==null||e>o.length)&&(e=o.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=o[t];return r}function OT(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var UT=Object.prototype.toString,_i=new es;_i.useLongestToken=!0;_i.tokenize=fp.tokenize;_i.castInput=function(o){var e=this.options,t=e.undefinedReplacement,r=e.stringifyReplacer,s=r===void 0?function(n,a){return typeof a=="undefined"?t:a}:r;return typeof o=="string"?o:JSON.stringify(ip(o,null,null,s),s,"  ")};_i.equals=function(o,e){return es.prototype.equals.call(_i,o.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};function ip(o,e,t,r,s){e=e||[],t=t||[],r&&(o=r(s,o));var n;for(n=0;n<e.length;n+=1)if(e[n]===o)return t[n];var a;if(UT.call(o)==="[object Array]"){for(e.push(o),a=new Array(o.length),t.push(a),n=0;n<o.length;n+=1)a[n]=ip(o[n],e,t,r,s);return e.pop(),t.pop(),a}if(o&&o.toJSON&&(o=o.toJSON()),sc(o)==="object"&&o!==null){e.push(o),a={},t.push(a);var i=[],l;for(l in o)o.hasOwnProperty(l)&&i.push(l);for(i.sort(),n=0;n<i.length;n+=1)l=i[n],a[l]=ip(o[l],e,t,r,l);e.pop(),t.pop()}else a=o;return a}var lp=new es;lp.tokenize=function(o){return o.slice()};lp.join=lp.removeEmpty=function(o){return o};function jx(o,e,t,r,s,n,a){a||(a={}),typeof a.context=="undefined"&&(a.context=4);var i=DT(t,r,a);if(!i)return;i.push({value:"",lines:[]});function l(v){return v.map(function(A){return" "+A})}for(var c=[],u=0,d=0,m=[],g=1,h=1,_=function(A){var O=i[A],E=O.lines||O.value.replace(/\n$/,"").split(`
`);if(O.lines=E,O.added||O.removed){var M;if(!u){var R=i[A-1];u=g,d=h,R&&(m=a.context>0?l(R.lines.slice(-a.context)):[],u-=m.length,d-=m.length)}(M=m).push.apply(M,np(E.map(function(pe){return(O.added?"+":"-")+pe}))),O.added?h+=E.length:g+=E.length}else{if(u)if(E.length<=a.context*2&&A<i.length-2){var D;(D=m).push.apply(D,np(l(E)))}else{var F,V=Math.min(E.length,a.context);(F=m).push.apply(F,np(l(E.slice(0,V))));var q={oldStart:u,oldLines:g-u+V,newStart:d,newLines:h-d+V,lines:m};if(A>=i.length-2&&E.length<=a.context){var j=/\n$/.test(t),z=/\n$/.test(r),Y=E.length==0&&m.length>q.oldLines;!j&&Y&&t.length>0&&m.splice(q.oldLines,0,"\\ No newline at end of file"),(!j&&!Y||!z)&&m.push("\\ No newline at end of file")}c.push(q),u=0,d=0,m=[]}g+=E.length,h+=E.length}},w=0;w<i.length;w++)_(w);return{oldFileName:o,newFileName:e,oldHeader:s,newHeader:n,hunks:c}}var Qx=require("obsidian");var nc=class{constructor(e){this.file1Start=e.file1Start,this.file2Start=e.file2Start,this.file1Lines=e.file1Lines,this.file2Lines=e.file2Lines}};var ac=class{constructor(e){this.file1Name=e.file1Name,this.file2Name=e.file2Name,this.differences=e.differences}static fromParsedDiff(e){let t=[];return e.hunks.forEach(r=>{let s=0,n=0;for(let a=0;a<r.lines.length;a+=1){let i=r.lines[a];if(i.startsWith("+")||i.startsWith("-")){let l=a,c=l;for(;c<r.lines.length-1&&(r.lines[c+1].startsWith("+")||r.lines[c+1].startsWith("-"));)c+=1;let u=r.lines.slice(l,c+1).filter(m=>m.startsWith("-")).map(m=>m.slice(1)),d=r.lines.slice(l,c+1).filter(m=>m.startsWith("+")).map(m=>m.slice(1));t.push(new nc({file1Start:r.oldStart+l-n-1,file2Start:r.newStart+l-s-1,file1Lines:u,file2Lines:d})),s+=u.length,n+=d.length,a+=c-l}}}),new this({file1Name:e.oldFileName,file2Name:e.newFileName,differences:t})}};function up(o){let e=o.fullText.split(`
`);return e.splice(o.position,0,o.newLine),e.join(`
`)}function Si(o){let e=o.fullText.split(`
`);return o.newLine===""?e.splice(o.position,o.linesToReplace):e.splice(o.position,o.linesToReplace,o.newLine),e.join(`
`)}function ki(o){let e=o.fullText.split(`
`);return e.splice(o.position,o.count),e.join(`
`)}function ua(o){return o!==""?o:"\u200E"}var gr=class{constructor(e){this.text=e.text,this.onClick=e.onClick}build(e){e.createEl("a",{text:this.text,cls:"no-decoration text-xxs file-diff__action-line"}).onClickEvent(this.onClick)}};var _o=class{static build(e){e.createEl("span",{text:"|",cls:"text-xxs file-diff__action-line"})}};var pp=require("obsidian");var Yx=Bs(Qd());var yr=class extends dt{constructor(t){super();this.observableName=t;this._map=new Map,this._derivedMaps=new WeakMap}set(t,r){return this._map.set(t,r),this.notifyListeners(),this}delete(t){let r=this._map.delete(t);return r&&this.notifyListeners(),r}clear(){this._map.clear(),this.notifyListeners()}has(t){return this._map.has(t)}get(t){return this._map.get(t)}keys(){return[...this._map.keys()]}values(){return[...this._map.values()]}entries(){return[...this._map.entries()]}get size(){return this._map.size}forEach(t){this._map.forEach(t)}find(t){for(let[r,s]of this._map)if(t(s,r))return s}some(t){for(let[r,s]of this._map)if(t(s,r))return!0;return!1}filter(t){let r=this._derivedMaps.get(t);if(r)return r;let s=new dp(this,t);return this._derivedMaps.set(t,s),s}},dp=class extends yr{constructor(t,r){super();this.parentMap=t;this.predicate=r;this.sub(),this.observableName=t.observableName+"(filter: "+r.toString()+")"}sub(){this.unsub||(this.unsub=this.parentMap.subscribe(()=>{let t=new Map;this.parentMap.forEach((r,s)=>{this.predicate(r,s)&&t.set(s,r)}),this._map=t,this.notifyListeners()}))}subscribe(t){return this.sub(),super.subscribe(t),()=>{this.unsubscribe(t)}}unsubscribe(t){super.unsubscribe(t),this._listeners.size===0&&this.unsub&&(this.unsub(),this.unsub=void 0)}destroy(){this.unsub&&this.unsub()}};function da(o,e){let t=o.path.split("/"),r=e.path.split("/");if(t.length===2&&r.length>2)return 1;if(r.length===2&&t.length>2)return-1;let s=Math.min(t.length,r.length);for(let n=0;n<s;n++)if(t[n]!==r[n]){if(n===t.length-1){let a=t[n].match(/\d+/g),i=r[n].match(/\d+/g);if(a&&i){let l=parseInt(a[0]),c=parseInt(i[0]);if(l!==c)return l-c}}return t[n].localeCompare(r[n])}return t.length-r.length}function Jx(o,e){let t=o.getText("contents"),r=t.toString(),s=new Yx.diff_match_patch,n=s.diff_main(r,e);s.diff_cleanupSemantic(n);let a=0,i=Te("[updateYDocFromDiskBuffer]","debug");i("Updating YDoc:"),i("Current content length:",r.length),i("Disk buffer length:",e.length),n.length!=0&&(o.transact(()=>{for(let[l,c]of n)switch(l){case 1:i(`Inserting "${c}" at position ${a}`),t.insert(a,c),a+=c.length;break;case 0:i(`Keeping "${c}" (length: ${c.length})`),a+=c.length;break;case-1:i(`Deleting "${c}" at position ${a}`),t.delete(a,c.length);break}}),i("Update complete. New content length:",t.toString().length))}var ic=class extends Ft{constructor(t,r,s,n=3){super();this.loginManager=t;this.timeProvider=r;this.sharedFolders=s;this.concurrency=n;this.activeSync=new ks;this.activeDownloads=new ks;this.syncGroups=new yr;this.syncQueue=[];this.downloadQueue=[];this.isProcessingSync=!1;this.isProcessingDownloads=!1;this.isPaused=!0;this.inProgressSyncs=new Set;this.inProgressDownloads=new Set;this.syncCompletionCallbacks=new Map;this.downloadCompletionCallbacks=new Map;this.loggedItems=new Map;this.subscriptions=[];this.start=this.resume;Bt.set(this,"BackgroundSync"),this.timeProvider.setInterval(()=>{this.processSyncQueue(),this.processDownloadQueue()},1e3)}get pendingSyncs(){return this.syncQueue}get pendingDownloads(){return this.downloadQueue}getOverallProgress(){let t=0,r=0,s=0,n=0,a=0,i=0;this.syncGroups.forEach(d=>{t+=d.total,r+=d.completed,s+=d.syncs,n+=d.completedSyncs,a+=d.downloads,i+=d.completedDownloads});let l=t>0?r/t*100:0,c=s>0?n/s*100:0,u=a>0?i/a*100:0;return{totalPercent:Math.round(l),syncPercent:Math.round(c),downloadPercent:Math.round(u),totalItems:t,completedItems:r,syncItems:s,completedSyncs:n,downloadItems:a,completedDownloads:i}}getGroupProgress(t){let r=this.syncGroups.get(t);if(!r)return null;let s=r.total>0?r.completed/r.total*100:0,n=r.syncs>0?r.completedSyncs/r.syncs*100:0,a=r.downloads>0?r.completedDownloads/r.downloads*100:0;return{percent:Math.round(s),syncPercent:Math.round(n),downloadPercent:Math.round(a),sharedFolder:t,status:r.status}}getAllGroupsProgress(){let t=[];return this.syncGroups.forEach((r,s)=>{let n=this.getGroupProgress(s);n&&t.push(n)}),t}async processSyncQueue(){if(this.isPaused||this.isProcessingSync)return;this.isProcessingSync=!0;let t=this.syncQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeSync.size<this.concurrency;){let r=t.shift();if(!r)break;this.syncQueue=this.syncQueue.filter(s=>s.guid!==r.guid),r.status="running",this.activeSync.add(r);try{let s=r.doc;await this.syncDocument(s),r.status="completed";let n=this.syncCompletionCallbacks.get(r.guid);n&&(n.resolve(),this.syncCompletionCallbacks.delete(r.guid));let a=this.syncGroups.get(r.sharedFolder);a&&(this.debug(`[Sync Progress] Before: completed=${a.completed}, total=${a.total}, syncs=${a.syncs}, completedSyncs=${a.completedSyncs}`),a.completedSyncs++,a.completed++,this.debug(`[Sync Progress] After: completed=${a.completed}, total=${a.total}, syncs=${a.syncs}, completedSyncs=${a.completedSyncs}`),a.completed===a.total&&(a.status="completed",this.debug("[Sync Progress] Group completed!")),this.syncGroups.set(r.sharedFolder,a))}catch(s){r.status="failed";let n=this.syncCompletionCallbacks.get(r.guid);n&&(n.reject(s instanceof Error?s:new Error(String(s))),this.syncCompletionCallbacks.delete(r.guid));let a=this.syncGroups.get(r.sharedFolder);a&&(this.error("[Sync Failed]",s),a.status="failed",this.syncGroups.set(r.sharedFolder,a))}finally{this.activeSync.delete(r),this.inProgressSyncs.delete(r.guid)}}this.isProcessingSync=!1,this.syncQueue.length>0&&!this.isPaused&&this.syncQueue.some(s=>s.sharedFolder.connected)&&this.processSyncQueue()}async processDownloadQueue(){if(this.isPaused||this.isProcessingDownloads)return;this.isProcessingDownloads=!0;let t=this.downloadQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeDownloads.size<this.concurrency;){let r=t.shift();if(!r)break;this.downloadQueue=this.downloadQueue.filter(s=>s.guid!==r.guid),r.status="running",this.activeDownloads.add(r);try{r.doc instanceof wt?await this.getCanvas(r.doc):await this.getDocument(r.doc),r.status="completed";let s=this.downloadCompletionCallbacks.get(r.guid);s&&(s.resolve(),this.downloadCompletionCallbacks.delete(r.guid));let n=this.syncGroups.get(r.sharedFolder);n&&(n.completedDownloads++,n.completed++,n.completed===n.total&&(n.status="completed"),this.syncGroups.set(r.sharedFolder,n))}catch(s){r.status="failed";let n=this.downloadCompletionCallbacks.get(r.guid);n&&(n.reject(s instanceof Error?s:new Error(String(s))),this.downloadCompletionCallbacks.delete(r.guid));let a=this.syncGroups.get(r.sharedFolder);a&&(a.status="failed",this.syncGroups.set(r.sharedFolder,a)),this.error("[processDownloadQueue]",s)}finally{this.activeDownloads.delete(r),this.inProgressDownloads.delete(r.guid)}}this.isProcessingDownloads=!1,this.downloadQueue.length>0&&!this.isPaused&&this.downloadQueue.some(s=>s.sharedFolder.connected)&&this.processDownloadQueue()}async enqueueSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueSync] Item ${t.guid} already in progress, skipping`);let i=this.syncCompletionCallbacks.get(t.guid);return i?new Promise((l,c)=>{i.resolve=l,i.reject=c}):(this.processSyncQueue(),Promise.resolve())}let r=t.sharedFolder,s={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r},n=this.syncGroups.get(r);n?(n.total++,n.syncs++):n={sharedFolder:r,total:1,completed:0,status:"pending",downloads:0,syncs:1,completedDownloads:0,completedSyncs:0},this.syncGroups.set(r,n),this.inProgressSyncs.add(t.guid);let a=new Promise((i,l)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:i,reject:l})});return this.syncQueue.push(s),this.syncQueue.sort(da),this.processSyncQueue(),a}enqueueDownload(t){if(this.inProgressDownloads.has(t.guid)){this.debug(`[enqueueDownload] Item ${t.guid} already in progress, skipping`);let i=this.downloadCompletionCallbacks.get(t.guid);return i?(this.processDownloadQueue(),new Promise((l,c)=>{i.resolve=l,i.reject=c})):(this.processDownloadQueue(),Promise.resolve())}let r=t.sharedFolder,s=this.syncGroups.get(r);s||(s={sharedFolder:r,total:0,completed:0,status:"pending",downloads:0,syncs:0,completedDownloads:0,completedSyncs:0}),s.downloads++,s.total++,this.syncGroups.set(r,s);let n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressDownloads.add(t.guid);let a=new Promise((i,l)=>{this.downloadCompletionCallbacks.set(t.guid,{resolve:i,reject:l})});return this.downloadQueue.push(n),this.downloadQueue.sort(da),this.processDownloadQueue(),a}enqueueSharedFolderSync(t){let r=[...t.files.values()].filter(Zr),s=[...t.files.values()].filter(Cr),n=[...r,...s],a={sharedFolder:t,total:n.length,completed:0,status:"pending",downloads:0,syncs:n.length,completedDownloads:0,completedSyncs:0};this.syncGroups.set(t,a);let i=[...r].sort(da),l=[...s].sort(da);for(let c of i)this.enqueueDocumentForGroupSync(c);for(let c of l)this.enqueueCanvasForGroupSync(c,t);a.status="running",this.syncGroups.set(t,a)}async enqueueDocumentForGroupSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueDocumentForGroupSync] Item ${t.guid} already in progress, skipping`);let a=this.syncCompletionCallbacks.get(t.guid);return a?(this.processSyncQueue(),new Promise((i,l)=>{a.resolve=i,a.reject=l})):Promise.resolve()}let r=t.sharedFolder,s={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressSyncs.add(t.guid);let n=new Promise((a,i)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:a,reject:i})});return this.syncQueue.push(s),this.syncQueue.sort(da),this.processSyncQueue(),n}getAuthHeader(t){var r;return{Authorization:Ge().enableDocumentServer?`Bearer ${t.token}`:`Bearer ${(r=this.loginManager.user)==null?void 0:r.token}`}}getBaseUrl(t,r){var i;let s=new URL(t.url);s.protocol="https:";let n=s.pathname.split("/");n.pop(),n.push(t.docId),s.pathname=n.join("/");let a=((i=t.baseUrl)==null?void 0:i.replace(/\/$/,""))||s.toString();if(Ge().enableDocumentServer)return a;if(r instanceof Ur)return`https://api.system3.md/relay/${r.relayId}/doc/${r.documentId}`;if(r instanceof sr)return`https://api.system3.md/relay/${r.relayId}/doc/${r.canvasId}`;throw new Error("unexpected case")}async downloadItem(t){let r=u=>u instanceof sr?u.canvasId:u.documentId,s=t.s3rn;if(this.log("[downloadItem]",t.path,`${bt.encode(s)}`),!(s instanceof Ur||s instanceof sr))throw new Error(`Unable to decode S3RN: ${bt.encode(s)}`);let n=await t.getProviderToken(),a=this.getAuthHeader(n),l=`${this.getBaseUrl(n,s)}/as-update`,c=await(0,pp.requestUrl)({url:l,method:"GET",headers:a,throw:!1});if(c.status===200)this.debug("[downloadItem]",r(s),c.status);else throw this.error("[downloadItem]",r(s),l,c.status,c.text),new Error(`Unable to download item: ${bt.encode(s)}`);return c}async syncDocumentWebsocket(t){let r="",s="",n=null;Cr(t)?(n=wt.exportCanvasData(t.ydoc),s=JSON.stringify(n)):Zr(t)&&(s=t.text);try{r=await t.sharedFolder.read(t)}catch(c){}let a=!1;if(Cr(t)&&n){let c=r?JSON.parse(r):{nodes:[],edges:[]};a=bo(n,c)}else a=s===r;if(!a&&r)return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let i=t.onceProviderSynced(),l=t.intent;return t.connect(),l==="disconnected"&&!t.userLock&&await i,l==="disconnected"&&!t.userLock&&(t.disconnect(),t.sharedFolder.tokenStore.removeFromRefreshQueue(bt.encode(t.s3rn))),!0}async uploadItem(t){let r=t.s3rn;if(this.log("[uploadItem]",`${bt.encode(r)}`),!(r instanceof Ur)&&!(r instanceof sr))throw new Error("Unable to decode S3RN");if(!this.loginManager.loggedIn)throw new Error("Not logged in");let s=await t.getProviderToken(),n={"Content-Type":"application/octet-stream",...this.getAuthHeader(s)},a=Qs(t.ydoc),l=`${this.getBaseUrl(s,r)}/update`,c=await(0,pp.requestUrl)({url:l,method:"POST",headers:n,body:a.buffer,throw:!1});return c.status===200?this.debug("[uploadItem]",r instanceof sr?r.canvasId:r.documentId,c.status,c.text):this.error("[uploadItem]",r instanceof sr?r.canvasId:r.documentId,l,c.status,c.text),c}enqueueCanvasDownload(t){return this.enqueueDownload(t)}async enqueueCanvasForGroupSync(t,r){try{if(!r.syncStore.has(t.path)){this.debug("[enqueueCanvasForGroupSync] Skipping canvas, not in sync list",t.path);return}await this.enqueueDownload(t)}catch(s){this.error("[enqueueCanvasForGroupSync]",s)}}async getCanvas(t,r=3,s=3e3){try{let n=wt.exportCanvasData(t.ydoc),a={edges:[],nodes:[]};try{let m=await t.sharedFolder.read(t);a=JSON.parse(m)}catch(m){}let i=bo(n.edges,a.edges)&&bo(n.nodes,a.nodes),l=a.nodes.length>0,u=(await this.downloadItem(t)).arrayBuffer,d=new Uint8Array(u);if(this.log("[getCanvas] applying content from server"),ho(t.ydoc,d),l&&!i){this.log("Skipping flush - file requires merge conflict resolution.");return}t.sharedFolder.syncStore.has(t.path)&&(t.sharedFolder.flush(t,t.json),this.log("[getCanvas] flushed"))}catch(n){throw this.error(n),n}}async getDocument(t,r=3,s=3e3){try{let n=t.text,a="";try{a=await t.sharedFolder.read(t)}catch(_){}let i=n===a,l=a!=="",u=(await this.downloadItem(t)).arrayBuffer,d=new Uint8Array(u),m=new vr;ho(m,d);let g=m.getMap("users");if(m.getText("contents").toString()===""){if(g.size===0){this.log("[getDocument] Server contains uninitialized document. Waiting for peer to upload.",g.size,r,s),r>0&&this.timeProvider.setTimeout(()=>{this.getDocument(t,r-1,s*2)},s);return}if(t.text){this.log("[getDocument] local crdt has contents, but remote is empty"),this.enqueueSync(t);return}}if(this.log("[getDocument] applying content from server"),ho(t.ydoc,d),l&&!i){this.log("Skipping flush - file requires merge conflict resolution.");return}t.sharedFolder.syncStore.has(t.path)&&(t.sharedFolder.flush(t,t.text),this.log("[getDocument] flushed"))}catch(n){throw this.error(n),n}}async syncItem(t){let r="",s="",n=null;Cr(t)?(n=wt.exportCanvasData(t.ydoc),s=JSON.stringify(n)):Zr(t)&&(s=t.text);try{r=await t.sharedFolder.read(t)}catch(g){}let a=!1;if(Cr(t)&&n){let g=r?JSON.parse(r):{nodes:[],edges:[]};a=bo(n,g)}else a=s===r;if(!a)return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let i=await this.downloadItem(t);if(i.status!==200)return this.log("server returned an error."),!1;let l=i.arrayBuffer,c=new Uint8Array(l),u=new vr;ho(u,c);let d=u.getMap("users"),m=!1;if(Cr(t)&&n){let g=wt.exportCanvasData(u);m=d.size>0&&bo(g,n)}else{let g=u.getText("contents").toString();m=d.size>0&&g===s}return m||(ho(t.ydoc,c),Cr(t)?t.sharedFolder.flush(t,t.json):Zr(t)&&t.sharedFolder.flush(t,t.text),this.uploadItem(t)),!0}async syncDocument(t){var r;try{Ge().enableHTTPSync&&((r=t.sharedFolder.remote)!=null&&r.relay.provider)?await this.syncItem(t):(this.debug("fallback to websocket sync"),Zr(t)?await this.syncDocumentWebsocket(t):Cr(t)&&await this.syncDocumentWebsocket(t))}catch(s){console.error(s);return}}subscribeToSync(t){return this.activeSync.subscribe(t)}subscribeToDownloads(t){return this.activeDownloads.subscribe(t)}subscribeToSyncGroups(t){return this.syncGroups.subscribe(t)}subscribeToProgress(t){let r=()=>{t(this.getOverallProgress())},s=this.activeSync.subscribe(()=>r()),n=this.activeDownloads.subscribe(()=>r()),a=this.syncGroups.subscribe(()=>r());return()=>{s(),n(),a()}}subscribeToGroupProgress(t,r){return this.syncGroups.subscribe(()=>{r(this.getGroupProgress(t))})}pause(){this.isPaused=!0}resume(){this.debug("starting"),this.isPaused=!1,this.processSyncQueue(),this.processDownloadQueue()}getQueueStatus(){return{syncsQueued:this.syncQueue.length,syncsActive:this.activeSync.size,downloadsQueued:this.downloadQueue.length,downloadsActive:this.activeDownloads.size,isPaused:this.isPaused}}destroy(){for(let[t,r]of this.syncCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.syncCompletionCallbacks.delete(t);for(let[t,r]of this.downloadCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.downloadCompletionCallbacks.delete(t);this.activeSync.destroy(),this.activeDownloads.destroy(),this.syncGroups.destroy(),this.syncQueue=[],this.downloadQueue=[],this.inProgressSyncs.clear(),this.inProgressDownloads.clear(),this.loggedItems.clear(),this.loginManager=null,this.timeProvider=null,this.subscriptions.forEach(t=>t())}};var lc=class{constructor(e,t){this.app=e;this.difference=t.difference,this.file1=t.file1,this.file2=t.file2,this.file1Content=t.file1Content,this.file2Content=t.file2Content,this.triggerRebuild=t.triggerRebuild}async modify(e,t){if(e instanceof At){Jx(e.ydoc,t);return}else if(e instanceof _s){e.contents=t;return}await this.app.vault.modify(e,t)}build(e){let t=e.createDiv({cls:"flex flex-row gap-1 py-0-5"}),r=this.difference.file1Lines.length>0,s=this.difference.file2Lines.length>0;s&&r?(new gr({text:"Accept Top (Editor)",onClick:n=>this.acceptTopClick(n,this.difference)}).build(t),_o.build(t),new gr({text:"Accept Bottom (Local Disk)",onClick:n=>this.acceptBottomClick(n,this.difference)}).build(t),_o.build(t),new gr({text:"Accept All",onClick:n=>this.acceptAllClick(n,this.difference)}).build(t),_o.build(t),new gr({text:"Accept None",onClick:n=>this.acceptNoneClick(n,this.difference)}).build(t)):r?(new gr({text:"Keep in Editor",onClick:n=>this.insertFile1Difference(n,this.difference)}).build(t),_o.build(t),new gr({text:"Discard in Editor",onClick:n=>this.discardFile1Difference(n,this.difference)}).build(t)):s&&(new gr({text:"Accept from Local Disk",onClick:n=>this.insertFile2Difference(n,this.difference)}).build(t),_o.build(t),new gr({text:"Discard on Disk",onClick:n=>this.discardFile2Difference(n,this.difference)}).build(t))}async acceptTopClick(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),s=Si({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,s),this.triggerRebuild()}async acceptBottomClick(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),s=Si({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,s),this.triggerRebuild()}async acceptAllClick(e,t){e.preventDefault();let r=[...t.file1Lines,...t.file2Lines].join(`
`),s=Si({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,s);let n=Si({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async acceptNoneClick(e,t){e.preventDefault();let r=ki({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r);let s=ki({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,s),this.triggerRebuild()}async insertFile1Difference(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),s=up({fullText:this.file2Content,newLine:r,position:t.file2Start});await this.modify(this.file2,s),this.triggerRebuild()}async insertFile2Difference(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),s=up({fullText:this.file1Content,newLine:r,position:t.file1Start});await this.modify(this.file1,s),this.triggerRebuild()}async discardFile1Difference(e,t){e.preventDefault();let r=ki({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r),this.triggerRebuild()}async discardFile2Difference(e,t){e.preventDefault();let r=ki({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,r),this.triggerRebuild()}};var pa="system3-differences-view";async function Xx(o,e){o.detachLeavesOfType(pa);let t=o.getLeaf(!0);t.setViewState({type:pa,active:!0,state:e}),o.revealLeaf(t)}var cc=class extends Qx.ItemView{constructor(t){super(t);this.file1Lines=[];this.file2Lines=[]}async getContent(t){return t instanceof At?t.text:t instanceof _s?t.contents:await this.app.vault.cachedRead(t)}getViewType(){return pa}getDisplayText(){var t,r;return(t=this.state)!=null&&t.file1&&((r=this.state)!=null&&r.file2)?`File Diff: ${this.state.file1.name} and ${this.state.file2.name}`:"File Diff"}async setState(t,r){super.setState(t,r),this.state=t,await this.updateState(),this.build()}async onunload(){var t,r;(r=(t=this.state)==null?void 0:t.onResolve)==null||r.call(t)}async updateState(){var r,s;if(((r=this.state)==null?void 0:r.file1)==null||((s=this.state)==null?void 0:s.file2)==null)return;this.file1Content=await this.getContent(this.state.file1),this.file2Content=await this.getContent(this.state.file2),this.file1Lines=this.file1Content.concat(`
`).split(`
`).map(n=>n.trimEnd()),this.file2Lines=this.file2Content.concat(`
`).split(`
`).map(n=>n.trimEnd());let t=jx(this.state.file1.path,this.state.file2.path,this.file1Lines.join(`
`),this.file2Lines.join(`
`));this.fileDifferences=ac.fromParsedDiff(t),this.fileDifferences.differences.length===0&&this.leaf.detach()}build(){this.contentEl.empty();let t=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(t),this.buildLines(t),this.scrollToFirstDifference()}update(){let t=this.contentEl.scrollTop;this.contentEl.empty();let r=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(r),this.buildLines(r),this.contentEl.scrollTop=t}buildHeader(t){let r=t.createDiv({cls:"flex flex-row gap-1 py-0-5"});new gr({text:"Keep Editor Contents",onClick:async s=>{s.preventDefault(),await this.acceptAllFromLeft()}}).build(r),_o.build(r),new gr({text:"Accept All from Local Disk",onClick:async s=>{s.preventDefault(),await this.acceptAllFromRight()}}).build(r)}async acceptAllFromLeft(){!this.state||!this.fileDifferences||(await this.app.vault.modify(this.state.file2,this.file1Content||""),this.leaf.detach())}async acceptAllFromRight(){!this.state||!this.fileDifferences||(await this.app.vault.modify(this.state.file1,this.file2Content||""),this.leaf.detach())}buildLines(t){var a,i,l;let r=0,s=0,n=Math.max(((a=this.file1Lines)==null?void 0:a.length)||0,((i=this.file2Lines)==null?void 0:i.length)||0);for(;r<=n||s<=n;){let c=(l=this.fileDifferences)==null?void 0:l.differences.find(u=>u.file1Start===r&&u.file2Start===s);if(c!=null){let u=t.createDiv({cls:"difference"});this.buildDifferenceVisualizer(u,c),r+=c.file1Lines.length,s+=c.file2Lines.length}else{let u=r<=s?this.file1Lines[r]:this.file2Lines[s];t.createDiv({text:ua(u),cls:"file-diff__line"}),r+=1,s+=1}}}buildDifferenceVisualizer(t,r){var s;(s=this.state)!=null&&s.showMergeOption&&new lc(this.app,{difference:r,file1:this.state.file1,file2:this.state.file2,file1Content:this.file1Content||"",file2Content:this.file2Content||"",triggerRebuild:async()=>{await this.updateState(),this.update()}}).build(t);for(let n=0;n<r.file1Lines.length;n+=1){let a=r.file1Lines[n],i=r.file2Lines[n],l=t.createDiv({cls:"file-diff__line file-diff__top-line__bg"}),c=this.buildDiffLine(a,i,"file-diff_top-line__character");(n<r.file1Lines.length-1||r.file2Lines.length!==0)&&l.classList.add("file-diff__no-bottom-border"),n!==0&&l.classList.add("file-diff__no-top-border"),l.appendChild(c)}for(let n=0;n<r.file2Lines.length;n+=1){let a=r.file1Lines[n],i=r.file2Lines[n],l=t.createDiv({cls:"file-diff__line file-diff__bottom-line__bg"}),c=this.buildDiffLine(i,a,"file-diff_bottom-line__character");(n==0&&r.file1Lines.length>0||n>0)&&l.classList.add("file-diff__no-top-border"),n<r.file2Lines.length-1&&l.classList.add("file-diff__no-bottom-border"),l.appendChild(c)}}buildDiffLine(t,r,s){let n=document.createElement("div");if(t!=null&&t.length===0)n.textContent=ua(t);else if(t!=null&&r!=null){let a=Gx(r,t);for(let i of a){if(i.removed)continue;let l=document.createElement("span");l.textContent=ua(i.value),i.added&&l.classList.add(s),n.appendChild(l)}}else if(t!=null&&r==null){let a=document.createElement("span");a.textContent=ua(t),a.classList.add(s),n.appendChild(a)}else n.textContent=ua(t);return n}scrollToFirstDifference(){var s;if(((s=this.fileDifferences)==null?void 0:s.differences.length)===0)return;let t=this.contentEl.getElementsByClassName("file-diff__container")[0].getBoundingClientRect(),r=this.contentEl.getElementsByClassName("difference")[0].getBoundingClientRect();this.contentEl.scrollTo({top:r.top-t.top-100,behavior:"smooth"})}};var fc=class extends Ft{constructor(t){super();this.view=t.view,this.canvas=t.view.canvas,this.relayCanvas=t.canvas,this.unsubscribes=[],this.relayCanvasView=t,this.observedTextNodes=new Set,this.install()}destroy(){this.canvas&&(this.unsubscribes.forEach(t=>t()),this.unsubscribes=[],console.log("uninstall successful")),this.relayCanvasView.tracking=!1,this.canvas=null,this.relayCanvas=null,this.relayCanvasView=null,this.unsubscribes.length=0}observeNode(t){if(!this.observedTextNodes.has(t.id)&&t.type==="text"){let r=this.relayCanvas.textNode(t),s=t.id,n=a=>{let i=this.canvas.nodes.get(s);i&&(i.setText(r.toString()),this.canvas.markDirty(i))};r.observe(n),this.unsubscribes.push(()=>{this.relayCanvas.textNode(t).unobserve(n),this.observedTextNodes.delete(s)})}}markDirty(t){let r=this.canvas.nodes.get(t.id);r&&this.canvas.markDirty(r)}install(){var i;if(!this.canvas)return;this.debug("connecting canvas view to canvas",(i=this.view.file)==null?void 0:i.path,this.relayCanvas.path);let t=this,r=wt.exportCanvasData(this.relayCanvas.ydoc);this.canvas.importData(r,!0),this.unsubscribes.push(an(this.canvas,{requestSave(l){return function(){let c=l.call(this);try{t.relayCanvas.importFromView(t.view)}catch(u){console.error(u)}return c}},applyHistory(l){return function(c){let u=l.call(this,c);try{t.relayCanvas.importFromView(t.view)}catch(d){console.error(d)}return u}}}));let s=(l,c)=>{var m,g,h,_;let u="";if(u+=`Transaction origin: ${l.transaction.origin} ${(g=(m=l.transaction.origin)==null?void 0:m.constructor)==null?void 0:g.name}
`,this.relayCanvas||this.warn("relay canvas is already destroyed"),!this.canvas){this.warn("canvas is already destroyed");return}if(!((h=this.view.file)!=null&&h.path.endsWith(this.relayCanvas.path))){this.log("event is for another node");return}if(l.transaction.origin===this.relayCanvas)return;let d=wt.exportCanvasData(this.relayCanvas.ydoc);for(let[w,v]of l.changes.keys)u+=`key: ${w} action: ${v.action}

`;this.debug(u),this.debug("importing data",(_=this.view.file)==null?void 0:_.path,this.relayCanvas.path,d),this.canvas.importData(d,!0),this.canvas.requestSave();for(let w of l.keysChanged){let v=c.get(w);v&&(this.canvas.nodes.has(v.id)&&this.observeNode(v.getData()),this.canvas.markMoved(v),this.canvas.markDirty(v))}},n=l=>s(l,this.canvas.nodes);this.relayCanvas.ynodes.observe(n),this.unsubscribes.push(()=>{this.relayCanvas.ynodes.unobserve(n)});for(let[,l]of this.relayCanvas.ynodes)this.observeNode(l);let a=l=>s(l,this.canvas.edges);this.relayCanvas.yedges.observe(a),this.unsubscribes.push(()=>{this.relayCanvas.yedges.unobserve(a)}),this.relayCanvasView.tracking=!0}};var uc=require("@codemirror/state"),eb=require("@codemirror/view");var gB=uc.Facet.define({combine(o){return o[o.length-1]}}),Zx=uc.Annotation.define(),mp=class{constructor(e){this.initialSet=!1;this.destroyed=!1;this.keyFrameCounter=0;this.debug=(...e)=>{};this.log=(...e)=>{};this.warn=(...e)=>{};this.embed=!1;var t,r,s,n;this.editor=e,this.connectionManager=this.editor.state.field(vo),this.view=(t=this.connectionManager)==null?void 0:t.findCanvas(this.editor),this.node=this.getNode(),this._ytext=this.getYText(),this._ytext&&this.view&&(this.log=Te(`[LiveNodePluginValue][${this.view.canvas.path}#${(r=this.node)==null?void 0:r.id}]`,"log"),this.warn=Te(`[LiveNodePluginValue][${this.view.canvas.path}#${(s=this.node)==null?void 0:s.id}]`,"warn"),this.debug=Te(`[LiveNodePluginValue][${this.view.canvas.path}#${(n=this.node)==null?void 0:n.id}]`,"debug"),this.debug("created"),this._observer=async(a,i)=>{var l;if(this._ytext=this.getYText(),this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}if(i.origin!==this){let c=a.delta,u=[],d=0;for(let m=0;m<c.length;m++){let g=c[m];g.insert!=null?u.push({from:d,to:d,insert:g.insert}):g.delete!=null?(u.push({from:d,to:d+g.delete,insert:""}),d+=g.delete):g.retain!=null&&(d+=g.retain)}(l=this.view)!=null&&l.canvas&&e.dispatch({changes:u,annotations:[Zx.of(this.editor)]})}},this.observer=(a,i)=>{var l;try{(l=this._observer)==null||l.call(this,a,i)}catch(c){c instanceof RangeError&&console.warn("range errors!")}},this._ytext.observe(this.observer))}getNode(){let e=this.editor.state.values.find(t=>{if(t&&t.node)return t.node});if(e)return this.node=e.node,this.node}getYText(){var t,r,s,n,a;this.view=(t=this.connectionManager)==null?void 0:t.findCanvas(this.editor);let e=this.editor.state.values.find(i=>{if(i&&i.node)return i.node});if(!e){this.observer&&((r=this._ytext)==null||r.unobserve(this.observer));return}return e.node.id!==((s=this.node)==null?void 0:s.id)&&this.observer&&((n=this._ytext)==null||n.unobserve(this.observer)),this.node=e.node,(a=this.view)==null?void 0:a.canvas.textNode(e.node)}update(e){var r;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(Zx)===this.editor)return;let t=this.getYText();t&&((r=t.doc)==null||r.transact(()=>{let s=0;e.changes.iterChanges((n,a,i,l,c)=>{let u=c.sliceString(0,c.length,`
`);n!==a&&t.delete(n+s,a-n),u.length>0&&t.insert(n+s,u),s+=u.length-(a-n)})},this))}destroy(){var e;this.destroyed=!0,this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},tb=eb.ViewPlugin.fromClass(mp);var NT=3;function hp(o,e){o.iterateAllLeaves(t=>{t.view instanceof ma.MarkdownView&&e(t.view)})}function gp(o,e){o.iterateAllLeaves(t=>{t.view.getViewType()==="canvas"&&Ge().enableCanvasSync&&e(t.view)})}function HT(o,e){var t,r,s,n;if(o.length!==e.length)return!1;for(let a=0;a<o.length;a++)if(((t=o[a].view.file)==null?void 0:t.path)!==((r=e[a].view.file)==null?void 0:r.path)||((s=o[a].document)==null?void 0:s.path)!==((n=e[a].document)==null?void 0:n.path))return!1;return!0}var dc=class{constructor(e,t,r){this.document=null;this.canConnect=!1;this._parent=e,this.view=t,this.login=r}attach(){return this.banner=new nn(this.view,"Login to enable Live edits",async()=>await this.login()),Promise.resolve(this)}release(){var e;(e=this.banner)==null||e.destroy()}destroy(){this.release(),this.banner=void 0,this.view=null}};function wo(o){return o instanceof Ts&&o.document!==void 0&&o.document.text!==void 0}function VT(o){return o instanceof pc&&o.document!==void 0}var pc=class{constructor(e,t,r,s=!0,n=!0){this._parent=e,this.view=t,this.canvas=r,this.document=r,this._tracking=!1,this.shouldConnect=s,this.canConnect=n,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.canvas.connect().then(e=>{e||(this.shouldConnect=!1)}):this.canvas.disconnect()}get tracking(){return this._tracking}set tracking(e){let t=this._tracking;this._tracking=e,this._tracking!==t&&this.attach()}offlineBanner(){if(this.shouldConnect){let e=new nn(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new Jd({target:e,anchor:e.firstChild,props:{view:this,state:this.canvas.state,remote:this.canvas.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.canvas.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.canvas.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.canvas.state,remote:this.canvas.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}attach(){return this.canvas.userLock=!0,this.setConnectionDot(),this.plugin||(this.plugin=new fc(this)),new Promise(e=>this.canvas.whenReady().then(t=>{this._parent.networkStatus.online&&this.canvas.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.canvas.disconnect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.canvas.connect()}release(){var e,t,r;(e=this.plugin)==null||e.destroy(),this.plugin=void 0,(t=this._viewActions)==null||t.$destroy(),this._viewActions=void 0,(r=this._banner)==null||r.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.canvas.disconnect(),this.canvas.userLock=!1}destroy(){var e;(e=this.plugin)==null||e.destroy(),this.plugin=null,this.release(),this.clearViewActions(),this.view.leaf.rebuildView(),this._parent=null,this.view=null,this.canvas=null}},Ts=class{constructor(e,t,r,s=!0,n=!0){this._parent=e,this.view=t,this.document=r,this._tracking=!1,this.shouldConnect=s,this.canConnect=n,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.document.connect().then(e=>{e||(this.shouldConnect=!1)}):this.document.disconnect()}get tracking(){return this._tracking}set tracking(e){let t=this._tracking;this._tracking=e,this._tracking!==t&&this.attach()}get ytext(){return this.document.ytext}mergeBanner(){return this._banner=new nn(this.view,"Merge conflict -- click to resolve",async()=>{let e=await this.document.diskBuffer();return await this.document.checkStale()&&this._parent.openDiffView({file1:this.document,file2:e,showMergeOption:!0,onResolve:async()=>{this.document.clearDiskBuffer()}}),!0}),()=>{}}offlineBanner(){if(this.shouldConnect){let e=new nn(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new Jd({target:e,anchor:e.firstChild,props:{view:this,state:this.document.state,remote:this.document.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.document.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.document.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.document.state,remote:this.document.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}async checkStale(){var t,r;let e=await this.document.checkStale();return e&&((t=this.document._diskBuffer)!=null&&t.contents)?this.mergeBanner():((r=this._banner)==null||r.destroy(),this._banner=void 0),e}attach(){return this.document.userLock=!0,this.setConnectionDot(),new Promise(e=>this.document.whenReady().then(t=>{this._parent.networkStatus.online&&this.document.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.document.disconnect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.document.connect()}release(){var e,t;(e=this._viewActions)==null||e.$destroy(),this._viewActions=void 0,(t=this._banner)==null||t.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.document.disconnect(),this.document.userLock=!1}destroy(){this.release(),this.clearViewActions(),this.view.leaf.rebuildView(),this._parent=null,this.view=null,this.document=null}},mc=class{constructor(e,t,r,s){this.app=e;this.destroyed=!1;this.offListeners=[];this.folderListeners=new Map;this.workspace=e.workspace,this.sharedFolders=t,this.views=[],this.extensions=[],this._activePromise=null,this.loginManager=r,this.networkStatus=s,this.refreshQueue=[],this._compartment=new hc.Compartment,this.log=Te("[LiveViews]","log"),this.warn=Te("[LiveViews]","warn"),this.metadataListeners=new Map;let n=(l,c,u)=>{let d=this.metadataListeners.get(l);d==null||d(c,u)},a=this.app.metadataCache.on("changed",n);this.offListeners.push(()=>{this.app.metadataCache.offref(a)}),this.offListeners.push(this.loginManager.on(()=>{this.refresh("[LoginManager]")}));let i=l=>(l.ready||(async()=>l.whenReady().then(()=>{this.refresh("[Shared Folder Ready]")}).catch(c=>{this.views.forEach(u=>{var d;((d=u.document)==null?void 0:d.sharedFolder)===l&&u.offlineBanner()})}))(),l.fset.on(()=>{this.refresh("[Docset]")}));this.offListeners.push(this.sharedFolders.subscribe(()=>{this.refresh("[Shared Folders]"),this.folderListeners.forEach((l,c)=>{this.sharedFolders.has(c)||(l(),this.folderListeners.delete(c))}),this.sharedFolders.forEach(l=>{this.folderListeners.has(l)||this.folderListeners.set(l,i(l))})})),Bt.set(this,"LiveViewManager")}reconfigure(e){e.dispatch({effects:this._compartment.reconfigure([vo.init(()=>this)])})}onMeta(e,t){this.metadataListeners.set(e,t)}offMeta(e){this.metadataListeners.delete(e)}openDiffView(e){Xx(this.workspace,e)}goOffline(){this.log("[System 3][Relay][Live Views] going offline"),this.views.forEach(e=>{var t;return(t=e.document)==null?void 0:t.disconnect()}),this.refresh("[NetworkStatus]")}goOnline(){this.log("[System 3][Relay][Live Views] going online"),this.refresh("[NetworkStatus]"),this.sharedFolders.items().forEach(e=>{e.connect()}),this.viewsAttachedWithConnectionPool(this.views)}docIsOpen(e){return this.views.some(t=>t.document===e)}releaseViews(e){e.forEach(t=>{t.release()})}findFolders(){let e=new Set;return hp(this.workspace,t=>{var n;let r=(n=t.file)==null?void 0:n.path;if(!r)return;let s=this.sharedFolders.lookup(r);s&&e.add(s)}),gp(this.workspace,t=>{var n;let r=(n=t.file)==null?void 0:n.path;if(!r)return;let s=this.sharedFolders.lookup(r);s&&e.add(s)}),e.size==0?[]:[...e]}async foldersReady(){let e=new Set;if(hp(this.workspace,r=>{var a;let s=(a=r.file)==null?void 0:a.path;if(!s)return;let n=this.sharedFolders.lookup(s);n&&e.add(n)}),gp(this.workspace,r=>{var a;let s=(a=r.file)==null?void 0:a.path;if(!s)return;let n=this.sharedFolders.lookup(s);n&&e.add(n)}),e.size===0)return[];let t=[...e].map(r=>r.whenReady());return Promise.all(t)}async getViews(){let e=[];return hp(this.workspace,async t=>{var n;let r=(n=t.file)==null?void 0:n.path;if(!r)return;let s=this.sharedFolders.lookup(r);if(s)if(this.loginManager.loggedIn)if(s.ready){let a=s.proxy.getDoc(r),i=new Ts(this,t,a);e.push(i)}else this.log(`Folder not ready, skipping views. folder=${s.path}`);else{let a=new dc(this,t,()=>this.loginManager.openLoginPage());e.push(a)}}),gp(this.workspace,t=>{var n;let r=(n=t.file)==null?void 0:n.path;if(!r)return;let s=this.sharedFolders.lookup(r);if(s)if(this.loginManager.loggedIn)if(s.ready){let a=s.proxy.getCanvas(r),i=new pc(this,t,a);e.push(i)}else this.log(`Folder not ready, skipping views. folder=${s.path}`);else{let a=new dc(this,t,()=>this.loginManager.openLoginPage());e.push(a)}}),e}findView(e){return this.views.filter(wo).find(t=>t.view.editor.cm===e)}findCanvas(e){let t=e.state.values.find(r=>{if(r&&r.node)return r.node});if(t)return this.views.filter(VT).find(r=>r.view.canvas===t.node.canvas)}async viewsReady(e){return await Promise.all(e.filter(t=>t instanceof Ts).map(async t=>t.document.whenReady().then(r=>t)))}async viewsAttachedWithConnectionPool(e,t=NT){let r=this.workspace.getActiveViewOfType(ma.MarkdownView),s=0,n=e.sort((i,l)=>l.view.leaf.activeTime-i.view.leaf.activeTime),a=new Set;for(let i of n)i instanceof Ts&&(i.view===r||a.has(i.document)?(i.canConnect=!0,a.add(i.document)):s<t?(i.canConnect=!0,a.add(i.document),s++):i.canConnect=!1);return s>t&&this.warn(`[System 3][Relay][Live Views] connection pool (max ${t}): rejected connections for ${s-t} views`),this.viewsAttached(e)}async viewsAttached(e){return await Promise.all(e.map(async t=>t.attach()))}deduplicate(e){let t=[],r=[];return this.views.forEach(s=>{let n=e.find(a=>{if(s.document==a.document&&s.view==a.view)return!0});n?(r.push(s),e.remove(n)):t.push(s)}),e.forEach(s=>{r.push(s)}),[r,t]}async _refreshViews(e,t){let r=`[LiveViews][${e}]`,s=Te(r,"debug"),n=(d,m)=>{s(d,m.map(g=>{var h;return{type:g.constructor.name,file:(h=g.document)==null?void 0:h.path,canConnect:g.canConnect}}))};if(s("Refresh"),this.destroyed)return!1;await this.foldersReady();let a=[];try{a=await this.getViews()}catch(d){return this.warn("[System 3][Relay][Live Views] error getting views",d),!1}let i=this.findFolders();if(i.length===0&&a.length===0)return this.extensions.length!==0&&(s("Unexpected plugins loaded."),this.wipe()),n("Releasing Views",this.views),this.releaseViews(this.views),this.views=[],!0;this.loginManager.loggedIn&&this.networkStatus.online?i.forEach(d=>{d.connect()}):this.sharedFolders.forEach(d=>{d.disconnect()});let[l,c]=this.deduplicate(a);if(n("Releasing Views",c),this.releaseViews(c),c.length===0&&HT(l,this.views)){let d=await this.viewsAttachedWithConnectionPool(this.views);n("Attached Views",d)}else{let d=await this.viewsReady(l);n("Ready Views",d);let m=await this.viewsAttachedWithConnectionPool(d);n("Attached Views",m),this.views=l}s("loading plugins"),this.load();let u=ma.moment.utc();return s(`refresh completed in ${u.diff(t)}ms`,r),!0}async refresh(e){if(this.destroyed)return!1;let t=Te(e,"warn"),r=ma.moment.utc();if(this.refreshQueue.push(()=>this._refreshViews(e,r)),this._activePromise!==null)return!1;for(;this.refreshQueue.length>0;){if(this.destroyed)return!1;this.refreshQueue.length>2&&t("refreshQueue size:",this.refreshQueue.length);let s=this.refreshQueue.pop();this.refreshQueue.length=0,this._activePromise=s().finally(()=>{this._activePromise=null}),await this._activePromise}return!0}wipe(){this.extensions.length=0,this.workspace.updateOptions()}load(){this.wipe(),this.views.length>0&&(this.extensions.push([this._compartment.of(vo.init(()=>this)),Nx,tb,Hx,Vx,Wx]),this.workspace.updateOptions())}destroy(){this.destroyed=!0,this.releaseViews(this.views),this.offListeners.forEach(e=>e()),this.offListeners.length=0,this.metadataListeners.clear(),this.metadataListeners=null,this.folderListeners.forEach(e=>e()),this.folderListeners.clear(),this.folderListeners=null,this.views.forEach(e=>e.destroy()),this.views=[],this.wipe(),this.sharedFolders=null,this.refreshQueue=null,this.networkStatus=null,this._activePromise=null,this.loginManager=null,this.app=null,this.workspace=null}},vo=hc.StateField.define({create(o){},update(o,e){return o}});var ha=require("obsidian");function qT(o){Pe(o,"svelte-1siabfk",".system3-folder-icons.svelte-1siabfk{display:inline-flex;align-items:center;vertical-align:middle;border-radius:var(--radius-m);transition:width 0.3s ease;margin-right:0.6em;padding-left:0.2em;padding-right:0.2em;background-color:var(--color-base-05);position:relative}.system3-icon.svelte-1siabfk{margin-right:0.2em;margin-left:0.2em;width:1em;display:flex;transition:display 0.3s ease}span.system3-connected.svelte-1siabfk{color:var(--color-accent)}span.system3-disconnected.svelte-1siabfk{color:var(--color-base-40)}span.notebook.svelte-1siabfk{color:var(--color-accent)}span.hidden.svelte-1siabfk{display:none}.system3-progress-text.svelte-1siabfk{margin-right:0.4em;font-size:0.8em;color:var(--color-accent);opacity:1;transition:opacity 0.3s ease}.system3-progress-text.completed.svelte-1siabfk{animation:svelte-1siabfk-fadeOutDelay 0.3s ease forwards}.system3-progress-text.failed.svelte-1siabfk{color:var(--color-red)}@keyframes svelte-1siabfk-fadeOutDelay{0%,50%{opacity:1}100%{opacity:0;display:none}}")}function rb(o){let e,t,r,s;return{c(){e=T("span"),t=K(o[3]),r=K("%"),x(e,"class",s="system3-progress-text system3-"+o[4]+" svelte-1siabfk"),de(e,"opacity","1")},m(n,a){I(n,e,a),k(e,t),k(e,r)},p(n,a){a&8&&ne(t,n[3]),a&16&&s!==(s="system3-progress-text system3-"+n[4]+" svelte-1siabfk")&&x(e,"class",s)},d(n){n&&C(e)}}}function WT(o){let e,t,r;return t=new Xo({props:{class:"inline-icon",style:"width: 0.8em"}}),{c(){e=T("span"),H(t.$$.fragment),x(e,"class","notebook system3-icon svelte-1siabfk"),x(e,"aria-label","Tracking Changes")},m(s,n){I(s,e,n),B(t,e,null),r=!0},p:X,i(s){r||(S(t.$$.fragment,s),r=!0)},o(s){P(t.$$.fragment,s),r=!1},d(s){s&&C(e),N(t)}}}function zT(o){let e,t,r,s,n,a,i,l;return t=new Xo({props:{class:"inline-icon",style:"width: 0.8em"}}),n=new sn({props:{class:"inline-icon"}}),{c(){var c;e=T("span"),H(t.$$.fragment),r=U(),s=T("span"),H(n.$$.fragment),x(e,"class","notebook system3-icon hidden svelte-1siabfk"),x(e,"aria-label","Tracking Changes"),x(s,"class",a="satellite system3-icon system3-"+o[0]+" svelte-1siabfk"),x(s,"aria-label",i=`${((c=o[2])==null?void 0:c.relay.name)||"Relay Server"} (${o[0]})`)},m(c,u){I(c,e,u),B(t,e,null),I(c,r,u),I(c,s,u),B(n,s,null),l=!0},p(c,u){var d;(!l||u&1&&a!==(a="satellite system3-icon system3-"+c[0]+" svelte-1siabfk"))&&x(s,"class",a),(!l||u&5&&i!==(i=`${((d=c[2])==null?void 0:d.relay.name)||"Relay Server"} (${c[0]})`))&&x(s,"aria-label",i)},i(c){l||(S(t.$$.fragment,c),S(n.$$.fragment,c),l=!0)},o(c){P(t.$$.fragment,c),P(n.$$.fragment,c),l=!1},d(c){c&&(C(e),C(r),C(s)),N(t),N(n)}}}function KT(o){let e,t,r,s,n,a=o[5]&&rb(o),i=[zT,WT],l=[];function c(u,d){return u[1]?0:1}return r=c(o,-1),s=l[r]=i[r](o),{c(){e=T("div"),a&&a.c(),t=U(),s.c(),x(e,"class","system3-folder-icons svelte-1siabfk")},m(u,d){I(u,e,d),a&&a.m(e,null),k(e,t),l[r].m(e,null),n=!0},p(u,[d]){u[5]?a?a.p(u,d):(a=rb(u),a.c(),a.m(e,t)):a&&(a.d(1),a=null);let m=r;r=c(u,d),r===m?l[r].p(u,d):(he(),P(l[m],1,1,()=>{l[m]=null}),ge(),s=l[r],s?s.p(u,d):(s=l[r]=i[r](u),s.c()),S(s,1),s.m(e,null))},i(u){n||(S(s),n=!0)},o(u){P(s),n=!1},d(u){u&&C(e),a&&a.d(),l[r].d()}}}function GT(o,e,t){let r,{status:s="disconnected"}=e,{relayId:n}=e,{remote:a}=e,{progress:i=0}=e,{syncStatus:l="pending"}=e;return o.$$set=c=>{"status"in c&&t(0,s=c.status),"relayId"in c&&t(1,n=c.relayId),"remote"in c&&t(2,a=c.remote),"progress"in c&&t(3,i=c.progress),"syncStatus"in c&&t(4,l=c.syncStatus)},o.$$.update=()=>{if(o.$$.dirty&24){e:t(5,r=(l!=="completed"||i<100)&&i>0)}},[s,n,a,i,l,r]}var yp=class extends ee{constructor(e){super(),oe(this,e,GT,KT,Z,{status:0,relayId:1,remote:2,progress:3,syncStatus:4},qT)}},ob=yp;function jT(o){Pe(o,"svelte-1swndfj",".system3-filepill.svelte-1swndfj{text-wrap:nowrap}")}function YT(o){let e,t,r;return{c(){e=T("div"),t=T("span"),r=K(o[0]),x(e,"class","nav-file-tag system3-filepill svelte-1swndfj"),x(e,"aria-label",o[1])},m(s,n){I(s,e,n),k(e,t),k(t,r)},p(s,[n]){n&1&&ne(r,s[0]),n&2&&x(e,"aria-label",s[1])},i:X,o:X,d(s){s&&C(e)}}}function JT(o,e,t){let{text:r}=e,{label:s}=e;return o.$$set=n=>{"text"in n&&t(0,r=n.text),"label"in n&&t(1,s=n.label)},[r,s]}var xp=class extends ee{constructor(e){super(),oe(this,e,JT,YT,Z,{text:0,label:1},jT)}},bp=xp;function QT(o){Pe(o,"svelte-1ljf67u",".system3-uploadpill.svelte-1ljf67u{text-wrap:nowrap}")}function XT(o){let e,t,r,s;return{c(){e=T("div"),t=T("span"),r=K(o[0]),x(e,"class","nav-file-tag system3-uploadpill svelte-1ljf67u"),x(e,"aria-label",o[1]),x(e,"style",s=o[2]?`color:${o[2]}`:"")},m(n,a){I(n,e,a),k(e,t),k(t,r)},p(n,[a]){a&1&&ne(r,n[0]),a&2&&x(e,"aria-label",n[1]),a&4&&s!==(s=n[2]?`color:${n[2]}`:"")&&x(e,"style",s)},i:X,o:X,d(n){n&&C(e)}}}function ZT(o,e,t){let{text:r}=e,{label:s}=e,{color:n}=e;return o.$$set=a=>{"text"in a&&t(0,r=a.text),"label"in a&&t(1,s=a.label),"color"in a&&t(2,n=a.color)},[r,s,n]}var wp=class extends ee{constructor(e){super(),oe(this,e,ZT,XT,Z,{text:0,label:1,color:2},QT)}},sb=wp;var vp=class{constructor(e,t){this.el=e,this.mutationObserver=new MutationObserver((r,s)=>{for(let n of r)n.type==="childList"&&e.nextSibling&&(t(e),s.disconnect())}),this.mutationObserver.observe(e.parentElement,{childList:!0,subtree:!0})}destroy(){var e;(e=this.mutationObserver)==null||e.disconnect(),this.mutationObserver=null}},ts=class{visitFolder(e,t,r,s){return null}visitFile(e,t,r,s){return null}},_p=class{constructor(e,t){this.el=e,this.sharedFolder=t,this.siblingWatcher=new vp(this.el,r=>{this.add()}),this.add()}add(){var e;(e=this.el.nextSibling)==null||e.addClass("system3-live")}remove(){var e;(e=this.el.nextSibling)==null||e.removeClass("system3-live")}destroy(){this.siblingWatcher.destroy(),this.remove()}},Sp=class extends ts{visitFolder(e,t,r,s){return s&&s.path===e.path?r||new _p(t.selfEl,s):(r&&r.destroy(),null)}},kp=class{constructor(e,t){this.sharedFolder=t;let r=e.querySelectorAll(".system3-folder-icons");r.length>1&&(r==null||r.forEach(n=>{n.remove()})),this.el=e,this.el.addClass("system3-pill"),this.pill=new ob({target:this.el,props:{status:this.sharedFolder.state.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote,progress:0,syncStatus:"pending"}});let s=[];s.push(this.sharedFolder.subscribe(this.el,n=>{this.pill.$set({status:n.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote})})),s.push(this.sharedFolder.backgroundSync.subscribeToGroupProgress(this.sharedFolder,n=>{n&&this.pill.$set({progress:n.percent,syncStatus:n.status})})),this.unsubscribe=()=>s.forEach(n=>n())}destroy(){this.pill.$destroy(),this.unsubscribe(),this.el.removeClass("system3-pill")}},Cp=class extends ts{visitFolder(e,t,r,s){return s&&s.path===e.path?r||new kp(t.selfEl,s):(r&&r.destroy(),null)}},Ip=class{constructor(e,t,r,s){this.el=e;this.path=t;this.activeSync=r;this.activeDownloads=s;this.unsubscribers=[];this.titleEl=e.querySelector(".nav-file-title")||e,this.unsubscribers.push(this.activeSync.subscribe(()=>this.checkStatus()),this.activeDownloads.subscribe(()=>this.checkStatus())),this.checkStatus()}checkStatus(){let e=this.activeSync.some(r=>r.path===this.path),t=this.activeDownloads.some(r=>r.path===this.path);e?this.titleEl.addClass("system3-syncing"):this.titleEl.removeClass("system3-syncing"),t?this.titleEl.addClass("system3-downloading"):this.titleEl.removeClass("system3-downloading")}destroy(){this.titleEl.removeClass("system3-uploading"),this.titleEl.removeClass("system3-downloading"),this.unsubscribers.forEach(e=>e())}},Lp=class extends ts{constructor(t,r){super();this.activeSync=t;this.activeDownloads=r}visitFile(t,r,s,n){return n&&n.ready&&n.checkPath(t.path)&&At.checkExtension(t.path)?s||new Ip(r.el,t.path,this.activeSync,this.activeDownloads):(s&&s.destroy(),null)}},Tp=class{constructor(e,t){this.el=e;this.file=t;this.unsubscribes=[];this.el.querySelectorAll(".system3-uploadpill").forEach(s=>{s.remove()});let r=s=>{var n;if(s.inMeta)(n=this.pill)==null||n.$destroy();else{let a=s.uploadError||"pending",i=s.uploadError?"var(--red)":void 0;this.pill?this.pill.$set({text:a,color:i}):this.pill=new sb({target:this.el,props:{text:a,color:i}})}};this.unsubscribes.push(this.file.subscribe(s=>{r(s)}))}destroy(){var e;this.unsubscribes.forEach(t=>t()),(e=this.pill)==null||e.$destroy(),this.el.querySelectorAll(".system3-uploadpill").forEach(t=>{t.remove()})}},Pp=class extends ts{visitFile(e,t,r,s){if(s&&s.ready)try{let n=s.proxy.viewSyncFile(e.path);if(n&&Qo(n)&&s.isSyncableTFile(e)&&s.connected)return r&&r.file===n?r:new Tp(t.selfEl,n)}catch(n){}return r&&r.destroy(),null}},Dp=class{constructor(e){this.el=e;this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()}),this.pill=new bp({target:this.el,props:{text:"NOT SYNCED",label:"Syncing this file type is disabled"}})}destroy(){this.pill.$destroy(),this.el.querySelectorAll(".system3-filepill").forEach(e=>{e.remove()})}},Fp=class extends ts{visitFile(e,t,r,s){return s&&s.checkPath(e.path)&&!s.isSyncableTFile(e)?r||new Dp(t.selfEl):(r&&r.destroy(),null)}},Ap=class{constructor(e,t,r){this.el=e,this.document=t,this.document.subscribe(e,s=>{this.docStatus(s)}),this.docStatus(this.document.state)}docStatus(e){(e==null?void 0:e.status)==="connected"?(this.el.removeClass("system3-connecting"),this.el.addClass("system3-connected"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="connecting"?(this.el.removeClass("system3-connected"),this.el.addClass("system3-connecting"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="disconnected"?(this.el.addClass("system3-live"),this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting")):(this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting"),this.el.removeClass("system3-live"))}destroy(){var e;(e=this.document)==null||e.unsubscribe(this.el),this.docStatus()}},Ep=class extends ts{visitFile(e,t,r,s){if(s)try{let n=s.getVirtualPath(e.path),a=s.syncStore.get(n);if(!a)return null;let i=s.files.get(a);return!(i instanceof At)||!i?null:r||new Ap(t.el,i,e)}catch(n){return null}return r&&r.destroy(),null}},Mp=class{constructor(e){this.el=e;this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()}),this.pill=new bp({target:this.el,props:{text:"DESYNC",label:"File content does not match document content"}})}destroy(){this.pill.$destroy(),this.el.querySelectorAll(".system3-filepill").forEach(e=>{e.remove()})}},Rp=class extends ts{visitFile(e,t,r,s){if(s&&At.checkExtension(e.path)){let n=s.proxy.viewDoc(e.path);if(!n||!n.ready)return null;if(e.stat.size!==n.stat.size)return r||new Mp(t.selfEl)}return r&&r.destroy(),null}},gc=class{constructor(e,t,r){this.fileExplorer=e,this.sharedFolders=t,this.visitors=r,this.storage=new Map;for(let s of this.visitors)this.storage.set(s,new Map)}_getFileExplorerItem(e){try{return this.fileExplorer.view.fileItems[e]}catch(t){return null}}getFileExplorerItem(e,t){return typeof t=="string"?this._getFileExplorerItem(t):this._getFileExplorerItem(t.path)}walk(e,t){if(this.fileExplorer.view.getViewType()!=="file-explorer")return;let r=this.sharedFolders.find(n=>n.path===e.path)||t,s=this.getFileExplorerItem(this.fileExplorer,e);s&&this.storage.forEach((n,a)=>{let i=n.get(s),l=a.visitFolder(e,s,i,r);i&&!l?n.delete(s):l&&n.set(s,l)}),e.children.forEach(n=>{if(n instanceof ha.TFolder)this.walk(n,r);else if(n instanceof ha.TFile){let a=this.getFileExplorerItem(this.fileExplorer,n);if(!a)return;this.storage.forEach((i,l)=>{let c=i.get(a),u=l.visitFile(n,a,c,r);c&&!u?i.delete(a):u&&i.set(a,u)})}})}destroy(){this.storage.forEach(e=>{e.forEach(t=>{t.destroy()})})}},yc=class{constructor(e,t,r,s){this.layoutReady=!1;this.vault=e,this.workspace=t,this.sharedFolders=r,this.backgroundSync=s,this.treeState=new Map,this.workspace.onLayoutReady(()=>{this.layoutReady=!0,this.refresh()}),this.unsubscribes=[],this.unsubscribes.push(s.activeSync.subscribe(()=>this.quickRefresh()),s.activeDownloads.subscribe(()=>this.quickRefresh()),s.syncGroups.subscribe(()=>this.quickRefresh())),this.offDocumentListeners=new Map,this.offFolderListener=this.sharedFolders.subscribe(()=>{this.sharedFolders.forEach(n=>{Qy([yo.enableDocumentStatus],()=>{this.offDocumentListeners.get(n)||this.offDocumentListeners.set(n,n.fset.on(()=>{this.refresh()}))}),n.whenReady().then(()=>{this.refresh()}),this.unsubscribes.push(n.syncSettingsManager.subscribe(a=>{this.quickRefresh()})),this.unsubscribes.push(n.subscribe(this,()=>{this.quickRefresh()}))}),this.refresh()}),this.offLayoutChange=(()=>{let n=this.workspace.on("layout-change",()=>this.quickRefresh());return()=>{this.workspace.offref(n)}})()}makeVisitors(){let e=[];return e.push(new Sp),e.push(new Cp),Go(yo.enableDocumentStatus,()=>{e.push(new Ep),e.push(new Lp(this.backgroundSync.activeSync,this.backgroundSync.activeDownloads))}),e.push(new Pp),Go(yo.enableDesyncPill,()=>{e.push(new Rp)}),e.push(new Fp),e}getFileExplorers(){let e=[];return this.workspace.iterateAllLeaves(t=>{t.view.getViewType()==="file-explorer"&&(e.includes(t)||e.push(t))}),e}quickRefresh(){if(!this.layoutReady)return;let e=this.getFileExplorers(),t=this.sharedFolders.map(r=>r.path);for(let r of e){let s=this.treeState.get(r)||new gc(r,this.sharedFolders,this.makeVisitors());this.treeState.set(r,s);for(let n of t){let a=this.vault.getAbstractFileByPath(n);a instanceof ha.TFolder&&s.walk(a)}}}refresh(){if(!this.layoutReady)return;let e=this.getFileExplorers();for(let t of e){let r=this.treeState.get(t)||new gc(t,this.sharedFolders,this.makeVisitors());this.treeState.set(t,r);let s=this.vault.getAbstractFileByPath("/");s instanceof ha.TFolder&&r.walk(s)}}destroy(){var e;(e=this.offFolderListener)==null||e.call(this),this.offDocumentListeners.forEach(t=>t()),this.offDocumentListeners.clear(),this.unsubscribes.forEach(t=>t()),this.unsubscribes.length=0,this.treeState.forEach(t=>{t.destroy()}),this.treeState.clear(),this.offLayoutChange(),this.vault=null,this.workspace=null,this.sharedFolders=null,this.backgroundSync=null,this.offFolderListener=null}};var xw=require("obsidian");function Ke(o,e,t,r){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function i(u){try{c(r.next(u))}catch(d){a(d)}}function l(u){try{c(r.throw(u))}catch(d){a(d)}}function c(u){u.done?n(u.value):s(u.value).then(i,l)}c((r=r.apply(o,e||[])).next())})}var Ps=require("obsidian");function eP(o){let e,t,r;return{c(){e=eo("svg"),t=eo("g"),r=eo("path"),x(r,"d","M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z"),x(r,"fill","#5865F2"),x(r,"fill-rule","nonzero"),x(e,"width",o[0]),x(e,"height",o[0]),x(e,"viewBox","0 -28.5 256 256"),x(e,"version","1.1"),x(e,"xmlns","http://www.w3.org/2000/svg"),x(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),x(e,"preserveAspectRatio","xMidYMid")},m(s,n){I(s,e,n),k(e,t),k(t,r)},p(s,[n]){n&1&&x(e,"width",s[0]),n&1&&x(e,"height",s[0])},i:X,o:X,d(s){s&&C(e)}}}function tP(o,e,t){let{size:r="1em"}=e;return o.$$set=s=>{"size"in s&&t(0,r=s.size)},[r]}var Op=class extends ee{constructor(e){super(),oe(this,e,tP,eP,Z,{size:0})}},xc=Op;function rP(o){Pe(o,"svelte-4t8k3t",`.menu-container.svelte-4t8k3t{display:inline-block;position:relative}.menu-button.svelte-4t8k3t{box-shadow:none;padding:8px;border:none;background:transparent;color:var(--text-muted)}.menu-button.svelte-4t8k3t:hover{color:var(--icon-color-hover)}.menu-button.svelte-4t8k3t:focus{color:var(--icon-color-focus)}.menu-dropdown.svelte-4t8k3t{position:absolute;right:0;margin-top:8px;width:224px;background:var(--color-base-10);border-radius:6px;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1),
			0 2px 4px -1px rgba(0, 0, 0, 0.06);border:1px solid rgba(0, 0, 0, 0.1)}.arrow.svelte-4t8k3t{position:absolute;top:-5px;right:12px;width:10px;height:10px;background:var(--color-base-10);border-left:1px solid rgba(0, 0, 0, 0.1);border-top:1px solid rgba(0, 0, 0, 0.1);transform:rotate(45deg)}.menu-content.svelte-4t8k3t{display:flex;flex-direction:column;gap:8px;padding:8px}.menu-item.svelte-4t8k3t{display:flex;width:100%;align-items:center;gap:12px;padding:8px;border-radius:4px;text-decoration:none;color:var(--text-muted);transition:background-color 0.2s;font-size:14px}.menu-item.svelte-4t8k3t:hover{background-color:var(--background-modifier-hover)}.menu-item.svelte-4t8k3t:focus{background-color:var(--background-modifier-hover)}`)}function nb(o){let e,t,r,s,n,a,i,l,c,u,d,m,g;return i=new xc({props:{size:20}}),{c(){e=T("div"),t=T("div"),r=U(),s=T("div"),n=T("span"),a=T("a"),H(i.$$.fragment),l=U(),c=T("span"),c.textContent="Join the community",x(t,"class","arrow svelte-4t8k3t"),x(a,"href","https://discord.system3.md"),x(a,"target","_blank"),x(a,"rel","noopener noreferrer"),x(a,"class","menu-item svelte-4t8k3t"),de(n,"text-align","center"),de(n,"display","flex"),x(s,"class","menu-content svelte-4t8k3t"),x(e,"class","menu-dropdown svelte-4t8k3t")},m(h,_){I(h,e,_),k(e,t),k(e,r),k(e,s),k(s,n),k(n,a),B(i,a,null),k(a,l),k(a,c),d=!0,m||(g=Ql(u=o[1].call(null,e)),m=!0)},i(h){d||(S(i.$$.fragment,h),d=!0)},o(h){P(i.$$.fragment,h),d=!1},d(h){h&&C(e),N(i),m=!1,g()}}}function oP(o){let e,t,r,s,n,a,i;r=new Od({props:{size:"20px"}});let l=o[0]&&nb(o);return{c(){e=T("div"),t=T("button"),H(r.$$.fragment),s=U(),l&&l.c(),x(t,"class","menu-button svelte-4t8k3t"),x(e,"class","menu-container svelte-4t8k3t")},m(c,u){I(c,e,u),k(e,t),B(r,t,null),k(e,s),l&&l.m(e,null),n=!0,a||(i=te(t,"click",Lx(o[2])),a=!0)},p(c,[u]){c[0]?l?u&1&&S(l,1):(l=nb(c),l.c(),S(l,1),l.m(e,null)):l&&(he(),P(l,1,1,()=>{l=null}),ge())},i(c){n||(S(r.$$.fragment,c),S(l),n=!0)},o(c){P(r.$$.fragment,c),P(l),n=!1},d(c){c&&C(e),N(r),l&&l.d(),a=!1,i()}}}function sP(o,e,t){let r=!1;function s(a){let i=l=>{let c=document.querySelector(".menu-button");!a.contains(l.target)&&l.target!==c&&!(c!=null&&c.contains(l.target))&&t(0,r=!1)};return setTimeout(()=>{document.addEventListener("click",i)},0),{destroy(){document.removeEventListener("click",i)}}}function n(a){a.stopPropagation(),t(0,r=!r)}return[r,s,n]}var Up=class extends ee{constructor(e){super(),oe(this,e,sP,oP,Z,{},rP)}},ab=Up;function nP(o){Pe(o,"svelte-ycfe1d",".relay-text.svelte-ycfe1d{fill:var(--text-normal)}")}function aP(o){let e,t;return{c(){e=eo("svg"),t=eo("path"),x(t,"d","m112.88679 65.94517c-1.8219-.6498-2.8316-1.9996-2.8205-3.7707.019-2.9692 4.2679-9.1564 8.5532-12.4538.8896-.6846 3.2865-2.0796 5.3264-3.1002l3.7089-1.8555 1.1034-2.1157c.6069-1.1636 1.0788-2.1403 1.0487-2.1704-.03-.03-.7517.2969-1.6037.7266-1.7893.9026-3.4923 1.0179-5.6348.3816-1.2664-.376-2.6971-1.5724-3.0511-2.5512-.1036-.2865-.2262-.2926-.6259-.031-1.6133 1.0551-3.9805 2.2931-5.3124 2.7783-3.2045 1.1672-7.1579.5507-8.5509-1.3335l-.5903-.7983-1.2238.7491c-3.1246 1.9126-7.5052 2.5576-9.6905 1.4268-1.3209-.6835-2.1336-1.8529-2.3663-3.405-.099-.6587-.2706-1.1976-.3819-1.1976-.1112 0-.4909.3082-.8437.685-1.1393 1.2168-4.3891 3.211-6.2437 3.8314-4.3168 1.4441-8.0424.1949-8.8532-2.9684-.1823-.7114-.3977-1.2593-.4786-1.2177-8.2088 4.2188-13.1666 5.5617-17.3451 4.6983-7.2318-1.4943-8.5363-7.633-3.2721-15.3969 3.43-5.0586 8.1226-8.1393 12.5368-8.2303 4.2661-.088 6.1851 2.8612 4.6067 7.0798-1.4639 3.9129-6.6553 7.7738-11.3995 8.4781l-1.2322.183-.173.9219c-.2449 1.3054.055 2.3726.8414 2.9909 1.4773 1.162 5.3481.4499 9.169-1.6869 4.0877-2.286 9.2494-6.7459 10.2254-8.8353 2.1729-4.6512 10.3391-19.4528 12.6199-22.8741 1.9649-2.9472 2.9544-3.913 4.6877-4.575 2.2454-.8575 3.8556.1204 3.8556 2.3418 0 1.0627-.8749 2.8756-5.2398 10.8581-4.5459 8.3134-10.5554 20.346-10.9601 21.9446-.372 1.4696-.093 1.8547 1.0954 1.5137 3.1691-.9088 8.5727-5.615 10.728-9.3431 3.192-5.5215 7.5241-8.5901 12.516-8.8657 1.3396-.074 2.6532.01 3.3914.2166 1.585.4437 3.5318 2.2009 3.7762 3.4083.1003.4954.3584.9822.5736 1.0817 1.6112.7453 1.9862 1.0047 2.0682 1.4307.051.2665-.9529 2.6236-2.2318 5.238-1.8799 3.8432-2.328 4.9899-2.3404 5.9886l-.015 1.2352.9261.077c1.132.094 3.2883-1.1349 5.6894-3.243 2.3304-2.0459 3.4794-3.659 6.2257-8.7403 1.3371-2.4739 2.6529-4.8096 2.924-5.1906.7068-.9931 1.8337-1.3742 3.6712-1.2413 1.7839.1291 2.6563.7039 2.6563 1.7502 0 .3631-1.6536 3.8273-3.6747 7.698-3.6147 6.9231-4.2241 8.2285-3.8408 8.2285.3864 0 2.6593-1.4351 4.2082-2.6571 2.9724-2.3449 4.1289-3.8334 6.7129-8.64 3.2167-5.9836 4.0513-6.6961 7.4599-6.3685 1.5037.1444 2.3637.7781 2.3637 1.7416 0 .6971-3.7642 8.1283-7.3844 14.5783-1.1774 2.0975-2.1406 3.9288-2.1406 4.0695 0 1.0032 6.4569-2.0079 10.373-4.8373 1.75083-1.265 2.80833-1.8553 3.32363-1.8553.8396 0 1.9138.8456 1.9138 1.5065 0 1.6136-6.83683 5.3607-15.31743 8.3952l-3.0144 1.0785-3.1147 4.959c-6.6125 10.5277-11.2414 15.4863-16.0267 17.1682-1.6492.5797-2.5036.6042-3.8855.1114zm3.4676-4.0874c2.3533-1.2035 5.0029-4.3759 7.0335-8.4211 1.4729-2.9341 1.2858-3.2801-1.0497-1.9405-2.6054 1.4944-6.0792 5.1835-7.6115 8.0833-1.3391 2.5343-.6792 3.458 1.6277 2.2783zm-13.7433-25.7067c2.0798-1.3888 2.707-2.2251 5.1929-6.9235 1.1337-2.1427 2.4702-4.3736 2.9701-4.9576.4999-.5839.8343-1.1823.7432-1.3297-.3028-.49-1.5733-.2724-2.9201.5001-3.9 2.237-10.6318 12.1845-9.2087 13.6076.4489.4489 1.7491.087 3.2226-.8969zm-39.6413-6.7383c1.4951-.7532 3.4914-2.3885 4.373-3.5822.8778-1.1886.8303-2.7169-.089-2.8472-.9504-.1348-2.84 1.147-4.3353 2.9408-1.4368 1.7237-2.8652 3.8321-2.8652 4.2293 0 .3431 1.5421-.048 2.916-.7407zm-15.7519 34.9397c-7.7618-1.6901-14.6809-7.6649-17.3519-14.9834-1.0082-2.7626-2.5946-8.8926-3.6898-14.2584-.7621-3.7334-1.4567-5.8195-2.0623-6.1938-.1258-.078-.173.4384-.1049 1.147l.1238 1.2883-2.6916 5.648c-3.9954 8.3841-5.3958 10.566-7.4555 11.6168-1.4222.7256-3.7417.6896-5.2712-.082-1.0729-.541-1.1779-.6797-1.1514-1.5213.017-.5465.8143-2.6067 1.945-5.0271 3.1568-6.7568 12.4018-25.1754 13.3068-26.5105 1.1089-1.6358 2.3136-2.186 4.3772-1.9989 1.8988.1722 3.7575 1.0556 3.7575 1.7858 0 .685-.9801 3.23-2.4839 6.4499-.6712 1.437-1.2203 2.6574-1.2203 2.712 0 .2508 2.423.059 3.8048-.3005 2.1083-.5492 3.5885-1.4764 5.2895-3.3138 2.9831-3.2221 3.5133-7.5609 1.1835-9.6842-3.8351-3.4952-12.7275-2.9971-21.5226 1.2055-6.4797 3.0962-10.7971 8.141-11.8606 13.8587-.5183 2.7868-1.354 3.618-2.8384 2.8236-2.234-1.1956-1.5337-5.997 1.651-11.3196 5.1483-8.6044 15.656-14.9768 26.6996-16.192 9.3582-1.0298 17.2345 3.5198 17.8697 10.322.3469 3.7147-1.5827 8.0493-5.1855 11.6487-2.6104 2.6078-4.969 3.9861-7.9877 4.6679l-1.94.4381.8512.2875c1.5709.5307 1.8619 1.0923 3.1019 5.988 2.5245 9.9665 4.9471 14.9264 9.4592 19.3659 6.055 5.9576 14.0611 6.1192 19.4354.3922.7131-.7598 2.2084-2.7055 3.323-4.3238 1.1145-1.6182 2.2218-3.0172 2.4606-3.1088 2.1176-.8126 2.9615 1.5236 1.6137 4.4675-2.2327 4.877-6.6161 9.1629-11.4944 11.2387-4.1481 1.7652-9.8251 2.3621-13.9414 1.4657z"),x(e,"class","relay-text svelte-ycfe1d"),x(e,"width",o[0]),x(e,"height",o[1]),x(e,"viewBox","0 0 154.24573 66.293579"),x(e,"xmlns","http://www.w3.org/2000/svg")},m(r,s){I(r,e,s),k(e,t)},p:X,i:X,o:X,d(r){r&&C(e)}}}function iP(o,e,t){let{size:r=64}=e,s=r,n=r/2;return o.$$set=a=>{"size"in a&&t(2,r=a.size)},[s,n,r]}var $p=class extends ee{constructor(e){super(),oe(this,e,iP,aP,Z,{size:2},nP)}},bc=$p;function lP(o){Pe(o,"svelte-120r7kg",".subtitle.svelte-120r7kg{color:var(--text-muted);font-size:1.25rem;margin:0}.description.svelte-120r7kg{color:var(--text-muted);font-size:1rem;max-width:480px;margin:0}")}function cP(o){let e,t,r,s,n,a;return e=new bc({props:{size:140}}),{c(){H(e.$$.fragment),t=U(),r=T("p"),r.textContent="Real-time collaboration in Obsidian",s=U(),n=T("p"),n.textContent=`Share folders with your team, edit together in real time, and keep your
	knowledge library exactly how you want it.`,x(r,"class","subtitle svelte-120r7kg"),x(n,"class","description svelte-120r7kg")},m(i,l){B(e,i,l),I(i,t,l),I(i,r,l),I(i,s,l),I(i,n,l),a=!0},p:X,i(i){a||(S(e.$$.fragment,i),a=!0)},o(i){P(e.$$.fragment,i),a=!1},d(i){i&&(C(t),C(r),C(s),C(n)),N(e,i)}}}var Bp=class extends ee{constructor(e){super(),oe(this,e,null,cP,Z,{},lP)}},ib=Bp;var wc=require("obsidian");function fP(o){Pe(o,"svelte-1kvxms3",`.help-section.svelte-1kvxms3{width:100%;padding:0 2rem;margin-bottom:2rem}.footer.svelte-1kvxms3{padding:0 2rem;margin-bottom:2rem;text-align:center}.help-container.svelte-1kvxms3{position:relative;max-width:640px;margin:0 auto}.why-google.svelte-1kvxms3:hover{background-color:transparent !important;box-shadow:none;color:var(--text-modifier-hover)}.why-google.svelte-1kvxms3{outline:0;color:var(--text-muted);font-size:0.875rem;margin:0;background-color:transparent !important;box-shadow:none;text-decoration-line:var(--link-decoration);padding:0;border:none;cursor:pointer;width:100%;text-align:left}.why-google.svelte-1kvxms3:hover{color:var(--text-normal)}.help-content.svelte-1kvxms3{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1);text-align:left}.popover.svelte-1kvxms3{position:absolute;z-index:50;width:256px;padding-left:1em;padding-right:1em;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:calc(100% + 8px);text-align:left;left:50%;transform:translateX(-50%);opacity:0;visibility:hidden;transition:opacity 0.3s ease,
			visibility 0.3s ease;transition-delay:0.1s}.popover.visible.svelte-1kvxms3{opacity:1;visibility:visible}.popover.svelte-1kvxms3:not(.visible){transition-delay:0s}.arrow.svelte-1kvxms3{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px;right:40px}.discord-link.svelte-1kvxms3{display:inline-flex;align-items:center;justify-content:center;gap:0.5rem;color:var(--text-muted);font-size:0.875rem;margin:0}`)}function uP(o){let e,t,r,s;return{c(){e=T("div"),t=T("div"),r=U(),s=T("p"),s.textContent=`${cb}`,x(t,"class","arrow svelte-1kvxms3"),x(e,"class","popover svelte-1kvxms3"),Be(e,"visible",o[0])},m(n,a){I(n,e,a),k(e,t),k(e,r),k(e,s),o[9](e)},p(n,a){a&1&&Be(e,"visible",n[0])},d(n){n&&C(e),o[9](null)}}}function dP(o){let e,t=o[0]&&lb(o);return{c(){t&&t.c(),e=Ie()},m(r,s){t&&t.m(r,s),I(r,e,s)},p(r,s){r[0]?t?t.p(r,s):(t=lb(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&C(e),t&&t.d(r)}}}function lb(o){let e,t;return{c(){e=T("div"),t=T("p"),t.textContent=`${cb}`,x(e,"class","help-content svelte-1kvxms3")},m(r,s){I(r,e,s),k(e,t)},p:X,d(r){r&&C(e)}}}function pP(o){let e,t,r,s,n,a,i,l,c,u,d,m;function g(w,v){return w[1]?dP:uP}let h=g(o,-1),_=h(o);return l=new xc({}),{c(){e=T("div"),t=T("div"),r=T("button"),r.textContent="Why sign in with Google?",s=U(),_.c(),n=U(),a=T("div"),i=T("a"),H(l.$$.fragment),c=K(`
		Join the project on Discord`),x(r,"class","why-google svelte-1kvxms3"),Be(r,"mobile",o[1]),x(t,"class","help-container svelte-1kvxms3"),x(e,"class","help-section svelte-1kvxms3"),x(i,"href","https://discord.system3.md"),x(i,"class","discord-link svelte-1kvxms3"),x(a,"class","footer svelte-1kvxms3")},m(w,v){I(w,e,v),k(e,t),k(t,r),o[8](r),k(t,s),_.m(t,null),I(w,n,v),I(w,a,v),k(a,i),B(l,i,null),k(i,c),u=!0,d||(m=[te(r,"mouseenter",o[4]),te(r,"mouseleave",o[5]),te(r,"click",o[6])],d=!0)},p(w,[v]){(!u||v&2)&&Be(r,"mobile",w[1]),h===(h=g(w,v))&&_?_.p(w,v):(_.d(1),_=h(w),_&&(_.c(),_.m(t,null)))},i(w){u||(S(l.$$.fragment,w),u=!0)},o(w){P(l.$$.fragment,w),u=!1},d(w){w&&(C(e),C(n),C(a)),o[8](null),_.d(),N(l),d=!1,Ce(m)}}}var cb="We require sign-in because your vault needs to communicate securely with Relay servers for syncing. An identity provider like Google helps to prevent spam accounts. We may add more sign-in options based on user feedback \u2014 let us know in Discord.";function mP(o,e,t){var r;let s=!1,n=!1,a,i;function l(){n||t(0,s=!0)}function c(){n||t(0,s=!1)}function u(){n&&t(0,s=!s)}function d(g){Nr[g?"unshift":"push"](()=>{a=g,t(2,a)})}function m(g){Nr[g?"unshift":"push"](()=>{i=g,t(3,i)})}return o.$$.update=()=>{if(o.$$.dirty&128){e:t(1,n=t(7,r=wc.Platform===null||wc.Platform===void 0?void 0:wc.Platform.isMobile)!==null&&r!==void 0?r:!1)}},[s,n,a,i,l,c,u,r,d,m]}var Np=class extends ee{constructor(e){super(),oe(this,e,mP,pP,Z,{},fP)}},fb=Np;var ub=[{color:"#30bced",light:"#30bced33"},{color:"#6eeb83",light:"#6eeb8333"},{color:"#ffbc42",light:"#ffbc4233"},{color:"#ecd444",light:"#ecd44433"},{color:"#ee6352",light:"#ee635233"},{color:"#9ac2c9",light:"#9ac2c933"},{color:"#8acb88",light:"#8acb8833"},{color:"#1be7ff",light:"#1be7ff33"}],vc=class{constructor(e,t,r,s,n){this.id=e;this.name=t;this.email=r;this.picture=s;this.token=n;this.color=ub[Na()%ub.length]}};function hP(o){Pe(o,"svelte-18fffd7",".avatar.svelte-18fffd7.svelte-18fffd7{position:relative;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;background-color:var(--color-base-30)}.avatar.svelte-18fffd7>img.svelte-18fffd7{margin:0px}.initial.svelte-18fffd7.svelte-18fffd7{color:var(--text-on-accent)}img.svelte-18fffd7.svelte-18fffd7{width:100%;height:100%;object-fit:cover}")}function gP(o){let e,t;return{c(){e=T("span"),t=K(o[5]),x(e,"class","initial svelte-18fffd7"),de(e,"font-size",o[4])},m(r,s){I(r,e,s),k(e,t)},p(r,s){s&32&&ne(t,r[5]),s&16&&de(e,"font-size",r[4])},d(r){r&&C(e)}}}function yP(o){let e,t,r,s;return{c(){e=T("img"),nd(e.src,t=o[0].picture)||x(e,"src",t),x(e,"alt",o[1]),x(e,"referrerpolicy","no-referrer"),x(e,"class","svelte-18fffd7")},m(n,a){I(n,e,a),r||(s=te(e,"error",o[6]),r=!0)},p(n,a){a&1&&!nd(e.src,t=n[0].picture)&&x(e,"src",t),a&2&&x(e,"alt",n[1])},d(n){n&&C(e),r=!1,s()}}}function xP(o){let e;function t(n,a){return!n[3]&&n[0].picture?yP:gP}let r=t(o,-1),s=r(o);return{c(){e=T("div"),s.c(),x(e,"class","avatar svelte-18fffd7"),de(e,"width",o[2]),de(e,"height",o[2])},m(n,a){I(n,e,a),s.m(e,null)},p(n,[a]){r===(r=t(n,a))&&s?s.p(n,a):(s.d(1),s=r(n),s&&(s.c(),s.m(e,null))),a&4&&de(e,"width",n[2]),a&4&&de(e,"height",n[2])},i:X,o:X,d(n){n&&C(e),s.d()}}}function bP(o){var e;return((e=o.match(/[a-z]+$/i))===null||e===void 0?void 0:e[0])||"px"}function wP(o,e,t){let r,s,n,{user:a}=e,{alt:i="Profile picture"}=e,{size:l="40px"}=e,c=!1;function u(){t(3,c=!0)}return o.$$set=d=>{"user"in d&&t(0,a=d.user),"alt"in d&&t(1,i=d.alt),"size"in d&&t(2,l=d.size)},o.$$.update=()=>{if(o.$$.dirty&1){e:t(5,r=a.name?a.name.charAt(0).toUpperCase():"?")}if(o.$$.dirty&4){e:t(7,s=bP(l))}if(o.$$.dirty&132){e:t(4,n=`${parseFloat(l)/2}${s}`)}},[a,i,l,c,n,r,u,s]}var Hp=class extends ee{constructor(e){super(),oe(this,e,wP,xP,Z,{user:0,alt:1,size:2},hP)}},db=Hp;var q5=require("obsidian");function vP(o){Pe(o,"svelte-zlums1",".setting-item-control.svelte-zlums1{width:unset !important;margin-top:unset !important}.setting-item.svelte-zlums1{flex-direction:unset !important;align-items:flex-start}.setting-item-info.svelte-zlums1{min-width:0;margin-top:auto;margin-bottom:auto}")}function _P(o){let e,t,r,s,n,a=(o[0].name||"")+"",i,l,c,u,d=(o[0].email||"")+"",m,g,h,_;t=new db({props:{size:"2.5em",user:o[0]}});let w=o[2].default,v=ye(w,o,o[1],null);return{c(){e=T("div"),H(t.$$.fragment),r=U(),s=T("div"),n=T("div"),i=K(a),l=U(),c=T("br"),u=U(),m=K(d),g=U(),h=T("div"),v&&v.c(),x(n,"class","setting-item-description"),x(s,"class","setting-item-info svelte-zlums1"),de(s,"display","grid"),x(h,"class","setting-item-control svelte-zlums1"),x(e,"class","setting-item svelte-zlums1")},m(A,O){I(A,e,O),B(t,e,null),k(e,r),k(e,s),k(s,n),k(n,i),k(n,l),k(n,c),k(n,u),k(n,m),k(e,g),k(e,h),v&&v.m(h,null),_=!0},p(A,[O]){let E={};O&1&&(E.user=A[0]),t.$set(E),(!_||O&1)&&a!==(a=(A[0].name||"")+"")&&ne(i,a),(!_||O&1)&&d!==(d=(A[0].email||"")+"")&&ne(m,d),v&&v.p&&(!_||O&2)&&be(v,w,A,A[1],_?xe(w,A[1],O,null):we(A[1]),null)},i(A){_||(S(t.$$.fragment,A),S(v,A),_=!0)},o(A){P(t.$$.fragment,A),P(v,A),_=!1},d(A){A&&C(e),N(t),v&&v.d(A)}}}function SP(o,e,t){let{$$slots:r={},$$scope:s}=e,{user:n}=e;return o.$$set=a=>{"user"in a&&t(0,n=a.user),"$$scope"in a&&t(1,s=a.$$scope)},[n,s,r]}var Vp=class extends ee{constructor(e){super(),oe(this,e,SP,_P,Z,{user:0},vP)}},_c=Vp;var Sc=require("obsidian");function kP(o){Pe(o,"svelte-5zjjwa",".help-container.svelte-5zjjwa{position:relative;display:inline-block}button.svelte-5zjjwa{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px;margin:0;background:transparent;border:none;color:var(--text-muted);box-shadow:none;border-radius:50%}button.svelte-5zjjwa:hover{box-shadow:none;color:var(--icon-color-hover);opacity:var(--icon-opacity-hover);background-color:transparent;border-radius:0}button.svelte-5zjjwa:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.popover.svelte-5zjjwa{position:absolute;z-index:50;width:256px;padding:8px;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:32px;transition-delay:0.1s}.popover.left.svelte-5zjjwa{right:100%;margin-right:8px}.popover.right.svelte-5zjjwa{left:0}.arrow.svelte-5zjjwa{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px}.arrow.left.svelte-5zjjwa{right:8px}.arrow.right.svelte-5zjjwa{left:8px}p.svelte-5zjjwa{margin:0;color:var(--text-normal)}")}function pb(o){let e,t,r,s,n;return{c(){e=T("div"),t=T("div"),r=U(),s=T("p"),n=K(o[0]),x(t,"class","arrow svelte-5zjjwa"),Be(t,"left",o[4]==="left"),Be(t,"right",o[4]==="right"),x(s,"class","svelte-5zjjwa"),x(e,"class","popover svelte-5zjjwa"),Be(e,"left",o[4]==="left"),Be(e,"right",o[4]==="right")},m(a,i){I(a,e,i),k(e,t),k(e,r),k(e,s),k(s,n),o[9](e)},p(a,i){i&16&&Be(t,"left",a[4]==="left"),i&16&&Be(t,"right",a[4]==="right"),i&1&&ne(n,a[0]),i&16&&Be(e,"left",a[4]==="left"),i&16&&Be(e,"right",a[4]==="right")},d(a){a&&C(e),o[9](null)}}}function CP(o){let e,t,r,s,n,a,i;r=new bi({props:{size:16}});let l=o[1]&&pb(o);return{c(){e=T("div"),t=T("button"),H(r.$$.fragment),s=U(),l&&l.c(),x(t,"type","button"),x(t,"class","svelte-5zjjwa"),x(e,"class","help-container svelte-5zjjwa")},m(c,u){I(c,e,u),k(e,t),B(r,t,null),o[8](t),k(e,s),l&&l.m(e,null),n=!0,a||(i=[te(t,"mouseenter",o[5]),te(t,"mouseleave",o[6]),te(t,"click",o[7])],a=!0)},p(c,[u]){c[1]?l?l.p(c,u):(l=pb(c),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},i(c){n||(S(r.$$.fragment,c),n=!0)},o(c){P(r.$$.fragment,c),n=!1},d(c){c&&C(e),N(r),o[8](null),l&&l.d(),a=!1,Ce(i)}}}function IP(o,e,t){let{helpText:r}=e,s=!1,n="right",a,i;function l(){t(1,s=!0)}function c(){t(1,s=!1)}function u(){t(1,s=!s)}function d(g){Nr[g?"unshift":"push"](()=>{a=g,t(2,a)})}function m(g){Nr[g?"unshift":"push"](()=>{i=g,t(3,i)})}return o.$$set=g=>{"helpText"in g&&t(0,r=g.helpText)},o.$$.update=()=>{if(o.$$.dirty&14){e:if(s&&a&&i){let g=a.getBoundingClientRect(),h=i.getBoundingClientRect(),_=window.innerWidth;t(4,n=g.right+h.width>_-20?"left":"right")}}},[r,s,a,i,n,l,c,u,d,m]}var qp=class extends ee{constructor(e){super(),oe(this,e,IP,CP,Z,{helpText:0},kP)}},mb=qp;function LP(o){Pe(o,"svelte-1v3t6m3",".setting-item-name.svelte-1v3t6m3{display:flex;align-items:center;gap:8px}.help-button.svelte-1v3t6m3{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px !important;margin:0;background:transparent;border:none;color:var(--text-muted);border-radius:50%;-webkit-tap-highlight-color:transparent}@media(hover: hover){.help-button.svelte-1v3t6m3:hover{box-shadow:none;color:var(--text-normal);background:transparent;border-radius:0}}.help-button.svelte-1v3t6m3:active{color:var(--text-normal)}.help-content.svelte-1v3t6m3{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1)}p.svelte-1v3t6m3{margin:0}")}var TP=o=>({}),hb=o=>({}),PP=o=>({}),gb=o=>({}),DP=o=>({}),yb=o=>({});function FP(o){let e;return{c(){e=K(o[0])},m(t,r){I(t,e,r)},p(t,r){r&1&&ne(e,t[0])},d(t){t&&C(e)}}}function xb(o){let e,t,r,s,n=[EP,AP],a=[];function i(l,c){return l[3]?0:1}return e=i(o,-1),t=a[e]=n[e](o),{c(){t.c(),r=Ie()},m(l,c){a[e].m(l,c),I(l,r,c),s=!0},p(l,c){let u=e;e=i(l,c),e===u?a[e].p(l,c):(he(),P(a[u],1,1,()=>{a[u]=null}),ge(),t=a[e],t?t.p(l,c):(t=a[e]=n[e](l),t.c()),S(t,1),t.m(r.parentNode,r))},i(l){s||(S(t),s=!0)},o(l){P(t),s=!1},d(l){l&&C(r),a[e].d(l)}}}function AP(o){let e,t;return e=new mb({props:{helpText:o[1]}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&2&&(n.helpText=r[1]),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function EP(o){let e,t,r,s,n;return t=new bi({props:{size:16}}),{c(){e=T("button"),H(t.$$.fragment),x(e,"class","help-button svelte-1v3t6m3"),x(e,"aria-expanded",o[2])},m(a,i){I(a,e,i),B(t,e,null),r=!0,s||(n=te(e,"click",o[4]),s=!0)},p(a,i){(!r||i&4)&&x(e,"aria-expanded",a[2])},i(a){r||(S(t.$$.fragment,a),r=!0)},o(a){P(t.$$.fragment,a),r=!1},d(a){a&&C(e),N(t),s=!1,n()}}}function MP(o){let e,t,r=o[7].description,s=ye(r,o,o[6],hb);return{c(){e=T("div"),s&&s.c(),x(e,"class","setting-item-description")},m(n,a){I(n,e,a),s&&s.m(e,null),t=!0},p(n,a){s&&s.p&&(!t||a&64)&&be(s,r,n,n[6],t?xe(r,n[6],a,TP):we(n[6]),hb)},i(n){t||(S(s,n),t=!0)},o(n){P(s,n),t=!1},d(n){n&&C(e),s&&s.d(n)}}}function bb(o){let e,t,r;return{c(){e=T("div"),t=T("p"),r=K(o[1]),x(t,"class","svelte-1v3t6m3"),x(e,"class","help-content svelte-1v3t6m3"),Be(e,"expanded",o[2])},m(s,n){I(s,e,n),k(e,t),k(t,r)},p(s,n){n&2&&ne(r,s[1]),n&4&&Be(e,"expanded",s[2])},d(s){s&&C(e)}}}function RP(o){let e,t,r,s,n,a,i,l,c,u=o[7].name,d=ye(u,o,o[6],yb),m=d||FP(o),g=o[1]&&xb(o),h=o[7].description,_=ye(h,o,o[6],gb),w=_||MP(o),v=o[1]&&o[2]&&o[3]&&bb(o),A=o[7].default,O=ye(A,o,o[6],null);return{c(){e=T("div"),t=T("div"),r=T("div"),m&&m.c(),s=U(),g&&g.c(),n=U(),w&&w.c(),a=U(),v&&v.c(),i=U(),l=T("div"),O&&O.c(),x(r,"class","setting-item-name svelte-1v3t6m3"),x(t,"class","setting-item-info"),x(l,"class","setting-item-control"),x(e,"class","setting-item setting-item-heading")},m(E,M){I(E,e,M),k(e,t),k(t,r),m&&m.m(r,null),k(r,s),g&&g.m(r,null),k(t,n),w&&w.m(t,null),k(t,a),v&&v.m(t,null),k(e,i),k(e,l),O&&O.m(l,null),c=!0},p(E,[M]){d?d.p&&(!c||M&64)&&be(d,u,E,E[6],c?xe(u,E[6],M,DP):we(E[6]),yb):m&&m.p&&(!c||M&1)&&m.p(E,c?M:-1),E[1]?g?(g.p(E,M),M&2&&S(g,1)):(g=xb(E),g.c(),S(g,1),g.m(r,null)):g&&(he(),P(g,1,1,()=>{g=null}),ge()),_?_.p&&(!c||M&64)&&be(_,h,E,E[6],c?xe(h,E[6],M,PP):we(E[6]),gb):w&&w.p&&(!c||M&64)&&w.p(E,c?M:-1),E[1]&&E[2]&&E[3]?v?v.p(E,M):(v=bb(E),v.c(),v.m(t,null)):v&&(v.d(1),v=null),O&&O.p&&(!c||M&64)&&be(O,A,E,E[6],c?xe(A,E[6],M,null):we(E[6]),null)},i(E){c||(S(m,E),S(g),S(w,E),S(O,E),c=!0)},o(E){P(m,E),P(g),P(w,E),P(O,E),c=!1},d(E){E&&C(e),m&&m.d(E),g&&g.d(),w&&w.d(E),v&&v.d(),O&&O.d(E)}}}function OP(o,e,t){let{$$slots:r={},$$scope:s}=e;var n;let{name:a=""}=e,{helpText:i=void 0}=e,l=!1,c=!1;function u(){c&&t(2,l=!l)}return o.$$set=d=>{"name"in d&&t(0,a=d.name),"helpText"in d&&t(1,i=d.helpText),"$$scope"in d&&t(6,s=d.$$scope)},o.$$.update=()=>{if(o.$$.dirty&32){e:t(3,c=t(5,n=Sc.Platform===null||Sc.Platform===void 0?void 0:Sc.Platform.isMobile)!==null&&n!==void 0?n:!1)}},[a,i,l,c,u,n,s,r]}var Wp=class extends ee{constructor(e){super(),oe(this,e,OP,RP,Z,{name:0,helpText:1},LP)}},Je=Wp;var ga=[];function UP(o,e){return{subscribe:_e(o,e).subscribe}}function _e(o,e=X){let t,r=new Set;function s(i){if(Z(o,i)&&(o=i,t)){let l=!ga.length;for(let c of r)c[1](),ga.push(c,o);if(l){for(let c=0;c<ga.length;c+=2)ga[c][0](ga[c+1]);ga.length=0}}}function n(i){s(i(o))}function a(i,l=X){let c=[i,l];return r.add(c),r.size===1&&(t=e(s,n)||X),i(o),()=>{r.delete(c),r.size===0&&t&&(t(),t=null)}}return{set:s,update:n,subscribe:a}}function ro(o,e,t){let r=!Array.isArray(o),s=r?[o]:o;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");let n=e.length<2;return UP(t,(a,i)=>{let l=!1,c=[],u=0,d=X,m=()=>{if(u)return;d();let h=e(r?c[0]:c,a,i);n?a(h):d=pt(h)?h:X},g=s.map((h,_)=>ar(h,w=>{c[_]=w,u&=~(1<<_),l&&m()},()=>{u|=1<<_}));return l=!0,m(),function(){Ce(g),d(),l=!1}})}function $P(o){Pe(o,"svelte-xcpzqp",`.continue.svelte-xcpzqp{font-weight:600;font-size:larger;margin-top:0;margin-bottom:0px}.link.svelte-xcpzqp{color:var(--text-muted)}.link.svelte-xcpzqp:hover{color:var(--text-normal)}.not-working.svelte-xcpzqp{margin-top:0px;margin-bottom:0px;color:var(--text-faint);font-size:0.75em}.link-button.svelte-xcpzqp{box-shadow:none;background:none;border:none;padding:0;font:inherit;text-decoration:underline}button.link-button.svelte-xcpzqp:hover{box-shadow:none;color:var(--text-normal)}button.link.link-button.svelte-xcpzqp{height:auto;padding:0;color:var(--text-faint)}.welcome.svelte-xcpzqp{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:7rem 2rem 1rem 2rem;max-width:640px;margin:0 auto;gap:2rem}.google-sign-in-button.svelte-xcpzqp{height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMTcuNiA5LjJsLS4xLTEuOEg5djMuNGg0LjhDMTMuNiAxMiAxMyAxMyAxMiAxMy42djIuMmgzYTguOCA4LjggMCAwIDAgMi42LTYuNnoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik05IDE4YzIuNCAwIDQuNS0uOCA2LTIuMmwtMy0yLjJhNS40IDUuNCAwIDAgMS04LTIuOUgxVjEzYTkgOSAwIDAgMCA4IDV6IiBmaWxsPSIjMzRBODUzIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNNCAxMC43YTUuNCA1LjQgMCAwIDEgMC0zLjRWNUgxYTkgOSAwIDAgMCAwIDhsMy0yLjN6IiBmaWxsPSIjRkJCQzA1IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNOSAzLjZjMS4zIDAgMi41LjQgMy40IDEuM0wxNSAyLjNBOSA5IDAgMCAwIDEgNWwzIDIuNGE1LjQgNS40IDAgMCAxIDUtMy43eiIgZmlsbD0iI0VBNDMzNSIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTAgMGgxOHYxOEgweiIvPjwvZz48L3N2Zz4=);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.google-sign-in-button.svelte-xcpzqp:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.google-sign-in-button.svelte-xcpzqp:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}`)}function BP(o){let e,t,r,s,n,a,i;t=new ib({});function l(h,_){return h[3]?VP:HP}let c=l(o,[-1,-1]),u=c(o);function d(h,_){if(h[5])return WP;if(h[4])return qP}let m=d(o,[-1,-1]),g=m&&m(o);return a=new fb({}),{c(){e=T("div"),H(t.$$.fragment),r=U(),u.c(),s=U(),g&&g.c(),n=U(),H(a.$$.fragment),x(e,"class","welcome svelte-xcpzqp")},m(h,_){I(h,e,_),B(t,e,null),k(e,r),u.m(e,null),k(e,s),g&&g.m(e,null),I(h,n,_),B(a,h,_),i=!0},p(h,_){c===(c=l(h,_))&&u?u.p(h,_):(u.d(1),u=c(h),u&&(u.c(),u.m(e,s))),m===(m=d(h,_))&&g?g.p(h,_):(g&&g.d(1),g=m&&m(h),g&&(g.c(),g.m(e,null)))},i(h){i||(S(t.$$.fragment,h),S(a.$$.fragment,h),i=!0)},o(h){P(t.$$.fragment,h),P(a.$$.fragment,h),i=!1},d(h){h&&(C(e),C(n)),N(t),u.d(),g&&g.d(),N(a,h)}}}function NP(o){let e,t,r,s,n,a,i;e=new Je({props:{$$slots:{name:[KP],default:[zP]},$$scope:{ctx:o}}}),r=new Je({props:{name:"Account"}}),n=new _c({props:{user:o[2].user,$$slots:{default:[GP]},$$scope:{ctx:o}}});let l=o[18].default,c=ye(l,o,o[25],null);return{c(){H(e.$$.fragment),t=U(),H(r.$$.fragment),s=U(),H(n.$$.fragment),a=U(),c&&c.c()},m(u,d){B(e,u,d),I(u,t,d),B(r,u,d),I(u,s,d),B(n,u,d),I(u,a,d),c&&c.m(u,d),i=!0},p(u,d){let m={};d[0]&33554432&&(m.$$scope={dirty:d,ctx:u}),e.$set(m);let g={};d[0]&4&&(g.user=u[2].user),d[0]&33554432&&(g.$$scope={dirty:d,ctx:u}),n.$set(g),c&&c.p&&(!i||d[0]&33554432)&&be(c,l,u,u[25],i?xe(l,u[25],d,null):we(u[25]),null)},i(u){i||(S(e.$$.fragment,u),S(r.$$.fragment,u),S(n.$$.fragment,u),S(c,u),i=!0)},o(u){P(e.$$.fragment,u),P(r.$$.fragment,u),P(n.$$.fragment,u),P(c,u),i=!1},d(u){u&&(C(t),C(s),C(a)),N(e,u),N(r,u),N(n,u),c&&c.d(u)}}}function HP(o){let e,t,r,s,n;return{c(){e=T("a"),t=T("button"),r=K("Sign in with Google"),x(t,"class","google-sign-in-button svelte-xcpzqp"),t.disabled=o[4],x(e,"href",o[1]),x(e,"target","_blank")},m(a,i){I(a,e,i),k(e,t),k(t,r),s||(n=te(t,"click",o[21]),s=!0)},p(a,i){i[0]&16&&(t.disabled=a[4]),i[0]&2&&x(e,"href",a[1])},d(a){a&&C(e),s=!1,n()}}}function VP(o){let e,t,r,s;return{c(){e=T("button"),t=K("Sign in with Google"),x(e,"class","google-sign-in-button svelte-xcpzqp"),e.disabled=o[4]},m(n,a){I(n,e,a),k(e,t),r||(s=te(e,"click",(0,Ps.debounce)(o[20])),r=!0)},p(n,a){a[0]&16&&(e.disabled=n[4])},d(n){n&&C(e),r=!1,s()}}}function qP(o){let e,t,r,s,n,a,i,l;return{c(){e=T("div"),t=T("p"),t.textContent="Continue in your browser...",r=U(),s=T("p"),n=K(`Not working?
					`),a=T("button"),a.textContent="(try again)",x(t,"class","continue svelte-xcpzqp"),x(a,"class","link link-button svelte-xcpzqp"),x(s,"class","not-working svelte-xcpzqp")},m(c,u){I(c,e,u),k(e,t),k(e,r),k(e,s),k(s,n),k(s,a),i||(l=te(a,"click",o[24]),i=!0)},p:X,d(c){c&&C(e),i=!1,l()}}}function WP(o){let e,t,r,s,n,a,i,l,c,u,d,m=o[6]&&wb(o);return{c(){e=T("p"),t=K(o[5]),r=K("."),s=T("br"),n=U(),m&&m.c(),a=U(),i=T("p"),l=K(`Not working?
				`),c=T("button"),c.textContent="(try again)",x(c,"class","link link-button svelte-xcpzqp"),x(i,"class","not-working svelte-xcpzqp")},m(g,h){I(g,e,h),k(e,t),k(e,r),k(e,s),k(e,n),m&&m.m(e,null),I(g,a,h),I(g,i,h),k(i,l),k(i,c),u||(d=te(c,"click",o[23]),u=!0)},p(g,h){h[0]&32&&ne(t,g[5]),g[6]?m?m.p(g,h):(m=wb(g),m.c(),m.m(e,null)):m&&(m.d(1),m=null)},d(g){g&&(C(e),C(a),C(i)),m&&m.d(),u=!1,d()}}}function wb(o){let e,t,r,s;return{c(){e=K("Already logged in? "),t=T("button"),t.textContent="(click here)",x(t,"class","link link-button svelte-xcpzqp")},m(n,a){I(n,e,a),I(n,t,a),r||(s=te(t,"click",(0,Ps.debounce)(o[22])),r=!0)},p:X,d(n){n&&(C(e),C(t)),r=!1,s()}}}function zP(o){let e,t;return e=new ab({}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function KP(o){let e,t;return e=new bc({props:{slot:"name"}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p:X,i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function GP(o){let e,t,r;return{c(){e=T("button"),e.textContent="Logout"},m(s,n){I(s,e,n),t||(r=te(e,"click",(0,Ps.debounce)(o[19])),t=!0)},p:X,d(s){s&&C(e),t=!1,r()}}}function jP(o){let e,t,r,s,n=[NP,BP],a=[];function i(l,c){return l[2].hasUser&&l[2].user?0:1}return e=i(o,[-1,-1]),t=a[e]=n[e](o),{c(){t.c(),r=Ie()},m(l,c){a[e].m(l,c),I(l,r,c),s=!0},p(l,c){let u=e;e=i(l,c),e===u?a[e].p(l,c):(he(),P(a[u],1,1,()=>{a[u]=null}),ge(),t=a[e],t?t.p(l,c):(t=a[e]=n[e](l),t.c()),S(t,1),t.m(r.parentNode,r))},i(l){s||(S(t),s=!0)},o(l){P(t),s=!1},d(l){l&&C(r),a[e].d(l)}}}function YP(o,e,t){let r,s,n,a=X,i=()=>(a(),a=ar(_,le=>t(2,n=le)),_),l,c,u,d;o.$$.on_destroy.push(()=>a());let{$$slots:m={},$$scope:g}=e,{plugin:h}=e,_,w=_e(!Ps.Platform.isIosApp);me(o,w,le=>t(3,l=le));let v=_e(!1);me(o,v,le=>t(4,c=le)),i(_=h.loginManager);let A=_e(!1);me(o,A,le=>t(6,d=le));let O=_e(!1),E=_e(!0);me(o,E,le=>t(28,r=le));let M=_e("please wait...");me(o,M,le=>t(1,s=le));let R,D,F=_e("");me(o,F,le=>t(5,u=le));function V(){return Ke(this,void 0,void 0,function*(){h.loginManager.logout(),O.set(!1),A.set(!1)})}function q(){return Ke(this,void 0,void 0,function*(){try{yield h.loginManager.login()}catch(le){w.set(!1),O.set(!1),s&&s!=="please wait..."&&(window.open(s,"_blank"),pe())}})}let j=_e(h.loginManager.pb);function z(){j.set(h.loginManager.pb)}function Y(){try{let le=r?Rt:fetch;R=void 0,M.set("please wait..."),_.initiateManualOAuth2CodeFlow(le).then(([W,Fe,Ye])=>{R=Fe,D=Ye,M.set(W)}).catch(W=>{let Fe=W.message;throw Fe=Fe,F.set(Fe),O.set(!1),W})}catch(le){F.set(le.message)}}lr(()=>{O.set(!1),Y()});function pe(){return Ke(this,void 0,void 0,function*(){if(!(!R||!D))return yield h.loginManager.poll(R,D).then(le=>{O.set(!0),v.set(!1),F.set("")}).catch(le=>{A.set(!0),v.set(!1),O.set(!1),F.set(le.message)})})}function De(le){let W=le.target;W.focus(),W.select(),navigator.clipboard.writeText(W.value).then(()=>new Ps.Notice("Invite link copied")).catch(Fe=>{}),pe()}let G=()=>{V()},se=async()=>{v.set(!0),await q()},ke=()=>{v.set(!0),pe()},Qe=()=>{pe()},Re=()=>{v.set(!1),w.set(!1),F.set(""),Y()},ce=()=>{v.set(!1),w.set(!1)};return o.$$set=le=>{"plugin"in le&&t(17,h=le.plugin),"$$scope"in le&&t(25,g=le.$$scope)},[_,s,n,l,c,u,d,w,v,A,E,M,F,V,q,Y,pe,h,m,G,se,ke,Qe,Re,ce,g]}var zp=class extends ee{constructor(e){super(),oe(this,e,YP,jP,Z,{plugin:17},$P,[-1,-1])}},vb=zp;function _b(o,e,t){let r=o.slice();return r[5]=e[t],r}var JP=o=>({}),Sb=o=>({}),QP=o=>({}),kb=o=>({});function XP(o){let e;return{c(){e=K(o[0])},m(t,r){I(t,e,r)},p(t,r){r&1&&ne(e,t[0])},d(t){t&&C(e)}}}function ZP(o){let e,t=Ae(o[1]),r=[];for(let s=0;s<t.length;s+=1)r[s]=Cb(_b(o,t,s));return{c(){for(let s=0;s<r.length;s+=1)r[s].c();e=Ie()},m(s,n){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(s,n);I(s,e,n)},p(s,n){if(n&2){t=Ae(s[1]);let a;for(a=0;a<t.length;a+=1){let i=_b(s,t,a);r[a]?r[a].p(i,n):(r[a]=Cb(i),r[a].c(),r[a].m(e.parentNode,e))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(s){s&&C(e),st(r,s)}}}function Cb(o){let e;return{c(){e=T("div"),e.textContent=`${o[5]} `},m(t,r){I(t,e,r)},p:X,d(t){t&&C(e)}}}function eD(o){let e,t=o[1].length>0&&ZP(o);return{c(){t&&t.c(),e=Ie()},m(r,s){t&&t.m(r,s),I(r,e,s)},p(r,s){r[1].length>0&&t.p(r,s)},d(r){r&&C(e),t&&t.d(r)}}}function tD(o){let e,t,r,s,n,a,i,l,c=o[4].name,u=ye(c,o,o[3],kb),d=u||XP(o),m=o[4].description,g=ye(m,o,o[3],Sb),h=g||eD(o),_=o[4].default,w=ye(_,o,o[3],null);return{c(){e=T("div"),t=T("div"),r=T("div"),d&&d.c(),s=U(),n=T("div"),h&&h.c(),a=U(),i=T("div"),w&&w.c(),x(r,"class","setting-item-name"),de(r,"display","grid"),de(r,"align-items","center"),x(n,"class","setting-item-description"),x(t,"class","setting-item-info"),de(t,"display","grid"),x(i,"class","setting-item-control"),x(e,"class","setting-item")},m(v,A){I(v,e,A),k(e,t),k(t,r),d&&d.m(r,null),k(t,s),k(t,n),h&&h.m(n,null),k(e,a),k(e,i),w&&w.m(i,null),l=!0},p(v,[A]){u?u.p&&(!l||A&8)&&be(u,c,v,v[3],l?xe(c,v[3],A,QP):we(v[3]),kb):d&&d.p&&(!l||A&1)&&d.p(v,l?A:-1),g&&g.p&&(!l||A&8)&&be(g,m,v,v[3],l?xe(m,v[3],A,JP):we(v[3]),Sb),w&&w.p&&(!l||A&8)&&be(w,_,v,v[3],l?xe(_,v[3],A,null):we(v[3]),null)},i(v){l||(S(d,v),S(h,v),S(w,v),l=!0)},o(v){P(d,v),P(h,v),P(w,v),l=!1},d(v){v&&C(e),d&&d.d(v),h&&h.d(v),w&&w.d(v)}}}function rD(o,e,t){let{$$slots:r={},$$scope:s}=e,{name:n=""}=e,{description:a}=e,i=a!==void 0?a.split(`
`):[];return o.$$set=l=>{"name"in l&&t(0,n=l.name),"description"in l&&t(2,a=l.description),"$$scope"in l&&t(3,s=l.$$scope)},[n,i,a,s,r]}var Kp=class extends ee{constructor(e){super(),oe(this,e,rD,tD,Z,{name:0,description:2})}},ze=Kp;function oD(o){Pe(o,"svelte-11hpkul",".setting-item-control.svelte-11hpkul{width:unset !important;margin-top:unset !important}.setting-item.svelte-11hpkul{flex-direction:unset !important}.setting-item-info.svelte-11hpkul{min-width:0;margin-top:auto;margin-bottom:auto}.setting-item-name.svelte-11hpkul{min-width:0}.truncate.svelte-11hpkul *{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}")}var sD=o=>({}),Ib=o=>({}),nD=o=>({}),Lb=o=>({});function aD(o){let e;return{c(){e=K(o[0])},m(t,r){I(t,e,r)},p(t,r){r&1&&ne(e,t[0])},d(t){t&&C(e)}}}function Tb(o){let e,t;return{c(){e=T("div"),t=K(o[1]),x(e,"class","setting-item-description")},m(r,s){I(r,e,s),k(e,t)},p(r,s){s&2&&ne(t,r[1])},d(r){r&&C(e)}}}function iD(o){let e,t=o[1]&&Tb(o);return{c(){t&&t.c(),e=Ie()},m(r,s){t&&t.m(r,s),I(r,e,s)},p(r,s){r[1]?t?t.p(r,s):(t=Tb(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&C(e),t&&t.d(r)}}}function lD(o){let e,t,r,s,n,a,i,l=o[3].name,c=ye(l,o,o[2],Lb),u=c||aD(o),d=o[3].description,m=ye(d,o,o[2],Ib),g=m||iD(o),h=o[3].default,_=ye(h,o,o[2],null);return{c(){e=T("div"),t=T("div"),r=T("div"),u&&u.c(),s=U(),g&&g.c(),n=U(),a=T("div"),_&&_.c(),x(r,"class","setting-item-name truncate svelte-11hpkul"),x(t,"class","setting-item-info svelte-11hpkul"),x(a,"class","setting-item-control svelte-11hpkul"),x(e,"class","setting-item svelte-11hpkul")},m(w,v){I(w,e,v),k(e,t),k(t,r),u&&u.m(r,null),k(t,s),g&&g.m(t,null),k(e,n),k(e,a),_&&_.m(a,null),i=!0},p(w,[v]){c?c.p&&(!i||v&4)&&be(c,l,w,w[2],i?xe(l,w[2],v,nD):we(w[2]),Lb):u&&u.p&&(!i||v&1)&&u.p(w,i?v:-1),m?m.p&&(!i||v&4)&&be(m,d,w,w[2],i?xe(d,w[2],v,sD):we(w[2]),Ib):g&&g.p&&(!i||v&2)&&g.p(w,i?v:-1),_&&_.p&&(!i||v&4)&&be(_,h,w,w[2],i?xe(h,w[2],v,null):we(w[2]),null)},i(w){i||(S(u,w),S(g,w),S(_,w),i=!0)},o(w){P(u,w),P(g,w),P(_,w),i=!1},d(w){w&&C(e),u&&u.d(w),g&&g.d(w),_&&_.d(w)}}}function cD(o,e,t){let{$$slots:r={},$$scope:s}=e,{name:n=""}=e,{description:a=""}=e;return o.$$set=i=>{"name"in i&&t(0,n=i.name),"description"in i&&t(1,a=i.description),"$$scope"in i&&t(2,s=i.$$scope)},[n,a,s,r]}var Gp=class extends ee{constructor(e){super(),oe(this,e,cD,lD,Z,{name:0,description:1},oD)}},It=Gp;function fD(o){Pe(o,"svelte-y529x8",".extra-setting-button.svelte-y529x8:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.extra-setting-button.svelte-y529x8:hover{box-shadow:none;opacity:var(--icon-opacity-hover);color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}")}function uD(o){let e,t,r,s,n;return t=new zd({props:{class:"svg-icon lucide-settings",props:{class:"svg-icon lucide-settings"}}}),{c(){e=T("div"),H(t.$$.fragment),x(e,"class","clickable-icon extra-setting-button svelte-y529x8"),x(e,"aria-label","Options"),x(e,"role","button"),x(e,"tabindex","0")},m(a,i){I(a,e,i),B(t,e,null),r=!0,s||(n=[te(e,"click",o[0]),te(e,"keydown",o[0])],s=!0)},p:X,i(a){r||(S(t.$$.fragment,a),r=!0)},o(a){P(t.$$.fragment,a),r=!1},d(a){a&&C(e),N(t),s=!1,Ce(n)}}}function dD(o){let e=Kt();function t(r){(r instanceof MouseEvent||r instanceof KeyboardEvent&&(r.key==="Enter"||r.key===" "))&&e("settings")}return[t]}var jp=class extends ee{constructor(e){super(),oe(this,e,dD,uD,Z,{},fD)}},ln=jp;function pD(o){let e,t,r,s,n,a;t=new sn({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0;"}});let i=o[3].default,l=ye(i,o,o[2],null);return{c(){e=T("span"),H(t.$$.fragment),r=U(),l&&l.c(),x(e,"role","button"),x(e,"tabindex","0"),de(e,"display","flex"),de(e,"align-items","center"),de(e,"width","100%")},m(c,u){I(c,e,u),B(t,e,null),k(e,r),l&&l.m(e,null),s=!0,n||(a=[te(e,"keypress",o[0]),te(e,"click",o[0])],n=!0)},p(c,[u]){l&&l.p&&(!s||u&4)&&be(l,i,c,c[2],s?xe(i,c[2],u,null):we(c[2]),null)},i(c){s||(S(t.$$.fragment,c),S(l,c),s=!0)},o(c){P(t.$$.fragment,c),P(l,c),s=!1},d(c){c&&C(e),N(t),l&&l.d(c),n=!1,Ce(a)}}}function mD(o,e,t){let{$$slots:r={},$$scope:s}=e,{relay:n=void 0}=e,a=Kt();function i(){n&&a("manageRelay",{relay:n})}return o.$$set=l=>{"relay"in l&&t(1,n=l.relay),"$$scope"in l&&t(2,s=l.$$scope)},[i,n,s,r]}var Yp=class extends ee{constructor(e){super(),oe(this,e,mD,pD,Z,{relay:1})}},Ds=Yp;function hD(o){let e,t,r,s,n,a;t=new Pd({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0"}});let i=o[3].default,l=ye(i,o,o[2],null);return{c(){e=T("span"),H(t.$$.fragment),r=U(),l&&l.c(),x(e,"role","button"),x(e,"tabindex","0"),de(e,"display","inline-flex"),de(e,"align-items","center"),de(e,"width","100%")},m(c,u){I(c,e,u),B(t,e,null),k(e,r),l&&l.m(e,null),s=!0,n||(a=[te(e,"keypress",o[0]),te(e,"click",o[0])],n=!0)},p(c,[u]){l&&l.p&&(!s||u&4)&&be(l,i,c,c[2],s?xe(i,c[2],u,null):we(c[2]),null)},i(c){s||(S(t.$$.fragment,c),S(l,c),s=!0)},o(c){P(t.$$.fragment,c),P(l,c),s=!1},d(c){c&&C(e),N(t),l&&l.d(c),n=!1,Ce(a)}}}function gD(o,e,t){let{$$slots:r={},$$scope:s}=e,{folder:n=void 0}=e,a=Kt();function i(){var l;n&&a("manageSharedFolder",{folder:n,relay:(l=n.remote)===null||l===void 0?void 0:l.relay})}return o.$$set=l=>{"folder"in l&&t(1,n=l.folder),"$$scope"in l&&t(2,s=l.$$scope)},[i,n,s,r]}var Jp=class extends ee{constructor(e){super(),oe(this,e,gD,hD,Z,{folder:1})}},So=Jp;function yD(o){let e,t=o[0].name+"",r;return{c(){e=T("span"),r=K(t),de(e,"overflow","hidden"),de(e,"text-overflow","ellipsis"),de(e,"white-space","nowrap")},m(s,n){I(s,e,n),k(e,r)},p(s,n){n&1&&t!==(t=s[0].name+"")&&ne(r,t)},d(s){s&&C(e)}}}function Pb(o){let e,t,r,s,n;return t=new hd({props:{size:16,class:"svg-icon"}}),s=new Ds({props:{relay:o[1],$$slots:{default:[xD]},$$scope:{ctx:o}}}),s.$on("manageRelay",o[3]),{c(){e=T("span"),H(t.$$.fragment),r=U(),H(s.$$.fragment),de(e,"width","16px"),de(e,"flex-shrink","0"),de(e,"display","flex"),de(e,"justify-content","center")},m(a,i){I(a,e,i),B(t,e,null),I(a,r,i),B(s,a,i),n=!0},p(a,i){let l={};i&2&&(l.relay=a[1]),i&17&&(l.$$scope={dirty:i,ctx:a}),s.$set(l)},i(a){n||(S(t.$$.fragment,a),S(s.$$.fragment,a),n=!0)},o(a){P(t.$$.fragment,a),P(s.$$.fragment,a),n=!1},d(a){a&&(C(e),C(r)),N(t),N(s,a)}}}function xD(o){let e,t=o[0].remote.relay.name+"",r;return{c(){e=T("span"),r=K(t),de(e,"flex","1"),de(e,"min-width","0"),de(e,"text-overflow","ellipsis"),de(e,"white-space","nowrap")},m(s,n){I(s,e,n),k(e,r)},p(s,n){n&1&&t!==(t=s[0].remote.relay.name+"")&&ne(r,t)},d(s){s&&C(e)}}}function bD(o){let e,t,r,s,n;r=new So({props:{folder:o[0],$$slots:{default:[yD]},$$scope:{ctx:o}}}),r.$on("manageSharedFolder",o[2]);let a=o[0].remote&&Pb(o);return{c(){e=T("span"),t=T("span"),H(r.$$.fragment),s=U(),a&&a.c(),de(t,"display","inline-flex"),de(t,"align-items","center"),de(t,"width","200px"),de(t,"min-width","200px"),de(t,"flex-shrink","0"),de(e,"display","inline-flex"),de(e,"align-items","center"),de(e,"width","100%"),de(e,"gap","8px")},m(i,l){I(i,e,l),k(e,t),B(r,t,null),k(e,s),a&&a.m(e,null),n=!0},p(i,[l]){let c={};l&1&&(c.folder=i[0]),l&17&&(c.$$scope={dirty:l,ctx:i}),r.$set(c),i[0].remote?a?(a.p(i,l),l&1&&S(a,1)):(a=Pb(i),a.c(),S(a,1),a.m(e,null)):a&&(he(),P(a,1,1,()=>{a=null}),ge())},i(i){n||(S(r.$$.fragment,i),S(a),n=!0)},o(i){P(r.$$.fragment,i),P(a),n=!1},d(i){i&&C(e),N(r),a&&a.d()}}}function wD(o,e,t){let{folder:r}=e,{relay:s}=e;function n(i){to.call(this,o,i)}function a(i){to.call(this,o,i)}return o.$$set=i=>{"folder"in i&&t(0,r=i.folder),"relay"in i&&t(1,s=i.relay)},[r,s,n,a]}var Qp=class extends ee{constructor(e){super(),oe(this,e,wD,bD,Z,{folder:0,relay:1})}},Db=Qp;var Fs=require("obsidian");function vD(o){Pe(o,"svelte-yg42fv","input.system3-input-invalid.svelte-yg42fv{border:1px solid var(--color-red) !important}span.faint.svelte-yg42fv{color:var(--text-faint)}")}function Fb(o,e,t){let r=o.slice();return r[22]=e[t],r}function Ab(o,e,t){let r=o.slice();return r[25]=e[t],r}function _D(o){let e,t,r,s,n,a,i;return{c(){e=T("input"),r=U(),s=T("button"),n=K("Join"),x(e,"type","text"),x(e,"placeholder","Enter share key"),e.disabled=o[3],x(e,"class",t=oa(o[2]?"system3-input-invalid":"")+" svelte-yg42fv"),x(s,"class","mod-cta"),s.disabled=o[3]},m(l,c){I(l,e,c),ir(e,o[1]),I(l,r,c),I(l,s,c),k(s,n),a||(i=[te(e,"input",o[13]),te(e,"input",o[9]),te(s,"click",function(){pt((0,Fs.debounce)(o[14]))&&(0,Fs.debounce)(o[14]).apply(this,arguments)})],a=!0)},p(l,c){o=l,c&8&&(e.disabled=o[3]),c&4&&t!==(t=oa(o[2]?"system3-input-invalid":"")+" svelte-yg42fv")&&x(e,"class",t),c&2&&e.value!==o[1]&&ir(e,o[1]),c&8&&(s.disabled=o[3])},d(l){l&&(C(e),C(r),C(s)),a=!1,Ce(i)}}}function SD(o){let e;return{c(){e=T("span"),e.textContent="Relay Servers",x(e,"slot","name"),de(e,"display","inline-flex"),de(e,"align-items","center")},m(t,r){I(t,e,r)},p:X,d(t){t&&C(e)}}}function kD(o){let e,t;function r(){return o[16](o[25])}return e=new ln({}),e.$on("settings",r),{c(){H(e.$$.fragment)},m(s,n){B(e,s,n),t=!0},p(s,n){o=s},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){N(e,s)}}}function CD(o){let e;return{c(){e=T("span"),e.textContent="(Untitled Relay Server)",x(e,"class","faint svelte-yg42fv")},m(t,r){I(t,e,r)},p:X,d(t){t&&C(e)}}}function ID(o){let e=o[25].name+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s&16&&e!==(e=r[25].name+"")&&ne(t,e)},d(r){r&&C(t)}}}function LD(o){let e;function t(n,a){return n[25].name?ID:CD}let r=t(o,-1),s=r(o);return{c(){s.c(),e=Ie()},m(n,a){s.m(n,a),I(n,e,a)},p(n,a){r===(r=t(n,a))&&s?s.p(n,a):(s.d(1),s=r(n),s&&(s.c(),s.m(e.parentNode,e)))},d(n){n&&C(e),s.d(n)}}}function TD(o){let e,t;return e=new Ds({props:{slot:"name",relay:o[25],t:"name",$$slots:{default:[LD]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[15]),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&16&&(n.relay=r[25]),s&268435472&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function Eb(o){let e,t;return e=new It({props:{$$slots:{name:[TD],default:[kD]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&268435472&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function PD(o){let e,t,r;return{c(){e=T("button"),e.textContent="Create",x(e,"class","mod-cta")},m(s,n){I(s,e,n),t||(r=te(e,"click",(0,Fs.debounce)(o[17])),t=!0)},p:X,d(s){s&&C(e),t=!1,r()}}}function Mb(o){let e,t;return e=new ze({props:{description:"Go to a Relay Server's settings page above to share existing folders, or add Shared Folders to your vault."}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function DD(o){let e,t,r;function s(){return o[20](o[22])}return e=new ln({}),e.$on("settings",function(){pt((0,Fs.debounce)(s))&&(0,Fs.debounce)(s).apply(this,arguments)}),{c(){H(e.$$.fragment),t=U()},m(n,a){B(e,n,a),I(n,t,a),r=!0},p(n,a){o=n},i(n){r||(S(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){n&&C(t),N(e,n)}}}function FD(o){var r;let e,t;return e=new Db({props:{folder:o[22],relay:(r=o[22].remote)==null?void 0:r.relay,slot:"name"}}),e.$on("manageRelay",o[18]),e.$on("manageSharedFolder",o[19]),{c(){H(e.$$.fragment)},m(s,n){B(e,s,n),t=!0},p(s,n){var i;let a={};n&32&&(a.folder=s[22]),n&32&&(a.relay=(i=s[22].remote)==null?void 0:i.relay),e.$set(a)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){N(e,s)}}}function Rb(o){let e,t;return e=new It({props:{$$slots:{name:[FD],default:[DD]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&268435504&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function AD(o){let e,t,r,s,n,a,i,l,c,u,d,m=o[5].items().length===0,g,h,_;e=new Je({props:{name:"Join a Relay Server"}}),r=new ze({props:{name:"Share key",description:"Enter the code that was shared with you.",$$slots:{default:[_D]},$$scope:{ctx:o}}}),n=new Je({props:{helpText:"A Relay Server coordinates real-time updates between collaborators. You can add collaborators and share folders on the Relay Server's settings page.",$$slots:{name:[SD]},$$scope:{ctx:o}}});let w=Ae(o[4].values().sort(Ob)),v=[];for(let D=0;D<w.length;D+=1)v[D]=Eb(Ab(o,w,D));let A=D=>P(v[D],1,1,()=>{v[D]=null});l=new ze({props:{name:"",description:"",$$slots:{default:[PD]},$$scope:{ctx:o}}}),u=new Je({props:{name:"Shared Folders",helpText:"Shared Folders enhance local folders by tracking edits. You can see what Relay Server a Shared Folder is connected to below."}});let O=m&&Mb(o),E=Ae(o[5].items()),M=[];for(let D=0;D<E.length;D+=1)M[D]=Rb(Fb(o,E,D));let R=D=>P(M[D],1,1,()=>{M[D]=null});return{c(){H(e.$$.fragment),t=U(),H(r.$$.fragment),s=U(),H(n.$$.fragment),a=U();for(let D=0;D<v.length;D+=1)v[D].c();i=U(),H(l.$$.fragment),c=U(),H(u.$$.fragment),d=U(),O&&O.c(),g=U();for(let D=0;D<M.length;D+=1)M[D].c();h=Ie()},m(D,F){B(e,D,F),I(D,t,F),B(r,D,F),I(D,s,F),B(n,D,F),I(D,a,F);for(let V=0;V<v.length;V+=1)v[V]&&v[V].m(D,F);I(D,i,F),B(l,D,F),I(D,c,F),B(u,D,F),I(D,d,F),O&&O.m(D,F),I(D,g,F);for(let V=0;V<M.length;V+=1)M[V]&&M[V].m(D,F);I(D,h,F),_=!0},p(D,[F]){let V={};F&268435470&&(V.$$scope={dirty:F,ctx:D}),r.$set(V);let q={};if(F&268435456&&(q.$$scope={dirty:F,ctx:D}),n.$set(q),F&144){w=Ae(D[4].values().sort(Ob));let z;for(z=0;z<w.length;z+=1){let Y=Ab(D,w,z);v[z]?(v[z].p(Y,F),S(v[z],1)):(v[z]=Eb(Y),v[z].c(),S(v[z],1),v[z].m(i.parentNode,i))}for(he(),z=w.length;z<v.length;z+=1)A(z);ge()}let j={};if(F&268435456&&(j.$$scope={dirty:F,ctx:D}),l.$set(j),F&32&&(m=D[5].items().length===0),m?O?F&32&&S(O,1):(O=Mb(D),O.c(),S(O,1),O.m(g.parentNode,g)):O&&(he(),P(O,1,1,()=>{O=null}),ge()),F&304){E=Ae(D[5].items());let z;for(z=0;z<E.length;z+=1){let Y=Fb(D,E,z);M[z]?(M[z].p(Y,F),S(M[z],1)):(M[z]=Rb(Y),M[z].c(),S(M[z],1),M[z].m(h.parentNode,h))}for(he(),z=E.length;z<M.length;z+=1)R(z);ge()}},i(D){if(!_){S(e.$$.fragment,D),S(r.$$.fragment,D),S(n.$$.fragment,D);for(let F=0;F<w.length;F+=1)S(v[F]);S(l.$$.fragment,D),S(u.$$.fragment,D),S(O);for(let F=0;F<E.length;F+=1)S(M[F]);_=!0}},o(D){P(e.$$.fragment,D),P(r.$$.fragment,D),P(n.$$.fragment,D),v=v.filter(Boolean);for(let F=0;F<v.length;F+=1)P(v[F]);P(l.$$.fragment,D),P(u.$$.fragment,D),P(O),M=M.filter(Boolean);for(let F=0;F<M.length;F+=1)P(M[F]);_=!1},d(D){D&&(C(t),C(s),C(a),C(i),C(c),C(d),C(g),C(h)),N(e,D),N(r,D),N(n,D),st(v,D),N(l,D),N(u,D),O&&O.d(D),st(M,D)}}}function Ob(o,e){return o.owner&&!e.owner?-1:e.owner&&!o.owner||o.name>e.name?1:-1}function ED(o,e,t){let r,s=X,n=()=>(s(),s=ar(l,j=>t(4,r=j)),l),a;o.$$.on_destroy.push(()=>s());let{plugin:i}=e,{relays:l}=e;n();let c=i.sharedFolders;me(o,c,j=>t(5,a=j));let u="",d=!1,m=!1,g=Kt();function h(j){j&&g("manageRelay",{relay:j})}function _(j,z){j&&g("manageSharedFolder",{folder:j,relay:z})}function w(){t(2,d=!1)}function v(j){return Ke(this,void 0,void 0,function*(){try{t(3,m=!0);let z=yield i.relayManager.acceptInvitation(j).catch(Y=>{throw Y.status===429&&new Fs.Notice("Slow down"),Y});t(3,m=!1),g("joinRelay",{relay:z})}catch(z){t(2,d=!0),t(3,m=!1)}})}function A(){g("createRelay")}function O(){u=this.value,t(1,u)}let E=()=>v(u);function M(j){to.call(this,o,j)}let R=j=>{h(j)},D=()=>A();function F(j){to.call(this,o,j)}function V(j){to.call(this,o,j)}let q=j=>{let z=r.values().find(Y=>{var pe;return((pe=j.remote)==null?void 0:pe.relay.guid)===Y.guid});_(j,z)};return o.$$set=j=>{"plugin"in j&&t(12,i=j.plugin),"relays"in j&&n(t(0,l=j.relays))},[l,u,d,m,r,a,c,h,_,w,v,A,i,O,E,M,R,D,F,V,q]}var Xp=class extends ee{constructor(e){super(),oe(this,e,ED,AD,Z,{plugin:12,relays:0},vD)}},ko=Xp;var Ze=require("obsidian");var aw=Bs(Ra());function MD(o){Pe(o,"svelte-15ov1wm",".lock-icon.svelte-15ov1wm{width:16px;height:16px;opacity:0.5;display:flex;align-items:center;justify-content:center}")}function RD(o){let e,t,r;return t=new Md({props:{class:"svg-icon"}}),{c(){e=T("span"),H(t.$$.fragment),x(e,"class","lock-icon svelte-15ov1wm")},m(s,n){I(s,e,n),B(t,e,null),r=!0},p:X,i(s){r||(S(t.$$.fragment,s),r=!0)},o(s){P(t.$$.fragment,s),r=!1},d(s){s&&C(e),N(t)}}}var Zp=class extends ee{constructor(e){super(),oe(this,e,null,RD,Z,{},MD)}},kc=Zp;function OD(o){let e,t,r,s,n,a,i,l,c;s=new vd({props:{size:16}});let u=o[3].default,d=ye(u,o,o[4],null);return{c(){e=T("span"),t=K(o[1]),r=U(),H(s.$$.fragment),n=U(),a=T("span"),d&&d.c(),x(e,"tabindex","0"),x(e,"role","button"),de(a,"flex","1"),de(a,"min-width","0"),de(a,"text-overflow","ellipsis"),de(a,"white-space","nowrap"),de(a,"overflow","hidden")},m(m,g){I(m,e,g),k(e,t),I(m,r,g),B(s,m,g),I(m,n,g),I(m,a,g),d&&d.m(a,null),i=!0,l||(c=[te(e,"click",o[2]),te(e,"keypress",o[2])],l=!0)},p(m,g){(!i||g&2)&&ne(t,m[1]),d&&d.p&&(!i||g&16)&&be(d,u,m,m[4],i?xe(u,m[4],g,null):we(m[4]),null)},i(m){i||(S(s.$$.fragment,m),S(d,m),i=!0)},o(m){P(s.$$.fragment,m),P(d,m),i=!1},d(m){m&&(C(e),C(r),C(n),C(a)),N(s,m),d&&d.d(m),l=!1,Ce(c)}}}function UD(o){let e,t,r;var s=o[0];function n(a,i){return{props:{$$slots:{default:[OD]},$$scope:{ctx:a}}}}return s&&(t=aa(s,n(o))),{c(){e=T("h4"),t&&H(t.$$.fragment)},m(a,i){I(a,e,i),t&&B(t,e,null),r=!0},p(a,[i]){if(i&1&&s!==(s=a[0])){if(t){he();let l=t;P(l.$$.fragment,1,0,()=>{N(l,1)}),ge()}s?(t=aa(s,n(a,i)),H(t.$$.fragment),S(t.$$.fragment,1),B(t,e,null)):t=null}else if(s){let l={};i&18&&(l.$$scope={dirty:i,ctx:a}),t.$set(l)}},i(a){r||(t&&S(t.$$.fragment,a),r=!0)},o(a){t&&P(t.$$.fragment,a),r=!1},d(a){a&&C(e),t&&N(t)}}}function $D(o,e,t){let{$$slots:r={},$$scope:s}=e,{category:n}=e,{categoryText:a}=e,i=Kt();function l(){i("goBack")}return o.$$set=c=>{"category"in c&&t(0,n=c.category),"categoryText"in c&&t(1,a=c.categoryText),"$$scope"in c&&t(4,s=c.$$scope)},[n,a,l,r,s]}var em=class extends ee{constructor(e){super(),oe(this,e,$D,UD,Z,{category:0,categoryText:1})}},Cc=em;function BD(o){Pe(o,"svelte-1ezpbya",'.system3-disk-usage-container.svelte-1ezpbya{width:100%;background-color:var(--interactive-normal);overflow:hidden}.system3-disk-usage-bar.svelte-1ezpbya{height:0.5rem;background-color:var(--color-accent);transition:width 0.6s ease}.system3-disk-usage-report.svelte-1ezpbya{text-align:center}.system3-disk-usage-bar[data-state="warning"].svelte-1ezpbya{height:0.3rem;background-color:var(--red);transition:width 0.6s ease}')}function ND(o){let e,t,r,s,n,a;return{c(){e=T("div"),t=T("div"),s=U(),n=T("div"),a=K(o[1]),x(t,"class","system3-disk-usage-bar svelte-1ezpbya"),de(t,"width",o[0]+"%"),x(t,"data-state",r=o[0]>90?"warning":""),x(e,"class","system3-disk-usage-container svelte-1ezpbya"),x(n,"class","system3-disk-usage-report svelte-1ezpbya")},m(i,l){I(i,e,l),k(e,t),I(i,s,l),I(i,n,l),k(n,a)},p(i,[l]){l&1&&de(t,"width",i[0]+"%"),l&1&&r!==(r=i[0]>90?"warning":"")&&x(t,"data-state",r),l&2&&ne(a,i[1])},i:X,o:X,d(i){i&&(C(e),C(s),C(n))}}}function HD(o,e,t){let{diskUsagePercentage:r=0}=e,{text:s=""}=e;return r=Math.max(0,r),r=Math.min(100,r),o.$$set=n=>{"diskUsagePercentage"in n&&t(0,r=n.diskUsagePercentage),"text"in n&&t(1,s=n.text)},[r,s]}var tm=class extends ee{constructor(e){super(),oe(this,e,HD,ND,Z,{diskUsagePercentage:0,text:1},BD)}},Ub=tm;var Lc=require("obsidian");function VD(o){let e,t,r=o[0].shared&&$b(o);return{c(){e=T("div"),r&&r.c(),x(e,"class","suggestion-icon")},m(s,n){I(s,e,n),r&&r.m(e,null),t=!0},p(s,n){s[0].shared?r?n&1&&S(r,1):(r=$b(s),r.c(),S(r,1),r.m(e,null)):r&&(he(),P(r,1,1,()=>{r=null}),ge())},i(s){t||(S(r),t=!0)},o(s){P(r),t=!1},d(s){s&&C(e),r&&r.d()}}}function qD(o){let e;return{c(){e=T("span"),e.textContent="Enter to create",x(e,"class","suggestion-action")},m(t,r){I(t,e,r)},p:X,i:X,o:X,d(t){t&&C(e)}}}function $b(o){let e,t;return e=new Xo({props:{class:"svg-icon"}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function WD(o){let e,t,r=o[0].folder+"",s,n,a,i,l,c,u=[qD,VD],d=[];function m(g,h){return g[0].exists?1:0}return i=m(o,-1),l=d[i]=u[i](o),{c(){e=T("div"),t=T("div"),s=K(r),n=U(),a=T("div"),l.c(),x(t,"class","suggestion-title"),x(e,"class","suggestion-content"),x(a,"class","suggestion-aux")},m(g,h){I(g,e,h),k(e,t),k(t,s),I(g,n,h),I(g,a,h),d[i].m(a,null),c=!0},p(g,[h]){(!c||h&1)&&r!==(r=g[0].folder+"")&&ne(s,r);let _=i;i=m(g,h),i===_?d[i].p(g,h):(he(),P(d[_],1,1,()=>{d[_]=null}),ge(),l=d[i],l?l.p(g,h):(l=d[i]=u[i](g),l.c()),S(l,1),l.m(a,null))},i(g){c||(S(l),c=!0)},o(g){P(l),c=!1},d(g){g&&(C(e),C(n),C(a)),d[i].d()}}}function zD(o,e,t){let{suggestion:r}=e;return o.$$set=s=>{"suggestion"in s&&t(0,r=s.suggestion)},[r]}var rm=class extends ee{constructor(e){super(),oe(this,e,zD,WD,Z,{suggestion:0})}},Bb=rm;var Ic=class extends Lc.SuggestModal{constructor(t,r,s){super(t);this.sharedFolders=r;this.onChoose=s;this.components=[];this.sharedPaths=new Set(this.sharedFolders.map(n=>n.path)),this.hasRemotes=new Set(this.sharedFolders.filter(n=>n.remote!==void 0).map(n=>n.path)),this.setInstructions([{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Choose and share folder"},{command:"Esc",purpose:"Cancel"}])}sortFn(t,r){return t.exists&&!r.exists?1:!t.exists&&r.exists||t.shared&&!r.shared?-1:r.shared&&!t.shared?1:t.folder.localeCompare(r.folder)}onClose(){super.onClose(),this.components.forEach(t=>{t.$destroy()})}getSuggestions(t){this.components.forEach(i=>{i.$destroy()});let r=t.toLowerCase(),s=[],n=this.app.vault.getAbstractFileByPath(t)!==null;t.length>0&&!n&&s.push({folder:t,exists:!1,shared:!1});let a=i=>{let l=this.sharedPaths.has(i.path),c=this.hasRemotes.has(i.path);if(i.path.toLowerCase().contains(r)&&i.path.length>1&&!c&&s.push({folder:i.path,exists:!0,shared:l}),!l)for(let u of i.children)u instanceof Lc.TFolder&&a(u)};return a(this.app.vault.getRoot()),s.sort(this.sortFn)}renderSuggestion(t,r){r.addClass("mod-complex");let s=new Bb({target:r,props:{suggestion:t}});this.components.push(s)}onChooseSuggestion(t,r){this.onChoose(t.folder)}};var zb=require("obsidian");var sm=require("obsidian");var Nb=require("obsidian"),Hb=require("obsidian"),Tc=class extends Hb.AbstractInputSuggest{constructor(t,r,s){super(t,s);this.app=t;this.sharedFolders=r;this.inputEl=s;this.sharedPaths=new Set(this.sharedFolders.map(n=>n.path))}getSuggestions(t){let r=t.toLowerCase(),s=[],n=a=>{if(!this.sharedPaths.has(a.path)){a.path.toLowerCase().contains(r)&&s.push(a.path);for(let l of a.children)l instanceof Nb.TFolder&&n(l)}};return n(this.app.vault.getRoot()),s}renderSuggestion(t,r){r.setText(t)}selectSuggestion(t){this.inputEl.value=t,this.inputEl.trigger("input"),this.close()}};function KD(o){let e,t,r,s;return{c(){e=T("div"),t=T("input"),x(t,"type","text"),x(t,"placeholder","/"),x(e,"class","folder-suggest-container")},m(n,a){I(n,e,a),k(e,t),o[5](t),ir(t,o[2]),r||(s=[te(t,"input",GD),te(t,"input",o[6])],r=!0)},p(n,[a]){a&4&&t.value!==n[2]&&ir(t,n[2])},i:X,o:X,d(n){n&&C(e),o[5](null),r=!1,Ce(s)}}}function GD(){}function jD(o,e,t){let r,s=X,n=()=>(s(),s=ar(u,g=>t(2,r=g)),u);o.$$.on_destroy.push(()=>s());let{app:a}=e,i,l,{sharedFolders:c}=e,{selectedFolder:u=_e()}=e;n(),lr(()=>{l=new Tc(a,c,i);let g=h=>{n(t(0,u=h.detail.folder.path))};return i.addEventListener("folder-selected",g),()=>{i.removeEventListener("folder-selected",g)}}),id(()=>{l&&l.close()});function d(g){Nr[g?"unshift":"push"](()=>{i=g,t(1,i)})}function m(){r=this.value,u.set(r)}return o.$$set=g=>{"app"in g&&t(3,a=g.app),"sharedFolders"in g&&t(4,c=g.sharedFolders),"selectedFolder"in g&&n(t(0,u=g.selectedFolder))},[u,i,r,a,c,d,m]}var om=class extends ee{constructor(e){super(),oe(this,e,jD,KD,Z,{app:3,sharedFolders:4,selectedFolder:0})}},Vb=om;function YD(o){Pe(o,"svelte-hgd3zf","span.error.svelte-hgd3zf{flex:auto;align-content:center}")}function JD(o){let e,t,r;return{c(){e=T("input"),x(e,"type","text")},m(s,n){I(s,e,n),ir(e,o[4]),t||(r=te(e,"input",o[8]),t=!0)},p(s,n){n&16&&e.value!==s[4]&&ir(e,s[4])},d(s){s&&C(e),t=!1,r()}}}function QD(o){let e,t;return e=new Vb({props:{app:o[0],sharedFolders:o[2],selectedFolder:o[7]}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&1&&(n.app=r[0]),s&4&&(n.sharedFolders=r[2]),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function qb(o){let e,t;return{c(){e=T("span"),t=K(o[5]),x(e,"class","mod-warning error svelte-hgd3zf")},m(r,s){I(r,e,s),k(e,t)},p(r,s){s&32&&ne(t,r[5])},d(r){r&&C(e)}}}function XD(o){let e,t,r,s,n,a,i,l,c,u,d,m,g;s=new ze({props:{name:"Folder name",description:"Set the name of the folder to be added.",$$slots:{default:[JD]},$$scope:{ctx:o}}}),a=new ze({props:{name:"Folder location",description:"Set the location in your vault.",$$slots:{default:[QD]},$$scope:{ctx:o}}});let h=o[5]&&qb(o);return{c(){e=T("div"),e.textContent="Add to vault",t=U(),r=T("div"),H(s.$$.fragment),n=U(),H(a.$$.fragment),i=U(),l=T("div"),h&&h.c(),c=U(),u=T("button"),u.textContent="Confirm",x(e,"class","modal-title"),x(u,"class","mod-cta"),x(l,"class","modal-button-container"),x(r,"class","modal-content")},m(_,w){I(_,e,w),I(_,t,w),I(_,r,w),B(s,r,null),k(r,n),B(a,r,null),k(r,i),k(r,l),h&&h.m(l,null),k(l,c),k(l,u),d=!0,m||(g=te(u,"click",function(){pt((0,sm.debounce)(o[9]))&&(0,sm.debounce)(o[9]).apply(this,arguments)}),m=!0)},p(_,[w]){o=_;let v={};w&1040&&(v.$$scope={dirty:w,ctx:o}),s.$set(v);let A={};w&1029&&(A.$$scope={dirty:w,ctx:o}),a.$set(A),o[5]?h?h.p(o,w):(h=qb(o),h.c(),h.m(l,c)):h&&(h.d(1),h=null)},i(_){d||(S(s.$$.fragment,_),S(a.$$.fragment,_),d=!0)},o(_){P(s.$$.fragment,_),P(a.$$.fragment,_),d=!1},d(_){_&&(C(e),C(t),C(r)),N(s),N(a),h&&h.d(),m=!1,g()}}}function ZD(o,e,t){let r,{app:s}=e,{remoteFolder:n}=e,{sharedFolders:a}=e,{onConfirm:i}=e,l=n.name,c=_e();me(o,c,g=>t(6,r=g));let u="";function d(){l=this.value,t(4,l)}let m=async()=>{i(n,l,r||"").catch(g=>{t(5,u=g.message)})};return o.$$set=g=>{"app"in g&&t(0,s=g.app),"remoteFolder"in g&&t(1,n=g.remoteFolder),"sharedFolders"in g&&t(2,a=g.sharedFolders),"onConfirm"in g&&t(3,i=g.onConfirm)},[s,n,a,i,l,u,r,c,d,m]}var nm=class extends ee{constructor(e){super(),oe(this,e,ZD,XD,Z,{app:0,remoteFolder:1,sharedFolders:2,onConfirm:3},YD)}},Wb=nm;var Pc=class extends zb.Modal{constructor(t,r,s,n){super(t);this.sharedFolders=r;this.remoteFolder=s;this.onConfirm=n;this.onConfirm=n}onOpen(){let{contentEl:t}=this;this.component=new Wb({target:t,props:{remoteFolder:this.remoteFolder,sharedFolders:this.sharedFolders,onConfirm:async(r,s,n)=>{await this.onConfirm(r,s,n),this.close()},app:this.app}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var im=Bs(Kb());function eF(o){Pe(o,"svelte-9fsa8q",".system3-settings-danger-zone.svelte-9fsa8q.svelte-9fsa8q{margin-top:6em}input.system3-updating.svelte-9fsa8q.svelte-9fsa8q{border:1px solid var(--color-accent) !important}input.system3-input-invalid.svelte-9fsa8q.svelte-9fsa8q{border:1px solid var(--color-red) !important}.faint.svelte-9fsa8q.svelte-9fsa8q{color:var(--text-faint)}.share-key-container.svelte-9fsa8q.svelte-9fsa8q{width:100%}.input-with-icon.svelte-9fsa8q.svelte-9fsa8q{position:relative;width:100%}.share-key-toggle-icon.svelte-9fsa8q.svelte-9fsa8q{position:relative}.share-key-toggle-icon.svelte-9fsa8q.svelte-9fsa8q{display:flex;align-items:center;justify-content:center;cursor:pointer;width:24px;height:24px;position:absolute;right:4px;top:50%;transform:translateY(-50%);border-radius:4px}.share-key-toggle-icon.svelte-9fsa8q.svelte-9fsa8q:hover{background-color:var(--background-modifier-hover)}.share-key-disabled-notice.svelte-9fsa8q.svelte-9fsa8q{color:var(--text-error) !important;font-size:0.85em !important}.input-with-icon.svelte-9fsa8q>input.svelte-9fsa8q{padding-right:28px}.input-like.svelte-9fsa8q.svelte-9fsa8q{align-content:space-around;display:inline-block;border:var(--input-border-width) solid var(--background-modifier-border) !important;height:var(--input-height) !important;-webkit-app-region:no-drag;background:var(--background-modifier-form-field);color:var(--text-normal);font-family:inherit;padding:4px 8px;font-size:var(--font-ui-small);border-radius:var(--input-radius);outline:none;padding-block:1px;overflow-clip-margin:0px !important;overflow:clip !important}#system3InviteSecret.svelte-9fsa8q.svelte-9fsa8q{padding:4px 28px 4px 8px !important;padding-inline:2px}")}function Gb(o,e,t){let r=o.slice();return r[68]=e[t],r}function jb(o,e,t){let r=o.slice();return r[71]=e[t],r}function tF(o){let e;return{c(){e=T("span"),e.textContent="(Untitled Relay Server)",x(e,"class","faint svelte-9fsa8q")},m(t,r){I(t,e,r)},p:X,d(t){t&&C(e)}}}function rF(o){let e=o[0].name+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s[0]&1&&e!==(e=r[0].name+"")&&ne(t,e)},d(r){r&&C(t)}}}function oF(o){let e;function t(n,a){return n[0].name?rF:tF}let r=t(o,[-1,-1,-1]),s=r(o);return{c(){s.c(),e=Ie()},m(n,a){s.m(n,a),I(n,e,a)},p(n,a){r===(r=t(n,a))&&s?s.p(n,a):(s.d(1),s=r(n),s&&(s.c(),s.m(e.parentNode,e)))},d(n){n&&C(e),s.d(n)}}}function Yb(o){let e,t;return e=new ze({props:{name:"Name",description:"Set the Relay Server's name.",$$slots:{default:[sF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&1065|s[2]&4096&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function sF(o){let e,t,r,s;return{c(){e=T("input"),x(e,"type","text"),x(e,"spellcheck","false"),x(e,"placeholder","Example: Shared Notes"),x(e,"class",t=oa((o[10]?"system3-updating":"")+(o[5]?"":" system3-input-invalid"))+" svelte-9fsa8q")},m(n,a){I(n,e,a),ir(e,o[0].name),o[45](e),r||(s=[te(e,"input",o[44]),te(e,"input",o[36])],r=!0)},p(n,a){a[0]&1056&&t!==(t=oa((n[10]?"system3-updating":"")+(n[5]?"":" system3-input-invalid"))+" svelte-9fsa8q")&&x(e,"class",t),a[0]&1&&e.value!==n[0].name&&ir(e,n[0].name)},d(n){n&&C(e),o[45](null),r=!1,Ce(s)}}}function nF(o){let e,t;return e=new It({props:{$$slots:{name:[cF],default:[iF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&2048|s[2]&4096&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function aF(o){let e,t;return e=new It({props:{$$slots:{name:[dF],default:[fF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&6144|s[2]&4096&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function iF(o){let e,t,r;function s(){return o[49](o[71])}return{c(){e=T("button"),e.textContent="Add to Vault",x(e,"class","mod-cta"),x(e,"aria-label","Add shared folder to vault"),de(e,"max-width","8em")},m(n,a){I(n,e,a),t||(r=te(e,"click",function(){pt((0,Ze.debounce)(s))&&(0,Ze.debounce)(s).apply(this,arguments)}),t=!0)},p(n,a){o=n},d(n){n&&C(e),t=!1,r()}}}function lF(o){let e=o[71].name+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s[0]&2048&&e!==(e=r[71].name+"")&&ne(t,e)},d(r){r&&C(t)}}}function cF(o){let e,t;return e=new So({props:{slot:"name",$$slots:{default:[lF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&2048|s[2]&4096&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function fF(o){let e,t;function r(){return o[48](o[71])}return e=new ln({}),e.$on("settings",function(){pt((0,Ze.debounce)(r))&&(0,Ze.debounce)(r).apply(this,arguments)}),{c(){H(e.$$.fragment)},m(s,n){B(e,s,n),t=!0},p(s,n){o=s},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){N(e,s)}}}function uF(o){let e=o[71].name+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s[0]&2048&&e!==(e=r[71].name+"")&&ne(t,e)},d(r){r&&C(t)}}}function dF(o){let e,t;function r(...s){return o[46](o[71],...s)}return e=new So({props:{folder:o[12].find(r),slot:"name",$$slots:{default:[uF]},$$scope:{ctx:o}}}),e.$on("manageSharedFolder",o[47]),{c(){H(e.$$.fragment)},m(s,n){B(e,s,n),t=!0},p(s,n){o=s;let a={};n[0]&6144&&(a.folder=o[12].find(r)),n[0]&2048|n[2]&4096&&(a.$$scope={dirty:n,ctx:o}),e.$set(a)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){N(e,s)}}}function Jb(o){let e,t,r,s,n;function a(...u){return o[43](o[71],...u)}let i=[aF,nF],l=[];function c(u,d){return d[0]&6144&&(e=null),e==null&&(e=!!u[12].find(a)),e?0:1}return t=c(o,[-1,-1,-1]),r=l[t]=i[t](o),{c(){r.c(),s=Ie()},m(u,d){l[t].m(u,d),I(u,s,d),n=!0},p(u,d){o=u;let m=t;t=c(o,d),t===m?l[t].p(o,d):(he(),P(l[m],1,1,()=>{l[m]=null}),ge(),r=l[t],r?r.p(o,d):(r=l[t]=i[t](o),r.c()),S(r,1),r.m(s.parentNode,s))},i(u){n||(S(r),n=!0)},o(u){P(r),n=!1},d(u){u&&C(s),l[t].d(u)}}}function pF(o){let e,t,r;return{c(){e=T("button"),e.textContent="Share a folder",x(e,"class","mod-cta"),x(e,"aria-label","Select a folder to share it with this Relay Server")},m(s,n){I(s,e,n),t||(r=te(e,"click",(0,Ze.debounce)(o[50])),t=!0)},p:X,d(s){s&&C(e),t=!1,r()}}}function mF(o){let e=o[13].values().length+"",t,r,s=o[8].userLimit+"",n;return{c(){t=K(e),r=K(" / "),n=K(s)},m(a,i){I(a,t,i),I(a,r,i),I(a,n,i)},p(a,i){i[0]&8192&&e!==(e=a[13].values().length+"")&&ne(t,e),i[0]&256&&s!==(s=a[8].userLimit+"")&&ne(n,s)},d(a){a&&(C(t),C(r),C(n))}}}function Qb(o){let e,t,r;function s(){return o[51](o[68])}return{c(){e=T("button"),e.textContent="Kick",x(e,"class","mod-destructive")},m(n,a){I(n,e,a),t||(r=te(e,"click",function(){pt((0,Ze.debounce)(s))&&(0,Ze.debounce)(s).apply(this,arguments)}),t=!0)},p(n,a){o=n},d(n){n&&C(e),t=!1,r()}}}function hF(o){let e,t=o[68].role==="Member"&&o[8].owner&&Qb(o);return{c(){t&&t.c(),e=U()},m(r,s){t&&t.m(r,s),I(r,e,s)},p(r,s){r[68].role==="Member"&&r[8].owner?t?t.p(r,s):(t=Qb(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&C(e),t&&t.d(r)}}}function Xb(o){let e,t;return e=new _c({props:{user:o[68].user,$$slots:{default:[hF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&8192&&(n.user=r[68].user),s[0]&8448|s[2]&4096&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function Zb(o){let e,t;return e=new kc({}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function gF(o){let e,t,r,s,n,a,i,l,c,u,d,m=!o[0].owner&&Zb(o);return{c(){e=T("div"),m&&m.c(),t=U(),r=T("div"),s=T("input"),a=U(),i=T("div"),x(s,"type","checkbox"),s.checked=o[7],s.disabled=n=!o[0].owner,x(i,"class","checkbox-toggle"),x(r,"role","checkbox"),x(r,"aria-checked",o[7]),x(r,"tabindex","0"),x(r,"class",l=o[0].owner?"checkbox-container":"checkbox-container checkbox-locked"),Be(r,"is-enabled",o[7]),x(e,"class","setting-item-control")},m(g,h){I(g,e,h),m&&m.m(e,null),k(e,t),k(e,r),k(r,s),k(r,a),k(r,i),c=!0,u||(d=[te(s,"change",o[52]),te(r,"keypress",o[53]),te(r,"click",o[54])],u=!0)},p(g,h){g[0].owner?m&&(he(),P(m,1,1,()=>{m=null}),ge()):m?h[0]&1&&S(m,1):(m=Zb(g),m.c(),S(m,1),m.m(e,t)),(!c||h[0]&128)&&(s.checked=g[7]),(!c||h[0]&1&&n!==(n=!g[0].owner))&&(s.disabled=n),(!c||h[0]&128)&&x(r,"aria-checked",g[7]),(!c||h[0]&1&&l!==(l=g[0].owner?"checkbox-container":"checkbox-container checkbox-locked"))&&x(r,"class",l),(!c||h[0]&129)&&Be(r,"is-enabled",g[7])},i(g){c||(S(m),c=!0)},o(g){P(m),c=!1},d(g){g&&C(e),m&&m.d(),u=!1,Ce(d)}}}function yF(o){let e;return{c(){e=T("div"),e.textContent="The owner of this Relay Server has disabled key sharing.",x(e,"class","setting-item-description mod-warning")},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function xF(o){let e;return{c(){e=T("div"),e.textContent="The owner of this Relay Server has enabled key sharing.",x(e,"class","setting-item-description")},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function bF(o){let e;return{c(){e=T("div"),e.textContent="Allow others to join this Relay Server with a Share Key.",x(e,"class","setting-item-description")},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function wF(o){let e;function t(n,a){return n[0].owner?bF:n[7]?xF:yF}let r=t(o,[-1,-1,-1]),s=r(o);return{c(){e=T("fragment"),s.c(),x(e,"slot","description")},m(n,a){I(n,e,a),s.m(e,null)},p(n,a){r!==(r=t(n,a))&&(s.d(1),s=r(n),s&&(s.c(),s.m(e,null)))},d(n){n&&C(e),s.d()}}}function ew(o){let e,t,r,s;e=new It({props:{name:"Share Key",description:"Share this key with your collaborators.",$$slots:{default:[CF]},$$scope:{ctx:o}}});let n=o[0].owner&&tw(o);return{c(){H(e.$$.fragment),t=U(),n&&n.c(),r=Ie()},m(a,i){B(e,a,i),I(a,t,i),n&&n.m(a,i),I(a,r,i),s=!0},p(a,i){let l={};i[0]&208|i[2]&4096&&(l.$$scope={dirty:i,ctx:a}),e.$set(l),a[0].owner?n?(n.p(a,i),i[0]&1&&S(n,1)):(n=tw(a),n.c(),S(n,1),n.m(r.parentNode,r)):n&&(he(),P(n,1,1,()=>{n=null}),ge())},i(a){s||(S(e.$$.fragment,a),S(n),s=!0)},o(a){P(e.$$.fragment,a),P(n),s=!1},d(a){a&&(C(t),C(r)),N(e,a),n&&n.d(a)}}}function vF(o){let e,t,r,s,n,a,i;function l(d,m){return d[6]?kF:SF}let c=l(o,[-1,-1,-1]),u=c(o);return{c(){e=T("div"),u.c(),t=U(),r=T("div"),x(r,"class","share-key-toggle-icon svelte-9fsa8q"),x(r,"role","button"),x(r,"tabindex","0"),x(r,"aria-label",s=o[6]?"Hide share key":"Show share key"),x(e,"class","input-with-icon svelte-9fsa8q")},m(d,m){I(d,e,m),u.m(e,null),k(e,t),k(e,r),a||(i=[Ql(n=o[32].call(null,r)),te(r,"click",o[55]),te(r,"keypress",o[56])],a=!0)},p(d,m){c===(c=l(d,m))&&u?u.p(d,m):(u.d(1),u=c(d),u&&(u.c(),u.m(e,t))),m[0]&64&&s!==(s=d[6]?"Hide share key":"Show share key")&&x(r,"aria-label",s)},d(d){d&&C(e),u.d(),a=!1,Ce(i)}}}function _F(o){let e;return{c(){e=T("span"),e.textContent="Share key is currently disabled",x(e,"role","button"),x(e,"tabindex","0"),x(e,"class","input-like share-key-disabled-notice svelte-9fsa8q")},m(t,r){I(t,e,r)},p:X,d(t){t&&C(e)}}}function SF(o){let e,t,r;return{c(){e=T("span"),e.textContent="\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",x(e,"role","button"),x(e,"tabindex","0"),x(e,"class","input-like svelte-9fsa8q"),x(e,"id","system3InviteSecret")},m(s,n){I(s,e,n),t||(r=[te(e,"click",(0,Ze.debounce)(o[40])),te(e,"keypress",(0,Ze.debounce)(o[40]))],t=!0)},p:X,d(s){s&&C(e),t=!1,Ce(r)}}}function kF(o){let e,t,r,s,n;return{c(){e=T("input"),e.value=t=o[4].key,x(e,"type","text"),e.readOnly=!0,x(e,"id","system3InviteLink"),e.disabled=r=!o[7],x(e,"class","svelte-9fsa8q")},m(a,i){I(a,e,i),s||(n=te(e,"click",(0,Ze.debounce)(o[40])),s=!0)},p(a,i){i[0]&16&&t!==(t=a[4].key)&&e.value!==t&&(e.value=t),i[0]&128&&r!==(r=!a[7])&&(e.disabled=r)},d(a){a&&C(e),s=!1,n()}}}function CF(o){let e;function t(n,a){return n[7]?vF:_F}let r=t(o,[-1,-1,-1]),s=r(o);return{c(){e=T("div"),s.c(),x(e,"class","share-key-container svelte-9fsa8q")},m(n,a){I(n,e,a),s.m(e,null)},p(n,a){r===(r=t(n,a))&&s?s.p(n,a):(s.d(1),s=r(n),s&&(s.c(),s.m(e,null)))},d(n){n&&C(e),s.d()}}}function tw(o){let e,t;return e=new ze({props:{name:"Rotate key",description:"Create a new share key. The old key will no longer work.",$$slots:{default:[IF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[2]&4096&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function IF(o){let e,t,r;return{c(){e=T("button"),e.textContent="Rotate key",x(e,"class","mod-destructive")},m(s,n){I(s,e,n),t||(r=te(e,"click",(0,Ze.debounce)(o[33])),t=!0)},p:X,d(s){s&&C(e),t=!1,r()}}}function LF(o){let e,t,r,s;return e=new Je({props:{name:"Membership"}}),r=new ze({props:{name:"Leave Relay Server",description:"Leave the Relay Server. Local data is preserved.",$$slots:{default:[PF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment),t=U(),H(r.$$.fragment)},m(n,a){B(e,n,a),I(n,t,a),B(r,n,a),s=!0},p(n,a){let i={};a[2]&4096&&(i.$$scope={dirty:a,ctx:n}),r.$set(i)},i(n){s||(S(e.$$.fragment,n),S(r.$$.fragment,n),s=!0)},o(n){P(e.$$.fragment,n),P(r.$$.fragment,n),s=!1},d(n){n&&C(t),N(e,n),N(r,n)}}}function TF(o){let e,t,r,s,n,a,i,l,c,u;e=new Je({props:{name:"Plan"}});let d=[FF,DF],m=[];function g(_,w){return _[14]?0:1}r=g(o,[-1,-1,-1]),s=m[r]=d[r](o);let h=o[15]&&o[15].quota>0&&sw(o);return i=new Je({props:{name:"Danger zone"}}),c=new ze({props:{name:"Destroy Relay Server",description:"This will destroy the Relay Server (deleting all data on the server). Local data is preserved.",$$slots:{default:[VF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment),t=U(),s.c(),n=U(),h&&h.c(),a=U(),H(i.$$.fragment),l=U(),H(c.$$.fragment)},m(_,w){B(e,_,w),I(_,t,w),m[r].m(_,w),I(_,n,w),h&&h.m(_,w),I(_,a,w),B(i,_,w),I(_,l,w),B(c,_,w),u=!0},p(_,w){let v=r;r=g(_,w),r===v?m[r].p(_,w):(he(),P(m[v],1,1,()=>{m[v]=null}),ge(),s=m[r],s?s.p(_,w):(s=m[r]=d[r](_),s.c()),S(s,1),s.m(n.parentNode,n)),_[15]&&_[15].quota>0?h?(h.p(_,w),w[0]&32768&&S(h,1)):(h=sw(_),h.c(),S(h,1),h.m(a.parentNode,a)):h&&(he(),P(h,1,1,()=>{h=null}),ge());let A={};w[0]&512|w[2]&4096&&(A.$$scope={dirty:w,ctx:_}),c.$set(A)},i(_){u||(S(e.$$.fragment,_),S(s),S(h),S(i.$$.fragment,_),S(c.$$.fragment,_),u=!0)},o(_){P(e.$$.fragment,_),P(s),P(h),P(i.$$.fragment,_),P(c.$$.fragment,_),u=!1},d(_){_&&(C(t),C(n),C(a),C(l)),N(e,_),m[r].d(_),h&&h.d(_),N(i,_),N(c,_)}}}function PF(o){let e,t,r;return{c(){e=T("button"),e.textContent="Leave",x(e,"class","mod-warning")},m(s,n){I(s,e,n),t||(r=te(e,"click",(0,Ze.debounce)(o[60])),t=!0)},p:X,d(s){s&&C(e),t=!1,r()}}}function DF(o){let e,t;return e=new ze({props:{name:`Plan: ${o[8].plan}`,description:o[8].cta||"Thanks for supporting Relay development",$$slots:{default:[AF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&256&&(n.name=`Plan: ${r[8].plan}`),s[0]&256&&(n.description=r[8].cta||"Thanks for supporting Relay development"),s[0]&256|s[2]&4096&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function FF(o){let e,t,r=!o[9].values()[0].active||o[9].values()[0].cancelAt,s,n;e=new ze({props:{name:`Plan: ${o[8].plan}`,description:"",$$slots:{description:[MF],default:[EF]},$$scope:{ctx:o}}});let a=r&&ow(o);return{c(){H(e.$$.fragment),t=U(),a&&a.c(),s=Ie()},m(i,l){B(e,i,l),I(i,t,l),a&&a.m(i,l),I(i,s,l),n=!0},p(i,l){let c={};l[0]&256&&(c.name=`Plan: ${i[8].plan}`),l[0]&17152|l[2]&4096&&(c.$$scope={dirty:l,ctx:i}),e.$set(c),l[0]&512&&(r=!i[9].values()[0].active||i[9].values()[0].cancelAt),r?a?(a.p(i,l),l[0]&512&&S(a,1)):(a=ow(i),a.c(),S(a,1),a.m(s.parentNode,s)):a&&(he(),P(a,1,1,()=>{a=null}),ge())},i(i){n||(S(e.$$.fragment,i),S(a),n=!0)},o(i){P(e.$$.fragment,i),P(a),n=!1},d(i){i&&(C(t),C(s)),N(e,i),a&&a.d(i)}}}function AF(o){let e,t,r;return{c(){e=T("button"),e.textContent="Upgrade",x(e,"class","mod-cta")},m(s,n){I(s,e,n),t||(r=te(e,"click",function(){pt((0,Ze.debounce)(o[59]))&&(0,Ze.debounce)(o[59]).apply(this,arguments)}),t=!0)},p(s,n){o=s},d(s){s&&C(e),t=!1,r()}}}function rw(o){let e,t,r;return{c(){e=T("button"),e.textContent="Cancel",x(e,"class","mod-destructive")},m(s,n){I(s,e,n),t||(r=te(e,"click",function(){pt((0,Ze.debounce)(o[58]))&&(0,Ze.debounce)(o[58]).apply(this,arguments)}),t=!0)},p(s,n){o=s},d(s){s&&C(e),t=!1,r()}}}function EF(o){let e,t,r=o[9].values()[0].active&&!o[9].values()[0].cancelAt,s,n,a,i=r&&rw(o);return{c(){e=T("button"),e.textContent="Manage",t=U(),i&&i.c(),s=Ie()},m(l,c){I(l,e,c),I(l,t,c),i&&i.m(l,c),I(l,s,c),n||(a=te(e,"click",function(){pt((0,Ze.debounce)(o[57]))&&(0,Ze.debounce)(o[57]).apply(this,arguments)}),n=!0)},p(l,c){o=l,c[0]&512&&(r=o[9].values()[0].active&&!o[9].values()[0].cancelAt),r?i?i.p(o,c):(i=rw(o),i.c(),i.m(s.parentNode,s)):i&&(i.d(1),i=null)},d(l){l&&(C(e),C(t),C(s)),i&&i.d(l),n=!1,a()}}}function MF(o){let e,t=o[8].cta+"",r;return{c(){e=T("fragment"),r=K(t),x(e,"slot","description")},m(s,n){I(s,e,n),k(e,r)},p(s,n){n[0]&256&&t!==(t=s[8].cta+"")&&ne(r,t)},d(s){s&&C(e)}}}function ow(o){let e,t;return e=new ze({props:{description:"",$$slots:{name:[OF],default:[RF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&512|s[2]&4096&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function RF(o){let e=o[17](o[9].values()[0].cancelAt)+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s[0]&512&&e!==(e=r[17](r[9].values()[0].cancelAt)+"")&&ne(t,e)},d(r){r&&C(t)}}}function OF(o){let e;return{c(){e=T("span"),e.textContent="Status: Cancelled",x(e,"slot","name"),x(e,"class","mod-warning")},m(t,r){I(t,e,r)},p:X,d(t){t&&C(e)}}}function sw(o){let e,t,r,s,n,a,i,l,c,u;return e=new Je({props:{name:"Storage"}}),r=new Ub({props:{diskUsagePercentage:Math.round(o[15].usage*100/o[15].quota)}}),n=new It({props:{name:"Usage",description:"Storage for images, audio, video, etc",$$slots:{default:[UF]},$$scope:{ctx:o}}}),i=new It({props:{name:"Total storage",description:"Total available storage.",$$slots:{default:[$F]},$$scope:{ctx:o}}}),c=new It({props:{name:"File size limit",description:"Maximum supported file size.",$$slots:{default:[BF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment),t=U(),H(r.$$.fragment),s=U(),H(n.$$.fragment),a=U(),H(i.$$.fragment),l=U(),H(c.$$.fragment)},m(d,m){B(e,d,m),I(d,t,m),B(r,d,m),I(d,s,m),B(n,d,m),I(d,a,m),B(i,d,m),I(d,l,m),B(c,d,m),u=!0},p(d,m){let g={};m[0]&32768&&(g.diskUsagePercentage=Math.round(d[15].usage*100/d[15].quota)),r.$set(g);let h={};m[0]&32768|m[2]&4096&&(h.$$scope={dirty:m,ctx:d}),n.$set(h);let _={};m[0]&32768|m[2]&4096&&(_.$$scope={dirty:m,ctx:d}),i.$set(_);let w={};m[0]&32768|m[2]&4096&&(w.$$scope={dirty:m,ctx:d}),c.$set(w)},i(d){u||(S(e.$$.fragment,d),S(r.$$.fragment,d),S(n.$$.fragment,d),S(i.$$.fragment,d),S(c.$$.fragment,d),u=!0)},o(d){P(e.$$.fragment,d),P(r.$$.fragment,d),P(n.$$.fragment,d),P(i.$$.fragment,d),P(c.$$.fragment,d),u=!1},d(d){d&&(C(t),C(s),C(a),C(l)),N(e,d),N(r,d),N(n,d),N(i,d),N(c,d)}}}function UF(o){let e=xa(o[15].usage)+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s[0]&32768&&e!==(e=xa(r[15].usage)+"")&&ne(t,e)},d(r){r&&C(t)}}}function $F(o){let e=xa(o[15].quota)+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s[0]&32768&&e!==(e=xa(r[15].quota)+"")&&ne(t,e)},d(r){r&&C(t)}}}function BF(o){let e=xa(o[15].maxFileSize)+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s[0]&32768&&e!==(e=xa(r[15].maxFileSize)+"")&&ne(t,e)},d(r){r&&C(t)}}}function NF(o){let e,t,r;return{c(){e=T("button"),e.textContent="Destroy",x(e,"class","mod-warning")},m(s,n){I(s,e,n),t||(r=te(e,"click",(0,Ze.debounce)(o[37])),t=!0)},p:X,d(s){s&&C(e),t=!1,r()}}}function HF(o){let e,t;return{c(){e=T("button"),e.textContent="Destroy",e.disabled=t=!0,x(e,"class","mod-warning"),x(e,"aria-label","Cancel subscription to destroy Relay Server.")},m(r,s){I(r,e,s)},p:X,d(r){r&&C(e)}}}function VF(o){let e,t;function r(a,i){return i[0]&512&&(e=null),e==null&&(e=a[9].values().length>0&&!a[9].values()[0].cancelAt),e?HF:NF}let s=r(o,[-1,-1,-1]),n=s(o);return{c(){n.c(),t=Ie()},m(a,i){n.m(a,i),I(a,t,i)},p(a,i){s===(s=r(a,i))&&n?n.p(a,i):(n.d(1),n=s(a),n&&(n.c(),n.m(t.parentNode,t)))},d(a){a&&C(t),n.d(a)}}}function qF(o){let e,t,r,s,n,a,i,l,c,u,d,m,g,h,_,w,v,A,O,E;e=new Cc({props:{category:Ds,categoryText:"Relay Servers",$$slots:{default:[oF]},$$scope:{ctx:o}}}),e.$on("goBack",o[28]);let M=o[0].owner&&Yb(o);s=new Je({props:{name:"Folders on this Relay Server"}});let R=Ae(o[11].values()),D=[];for(let G=0;G<R.length;G+=1)D[G]=Jb(jb(o,R,G));let F=G=>P(D[G],1,1,()=>{D[G]=null});i=new ze({props:{description:"",name:"",$$slots:{default:[pF]},$$scope:{ctx:o}}}),c=new Je({props:{name:"Users",$$slots:{default:[mF]},$$scope:{ctx:o}}});let V=Ae(o[13].values().sort(nw)),q=[];for(let G=0;G<V.length;G+=1)q[G]=Xb(Gb(o,V,G));let j=G=>P(q[G],1,1,()=>{q[G]=null});m=new Je({props:{name:"Sharing"}}),h=new It({props:{name:o[0].owner?"Enable key sharing":"Key sharing",$$slots:{description:[wF],default:[gF]},$$scope:{ctx:o}}});let z=o[7]&&ew(o),Y=[TF,LF],pe=[];function De(G,se){return G[8].owner?0:1}return v=De(o,[-1,-1,-1]),A=pe[v]=Y[v](o),{c(){H(e.$$.fragment),t=U(),M&&M.c(),r=U(),H(s.$$.fragment),n=U();for(let G=0;G<D.length;G+=1)D[G].c();a=U(),H(i.$$.fragment),l=U(),H(c.$$.fragment),u=U();for(let G=0;G<q.length;G+=1)q[G].c();d=U(),H(m.$$.fragment),g=U(),H(h.$$.fragment),_=U(),z&&z.c(),w=U(),A.c(),O=Ie()},m(G,se){B(e,G,se),I(G,t,se),M&&M.m(G,se),I(G,r,se),B(s,G,se),I(G,n,se);for(let ke=0;ke<D.length;ke+=1)D[ke]&&D[ke].m(G,se);I(G,a,se),B(i,G,se),I(G,l,se),B(c,G,se),I(G,u,se);for(let ke=0;ke<q.length;ke+=1)q[ke]&&q[ke].m(G,se);I(G,d,se),B(m,G,se),I(G,g,se),B(h,G,se),I(G,_,se),z&&z.m(G,se),I(G,w,se),pe[v].m(G,se),I(G,O,se),E=!0},p(G,se){let ke={};if(se[0]&1|se[2]&4096&&(ke.$$scope={dirty:se,ctx:G}),e.$set(ke),G[0].owner?M?(M.p(G,se),se[0]&1&&S(M,1)):(M=Yb(G),M.c(),S(M,1),M.m(r.parentNode,r)):M&&(he(),P(M,1,1,()=>{M=null}),ge()),se[0]&6144|se[1]&272){R=Ae(G[11].values());let W;for(W=0;W<R.length;W+=1){let Fe=jb(G,R,W);D[W]?(D[W].p(Fe,se),S(D[W],1)):(D[W]=Jb(Fe),D[W].c(),S(D[W],1),D[W].m(a.parentNode,a))}for(he(),W=R.length;W<D.length;W+=1)F(W);ge()}let Qe={};se[2]&4096&&(Qe.$$scope={dirty:se,ctx:G}),i.$set(Qe);let Re={};if(se[0]&8448|se[2]&4096&&(Re.$$scope={dirty:se,ctx:G}),c.$set(Re),se[0]&8448|se[1]&128){V=Ae(G[13].values().sort(nw));let W;for(W=0;W<V.length;W+=1){let Fe=Gb(G,V,W);q[W]?(q[W].p(Fe,se),S(q[W],1)):(q[W]=Xb(Fe),q[W].c(),S(q[W],1),q[W].m(d.parentNode,d))}for(he(),W=V.length;W<q.length;W+=1)j(W);ge()}let ce={};se[0]&1&&(ce.name=G[0].owner?"Enable key sharing":"Key sharing"),se[0]&129|se[2]&4096&&(ce.$$scope={dirty:se,ctx:G}),h.$set(ce),G[7]?z?(z.p(G,se),se[0]&128&&S(z,1)):(z=ew(G),z.c(),S(z,1),z.m(w.parentNode,w)):z&&(he(),P(z,1,1,()=>{z=null}),ge());let le=v;v=De(G,se),v===le?pe[v].p(G,se):(he(),P(pe[le],1,1,()=>{pe[le]=null}),ge(),A=pe[v],A?A.p(G,se):(A=pe[v]=Y[v](G),A.c()),S(A,1),A.m(O.parentNode,O))},i(G){if(!E){S(e.$$.fragment,G),S(M),S(s.$$.fragment,G);for(let se=0;se<R.length;se+=1)S(D[se]);S(i.$$.fragment,G),S(c.$$.fragment,G);for(let se=0;se<V.length;se+=1)S(q[se]);S(m.$$.fragment,G),S(h.$$.fragment,G),S(z),S(A),E=!0}},o(G){P(e.$$.fragment,G),P(M),P(s.$$.fragment,G),D=D.filter(Boolean);for(let se=0;se<D.length;se+=1)P(D[se]);P(i.$$.fragment,G),P(c.$$.fragment,G),q=q.filter(Boolean);for(let se=0;se<q.length;se+=1)P(q[se]);P(m.$$.fragment,G),P(h.$$.fragment,G),P(z),P(A),E=!1},d(G){G&&(C(t),C(r),C(n),C(a),C(l),C(u),C(d),C(g),C(_),C(w),C(O)),N(e,G),M&&M.d(G),N(s,G),st(D,G),N(i,G),N(c,G),st(q,G),N(m,G),N(h,G),z&&z.d(G),pe[v].d(G)}}}function xa(o,e=2){if(o===0)return"0 MB";let t=1024,r=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],s=Math.floor(Math.log(o)/Math.log(t));return(o/Math.pow(t,s)).toFixed(e)+" "+r[s]}function nw(o,e){return o.role==="Owner"&&e.role!=="Owner"?-1:o.role!=="Owner"&&e.role==="Owner"||o.user.name>e.user.name?1:-1}function WF(o){if(/[\\:*?"<>|]/.test(o))return!1;let t=o.split("/");for(let r of t)if(r===""||r==="."||r==="..")return!1;return!0}function zF(o,e,t){let r,s,n,a,i,l=X,c=()=>(l(),l=ar(q,re=>t(63,i=re)),q),u,d=X,m=()=>(d(),d=ar(R,re=>t(8,u=re)),R),g,h,_,w,v=X,A=()=>(v(),v=ar(V,re=>t(12,w=re)),V),O,E,M;o.$$.on_destroy.push(()=>l()),o.$$.on_destroy.push(()=>d()),o.$$.on_destroy.push(()=>v());let{relay:R}=e;m();let D=R.folders;me(o,D,re=>t(11,_=re));let{plugin:F}=e,{sharedFolders:V}=e;A();let{relayRoles:q}=e;c();function j(re){if(!re)return"Active";let Oe=(0,im.default)(),Pt=(0,im.default)(re).diff(Oe,"days");return Pt<=0?"Subscription has ended":Pt===1?"Active for 1 more day":`Active for ${Pt} more days`}let z=u.subscriptions;me(o,z,re=>t(9,g=re));let Y=ro(g,re=>{if(re.values().length===0)return;let Oe=re.values()[0];return Oe.token||F.relayManager.getSubscriptionToken(Oe).then(ft=>{Oe.token=ft}),Oe});me(o,Y,re=>t(14,E=re));let pe=u.storageQuota;me(o,pe,re=>t(15,M=re));let De=i.filter(re=>re.relayId===R.id);me(o,De,re=>t(13,O=re));let G=_e(!0);me(o,G,re=>t(5,r=re));let se;lr(()=>{se&&se.value===""&&se.focus()});let ke=Kt();function Qe(re){return Ke(this,void 0,void 0,function*(){var Oe;if(!(!((Oe=F.loginManager)===null||Oe===void 0)&&Oe.user))return;let ft={relay:re.id,quantity:10,user_email:F.loginManager.user.email},Pt=btoa(JSON.stringify(ft)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(F.buildApiUrl(`/subscribe/${Pt}`),"_blank")})}function Re(re){return Ke(this,void 0,void 0,function*(){let Oe=re.token,ft=re.id;window.open(F.buildApiUrl(`/subscriptions/${ft}/manage?token=${Oe}`),"_blank")})}function ce(re){return Ke(this,void 0,void 0,function*(){let Oe=re.token,ft=re.id;window.open(F.buildApiUrl(`/subscriptions/${ft}/cancel?token=${Oe}`),"_blank")})}function le(re){R.owner&&(mt.set(re),F.relayManager.toggleRelayInvitation(Ye,a).then(Oe=>{mt.set(Oe.enabled)}))}function W(){return Ke(this,void 0,void 0,function*(){F.relayManager.leaveRelay(R),ke("goBack",{clear:!0})})}function Fe(){return Ke(this,void 0,void 0,function*(){ke("goBack",{clear:!0})})}let Ye,vt=_e(!1);me(o,vt,re=>t(6,s=re));let mt=_e(!0);me(o,mt,re=>t(7,a=re));let _t,ct=_e(!1);me(o,ct,re=>t(62,n=re));function yt(re){_t=re;let Oe=()=>{n?((0,Ze.setIcon)(re,"clipboard-check"),re.addClass("mod-success")):((0,Ze.setIcon)(re,s?"eye-off":"eye"),re.removeClass("mod-success"))},ft=vt.subscribe(()=>{Oe()}),Pt=ct.subscribe(()=>{Oe()});return Oe(),{destroy(){ft(),Pt()}}}F.relayManager.getRelayInvitation(R).then(re=>{re&&(t(4,Ye=re),mt.set(re.enabled))});function Qt(){return Ke(this,void 0,void 0,function*(){Ye&&t(4,Ye=yield F.relayManager.rotateKey(Ye).catch(re=>{throw re.status===429&&new Ze.Notice("Slow down"),re}))})}function Ms(re,Oe,ft){return Ke(this,void 0,void 0,function*(){let Pt=(0,Ze.normalizePath)((0,aw.join)(ft,Oe));F.vault.getFolderByPath(Pt)===null&&(yield F.vault.createFolder(Pt));let no=F.sharedFolders.new(Pt,re.guid,R.guid,!0);return no.remote=re,F.sharedFolders.notifyListeners(),no})}let Io=_e(!1);me(o,Io,re=>t(10,h=re));let va=F.timeProvider.debounce(()=>{F.relayManager.updateRelay(R).then(()=>{Io.set(!1)})},500),dn=re=>{new Pc(F.app,V,re,Ms).open()};function pn(){G.set(WF(se.value)),r&&se.value!==""&&(Io.set(!0),va())}function _a(){F.relayManager.destroyRelay(R),ke("goBack",{})}function xr(re){F.relayManager.kick(re)}function at(re,Oe){re&&ke("manageSharedFolder",{folder:re,relay:Oe,mount:!1})}function Xt(re){let Oe=re.target;Oe.focus(),Oe.select(),navigator.clipboard.writeText(Oe.value).then(()=>new Ze.Notice("Invite link copied")).catch(ft=>{})}function Lo(re){Ye&&navigator.clipboard.writeText(Ye.key).then(()=>{new Ze.Notice("Invite link copied"),ct.set(!0),setTimeout(()=>{ct.set(!1)},800)}).catch(Oe=>{})}let ns=new Ic(F.app,V,re=>Ke(void 0,void 0,void 0,function*(){let Oe=(0,Ze.normalizePath)(re),ft=V.find(ls=>ls.path==re);if(ft){let ls=yield F.relayManager.createRemoteFolder(ft,R);ft.remote=ls,ft.connect(),F.sharedFolders.notifyListeners();return}F.vault.getFolderByPath(Oe)===null&&(yield F.vault.createFolder(Oe));let Pt=Rn(),no=F.sharedFolders.new((0,Ze.normalizePath)(re),Pt,R.guid,!0),rf=yield F.relayManager.createRemoteFolder(no,R);no.remote=rf,F.sharedFolders.notifyListeners()})),Tt=(re,Oe)=>Oe.remote===re;function Sa(){R.name=this.value,m(t(0,R))}function as(re){Nr[re?"unshift":"push"](()=>{se=re,t(3,se)})}let Yt=(re,Oe)=>Oe.remote===re;function $e(re){to.call(this,o,re)}let so=re=>{let Oe=w.find(ft=>ft.remote===re);Oe&&at(Oe,re.relay)},is=re=>{dn(re)},mn=()=>{ns.open()},ka=re=>{xr(re)},Ca=re=>le(re.currentTarget.checked),hn=()=>le(!a),Vt=()=>le(!a),gn=()=>vt.update(re=>!re),Rs=()=>vt.update(re=>!re),Q=()=>{Re(E)},ue=()=>{ce(E)},ot=()=>{Qe(u)},Hr=()=>{W()};return o.$$set=re=>{"relay"in re&&m(t(0,R=re.relay)),"plugin"in re&&t(42,F=re.plugin),"sharedFolders"in re&&A(t(1,V=re.sharedFolders)),"relayRoles"in re&&c(t(2,q=re.relayRoles))},[R,V,q,se,Ye,r,s,a,u,g,h,_,w,O,E,M,D,j,z,Y,pe,De,G,Qe,Re,ce,le,W,Fe,vt,mt,ct,yt,Qt,Io,dn,pn,_a,xr,at,Lo,ns,F,Tt,Sa,as,Yt,$e,so,is,mn,ka,Ca,hn,Vt,gn,Rs,Q,ue,ot,Hr]}var lm=class extends ee{constructor(e){super(),oe(this,e,zF,qF,Z,{relay:0,plugin:42,sharedFolders:1,relayRoles:2},eF,[-1,-1,-1])}},ba=lm;function KF(o){let e,t,r,s,n,a;return r=new bd({}),{c(){e=T("div"),t=T("div"),H(r.$$.fragment),x(t,"class","clickable-icon"),x(t,"aria-label","Back"),x(t,"tabindex","0"),x(t,"role","button"),x(e,"class","modal-setting-nav-bar")},m(i,l){I(i,e,l),k(e,t),B(r,t,null),s=!0,n||(a=[te(t,"click",o[0]),te(t,"keypress",o[1])],n=!0)},p:X,i(i){s||(S(r.$$.fragment,i),s=!0)},o(i){P(r.$$.fragment,i),s=!1},d(i){i&&C(e),N(r),n=!1,Ce(a)}}}function GF(o){let e=Kt();function t(){e("goBack",{})}function r(s){s.key==="Escape"&&(e("goBack",{}),s.stopPropagation())}return[t,r]}var cm=class extends ee{constructor(e){super(),oe(this,e,GF,KF,Z,{})}},iw=cm;var As=require("obsidian");function lw(o,e,t){let r=o.slice();return r[32]=e[t][0],r[33]=e[t][1],r}function jF(o){let e=o[1].name+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s[0]&2&&e!==(e=r[1].name+"")&&ne(t,e)},d(r){r&&C(t)}}}function YF(o){let e,t;return e=new ze({props:{description:"This folder is tracking edits, but is not connected to a Relay Server."}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p:X,i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function JF(o){let e,t;return e=new It({props:{$$slots:{name:[ZF],default:[QF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&128|s[1]&32&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function QF(o){let e,t;return e=new ln({}),e.$on("settings",function(){pt((0,As.debounce)(o[22]))&&(0,As.debounce)(o[22]).apply(this,arguments)}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){o=r},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function XF(o){let e=o[7].name+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s[0]&128&&e!==(e=r[7].name+"")&&ne(t,e)},d(r){r&&C(t)}}}function ZF(o){let e,t;return e=new Ds({props:{slot:"name",relay:o[7],$$slots:{default:[XF]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[21]),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&128&&(n.relay=r[7]),s[0]&128|s[1]&32&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function cw(o){let e,t,r,s,n;e=new Je({props:{name:"Sync settings",helpText:"You must have attachment storage available in order to sync attachments."}});let a=Ae(o[4]),i=[];for(let u=0;u<a.length;u+=1)i[u]=uw(lw(o,a,u));let l=u=>P(i[u],1,1,()=>{i[u]=null}),c=o[6]&&o[7]&&dw(o);return{c(){H(e.$$.fragment),t=U();for(let u=0;u<i.length;u+=1)i[u].c();r=U(),c&&c.c(),s=Ie()},m(u,d){B(e,u,d),I(u,t,d);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(u,d);I(u,r,d),c&&c.m(u,d),I(u,s,d),n=!0},p(u,d){if(d[0]&16728){a=Ae(u[4]);let m;for(m=0;m<a.length;m+=1){let g=lw(u,a,m);i[m]?(i[m].p(g,d),S(i[m],1)):(i[m]=uw(g),i[m].c(),S(i[m],1),i[m].m(r.parentNode,r))}for(he(),m=a.length;m<i.length;m+=1)l(m);ge()}u[6]&&u[7]?c?(c.p(u,d),d[0]&192&&S(c,1)):(c=dw(u),c.c(),S(c,1),c.m(s.parentNode,s)):c&&(he(),P(c,1,1,()=>{c=null}),ge())},i(u){if(!n){S(e.$$.fragment,u);for(let d=0;d<a.length;d+=1)S(i[d]);S(c),n=!0}},o(u){P(e.$$.fragment,u),i=i.filter(Boolean);for(let d=0;d<i.length;d+=1)P(i[d]);P(c),n=!1},d(u){u&&(C(t),C(r),C(s)),N(e,u),st(i,u),c&&c.d(u)}}}function fw(o){let e,t;return e=new kc({}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function eA(o){let e,t,r,s,n,a,i,l,c,u,d,m=o[6]&&fw(o);function g(...w){return o[23](o[32],...w)}function h(){return o[24](o[32])}function _(){return o[25](o[32])}return{c(){e=T("div"),m&&m.c(),t=U(),r=T("div"),s=T("input"),a=U(),i=T("div"),x(s,"type","checkbox"),s.checked=n=o[8][o[32]]&&!o[6],s.disabled=o[3],x(i,"class","checkbox-toggle"),x(r,"role","checkbox"),x(r,"aria-checked",l=o[8][o[32]]&&!o[6]),x(r,"tabindex","0"),x(r,"class","checkbox-container"),Be(r,"is-enabled",o[8][o[32]]&&!o[6]),x(e,"class","setting-item-control")},m(w,v){I(w,e,v),m&&m.m(e,null),k(e,t),k(e,r),k(r,s),k(r,a),k(r,i),c=!0,u||(d=[te(s,"change",g),te(r,"keypress",h),te(r,"click",_)],u=!0)},p(w,v){o=w,o[6]?m?v[0]&64&&S(m,1):(m=fw(o),m.c(),S(m,1),m.m(e,t)):m&&(he(),P(m,1,1,()=>{m=null}),ge()),(!c||v[0]&336&&n!==(n=o[8][o[32]]&&!o[6]))&&(s.checked=n),(!c||v[0]&8)&&(s.disabled=o[3]),(!c||v[0]&336&&l!==(l=o[8][o[32]]&&!o[6]))&&x(r,"aria-checked",l),(!c||v[0]&336)&&Be(r,"is-enabled",o[8][o[32]]&&!o[6])},i(w){c||(S(m),c=!0)},o(w){P(m),c=!1},d(w){w&&C(e),m&&m.d(),u=!1,Ce(d)}}}function uw(o){let e,t;return e=new It({props:{name:o[33].name,description:o[33].description,$$slots:{default:[eA]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&16&&(n.name=r[33].name),s[0]&16&&(n.description=r[33].description),s[0]&344|s[1]&32&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function dw(o){let e,t;return e=new It({props:{name:"",$$slots:{default:[tA]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&128|s[1]&32&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function tA(o){let e,t,r;return{c(){e=T("button"),e.textContent="Buy storage",x(e,"class","mod-cta")},m(s,n){I(s,e,n),t||(r=te(e,"click",function(){pt((0,As.debounce)(o[26]))&&(0,As.debounce)(o[26]).apply(this,arguments)}),t=!0)},p(s,n){o=s},d(s){s&&C(e),t=!1,r()}}}function rA(o){let e,t,r;return{c(){e=T("button"),e.textContent="Delete local",x(e,"class","mod-warning")},m(s,n){I(s,e,n),t||(r=te(e,"click",(0,As.debounce)(o[27])),t=!0)},p:X,d(s){s&&C(e),t=!1,r()}}}function oA(o){let e,t,r,s,n,a,i;return{c(){e=T("button"),t=K("Delete metadata"),x(e,"class",r=o[7]?"mod-disabled":"mod-warning"),e.disabled=s=!!o[7],x(e,"aria-label",n=o[7]?"Metadata is required for sharing.":"")},m(l,c){I(l,e,c),k(e,t),a||(i=te(e,"click",(0,As.debounce)(o[28])),a=!0)},p(l,c){c[0]&128&&r!==(r=l[7]?"mod-disabled":"mod-warning")&&x(e,"class",r),c[0]&128&&s!==(s=!!l[7])&&(e.disabled=s),c[0]&128&&n!==(n=l[7]?"Metadata is required for sharing.":"")&&x(e,"aria-label",n)},d(l){l&&C(e),a=!1,i()}}}function pw(o){var s,n,a,i,l;let e,t,r=(((s=o[7])==null?void 0:s.owner)||((i=(a=(n=o[5])==null?void 0:n.remote)==null?void 0:a.creator)==null?void 0:i.id)===((l=o[0].relayManager.user)==null?void 0:l.id))&&mw(o);return{c(){r&&r.c(),e=Ie()},m(c,u){r&&r.m(c,u),I(c,e,u),t=!0},p(c,u){var d,m,g,h,_;(d=c[7])!=null&&d.owner||((h=(g=(m=c[5])==null?void 0:m.remote)==null?void 0:g.creator)==null?void 0:h.id)===((_=c[0].relayManager.user)==null?void 0:_.id)?r?(r.p(c,u),u[0]&161&&S(r,1)):(r=mw(c),r.c(),S(r,1),r.m(e.parentNode,e)):r&&(he(),P(r,1,1,()=>{r=null}),ge())},i(c){t||(S(r),t=!0)},o(c){P(r),t=!1},d(c){c&&C(e),r&&r.d(c)}}}function mw(o){let e,t,r,s;return e=new Je({props:{name:"Remote Folder"}}),r=new ze({props:{name:"Remove from relay",description:"Deletes the remote folder from the relay. Local files will be preserved.",$$slots:{default:[sA]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment),t=U(),H(r.$$.fragment)},m(n,a){B(e,n,a),I(n,t,a),B(r,n,a),s=!0},p(n,a){let i={};a[1]&32&&(i.$$scope={dirty:a,ctx:n}),r.$set(i)},i(n){s||(S(e.$$.fragment,n),S(r.$$.fragment,n),s=!0)},o(n){P(e.$$.fragment,n),P(r.$$.fragment,n),s=!1},d(n){n&&C(t),N(e,n),N(r,n)}}}function sA(o){let e,t,r;return{c(){e=T("button"),e.textContent="Delete remote",x(e,"class","mod-destructive")},m(s,n){I(s,e,n),t||(r=te(e,"click",(0,As.debounce)(o[17])),t=!0)},p:X,d(s){s&&C(e),t=!1,r()}}}function nA(o){let e,t,r,s,n,a,i,l=o[7]&&Ge().enableAttachmentSync,c,u,d,m,g,h,_,w,v;e=new Cc({props:{category:So,categoryText:"Shared Folders",$$slots:{default:[jF]},$$scope:{ctx:o}}}),e.$on("goBack",o[15]),r=new Je({props:{name:"Relay Server"}});let A=[JF,YF],O=[];function E(D,F){return D[7]?0:1}n=E(o,[-1,-1]),a=O[n]=A[n](o);let M=l&&cw(o);u=new Je({props:{name:"Local folder"}}),m=new ze({props:{name:"Delete from vault",description:"Delete the local Shared Folder and all of its contents.",$$slots:{default:[rA]},$$scope:{ctx:o}}}),h=new ze({props:{name:"Delete metadata",description:"Deletes edit history and disables change tracking.",$$slots:{default:[oA]},$$scope:{ctx:o}}});let R=o[7]&&pw(o);return{c(){H(e.$$.fragment),t=U(),H(r.$$.fragment),s=U(),a.c(),i=U(),M&&M.c(),c=U(),H(u.$$.fragment),d=U(),H(m.$$.fragment),g=U(),H(h.$$.fragment),_=U(),R&&R.c(),w=Ie()},m(D,F){B(e,D,F),I(D,t,F),B(r,D,F),I(D,s,F),O[n].m(D,F),I(D,i,F),M&&M.m(D,F),I(D,c,F),B(u,D,F),I(D,d,F),B(m,D,F),I(D,g,F),B(h,D,F),I(D,_,F),R&&R.m(D,F),I(D,w,F),v=!0},p(D,F){let V={};F[0]&2|F[1]&32&&(V.$$scope={dirty:F,ctx:D}),e.$set(V);let q=n;n=E(D,F),n===q?O[n].p(D,F):(he(),P(O[q],1,1,()=>{O[q]=null}),ge(),a=O[n],a?a.p(D,F):(a=O[n]=A[n](D),a.c()),S(a,1),a.m(i.parentNode,i)),F[0]&128&&(l=D[7]&&Ge().enableAttachmentSync),l?M?(M.p(D,F),F[0]&128&&S(M,1)):(M=cw(D),M.c(),S(M,1),M.m(c.parentNode,c)):M&&(he(),P(M,1,1,()=>{M=null}),ge());let j={};F[1]&32&&(j.$$scope={dirty:F,ctx:D}),m.$set(j);let z={};F[0]&128|F[1]&32&&(z.$$scope={dirty:F,ctx:D}),h.$set(z),D[7]?R?(R.p(D,F),F[0]&128&&S(R,1)):(R=pw(D),R.c(),S(R,1),R.m(w.parentNode,w)):R&&(he(),P(R,1,1,()=>{R=null}),ge())},i(D){v||(S(e.$$.fragment,D),S(r.$$.fragment,D),S(a),S(M),S(u.$$.fragment,D),S(m.$$.fragment,D),S(h.$$.fragment,D),S(R),v=!0)},o(D){P(e.$$.fragment,D),P(r.$$.fragment,D),P(a),P(M),P(u.$$.fragment,D),P(m.$$.fragment,D),P(h.$$.fragment,D),P(R),v=!1},d(D){D&&(C(t),C(s),C(i),C(c),C(d),C(g),C(_),C(w)),N(e,D),N(r,D),O[n].d(D),M&&M.d(D),N(u,D),N(m,D),N(h,D),R&&R.d(D)}}}function aA(o,e,t){let r,s,n,a,i=X,l=()=>(i(),i=ar(g,ce=>t(29,a=ce)),g),c,u;o.$$.on_destroy.push(()=>i());let{plugin:d}=e,{sharedFolder:m}=e,{sharedFolders:g}=e;l();let{relayRoles:h}=e;function _(ce){return Ke(this,void 0,void 0,function*(){var le;if(!(!((le=d.loginManager)===null||le===void 0)&&le.user))return;let W={relay:ce.id,quantity:10,user_email:d.loginManager.user.email},Fe=btoa(JSON.stringify(W)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(d.buildApiUrl(`/subscribe/${Fe}?action="buy_storage"`),"_blank")})}let w=ro(a,ce=>ce.find(le=>le===m));me(o,w,ce=>t(5,s=ce));let v=m.syncSettingsManager;me(o,v,ce=>t(8,u=ce));let A=ro([w,h],([ce,le])=>{var W;return(W=le.find(Fe=>{var Ye;return Fe.relay===((Ye=ce==null?void 0:ce.remote)===null||Ye===void 0?void 0:Ye.relay)}))===null||W===void 0?void 0:W.relay});me(o,A,ce=>t(7,c=ce));let O=ro([w,h],([ce,le])=>{var W,Fe,Ye;return((Ye=(Fe=(W=le.find(vt=>{var mt;return vt.relay===((mt=ce==null?void 0:ce.remote)===null||mt===void 0?void 0:mt.relay)}))===null||W===void 0?void 0:W.relay)===null||Fe===void 0?void 0:Fe.storageQuota)===null||Ye===void 0?void 0:Ye.quota)===0});me(o,O,ce=>t(6,n=ce));let E=!1;function M(ce,le){return Ke(this,void 0,void 0,function*(){if(!E&&!n){t(3,E=!0);try{yield v.toggleCategory(ce,le),t(4,r=Object.entries(v.getCategories()))}catch(W){}finally{t(3,E=!1)}}})}let R;lr(()=>{!m&&R&&R.value===""&&R.focus()});let D=Kt();function F(){return Ke(this,void 0,void 0,function*(){D("goBack",{clear:!0})})}function V(ce){ce&&D("manageRelay",{relay:ce})}function q(){return Ke(this,void 0,void 0,function*(){yield d.relayManager.deleteRemote(m),d.sharedFolders.notifyListeners()})}function j(){return Ke(this,void 0,void 0,function*(){s&&d.sharedFolders.delete(s),D("goBack",{clear:!0})})}function z(){let ce=d.vault.getFolderByPath(m.path);ce&&d.app.vault.trash(ce,!1),D("goBack",{})}function Y(ce){to.call(this,o,ce)}let pe=()=>{V(c)},De=(ce,le)=>M(ce,le.currentTarget.checked),G=ce=>M(ce,!u[ce]),se=ce=>M(ce,!u[ce]),ke=()=>{_(c)},Qe=()=>{z()},Re=()=>{j()};o.$$set=ce=>{"plugin"in ce&&t(0,d=ce.plugin),"sharedFolder"in ce&&t(1,m=ce.sharedFolder),"sharedFolders"in ce&&l(t(2,g=ce.sharedFolders)),"relayRoles"in ce&&t(20,h=ce.relayRoles)};e:t(4,r=Object.entries(v.getCategories()));return[d,m,g,E,r,s,n,c,u,_,w,v,A,O,M,F,V,q,j,z,h,Y,pe,De,G,se,ke,Qe,Re]}var fm=class extends ee{constructor(e){super(),oe(this,e,aA,nA,Z,{plugin:0,sharedFolder:1,sharedFolders:2,relayRoles:20},null,[-1,-1])}},um=fm;function iA(o){let e=[],t="",r=0;for(;r<o.length;)o[r]==="*"&&r+1<o.length&&o[r+1]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"DOUBLE_STAR"}),r+=2):o[r]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"STAR"}),r++):(t+=o[r],r++);return t&&e.push({type:"TEXT",value:t}),e}function lA(o){let e="",t="NORMAL",r=0;for(;r<o.length;){let s=o[r];switch(t){case"NORMAL":s.type==="TEXT"?e+=s.value:s.type==="STAR"?(t="EMPHASIS",e+="<u>"):s.type==="DOUBLE_STAR"&&(t="BOLD",e+="<strong>");break;case"EMPHASIS":s.type==="TEXT"?e+=s.value:s.type==="STAR"?(t="NORMAL",e+="</u>"):s.type==="DOUBLE_STAR"&&(t="BOLD",e+="</u><strong>");break;case"BOLD":s.type==="TEXT"?e+=s.value:s.type==="STAR"?e+="*":s.type==="DOUBLE_STAR"&&(t="NORMAL",e+="</strong>");break}r++}return t==="EMPHASIS"?e+="</u>":t==="BOLD"&&(e+="</strong>"),e}function dm(o){let e=iA(o);return lA(e)}function cA(o){Pe(o,"svelte-d22j3",".relay-version.svelte-d22j3{user-select:auto;background:var(--color-base-10);color:var(--text-faint);position:absolute;bottom:0;right:0;font-size:xx-small;padding-right:1em;padding-top:0.3em;padding-left:1em;border-top-left-radius:1em}.vertical-tab-content.svelte-d22j3{max-height:var(--modal-max-height);position:relative}.system3-announcement-banner.svelte-d22j3{padding-left:48px !important}.system3-announcement.svelte-d22j3{color:var(--text-on-accent)}")}function fA(o){let e,t,r,s,n=o[0].networkStatus.status&&hw(o);return{c(){e=T("div"),t=T("span"),n&&n.c(),x(t,"class","system3-announcement svelte-d22j3"),de(t,"color",o[0].networkStatus.status.color?o[0].networkStatus.status.color:"var(--text-on-accent)",1),x(e,"class","modal-setting-nav-bar system3-announcement-banner svelte-d22j3"),x(e,"role","button"),x(e,"tabindex","0"),de(e,"background-color",o[0].networkStatus.status.backgroundColor?o[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},m(a,i){I(a,e,i),k(e,t),n&&n.m(t,null),r||(s=[te(e,"click",o[17]),te(e,"keypress",o[18])],r=!0)},p(a,i){a[0].networkStatus.status?n?n.p(a,i):(n=hw(a),n.c(),n.m(t,null)):n&&(n.d(1),n=null),i&1&&de(t,"color",a[0].networkStatus.status.color?a[0].networkStatus.status.color:"var(--text-on-accent)",1),i&1&&de(e,"background-color",a[0].networkStatus.status.backgroundColor?a[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},i:X,o:X,d(a){a&&C(e),n&&n.d(),r=!1,Ce(s)}}}function uA(o){let e,t;return e=new iw({}),e.$on("goBack",o[9]),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p:X,i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function hw(o){let e,t=dm(o[0].networkStatus.status.status)+"",r;return{c(){e=new na(!1),r=Ie(),e.a=r},m(s,n){e.m(t,s,n),I(s,r,n)},p(s,n){n&1&&t!==(t=dm(s[0].networkStatus.status.status)+"")&&e.p(t)},d(s){s&&(C(r),e.d())}}}function dA(o){let e,t;return e=new vb({props:{plugin:o[0],$$slots:{default:[hA]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&1&&(n.plugin=r[0]),s&8388609&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function pA(o){let e,t;return e=new ba({props:{plugin:o[0],relayRoles:o[3],relay:o[2],sharedFolders:o[5]}}),e.$on("goBack",o[9]),e.$on("close",o[10]),e.$on("manageSharedFolder",o[7]),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&1&&(n.plugin=r[0]),s&4&&(n.relay=r[2]),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function mA(o){let e,t;return e=new um({props:{plugin:o[0],relayRoles:o[3],sharedFolder:o[1],sharedFolders:o[5]}}),e.$on("goBack",o[9]),e.$on("close",o[10]),e.$on("manageRelay",o[6]),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&1&&(n.plugin=r[0]),s&2&&(n.sharedFolder=r[1]),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function hA(o){let e,t;return e=new ko({props:{relays:o[4],plugin:o[0]}}),e.$on("manageRelay",o[6]),e.$on("manageSharedFolder",o[7]),e.$on("createRelay",o[8]),e.$on("joinRelay",o[11]),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&1&&(n.plugin=r[0]),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function gw(o){let e,t=o[0].version+"",r;return{c(){e=T("span"),r=K(t),x(e,"class","relay-version svelte-d22j3")},m(s,n){I(s,e,n),k(e,r)},p(s,n){n&1&&t!==(t=s[0].version+"")&&ne(r,t)},d(s){s&&C(e)}}}function gA(o){let e,t,r,s,n,a,i,l,c,u=[uA,fA],d=[];function m(v,A){return v[2]||v[1]?0:v[0].networkStatus.status?1:-1}~(e=m(o,-1))&&(t=d[e]=u[e](o));let g=[mA,pA,dA],h=[];function _(v,A){return v[1]?0:v[2]?1:2}n=_(o,-1),a=h[n]=g[n](o);let w=o[0].manifest.version!==o[0].version&&gw(o);return{c(){t&&t.c(),r=U(),s=T("div"),a.c(),i=U(),w&&w.c(),l=Ie(),x(s,"class","vertical-tab-content svelte-d22j3")},m(v,A){~e&&d[e].m(v,A),I(v,r,A),I(v,s,A),h[n].m(s,null),I(v,i,A),w&&w.m(v,A),I(v,l,A),c=!0},p(v,[A]){let O=e;e=m(v,A),e===O?~e&&d[e].p(v,A):(t&&(he(),P(d[O],1,1,()=>{d[O]=null}),ge()),~e?(t=d[e],t?t.p(v,A):(t=d[e]=u[e](v),t.c()),S(t,1),t.m(r.parentNode,r)):t=null);let E=n;n=_(v,A),n===E?h[n].p(v,A):(he(),P(h[E],1,1,()=>{h[E]=null}),ge(),a=h[n],a?a.p(v,A):(a=h[n]=g[n](v),a.c()),S(a,1),a.m(s,null)),v[0].manifest.version!==v[0].version?w?w.p(v,A):(w=gw(v),w.c(),w.m(l.parentNode,l)):w&&(w.d(1),w=null)},i(v){c||(S(t),S(a),c=!0)},o(v){P(t),P(a),c=!1},d(v){v&&(C(r),C(s),C(i),C(l)),~e&&d[e].d(v),h[n].d(),w&&w.d(v)}}}function yA(o,e,t){let r,{plugin:s}=e,{path:n=void 0}=e,a=s.app,i=s.relayManager,l=i.relayRoles,c=i.relays;me(o,c,q=>t(16,r=q));let u=s.sharedFolders,d,m=ko,g,h=[{component:ko}],{close:_}=e;function w(q){if(t(2,g=void 0),t(1,d=void 0),q==="/"){t(15,m=ko);return}let j=new URLSearchParams(q.split("?")[1]||""),z=j.get("id");if(q.startsWith("/relays")){z?(t(2,g=i.relays.find(Y=>Y.guid===z)),t(15,m=ba)):t(15,m=ko);return}if(q.startsWith("/shared-folders")){if(z){t(1,d=u.find(pe=>pe.guid===z));let Y=j.get("relay");Y&&t(2,g=i.relays.get(Y)),t(15,m=um)}return}}function v(q){h.push({currentRelay:g,sharedFolder:d,component:m}),t(2,g=q.detail.relay),t(1,d=void 0),t(15,m=ba)}function A(q){h.push({currentRelay:g,sharedFolder:d,component:m}),t(1,d=q.detail.folder),t(2,g=q.detail.relay)}function O(q){return Ke(this,void 0,void 0,function*(){h.push({currentRelay:g,sharedFolder:d,component:m}),t(2,g=yield s.relayManager.createRelay("")),t(15,m=ba)})}function E(q){if(q.detail.clear){h.length=0,t(2,g=void 0),t(1,d=void 0),t(15,m=ko);return}let j=h.pop();if(j)for(;j;){if(!j.currentRelay&&!j.sharedFolder)t(2,g=j.currentRelay),t(1,d=j.sharedFolder),t(15,m=j.component);else if(j.sharedFolder&&u.has(j.sharedFolder)){t(2,g=j.currentRelay),t(1,d=j.sharedFolder),t(15,m=j.component);break}else if(j.currentRelay&&i.relays.get(j.currentRelay.id)){t(2,g=j.currentRelay),t(1,d=j.sharedFolder),t(15,m=j.component);break}j=h.pop()}else t(2,g=void 0),t(1,d=void 0),t(15,m=ko)}function M(q){h.length=0,_()}function R(q){t(2,g=q.detail.relay),t(15,m=ba)}function D(){var q;!((q=s.networkStatus.status)===null||q===void 0)&&q.versions&&(s.releaseSettings.get().channel==="stable"?s.installVersion(s.networkStatus.status.versions.stable):s.releaseSettings.get().channel==="beta"&&s.installVersion(s.networkStatus.status.versions.beta))}let F=()=>{var q,j;(q=s.networkStatus.status)!=null&&q.versions?D():(j=s.networkStatus.status)!=null&&j.link&&window.open(s.networkStatus.status.link)},V=()=>{var q,j;(q=s.networkStatus.status)!=null&&q.versions?D():(j=s.networkStatus.status)!=null&&j.link&&window.open(s.networkStatus.status.link)};return o.$$set=q=>{"plugin"in q&&t(0,s=q.plugin),"path"in q&&t(13,n=q.path),"close"in q&&t(14,_=q.close)},o.$$.update=()=>{if(o.$$.dirty&8192){e:n&&w(n)}if(o.$$.dirty&65540){e:g&&!r.has(g.id)&&(t(2,g=void 0),t(15,m=ko))}if(o.$$.dirty&2){e:d&&!u.has(d)&&(t(1,d=void 0),t(15,m=ko))}if(o.$$.dirty&32774){e:(m||g||d)&&setTimeout(()=>{let q=document.querySelector(".vertical-tab-content");q&&(q.scrollTop=0)},0)}},[s,d,g,l,c,u,v,A,O,E,M,R,D,n,_,m,r,F,V]}var pm=class extends ee{constructor(e){super(),oe(this,e,yA,gA,Z,{plugin:0,path:13,close:14},cA)}},yw=pm;var Dc=class extends xw.PluginSettingTab{constructor(t,r){super(t,r);this.plugin=r}display(){let{containerEl:t}=this;this.targetEl=t.parentElement,this.targetEl.empty(),this.plugin.relayManager.update(),this.component=new yw({target:this.targetEl,props:{plugin:this.plugin,close:()=>{this.setting.close()}}})}navigateTo(t){var r;(r=this.component)==null||r.$set({path:t})}hide(){var t;try{(t=this.component)==null||t.$destroy()}catch(r){console.warn(r)}}destroy(){this.hide(),this.plugin=null}};var mm=require("obsidian");var Fc=class extends ui{constructor(t="pocketbase_auth"){super();this.storageFallback={};this._storageChangeHandler=t=>{if(t.key!=this.storageKey)return;let r=this._storageGet(this.storageKey)||{};super.save(r.token||"",r.model||null)};this.storageKey=t,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(t,r){this._storageSet(this.storageKey,{token:t,model:r}),super.save(t,r)}clear(){this._storageRemove(this.storageKey),super.clear()}destroy(){this._unbindStorageEvent()}_storageGet(t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=window.localStorage.getItem(t)||"";try{return JSON.parse(r)}catch(s){return r}}return this.storageFallback[t]}_storageSet(t,r){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let s=r;typeof r!="string"&&(s=JSON.stringify(r)),window.localStorage.setItem(t,s)}else this.storageFallback[t]=r}_storageRemove(t){var r;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((r=window.localStorage)==null||r.removeItem(t)),delete this.storageFallback[t]}_bindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.addEventListener("storage",this._storageChangeHandler)}_unbindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.removeEventListener("storage",this._storageChangeHandler)}};var Ac=class extends dt{constructor(t,r,s,n){var i;super();this.beforeLogin=n;let a=Te("[Pocketbase]","debug");this.authStore=new Fc(`pocketbase_auth_${t}`),this.pb=new ra("https://auth.system3.md",this.authStore),this.pb.beforeSend=(l,c)=>(a(l,c),c.fetch=Rt,c.headers=Object.assign({},c.headers,{"Relay-Version":"0.5.4"}),{url:l,options:c}),this.refreshToken(),s.setInterval(()=>this.refreshToken(),864e5),this.openSettings=r,this.pb.authStore.isValid||this.logout(),(i=this.pb.authStore.model)!=null&&i.id&&this.pb.collection("users").getOne(this.pb.authStore.model.id).then(()=>{this.getFlags()}).catch(l=>{l.status===404&&this.logout()}),Bt.set(this,"loginManager")}refreshToken(){this.pb.authStore.isValid&&(this.user=this.makeUser(this.pb.authStore),this.pb.collection("users").authRefresh().then(t=>{let r=t.token,[,s]=r.split("."),n=JSON.parse(atob(s)),a=new Date(n.exp*1e3),i=new Date,l=Math.ceil((a.getTime()-i.getTime())/(1e3*60*60*24));this.log("Token Refreshed"),this.log("JWT Info:",{expiresAt:a.toLocaleString(),expiresIn:`${l} days`,userId:n.id,email:n.email})}))}setup(t){var r,s;return this.pb.authStore.isValid?(this.user=this.makeUser(this.pb.authStore,(r=t==null?void 0:t.meta)==null?void 0:r.rawUser),this.notifyListeners(),t&&this.pb.collection("oauth2_response").create({user:t.record.id,oauth_response:(s=t.meta)==null?void 0:s.rawUser}).then(()=>{this.notifyListeners()}).catch(n=>{this.log(n)}),!0):(this.notifyListeners(),!1)}getFlags(){let t={Authorization:`Bearer ${this.pb.authStore.token}`,"Relay-Version":"0.5.4"};(0,mm.requestUrl)({url:"https://api.system3.md/flags",method:"GET",headers:t}).then(r=>{if(r.status===200){let s=r.json;Nt.getInstance().applyServerFlags(s)}}).catch(r=>{this.log(r)})}whoami(){let t={Authorization:`Bearer ${this.pb.authStore.token}`};(0,mm.requestUrl)({url:"https://api.system3.md/whoami",method:"GET",headers:t}).then(r=>{this.log(r.json)}).catch(r=>{this.log(r)})}get loggedIn(){return this.user!==void 0}get hasUser(){return this.user!==void 0}makeUser(t,r){var s,n,a,i;return new vc((s=t.model)==null?void 0:s.id,((n=t.model)==null?void 0:n.name)||(r==null?void 0:r.name),(a=t.model)==null?void 0:a.email,((i=t.model)==null?void 0:i.picture)||(r==null?void 0:r.picture),t.token)}logout(){this.pb.cancelAllRequests(),this.pb.authStore.clear(),this.user=void 0,this.notifyListeners()}webviewIntercept(){let t=this.pb.buildUrl("/api/oauth2-redirect"),r="https:\\/\\/accounts\\.google\\.com\\/o\\/oauth2\\/auth";return new RegExp(`^${r}.*?[?&]redirect_uri=${encodeURIComponent(t)}`,"i")}async initiateManualOAuth2CodeFlow(t){this.beforeLogin();let s=(await this.pb.collection("users").listAuthMethods({fetch:t}).catch(a=>{throw a.originalError})).authProviders[0],n=this.pb.buildUrl("/api/oauth2-redirect");return[s.authUrl+n,s,async a=>this.pb.collection("users").authWithOAuth2Code(s.name,a,s.codeVerifier,n,{fetch:t}).then(i=>(this.setup(i),i))]}async poll(t,r){let s=0,n=1e3;return new Promise((a,i)=>{let l=setInterval(()=>{if(s+=1,s>=30)return clearInterval(l),i(new Error(`Auth timeout: Timed out after ${s*n/1e3} seconds`));this.pb.collection("code_exchange").getOne(t.state.slice(0,15)).then(c=>{if(c)return clearInterval(l),a(r(c.code))}).catch(c=>{})},n)})}async login(){this.beforeLogin();let t=await this.pb.collection("users").authWithOAuth2({provider:"google"});return this.setup(t)}async openLoginPage(){return await this.openSettings(),await new Promise((r,s)=>{let n=()=>{this.loggedIn&&(this.off(n),r(!0)),r(!1)};this.on(n)})}destroy(){this.pb.cancelAllRequests(),this.pb.realtime.unsubscribe(),this.pb=null,this.authStore.destroy(),this.authStore=null,this.user=void 0,this.openSettings=null,super.destroy()}};var Gt=crypto;var Co=new TextEncoder,Tr=new TextDecoder,kq=2**32;var bw=o=>{let e=o;typeof e=="string"&&(e=Co.encode(e));let t=32768,r=[];for(let s=0;s<e.length;s+=t)r.push(String.fromCharCode.apply(null,e.subarray(s,s+t)));return btoa(r.join(""))},oo=o=>bw(o).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),ww=o=>{let e=atob(o),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},cn=o=>{let e=o;e instanceof Uint8Array&&(e=Tr.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return ww(e)}catch(t){throw new TypeError("The input to be decoded is not correctly encoded.")}};var hm={};_f(hm,{JOSEAlgNotAllowed:()=>Ii,JOSEError:()=>Ht,JOSENotSupported:()=>Lt,JWEDecryptionFailed:()=>Li,JWEInvalid:()=>Pr,JWKInvalid:()=>Mc,JWKSInvalid:()=>Rc,JWKSMultipleMatchingKeys:()=>Oc,JWKSNoMatchingKey:()=>Ti,JWKSTimeout:()=>Uc,JWSInvalid:()=>rs,JWSSignatureVerificationFailed:()=>Pi,JWTClaimValidationFailed:()=>Ci,JWTExpired:()=>Ec,JWTInvalid:()=>cr});var Ht=class extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)==null||t.call(Error,this,this.constructor)}},Ci=class extends Ht{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}},Ec=class extends Ht{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}},Ii=class extends Ht{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}},Lt=class extends Ht{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}},Li=class extends Ht{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}},Pr=class extends Ht{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}},rs=class extends Ht{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}},cr=class extends Ht{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}},Mc=class extends Ht{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}},Rc=class extends Ht{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}},Ti=class extends Ht{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}},Oc=class extends Ht{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}},Uc=class extends Ht{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}},Pi=class extends Ht{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};var $c=Gt.getRandomValues.bind(Gt);function _A(o){return typeof o=="object"&&o!==null}function fr(o){if(!_A(o)||Object.prototype.toString.call(o)!=="[object Object]")return!1;if(Object.getPrototypeOf(o)===null)return!0;let e=o;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(o)===e}var MA=Symbol();var WA,Hc,Fw;(typeof navigator=="undefined"||!((Fw=(Hc=navigator.userAgent)==null?void 0:Hc.startsWith)!=null&&Fw.call(Hc,"Mozilla/5.0 ")))&&(WA="jose/v5.3.0");var xm={};_f(xm,{decode:()=>Vc,encode:()=>zA});var zA=oo,Vc=cn;function bm(o){if(typeof o!="string")throw new cr("JWTs must use Compact JWS serialization, JWT must be a string");let{1:e,length:t}=o.split(".");if(t===5)throw new cr("Only JWTs using Compact JWS serialization can be decoded");if(t!==3)throw new cr("Invalid JWT");if(!e)throw new cr("JWTs must contain a payload");let r;try{r=Vc(e)}catch(n){throw new cr("Failed to base64url decode the payload")}let s;try{s=JSON.parse(Tr.decode(r))}catch(n){throw new cr("Failed to parse the decoded payload as JSON")}if(!fr(s))throw new cr("Invalid JWT Claims Set");return s}var fn=class extends Error{constructor(e){super(e),this.name="[System3] Relay Error"}};function Aw(o){return o<1e3?`${o}ms`:o<6e4?`${Math.round(o/1e3)}s`:o<36e5?`${Math.round(o/6e4)}m`:`${Math.round(o/36e5)}h`}function KA(o){let e=bm(o.token);if(typeof e=="string")return 0;let t=e==null?void 0:e.exp;return t?t*1e3:0}var qc=class{constructor(e,t=5){this.expiryMargin=5*60*1e3;this.activeConnections=0;this._activePromises=new Map,e.getStorage?this.tokenMap=e.getStorage():this.tokenMap=new Map,this.callbacks=new Map,this.refreshQueue=new Set,this._log=e.log,this.refresh=e.refresh,this.timeProvider=e.getTimeProvider(),e.getJwtExpiry?this.getJwtExpiry=e.getJwtExpiry:this.getJwtExpiry=KA,this.maxConnections=t,this.refreshInterval=null,Bt.set(this,"TokenStore")}onRefresh(e){return new Promise((r,s)=>{let n=i=>{r(i)},a=i=>{this.removeFromRefreshQueue(e),s(i)};this.refresh(e,n,a)})}start(){this.log("starting"),this.report(),this.refreshInterval=this.timeProvider.setInterval(()=>this.checkAndRefreshTokens(),60*1e3),this.checkAndRefreshTokens()}stop(){this.log("stopping"),this.refreshInterval&&(this.timeProvider.clearInterval(this.refreshInterval),this.refreshInterval=null)}_cleanupInvalidTokens(){let e=[];for(let[t,r]of this.tokenMap.entries())this.isTokenValid(r)||e.push(t);for(let t of e)this.tokenMap.delete(t)}checkAndRefreshTokens(){this.log("check and refresh tokens"),this._cleanupInvalidTokens();for(let[e,t]of this.tokenMap.entries())this.callbacks.has(e)&&this.shouldRefresh(t)&&(this.log("adding to refresh queue"),this.addToRefreshQueue(e));this.log(this.report())}dequeue(){if(this.log("getting next item in queue"),this.refreshQueue.size>0){let e=this.refreshQueue.values().next().value;return this.refreshQueue.delete(e),e}return null}addToRefreshQueue(e){if(this.activeConnections<this.maxConnections){this.log(`immediate refresh of ${e}`),this.activeConnections++;let t=s=>{this.onTokenRefreshed(e,s),this.activeConnections--;let n=this.dequeue();n&&this.addToRefreshQueue(n)},r=()=>{this.onRefreshFailure(e),this.activeConnections--;let s=this.dequeue();s&&this.addToRefreshQueue(s)};this.refresh(e,t,r)}else this.log(`enqueued refresh of ${e}`),this.refreshQueue.add(e)}removeFromRefreshQueue(e){return this.log(`removing ${e} from refresh queue`),this.refreshQueue.has(e)?(this.refreshQueue.delete(e),!0):!1}log(e){this._log(e)}onTokenRefreshed(e,t){let r=this.getJwtExpiry(t);if(this.tokenMap.has(e)){let s=this.tokenMap.get(e),n=this.callbacks.get(e);this.log(`new expiry time is ${r}`),this.tokenMap.set(e,{...s,token:t,expiryTime:r}),n(t),this.log(`Token refreshed for ${s.friendlyName} (${e})`)}}onRefreshFailure(e){let t=this.tokenMap.get(e),r=(t==null?void 0:t.attempts)||0+1;r<=3?this.tokenMap.set(e,{...t,attempts:r}):this.tokenMap.delete(e)}isTokenValid(e){return this.timeProvider.getTime()<e.expiryTime}shouldRefresh(e){return this.timeProvider.getTime()+this.expiryMargin>e.expiryTime}getTokenSync(e){var t,r;return(r=(t=this.tokenMap)==null?void 0:t.get(e))==null?void 0:r.token}getTokenFromNetwork(e,t,r){let s=this._activePromises.get(e);if(s)return s;this.tokenMap.set(e,{token:null,friendlyName:t,expiryTime:0,attempts:0}),this.callbacks.set(e,r);let n=this.onRefresh(e).then(a=>(this.onTokenRefreshed(e,a),this._activePromises.delete(e),a)).catch(a=>{throw this.onRefreshFailure(e),this._activePromises.delete(e),a});return this._activePromises.set(e,n),n}async getToken(e,t,r){if(this.log(`getting token ${t}`),this.tokenMap||Promise.reject(new fn("attempted to get token after TokenStore was destroyed.")),this.tokenMap.has(e)){let s=this.tokenMap.get(e);if(s.token&&this.isTokenValid(s))return this.callbacks.set(e,r),s.friendlyName=t,r(s.token),this.log("token was valid, cache hit!"),this._activePromises.delete(e),Promise.resolve(s.token)}return this.getTokenFromNetwork(e,t,r)}_reportWithFilter(e){let t=[],r=this.timeProvider.getTime(),s=Array.from(this.tokenMap.entries()).sort((n,a)=>n[1].expiryTime-a[1].expiryTime);for(let[n,{friendlyName:a,expiryTime:i,attempts:l}]of s){if(!e(n))continue;let c=i-r,u="";c>0?u=`expires in ${Aw(c-this.expiryMargin)}`:u="expired",t.push(`${n} (${a}): ${l} attempts, (${u})`)}return t}report(){let e=[];return e.push("Token Store Report:"),e.push(`Expiry Margin: ${Aw(this.expiryMargin)}`),e.push("Active Tokens:"),e.push(...this._reportWithFilter(t=>this.callbacks.has(t))),e.push("Stale Tokens:"),e.push(...this._reportWithFilter(t=>!this.callbacks.has(t))),e.push(`Queue size: ${this.refreshQueue.size}`),e.join(`
`)}async waitForQueue(){return new Promise(e=>{setInterval(()=>{if(this.refreshQueue.size==0)return e()},100)})}clearState(){this.refreshQueue.clear();for(let[e,t]of this.tokenMap.entries())this.isTokenValid(t)?this.tokenMap.set(e,{...t,attempts:0}):this.tokenMap.delete(e)}clear(e){e?this.tokenMap.forEach((t,r)=>{e(t)&&(this.tokenMap.delete(r),this.refreshQueue.delete(r))}):(this.tokenMap.clear(),this.refreshQueue.clear())}destroy(){this.clear(),this.timeProvider.destroy(),this.timeProvider=null,this.refresh=null,this.callbacks.clear(),this.callbacks=null,this._activePromises.clear(),this._activePromises=null,this.tokenMap=null}};function GA(o){return o.expiryTime||0}function jA(o,e){return(...t)=>e(o,...t)}async function YA(o,e,t,r){var c;let s=Te("[TokenStore][Refresh]","debug"),n=Te("[TokenStore][Refresh]","error");s(`${e}`);let a=bt.decode(e),i;if(a instanceof Ur)i=JSON.stringify({docId:a.documentId,relay:a.relayId,folder:a.folderId});else if(a instanceof sr)i=JSON.stringify({docId:a.canvasId,relay:a.relayId,folder:a.folderId});else if(a instanceof Wo)i=JSON.stringify({docId:a.folderId,relay:a.relayId,folder:a.folderId});else if(a instanceof zo)i=JSON.stringify({docId:a.fileId,relay:a.relayId,folder:a.folderId});else{r(new Error("No remote to connect to"));return}if(!o.loggedIn){r(Error("Not logged in"));return}let l={Authorization:`Bearer ${(c=o.user)==null?void 0:c.token}`,"Relay-Version":"0.5.4"};try{let u=await Rt("https://api.system3.md/token",{method:"POST",headers:l,body:i});if(!u.ok){s(u.status,await u.text()),r(Error(`Received status code ${u.status} from an API.`));return}let d=await u.json();t(d)}catch(u){n(u,i),r(u)}}var Wc=class extends qc{constructor(t,r,s,n=5){super({log:Te("[LiveTokenStore]","debug"),refresh:jA(t,YA),getJwtExpiry:GA,getStorage:function(){return new Yo("TokenStore/"+s)},getTimeProvider:()=>r},n);this.loginManager=t}async getFileTokenFromNetwork(t,r,s,n){let a=`${t}${r}`,i=this._activePromises.get(a);if(i)return i;this.tokenMap.set(t,{token:null,expiryTime:0,attempts:0});let l=this.fetchFileToken(t,r,s,n).then(c=>{let u=this.getJwtExpiry(c),d=this.tokenMap.get(a);return this.tokenMap.set(r,{...d,token:c,expiryTime:u}),this._activePromises.delete(a),c}).catch(c=>{throw this._activePromises.delete(a),c});return this._activePromises.set(a,l),l}async fetchFileToken(t,r,s,n){var m;let a=Te("[TokenStore][Fetch]","debug");a(`${t}`);let i=bt.decode(t),l;if(i instanceof zo)l=JSON.stringify({docId:i.fileId,relay:i.relayId,folder:i.folderId,hash:r,contentType:s,contentLength:n});else throw new Error(`No remote to connect to for ${t}`);if(!this.loginManager.loggedIn)throw new Error("Not logged in");let c={Authorization:`Bearer ${(m=this.loginManager.user)==null?void 0:m.token}`,"Relay-Version":"0.5.4"},u=await Rt("https://api.system3.md/file-token",{method:"POST",headers:c,body:l});if(!u.ok){a(u.status,await u.text());let g=await u.json();throw new Error(g.error)}return await u.json()}async getFileToken(t,r,s,n){let a=`${t}${r}`,i=this.tokenMap.get(a);return i&&i.token&&this.isTokenValid(i)?(this.log("token was valid, cache hit!"),this._activePromises.delete(a),Promise.resolve(i.token)):this.getFileTokenFromNetwork(t,r,s,n)}};var Ew=require("obsidian");var wm=class{constructor(e,t,r=1e4){this.timeProvider=e;this.onOnline=[];this.onOffline=[];this.online=!0;this._log=Te("[NetworkStatus]"),this.url=t,this.interval=r,this._onceOnline=new Set}log(e,...t){this._log(e,...t)}start(){this.timer||(this.timer=this.checkStatusRepeatedly())}stop(){this.timer&&clearInterval(this.timer)}checkStatusRepeatedly(){return this.timeProvider.setInterval(this._checkStatus.bind(this),this.interval)}checkStatus(){return this.online?Promise.resolve(!0):new Promise(e=>{this._checkStatus().then(()=>{e(this.online)})})}async _checkStatus(){return(0,Ew.requestUrl)({url:this.url,method:"GET",headers:{"Relay-Version":"0.5.4"}}).then(e=>{if(e.status===200){if(e.json&&e.json.status&&(this.status=e.json),!this.online){this.log("back online"),this.online=!0,this.onOnline.forEach(t=>t(this.status)),this._onceOnline.forEach(t=>t(this.status)),this._onceOnline.clear();return}}else if(e.status!==200&&this.online)throw new Error("disconnected")}).catch(e=>{if(e.message.includes("ERR_NETWORK_CHANGED")){this._checkStatus();return}this.online=!1,this.onOffline.forEach(t=>t(this.status))})}onceOnline(e){this._onceOnline.add(e)}addEventListener(e,t){e==="online"?this.onOnline.push(t):e==="offline"&&this.onOffline.push(t)}destroy(){this._onceOnline.clear(),this._onceOnline=null,this.onOnline=null,this.onOffline=null,this.timeProvider=null}},Mw=wm;function vm(o){return typeof o.id=="string"}function JA(o){return typeof o.name=="string"}var _m=class{constructor(e){this.collectionName="roles";this.roles=e}items(){return this.roles.values()}clear(){this.roles.clear()}get(e){return this.roles.get(e)}ingest(e){return this.roles.set(e.id,e),e}delete(e){this.roles.delete(e)}};function Rw(o){return typeof o.aggregate_root=="object"}function Ow(o){return typeof o.acl=="object"}var Fi=class{get aggregate_root(){}get acl(){}},Sm=class extends dt{constructor(t,r){super();this.storageQuota=t;this.relays=r}update(t){return this.storageQuota=t,this}get id(){return this.storageQuota.id}get quota(){return this.storageQuota.quota}get pending(){return this.storageQuota.pending}get usage(){return this.storageQuota.usage}get maxFileSize(){return this.storageQuota.max_file_size}get updated(){return this.storageQuota.updated}get created(){return this.storageQuota.created}},km=class{constructor(e,t){this.storageQuota=e;this.relays=t;this.collectionName="storage_quotas"}items(){return this.storageQuota.values()}clear(){this.storageQuota.clear()}get(e){return this.storageQuota.get(e)}ingest(e){let t=this.storageQuota.get(e.id);if(t)return t.update(e),this.storageQuota.notifyListeners(),t;let r=new Sm(e,this.relays);return this.storageQuota.set(e.id,r),r}delete(e){this.storageQuota.delete(e)}},zc=class extends Fi{constructor(t){super();this.user=t}get id(){return this.user.id}get name(){return this.user.name}get email(){return this.user.email}get picture(){return this.user.picture}update(t){return this.user=t,this}},Cm=class extends Fi{constructor(t,r,s){super();this.remoteFolder=t;this.relays=r;this.users=s}update(t){return this.remoteFolder=t,this}get id(){return this.remoteFolder.id}get guid(){return this.remoteFolder.guid}get name(){return this.remoteFolder.name}get private(){return this.remoteFolder.private}get creator(){let t=this.users.get(this.remoteFolder.creator);if(!t)throw new Error("invalid remote folder");return t}get relay(){let t=this.relays.get(this.remoteFolder.relay);if(!t)throw new Error("invalid remote folder");return t}get aggregate_root(){return["relays",this.remoteFolder.relay]}get acl(){return["relays",this.remoteFolder.relay]}},Im=class{constructor(e,t,r){this.remoteFolders=e;this.relays=t;this.users=r;this.collectionName="shared_folders"}items(){return this.remoteFolders.values()}clear(){this.remoteFolders.clear()}get(e){return this.remoteFolders.get(e)}ingest(e){let t=this.remoteFolders.get(e.id);if(t)return t.update(e),this.remoteFolders.notifyListeners(),t;let r=new Cm(e,this.relays,this.users);return this.remoteFolders.set(e.id,r),r}delete(e){this.remoteFolders.delete(e)}},Lm=class{constructor(e,t,r,s,n,a,i,l){this.relays=e;this.roles=t;this.relayRoles=r;this.relayInvitations=s;this.remoteFolders=n;this.subscriptions=a;this.storageQuotas=i;this.user=l;this.collectionName="relays"}items(){return this.relays.values()}clear(){this.relays.clear()}get(e){return this.relays.get(e)}ingest(e){let t=this.relays.get(e.id);if(t)return t.update(e),this.relays.notifyListeners(),t;let r=new Kc(e,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.user);return this.relays.set(r.id,r),r}delete(e){this.relays.delete(e)}},Tm=class{constructor(e,t,r,s){this.collectionName="relay_roles";this.relayRoles=e,this.relays=t,this.users=r,this.roles=s}items(){return this.relayRoles.values()}clear(){this.relayRoles.clear()}get(e){return this.relayRoles.get(e)}ingest(e){let t=this.relayRoles.get(e.id);if(t)return t.update(e),this.relayRoles.notifyListeners(),t;let r=new Em(e,this.relays,this.users,this.roles);return this.relayRoles.set(r.id,r),r}delete(e){this.relayRoles.get(e)&&this.relayRoles.delete(e)}},Pm=class{constructor(e,t,r){this.collectionName="relay_invitations";this.relayInvitations=e,this.relays=t,this.roles=r}items(){return this.relayInvitations.values()}clear(){this.relayInvitations.clear()}get(e){return this.relayInvitations.get(e)}ingest(e){let t=this.relayInvitations.get(e.id);if(t)return t.update(e),this.relayInvitations.notifyListeners(),t;let r=new Mm(e,this.relays,this.roles);return this.relayInvitations.set(r.id,r),r}delete(e){this.relayInvitations.delete(e)}},Dm=class{constructor(e){this.users=e;this.collectionName="users"}items(){return this.users.values()}clear(){this.users.clear()}get(e){return this.users.get(e)}ingest(e){let t=this.users.get(e.id);if(t)return t.update(e),this.users.notifyListeners(),t;let r=new zc(e);return this.users.set(e.id,r),r}delete(e){this.users.delete(e)}},Fm=class{constructor(e,t,r){this.subscriptions=e;this.relays=t;this.users=r;this.collectionName="subscriptions"}items(){return this.subscriptions.values()}clear(){this.subscriptions.clear()}get(e){return this.subscriptions.get(e)}ingest(e){let t=this.subscriptions.get(e.id);if(t)return t.update(e),this.subscriptions.notifyListeners(),t;let r=new Rm(e,this.relays,this.users);return this.subscriptions.set(e.id,r),r}delete(e){this.subscriptions.delete(e)}},Am=class extends Ft{constructor(t){super();this.collections=new Map,this.relationships=new Map;for(let r of t)this.collections.set(r.collectionName,r);Bt.set(this,"Store")}getCollection(t){let r=this.collections.get(t);if(!r)throw this.error("No collection found for",t),new Error("No collection found for "+t);return r}clear(){let t=Br.getInstance();t.beginTransaction(),this.collections.forEach(r=>{r.clear()}),this.collections.clear(),this.relationships.clear(),t.commitTransaction()}destroy(){this.clear(),this.collections=null,this.relationships=null}ingestPage(t){return this.ingestBatch(t==null?void 0:t.items)}ingestBatch(t){if(t)return t.map(r=>this.ingest(r))}ingest(t){let r=Br.getInstance();r.beginTransaction();let s=this._ingest(t);return r.commitTransaction(),s}_ingest(t){if(!t)return;let r,s=this.collections.get(t.collectionName);if(s?r=s.ingest(t):this.error("No collection found for record",t),Rw(r)){let n=r.aggregate_root;if(n){let a=t.id,i=this.relationships.get(n.join(":"))||new Set;i.add([t.collectionName,a].join(":")),this.relationships.set(n.join(":"),i)}}if(Ow(r)){let n=r.acl;if(n){let a=t.id,i=this.relationships.get(n.join(":"))||new Set;i.add([t.collectionName,a].join(":")),this.relationships.set(n.join(":"),i)}}if(t.expand)for(let[,n]of Object.entries(t.expand))Array.isArray(n)?this.ingestBatch(n):this.ingest(n);return r}delete(t){this.cascade(t.collectionName,t.id)}graphviz(){let t=`digraph G {
`;for(let[r,s]of this.collections)for(let n of s.items()){if(!vm(n)){this.warn("record has no id",n);continue}let a=r+"_"+n.id;if(JA(n)&&(a=r+"_"+n.name),t+=`  ${r}_${n.id} [label="${a}"];
`,vm(n)&&Rw(n)&&n.aggregate_root){let[i,l]=n.aggregate_root;t+=`  ${r}_${n.id} -> ${i}_${l};
`}if(vm(n)&&Ow(n)&&n.acl){let[i,l]=n.acl;t+=`  ${r}_${n.id} -> ${i}_${l} [style=dotted];
`}}return t+="}",t}cascade(t,r){let s=this.collections.get(t),n=this.relationships.get([t,r].join(":")),a=Br.getInstance();a.beginTransaction(),s&&(this.warn("cascade delete parent",t,r),s.delete(r)),this.relationships.delete([t,r].join(":"));for(let i of n||[]){let[l,c]=i.split(":");this.warn("cascade delete child",l,c),this.getCollection(l)&&this.cascade(l,c)}a.commitTransaction()}},Em=class extends Fi{constructor(t,r,s,n){super();this.users=s,this.roles=n,this.relays=r,this.relayRole=t}update(t){return this.relayRole=t,this}get id(){return this.relayRole.id}get userId(){return this.relayRole.user}get user(){let t=this.users.get(this.relayRole.user);if(!t)throw new Error(`Unable to find user: ${this.relayRole.user}`);return t}get role(){var t;return(t=this.roles.get(this.relayRole.role))==null?void 0:t.name}get relayId(){return this.relayRole.relay}get relay(){let t=this.relays.get(this.relayRole.relay);if(!t)throw new Error(`invalid role: unable to find relay ${this.relayRole.relay} on role ${this.relayRole.id}`);return t}get aggregate_root(){return["relays",this.relayRole.relay]}get acl(){return["users",this.relayRole.user]}},Mm=class{constructor(e,t,r){this.relayInvitation=e,this.roles=r,this.relays=t}update(e){return this.relayInvitation=e,this}get key(){return this.relayInvitation.key}get id(){return this.relayInvitation.id}get role(){var e;return(e=this.roles.get(this.relayInvitation.role))==null?void 0:e.name}get relayId(){return this.relayInvitation.relay}get relay(){let e=this.relays.get(this.relayInvitation.relay);if(!e)throw new Error("invalid invitation");return e}get enabled(){return this.relayInvitation.enabled}get aggregate_root(){return["relays",this.relayInvitation.relay]}},Rm=class extends dt{constructor(t,r,s){super();this.subscription=t;this.relays=r;this.users=s}update(t){return this.subscription=t,this.notifyListeners(),this}get id(){return this.subscription.id}get token(){return this.subscription.token}get active(){return this.subscription.active}get user(){let t=this.users.get(this.subscription.user);if(!t)throw new Error("invalid subscription");return t}get relayId(){return this.subscription.relay}get relay(){let t=this.relays.get(this.subscription.relay);if(!t)throw new Error("invalid subscription");return t}get stripe_cancel_at(){return this.subscription.stripe_cancel_at}get cancelAt(){return this.subscription.stripe_cancel_at!==0?new Date(this.subscription.stripe_cancel_at*1e3):null}get quantity(){return this.subscription.stripe_quantity}get aggregate_root(){return["relays",this.subscription.relay]}get acl(){return["users",this.subscription.user]}},Kc=class extends dt{constructor(t,r,s,n,a,i,l){super();this.relay=t;this.relayRoles=r;this.relayInvitations=s;this.remoteFolders=n;this._subscriptions=a;this.storageQuotas=i;this.user=l}update(t){return this.relay=t,this.notifyListeners(),this}get cta(){return this.relay.cta}get plan(){return this.relay.plan}get id(){return this.relay.id}get guid(){return this.relay.guid}get name(){return this.relay.name}set name(t){this.relay.name=t}get userLimit(){return this.relay.user_limit}get role(){var s;let t=this.relay.creator===this.user.id,r=(s=this.relayRoles.find(n=>n.relayId===this.relay.id&&n.userId===this.user.id))==null?void 0:s.role;return r||(this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":"Member")}get owner(){return this.role==="Owner"}get invitation(){return this.relayInvitations.find(t=>t.relay.id===this.relay.id)}get storageQuota(){return this.storageQuotas.find(t=>t.id===this.relay.storage_quota)}get folders(){return this.remoteFolders.filter(t=>t.relay.id===this.id)}get subscriptions(){return this._subscriptions.filter(t=>t.relay.id===this.id)}get acl(){var r;let t=(r=this.relayRoles.find(s=>s.relayId===this.id&&s.userId===this.user.id))==null?void 0:r.id;if(t)return["relay_roles",t]}get provider(){return this.relay.provider}},Gc=class extends Ft{constructor(t){super();this.loginManager=t;this.destroyed=!1;this.pb=this.loginManager.pb,this.users=new yr("users"),this.relays=new yr("relays"),this.remoteFolders=new yr("remote folders"),this.relayInvitations=new yr("relay invitations"),this.relayRoles=new yr("relay roles"),this.roles=new yr("roles"),this.roles.set("2arnubkcv7jpce8",{name:"Owner",id:"2arnubkcv7jpce8"}),this.roles.set("x6lllh2qsf9lxk6",{name:"Member",id:"x6lllh2qsf9lxk6"}),this.subscriptions=new yr("subscriptions"),this.storageQuotas=new yr("storage quotas"),this._offLoginManager=this.loginManager.on(()=>{this.login()}),this.setUser(),this.user&&(Bt.set(this,"RelayManager"),this.buildGraph(),this.subscribe(),this.update())}buildGraph(){if(!this.user)return;if(!this.pb){console.warn("no pb!");return}if(this.store)return;let t=new _m(this.roles),r=new Dm(this.users),s=new Lm(this.relays,this.roles,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.user),n=new Tm(this.relayRoles,this.relays,this.users,this.roles),a=new Pm(this.relayInvitations,this.relays,this.roles),i=new Im(this.remoteFolders,this.relays,this.users),l=new Fm(this.subscriptions,this.relays,this.users),c=new km(this.storageQuotas,this.relays);this.store=new Am([t,r,s,n,a,i,l,c])}setUser(){var t;this.authUser=(t=this.pb)==null?void 0:t.authStore.model,this.authUser&&(this.user=new zc(this.authUser),this.users.set(this.user.id,this.user))}login(){this.setUser(),this.buildGraph(),this.subscribe(),this.update()}logout(){var t;(t=this.store)==null||t.clear(),this.user=void 0,this.store=void 0}async rotateKey(t){if(!this.pb)throw new Error("missing pocketbase");return this.pb.send("/api/rotate-key",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.id})}).then(r=>{var n;let s=(n=this.store)==null?void 0:n.ingest(r);if(!s)throw new Error("unable to rotate key");return s})}async toggleRelayInvitation(t,r){if(!this.pb)throw new Error("missing pocketbase");return this.pb.collection("relay_invitations").update(t.id,{enabled:r}).then(s=>{var a;let n=(a=this.store)==null?void 0:a.ingest(s);if(!n)throw new Error("unable to toggle invitation enable");return n})}async getRelayInvitation(t){if(!this.pb)return;let r=this.relayInvitations.find(s=>s.relay.id===t.id);return r||this.pb.collection("relay_invitations").getList(0,200).then(s=>{s.items.forEach(a=>{var i;(i=this.store)==null||i.ingest(a)});let n=this.relayInvitations.find(a=>a.relay.id===t.id);if(n)return n})}async getSubscriptionToken(t){if(!this.pb||!this.pb.authStore.isValid)throw new Error("Auth is not valid");let r=`/api/subscription/${t.id}/token`,s=await this.pb.send(r,{method:"POST"});if(s!==200)throw new Error("Token API failed");return s.json().token}async subscribe(){var s;if(!this.pb||!this.pb.authStore.isValid||((s=this.pb.authStore.model)==null?void 0:s.id)===void 0)return;let t=[{name:"relays",expand:["relay_invitations_via_relay","shared_folders_via_relay","shared_folders_via_relay.creator","subscriptions_via_relay","subscriptions_via_relay.relay","subscriptions_via_relay.relay.storage_quota","creator"]},{name:"relay_invitations",expand:["relay"]},{name:"relay_roles",expand:["user","relay"]},{name:"shared_folders",expand:["relay","creator"]},{name:"subscriptions",expand:["user","relay"]}],r=(n,a)=>{var i,l;this.debug(`[Event]: ${n}`,a.action,a.record),a.action==="delete"?(i=this.store)==null||i.delete(a.record):(l=this.store)==null||l.ingest(a.record)};for(let n of t)this.pb.collection(n.name).subscribe("*",a=>r(n.name,a),{expand:n.expand.join(","),fetch:Rt})}async update(){let t=(s,n={})=>{var a;return!this.pb||!this.pb.authStore.isValid||((a=this.pb.authStore.model)==null?void 0:a.id)===void 0?Promise.resolve([]):(typeof n=="function"&&(n=n(this.pb.authStore.model.id)),this.pb.collection(s).getFullList(n))};[t("users",s=>({filter:`id="${s}"`,expand:["relay_roles_via_user","relay_roles_via_user.relay","relay_roles_via_user.relay.storage_quota","relay_roles_via_user.role"].join(",")})),t("relay_roles",{expand:"user"}),t("relay_invitations"),t("shared_folders",{expand:"relay,creator"}),t("subscriptions",{expand:"relay,user"})].forEach(async s=>{let n=await s;for(let a of n)!this.destroyed&&this.store&&this.store.ingest(a)})}async acceptInvitation(t){var n;if(!this.pb)throw new Error("Failed to accept invitation");let r=await this.pb.send("/api/accept-invitation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:t})}).catch(a=>{throw a});this.debug("[InviteAccept]",r);let s=(n=this.store)==null?void 0:n.ingest(r);if(!s)throw new Error("Failed to accept invitation");return s}async createRelay(t){var a;let r=ta(),s=await((a=this.pb)==null?void 0:a.collection("relays").create({guid:r,name:t,path:null},{expand:"relay_roles_via_relay,relay_invitations_via_relay,storage_quota"}));if(!s)throw new Error("Failed to create Relay");if(!this.user)throw new Error("Not Logged In");let n=new Kc(s,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.user);return this.relays.set(n.id,n),n}async updateRelay(t){var n;if(!this.pb)throw new Error("Failed to update relay");let r=await this.pb.collection("relays").update(t.id,{name:t.name.trim()}),s=(n=this.store)==null?void 0:n.ingest(r);if(!s)throw new Error("Failed to update relay");return s}async deleteRemote(t){var s;t.remote=void 0;let r=this.remoteFolders.find(n=>n.guid===t.guid);return r?(await((s=this.pb)==null?void 0:s.collection("shared_folders").delete(r.id)),t.remote=void 0,!0):!1}async createRemoteFolder(t,r){var a,i;if(!this.pb)throw new Error("Failed to create folder");let s=await this.pb.collection("shared_folders").create({name:t.name,guid:t.guid,relay:r.id,creator:(a=this.user)==null?void 0:a.id,private:!1},{expand:"relay"}),n=(i=this.store)==null?void 0:i.ingest(s);if(!n)throw new Error("Failed to create folder");return n}async destroyRelay(t){var r,s;return(r=this.store)==null||r.cascade("relays",t.id),await((s=this.pb)==null?void 0:s.collection("relays").delete(t.id)),!0}async leaveRelay(t){var s,n;let r=this.relayRoles.find(a=>{var i;return a.userId===((i=this.user)==null?void 0:i.id)&&a.relayId===t.id});r?await((s=this.pb)==null?void 0:s.collection("relay_roles").delete(r.id)):this.warn("No role found to leave relay"),(n=this.store)==null||n.cascade("relay",t.id)}async kick(t){var r;return(r=this.pb)==null?void 0:r.collection("relay_roles").delete(t.id)}destroy(){var t,r,s;this.destroyed=!0,(t=this._offLoginManager)==null||t.call(this),this._offLoginManager=null,(r=this.pb)==null||r.cancelAllRequests(),this.loginManager=null,(s=this.store)==null||s.destroy(),this.pb=null,this.authUser=null,this.store=null}};var u_=require("obsidian");var Hw=require("obsidian");var Bw=require("obsidian");function QA(o){Pe(o,"svelte-4kkvmr",".feature-flag-toggle-modal.svelte-4kkvmr{padding:1rem}.feature-flag-item.svelte-4kkvmr{display:flex;justify-content:space-between;align-items:center;padding:0.5rem 0;border-top:1px solid var(--background-modifier-border)}.checkbox-container.svelte-4kkvmr{cursor:pointer}")}function Uw(o,e,t){let r=o.slice();return r[8]=e[t][0],r[9]=e[t][1],r}function $w(o){let e,t,r,s=o[8]+"",n,a,i,l,c=o[8]+"",u,d,m,g,h,_,w,v,A,O,E,M;function R(){return o[6](o[8])}function D(){return o[7](o[8])}return{c(){e=T("div"),t=T("div"),r=T("div"),n=K(s),a=U(),i=T("div"),l=K("Toggle "),u=K(c),d=K(" on or off"),m=U(),g=T("div"),h=T("div"),_=T("input"),v=U(),A=T("div"),x(r,"class","setting-item-name"),x(i,"class","setting-item-description"),x(t,"class","setting-item-info"),x(_,"type","checkbox"),x(_,"tabindex","-1"),_.checked=w=o[9],x(A,"class","checkbox-toggle"),x(h,"role","checkbox"),x(h,"aria-checked",O=o[9]),x(h,"tabindex","0"),x(h,"class","checkbox-container svelte-4kkvmr"),Be(h,"is-enabled",o[9]),x(g,"class","setting-item-control"),x(e,"class","feature-flag-item setting-item svelte-4kkvmr")},m(F,V){I(F,e,V),k(e,t),k(t,r),k(r,n),k(t,a),k(t,i),k(i,l),k(i,u),k(i,d),k(e,m),k(e,g),k(g,h),k(h,_),k(h,v),k(h,A),E||(M=[te(h,"keypress",R),te(h,"click",D)],E=!0)},p(F,V){o=F,V&2&&s!==(s=o[8]+"")&&ne(n,s),V&2&&c!==(c=o[8]+"")&&ne(u,c),V&2&&w!==(w=o[9])&&(_.checked=w),V&2&&O!==(O=o[9])&&x(h,"aria-checked",O),V&2&&Be(h,"is-enabled",o[9])},d(F){F&&C(e),E=!1,Ce(M)}}}function XA(o){let e,t,r,s,n,a,i,l,c,u=Ae(Object.entries(o[1])),d=[];for(let m=0;m<u.length;m+=1)d[m]=$w(Uw(o,u,m));return{c(){e=T("div"),t=T("h2"),t.textContent="Feature Flags",r=U();for(let m=0;m<d.length;m+=1)d[m].c();s=U(),n=T("div"),a=T("div"),i=T("button"),i.textContent="Apply",x(i,"aria-label","apply flag settings"),x(i,"tabindex","0"),x(a,"class","setting-item-control"),x(n,"class","setting-item"),x(e,"class","feature-flag-toggle-modal svelte-4kkvmr")},m(m,g){I(m,e,g),k(e,t),k(e,r);for(let h=0;h<d.length;h+=1)d[h]&&d[h].m(e,null);k(e,s),k(e,n),k(n,a),k(a,i),l||(c=[te(i,"click",function(){pt(o[0])&&o[0].apply(this,arguments)}),te(i,"keypress",function(){pt(o[0])&&o[0].apply(this,arguments)})],l=!0)},p(m,[g]){if(o=m,g&26){u=Ae(Object.entries(o[1]));let h;for(h=0;h<u.length;h+=1){let _=Uw(o,u,h);d[h]?d[h].p(_,g):(d[h]=$w(_),d[h].c(),d[h].m(e,s))}for(;h<d.length;h+=1)d[h].d(1);d.length=u.length}},i:X,o:X,d(m){m&&C(e),st(d,m),l=!1,Ce(c)}}}function ZA(o,e,t){let r,s,{reload:n}=e,a=Nt.getInstance();me(o,a,d=>t(5,s=d));function i(d){let m=!r[d];t(1,r[d]=m,r),a.setFlag(d,r[d])}function l(d){return d in r}lr(()=>{Object.keys(r).forEach(d=>{let m=document.getElementById(`toggle-${d}`);m&&(0,Bw.setIcon)(m,"check")})});let c=d=>{if(!l(d))throw new Error("Unexpected feature flag!");i(d)},u=d=>{if(!l(d))throw new Error("Unexpected feature flag!");i(d)};return o.$$set=d=>{"reload"in d&&t(0,n=d.reload)},o.$$.update=()=>{if(o.$$.dirty&32){e:t(1,r=Object.assign({},s.flags))}},[n,r,a,i,l,s,c,u]}var Om=class extends ee{constructor(e){super(),oe(this,e,ZA,XA,Z,{reload:0},QA)}},Nw=Om;var jc=class extends Hw.Modal{constructor(t,r){super(t);this.reload=r}onOpen(){let{contentEl:t}=this;this.component=new Nw({target:t,props:{reload:this.reload}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Qw=require("obsidian");var Yw=require("obsidian");function Vw(o,e,t){let r=o.slice();return r[13]=e[t],r}function qw(o,e,t){let r=o.slice();return r[16]=e[t],r}function eE(o){let e,t,r;return{c(){e=T("button"),e.textContent="Refresh"},m(s,n){I(s,e,n),t||(r=te(e,"click",(0,Yw.debounce)(o[12])),t=!0)},p:X,d(s){s&&C(e),t=!1,r()}}}function tE(o){let e=navigator.userAgent+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p:X,d(r){r&&C(t)}}}function rE(o){let e;return{c(){e=K(o[1])},m(t,r){I(t,e,r)},p(t,r){r&2&&ne(e,t[1])},d(t){t&&C(e)}}}function oE(o){let e;return{c(){e=K(o[2])},m(t,r){I(t,e,r)},p(t,r){r&4&&ne(e,t[2])},d(t){t&&C(e)}}}function sE(o){let e;return{c(){e=K(o[3])},m(t,r){I(t,e,r)},p(t,r){r&8&&ne(e,t[3])},d(t){t&&C(e)}}}function nE(o){let e=o[0].loadTime?`${o[0].loadTime}ms`:"unknown",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s&1&&e!==(e=r[0].loadTime?`${r[0].loadTime}ms`:"unknown")&&ne(t,e)},d(r){r&&C(t)}}}function Ww(o){let e,t=`${o[16]}`,r,s;return{c(){e=T("div"),r=K(t),s=U()},m(n,a){I(n,e,a),k(e,r),k(e,s)},p(n,a){a&16&&t!==(t=`${n[16]}`)&&ne(r,t)},d(n){n&&C(e)}}}function aE(o){let e,t=Ae(Object.keys(o[4].cancelControllers)),r=[];for(let s=0;s<t.length;s+=1)r[s]=Ww(qw(o,t,s));return{c(){e=T("div");for(let s=0;s<r.length;s+=1)r[s].c();x(e,"slot","description")},m(s,n){I(s,e,n);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(s,n){if(n&16){t=Ae(Object.keys(s[4].cancelControllers));let a;for(a=0;a<t.length;a+=1){let i=qw(s,t,a);r[a]?r[a].p(i,n):(r[a]=Ww(i),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(s){s&&C(e),st(r,s)}}}function zw(o){let e,t=`${o[13]}`,r,s;return{c(){e=T("div"),r=K(t),s=U()},m(n,a){I(n,e,a),k(e,r),k(e,s)},p(n,a){a&32&&t!==(t=`${n[13]}`)&&ne(r,t)},d(n){n&&C(e)}}}function iE(o){let e,t=Ae(o[5]),r=[];for(let s=0;s<t.length;s+=1)r[s]=zw(Vw(o,t,s));return{c(){e=T("div");for(let s=0;s<r.length;s+=1)r[s].c();x(e,"slot","description")},m(s,n){I(s,e,n);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(s,n){if(n&32){t=Ae(s[5]);let a;for(a=0;a<t.length;a+=1){let i=Vw(s,t,a);r[a]?r[a].p(i,n):(r[a]=zw(i),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(s){s&&C(e),st(r,s)}}}function lE(o){let e,t,r,s,n,a,i,l,c,u,d,m,g,h,_,w,v,A,O,E,M,R,D;return s=new Je({props:{name:"Environment",$$slots:{default:[eE]},$$scope:{ctx:o}}}),a=new ze({props:{name:"User Agent",description:"",$$slots:{default:[tE]},$$scope:{ctx:o}}}),l=new ze({props:{name:"Fetch",description:"",$$slots:{default:[rE]},$$scope:{ctx:o}}}),u=new ze({props:{name:"Response",description:"",$$slots:{default:[oE]},$$scope:{ctx:o}}}),m=new ze({props:{name:"Blink Fetch",description:"",$$slots:{default:[sE]},$$scope:{ctx:o}}}),h=new ze({props:{name:"Startup Time",description:"",$$slots:{default:[nE]},$$scope:{ctx:o}}}),w=new Je({props:{name:"Connections"}}),A=new ze({props:{name:"",description:"",$$slots:{description:[aE]},$$scope:{ctx:o}}}),E=new Je({props:{name:"Log Files"}}),R=new ze({props:{name:"",description:"",$$slots:{description:[iE]},$$scope:{ctx:o}}}),{c(){e=T("div"),e.textContent="Debug Info",t=U(),r=T("div"),H(s.$$.fragment),n=U(),H(a.$$.fragment),i=U(),H(l.$$.fragment),c=U(),H(u.$$.fragment),d=U(),H(m.$$.fragment),g=U(),H(h.$$.fragment),_=U(),H(w.$$.fragment),v=U(),H(A.$$.fragment),O=U(),H(E.$$.fragment),M=U(),H(R.$$.fragment),x(e,"class","modal-title"),x(r,"class","modal-content")},m(F,V){I(F,e,V),I(F,t,V),I(F,r,V),B(s,r,null),k(r,n),B(a,r,null),k(r,i),B(l,r,null),k(r,c),B(u,r,null),k(r,d),B(m,r,null),k(r,g),B(h,r,null),k(r,_),B(w,r,null),k(r,v),B(A,r,null),k(r,O),B(E,r,null),k(r,M),B(R,r,null),D=!0},p(F,[V]){let q={};V&524288&&(q.$$scope={dirty:V,ctx:F}),s.$set(q);let j={};V&524288&&(j.$$scope={dirty:V,ctx:F}),a.$set(j);let z={};V&524290&&(z.$$scope={dirty:V,ctx:F}),l.$set(z);let Y={};V&524292&&(Y.$$scope={dirty:V,ctx:F}),u.$set(Y);let pe={};V&524296&&(pe.$$scope={dirty:V,ctx:F}),m.$set(pe);let De={};V&524289&&(De.$$scope={dirty:V,ctx:F}),h.$set(De);let G={};V&524304&&(G.$$scope={dirty:V,ctx:F}),A.$set(G);let se={};V&524320&&(se.$$scope={dirty:V,ctx:F}),R.$set(se)},i(F){D||(S(s.$$.fragment,F),S(a.$$.fragment,F),S(l.$$.fragment,F),S(u.$$.fragment,F),S(m.$$.fragment,F),S(h.$$.fragment,F),S(w.$$.fragment,F),S(A.$$.fragment,F),S(E.$$.fragment,F),S(R.$$.fragment,F),D=!0)},o(F){P(s.$$.fragment,F),P(a.$$.fragment,F),P(l.$$.fragment,F),P(u.$$.fragment,F),P(m.$$.fragment,F),P(h.$$.fragment,F),P(w.$$.fragment,F),P(A.$$.fragment,F),P(E.$$.fragment,F),P(R.$$.fragment,F),D=!1},d(F){F&&(C(e),C(t),C(r)),N(s),N(a),N(l),N(u),N(m),N(h),N(w),N(A),N(E),N(R)}}}function Kw(){try{return Response.toString()}catch(o){return"undefined"}}function Gw(){try{return fetch.toString()}catch(o){return"undefined"}}function jw(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}function cE(o,e,t){let r,s,n,a,i,{plugin:l}=e,c=_e(Kw());me(o,c,w=>t(2,s=w));let u=_e(Gw());me(o,u,w=>t(1,r=w));let d=_e(jw());me(o,d,w=>t(3,n=w));let m=_e(l.loginManager.pb);me(o,m,w=>t(4,a=w));let g=_e([]);me(o,g,w=>t(5,i=w)),Ml().then(w=>{g.set(w)});function h(){c.set(Kw()),u.set(Gw()),d.set(jw()),m.set(l.loginManager.pb)}let _=()=>{h()};return o.$$set=w=>{"plugin"in w&&t(0,l=w.plugin)},[l,r,s,n,a,i,c,u,d,m,g,h,_]}var Um=class extends ee{constructor(e){super(),oe(this,e,cE,lE,Z,{plugin:0})}},Jw=Um;var Yc=class extends Qw.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new Jw({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Xw=require("obsidian"),Jc=class{notify(e){new Xw.Notice(e)}},Qc=class{constructor(e){this.vault=e}async append(e,t){return this.vault.adapter.append(e,t)}async stat(e){return this.vault.adapter.stat(e)}async exists(e){return this.vault.adapter.exists(e)}async remove(e){return this.vault.adapter.remove(e)}async rename(e,t){return this.vault.adapter.rename(e,t)}async write(e,t){return this.vault.adapter.write(e,t)}async read(e){return this.vault.adapter.read(e)}};var iv=require("obsidian");var nv=require("obsidian");function fE(o){Pe(o,"svelte-jmqfac",".system3-bug-report.svelte-jmqfac{display:flex;flex-direction:column;height:100%;min-height:30em}.report-container.svelte-jmqfac{display:flex;flex-direction:column;flex:1}.form-content.svelte-jmqfac{flex:1;overflow-y:auto}textarea.svelte-jmqfac{width:100%;height:300px;resize:vertical}.centered-message.svelte-jmqfac{display:flex;flex:1;align-items:center;justify-content:center;padding-bottom:5em}")}function Zw(o,e,t){let r=o.slice();return r[21]=e[t],r}function uE(o){let e,t,r,s,n,a,i,l,c,u,d,m,g;r=new ze({props:{name:"Description",description:"Please describe what went wrong and what you were trying to do."}}),i=new ze({props:{name:"Include Logs",description:"Send logs to the Relay developers to help them debug the issue.",$$slots:{default:[mE]},$$scope:{ctx:o}}});let h=o[4]&&ev(o);return u=new ze({props:{name:"",description:"",$$slots:{default:[gE]},$$scope:{ctx:o}}}),{c(){e=T("div"),t=T("div"),H(r.$$.fragment),s=U(),n=T("textarea"),a=U(),H(i.$$.fragment),l=U(),h&&h.c(),c=U(),H(u.$$.fragment),x(n,"placeholder","Describe the issue here..."),x(n,"class","svelte-jmqfac"),x(t,"class","form-content svelte-jmqfac"),x(e,"class","report-container svelte-jmqfac")},m(_,w){I(_,e,w),k(e,t),B(r,t,null),k(t,s),k(t,n),ir(n,o[3]),k(t,a),B(i,t,null),k(t,l),h&&h.m(t,null),k(e,c),B(u,e,null),d=!0,m||(g=te(n,"input",o[13]),m=!0)},p(_,w){w&8&&ir(n,_[3]);let v={};w&16777232&&(v.$$scope={dirty:w,ctx:_}),i.$set(v),_[4]?h?(h.p(_,w),w&16&&S(h,1)):(h=ev(_),h.c(),S(h,1),h.m(t,null)):h&&(he(),P(h,1,1,()=>{h=null}),ge());let A={};w&16777293&&(A.$$scope={dirty:w,ctx:_}),u.$set(A)},i(_){d||(S(r.$$.fragment,_),S(i.$$.fragment,_),S(h),S(u.$$.fragment,_),d=!0)},o(_){P(r.$$.fragment,_),P(i.$$.fragment,_),P(h),P(u.$$.fragment,_),d=!1},d(_){_&&C(e),N(r),N(i),h&&h.d(),N(u),m=!1,g()}}}function dE(o){let e;return{c(){e=T("div"),e.innerHTML='<div id="spinner" class="d-flex align-items-center"><strong>Sending Bug Report...</strong> <div class="spinner-border ms-auto" role="status" aria-hidden="true"></div></div>',x(e,"class","centered-message svelte-jmqfac")},m(t,r){I(t,e,r)},p:X,i:X,o:X,d(t){t&&C(e)}}}function pE(o){let e,t,r;return t=new ze({props:{name:"Thank you!",description:"Your bug report will help us improve Relay."}}),{c(){e=T("div"),H(t.$$.fragment),x(e,"class","centered-message svelte-jmqfac")},m(s,n){I(s,e,n),B(t,e,null),r=!0},p:X,i(s){r||(S(t.$$.fragment,s),r=!0)},o(s){P(t.$$.fragment,s),r=!1},d(s){s&&C(e),N(t)}}}function mE(o){let e,t,r,s,n,a;return{c(){e=T("div"),t=T("input"),r=U(),s=T("div"),x(t,"type","checkbox"),x(t,"tabindex","-1"),t.checked=o[4],x(s,"class","checkbox-toggle"),x(e,"role","checkbox"),x(e,"aria-checked",o[4]),x(e,"tabindex","0"),x(e,"class","checkbox-container"),Be(e,"is-enabled",o[4])},m(i,l){I(i,e,l),k(e,t),k(e,r),k(e,s),n||(a=[te(e,"keypress",xE),te(e,"click",o[14])],n=!0)},p(i,l){l&16&&(t.checked=i[4]),l&16&&x(e,"aria-checked",i[4]),l&16&&Be(e,"is-enabled",i[4])},d(i){i&&C(e),n=!1,Ce(a)}}}function ev(o){let e,t;return e=new ze({props:{name:"Logs",description:"",$$slots:{description:[hE]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&16777248&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function tv(o){let e,t=`${o[21]}
`,r,s;return{c(){e=T("div"),r=K(t),s=U()},m(n,a){I(n,e,a),k(e,r),k(e,s)},p(n,a){a&32&&t!==(t=`${n[21]}
`)&&ne(r,t)},d(n){n&&C(e)}}}function hE(o){let e,t=Ae(o[5]),r=[];for(let s=0;s<t.length;s+=1)r[s]=tv(Zw(o,t,s));return{c(){e=T("div");for(let s=0;s<r.length;s+=1)r[s].c();x(e,"slot","description")},m(s,n){I(s,e,n);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(s,n){if(n&32){t=Ae(s[5]);let a;for(a=0;a<t.length;a+=1){let i=Zw(s,t,a);r[a]?r[a].p(i,n):(r[a]=tv(i),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(s){s&&C(e),st(r,s)}}}function gE(o){let e,t,r,s;return{c(){e=T("button"),t=K("Send"),e.disabled=o[2]},m(n,a){I(n,e,a),k(e,t),r||(s=te(e,"click",o[15]),r=!0)},p(n,a){a&4&&(e.disabled=n[2])},d(n){n&&C(e),r=!1,s()}}}function yE(o){let e,t,r,s,n,a,i=[pE,dE,uE],l=[];function c(u,d){return u[1]?0:u[2]&&!u[1]?1:2}return s=c(o,-1),n=l[s]=i[s](o),{c(){e=T("div"),e.textContent="Send Bug Report",t=U(),r=T("div"),n.c(),x(e,"class","modal-title"),x(r,"class","modal-content system3-bug-report svelte-jmqfac")},m(u,d){I(u,e,d),I(u,t,d),I(u,r,d),l[s].m(r,null),a=!0},p(u,[d]){let m=s;s=c(u,d),s===m?l[s].p(u,d):(he(),P(l[m],1,1,()=>{l[m]=null}),ge(),n=l[s],n?n.p(u,d):(n=l[s]=i[s](u),n.c()),S(n,1),n.m(r,null))},i(u){a||(S(n),a=!0)},o(u){P(n),a=!1},d(u){u&&(C(e),C(t),C(r)),l[s].d()}}}function rv(){try{return Response.toString()}catch(o){return"undefined"}}function ov(){try{return fetch.toString()}catch(o){return"undefined"}}function sv(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}var xE=()=>{};function bE(o,e,t){let r,s,n,a,i,l,{plugin:c}=e,u=_e(rv()),d=_e(ov()),m=_e(sv()),g=_e("");me(o,g,F=>t(3,n=F));let h=_e(!1);me(o,h,F=>t(4,a=F));let _=_e(!1),w=_e(!1);me(o,w,F=>t(2,s=F));let v=_e(!1);me(o,v,F=>t(1,r=F));let A=_e(c.loginManager.pb);me(o,A,F=>t(6,l=F));let O=_e([]);me(o,O,F=>t(5,i=F)),Ml().then(F=>{O.set(F)});function E(){u.set(rv()),d.set(ov()),m.set(sv()),A.set(c.loginManager.pb)}function M(){n=this.value,g.set(n)}let R=()=>{let F=!a;h.set(F)},D=async()=>{var V;let F=`Bug Report

`;if(F+=JSON.stringify({userAgent:navigator.userAgent,manifest:c.manifest,user:(V=l==null?void 0:l.authStore.model)==null?void 0:V.id,loadTime:c.loadTime,description:n},null,2),F+=`

`,h){let q=await Gy();F+=q}(0,nv.requestUrl)({url:"https://bug-reports.system3.dev",method:"PUT",body:F,headers:{"Content-Type":"text/plain"}}).then(()=>{v.set(!0)}),w.set(!0)};return o.$$set=F=>{"plugin"in F&&t(0,c=F.plugin)},[c,r,s,n,a,i,l,g,h,w,v,A,O,M,R,D]}var $m=class extends ee{constructor(e){super(),oe(this,e,bE,yE,Z,{plugin:0},fE)}},av=$m;var Xc=class extends iv.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new av({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var gv=require("obsidian");async function lv(o){let{appId:e,filterByAppId:t,onProgress:r}=o,s=await window.indexedDB.databases(),n=s.length,a=[],i=0,l=0,c=0,u=0;for(let d of s)if(d.name){try{let m=await new Promise((g,h)=>{let _=indexedDB.open(d.name);_.onerror=()=>h(_.error),_.onsuccess=w=>g(w.target.result)});try{let g=Array.from(m.objectStoreNames);if(!g.includes("updates")||!g.includes("custom"))continue;let h=m.transaction(["updates","custom"],"readonly"),_=h.objectStore("updates"),w=h.objectStore("custom"),v=await new Promise(O=>{let E=w.get("appId");E.onsuccess=()=>O(E.result||"")});i++;let A=await new Promise((O,E)=>{let M=_.count();M.onsuccess=()=>O(M.result),M.onerror=()=>E(M.error)});if(l+=A,A>0){let O=0;if(await new Promise((E,M)=>{let R=_.openCursor();R.onsuccess=D=>{let F=D.target.result;if(F){let V=F.value instanceof Uint8Array?F.value.byteLength:JSON.stringify(F.value).length;O+=V,F.continue()}else E()},R.onerror=()=>M(R.error)}),c+=O,O>1024*1024&&(!t||v===e)){let E=await new Promise(D=>{let F=w.get("path");F.onsuccess=()=>D(F.result||"")}),M=await new Promise(D=>{let F=w.get("relay");F.onsuccess=()=>D(F.result||"")}),R=!d.name.startsWith(`${e}-relay`);a.push({slug:`${d.name}/${_.name}`,path:E,relay:M,appId:v||"unknown",count:A,estimatedSizeMB:Math.round(O/(1024*1024)*100)/100,isLegacy:R})}}}finally{m.close()}}catch(m){console.error(`Error processing database ${d.name}:`,m);continue}u++,r&&r(u/s.length*100)}return{totalStores:i,totalItems:l,totalSizeMB:Math.round(c/(1024*1024)*100)/100,databaseCount:n,largeStores:a.sort((d,m)=>m.estimatedSizeMB-d.estimatedSizeMB)}}async function cv(o){let[e,t]=o.split("/"),r=await new Promise((s,n)=>{let a=indexedDB.open(e);a.onerror=()=>n(a.error),a.onsuccess=()=>s(a.result)});try{let n=r.transaction(t,"readwrite").objectStore(t);await new Promise((a,i)=>{let l=n.clear();l.onsuccess=()=>a(),l.onerror=()=>i(l.error)})}catch(s){console.error(`Error deleting store: ${o}`,s)}finally{r.close()}}var MY=require("obsidian");function wE(o){Pe(o,"svelte-1n3w4sk",".system3-dangerous.svelte-1n3w4sk:enabled{background-color:var(--background-modifier-error)}.system3-indexeddb-analysis.svelte-1n3w4sk{padding:1rem;max-height:500px;overflow-y:auto}.system3-loading-container.svelte-1n3w4sk{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;gap:1rem}.system3-loading-spinner.svelte-1n3w4sk{border:4px solid var(--background-modifier-border);border-top:4px solid var(--interactive-accent);border-radius:50%;width:40px;height:40px;animation:svelte-1n3w4sk-spin 1s linear infinite}.system3-progress-bar.svelte-1n3w4sk{width:80%;height:8px;border-radius:4px;background-color:var(--background-secondary);overflow:hidden;margin:0 auto}.system3-progress-fill.svelte-1n3w4sk{height:100%;background-color:var(--color-accent);border-radius:4px;transition:width 0.3s ease;min-width:0%;max-width:100%}.system3-error-message.svelte-1n3w4sk{color:var(--text-error);padding:1rem;background-color:var(--mod-error);border-radius:4px}.system3-actions.svelte-1n3w4sk{display:flex;gap:0.5rem}.system3-summary-stats.svelte-1n3w4sk{display:grid;grid-template-columns:repeat(3, 1fr);gap:1rem;margin-bottom:2rem;padding:1rem;background-color:var(--background-secondary);border-radius:4px}.system3-stat-item.svelte-1n3w4sk{text-align:center}.system3-global-count.svelte-1n3w4sk{grid-column:1 / -1;padding-top:0.5rem;margin-top:0.5rem;border-bottom:1px solid var(--background-modifier-border)}.system3-warning.svelte-1n3w4sk{color:var(--text-warning)}.system3-critical.svelte-1n3w4sk{color:var(--text-error)}.system3-warning-text.svelte-1n3w4sk{font-size:0.8em;margin-top:0.5rem;color:var(--text-warning);line-height:1.4}.system3-warning-text.system3-critical.svelte-1n3w4sk{color:var(--text-error);font-weight:bold}.system3-stat-label.svelte-1n3w4sk{font-size:0.9em;color:var(--text-muted);margin-bottom:0.5rem}.system3-stat-value.svelte-1n3w4sk{font-size:1.2em;font-weight:bold}@keyframes svelte-1n3w4sk-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}")}function fv(o,e,t){let r=o.slice();return r[18]=e[t][0],r[19]=e[t][1],r}function uv(o,e,t){let r=o.slice();return r[22]=e[t],r}function vE(o){let e,t,r,s,n,a=o[0].databaseCount.toLocaleString()+"",i,l,c,u,d,m,g,h,_=o[0].totalStores+"",w,v,A,O,E,M,R=o[0].totalItems.toLocaleString()+"",D,F,V,q,j,z,Y=o[0].totalSizeMB.toFixed(2)+"",pe,De,G,se,ke;function Qe(W,Fe){if(W[0].databaseCount>45e3)return CE;if(W[0].databaseCount>4e4)return kE}let Re=Qe(o,-1),ce=Re&&Re(o),le=o[0].largeStores.length>0&&dv(o);return{c(){e=T("div"),t=T("div"),r=T("div"),r.textContent="Global Database Limit",s=U(),n=T("div"),i=K(a),l=K(" / 50,000"),c=U(),ce&&ce.c(),u=U(),d=T("div"),m=T("div"),m.textContent="Relay Databases",g=U(),h=T("div"),w=K(_),v=U(),A=T("div"),O=T("div"),O.textContent="Document Updates",E=U(),M=T("div"),D=K(R),F=U(),V=T("div"),q=T("div"),q.textContent="Total Size",j=U(),z=T("div"),pe=K(Y),De=K(" MB"),G=U(),le&&le.c(),se=Ie(),x(r,"class","system3-stat-label svelte-1n3w4sk"),x(n,"class","system3-stat-value svelte-1n3w4sk"),Be(n,"system3-warning",o[0].databaseCount>4e4),Be(n,"system3-critical",o[0].databaseCount>45e3),x(t,"class","system3-stat-item system3-global-count svelte-1n3w4sk"),x(m,"class","system3-stat-label svelte-1n3w4sk"),x(h,"class","system3-stat-value svelte-1n3w4sk"),x(d,"class","system3-stat-item svelte-1n3w4sk"),x(O,"class","system3-stat-label svelte-1n3w4sk"),x(M,"class","system3-stat-value svelte-1n3w4sk"),x(A,"class","system3-stat-item svelte-1n3w4sk"),x(q,"class","system3-stat-label svelte-1n3w4sk"),x(z,"class","system3-stat-value svelte-1n3w4sk"),x(V,"class","system3-stat-item svelte-1n3w4sk"),x(e,"class","system3-summary-stats svelte-1n3w4sk")},m(W,Fe){I(W,e,Fe),k(e,t),k(t,r),k(t,s),k(t,n),k(n,i),k(n,l),k(t,c),ce&&ce.m(t,null),k(e,u),k(e,d),k(d,m),k(d,g),k(d,h),k(h,w),k(e,v),k(e,A),k(A,O),k(A,E),k(A,M),k(M,D),k(e,F),k(e,V),k(V,q),k(V,j),k(V,z),k(z,pe),k(z,De),I(W,G,Fe),le&&le.m(W,Fe),I(W,se,Fe),ke=!0},p(W,Fe){(!ke||Fe&1)&&a!==(a=W[0].databaseCount.toLocaleString()+"")&&ne(i,a),(!ke||Fe&1)&&Be(n,"system3-warning",W[0].databaseCount>4e4),(!ke||Fe&1)&&Be(n,"system3-critical",W[0].databaseCount>45e3),Re!==(Re=Qe(W,Fe))&&(ce&&ce.d(1),ce=Re&&Re(W),ce&&(ce.c(),ce.m(t,null))),(!ke||Fe&1)&&_!==(_=W[0].totalStores+"")&&ne(w,_),(!ke||Fe&1)&&R!==(R=W[0].totalItems.toLocaleString()+"")&&ne(D,R),(!ke||Fe&1)&&Y!==(Y=W[0].totalSizeMB.toFixed(2)+"")&&ne(pe,Y),W[0].largeStores.length>0?le?(le.p(W,Fe),Fe&1&&S(le,1)):(le=dv(W),le.c(),S(le,1),le.m(se.parentNode,se)):le&&(he(),P(le,1,1,()=>{le=null}),ge())},i(W){ke||(S(le),ke=!0)},o(W){P(le),ke=!1},d(W){W&&(C(e),C(G),C(se)),ce&&ce.d(),le&&le.d(W)}}}function _E(o){let e,t;return{c(){e=T("div"),t=K(o[5]),x(e,"class","system3-error-message svelte-1n3w4sk")},m(r,s){I(r,e,s),k(e,t)},p(r,s){s&32&&ne(t,r[5])},i:X,o:X,d(r){r&&C(e)}}}function SE(o){let e,t,r,s,n,a,i;return{c(){e=T("div"),t=T("div"),r=U(),s=T("div"),s.textContent="Analyzing Databases...",n=U(),a=T("div"),i=T("div"),x(t,"class","system3-loading-spinner svelte-1n3w4sk"),x(s,"class","loading-text"),x(i,"class","system3-progress-fill svelte-1n3w4sk"),de(i,"width",o[4]+"%"),x(a,"class","system3-progress-bar svelte-1n3w4sk"),x(e,"class","system3-loading-container svelte-1n3w4sk")},m(l,c){I(l,e,c),k(e,t),k(e,r),k(e,s),k(e,n),k(e,a),k(a,i)},p(l,c){c&16&&de(i,"width",l[4]+"%")},i:X,o:X,d(l){l&&C(e)}}}function kE(o){let e;return{c(){e=T("div"),e.innerHTML=`Warning: high number of databases.<br/>
						Consider cleaning up unused databases.`,x(e,"class","system3-warning-text svelte-1n3w4sk")},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function CE(o){let e;return{c(){e=T("div"),e.innerHTML=`Critical: approaching IndexedDB database limit!<br/>
						Your browser may start deleting old databases soon.`,x(e,"class","system3-warning-text system3-critical svelte-1n3w4sk")},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function dv(o){let e,t,r,s;e=new Je({props:{name:"Large Stores (>1MB)"}});let n=Ae(o[2]),a=[];for(let l=0;l<n.length;l+=1)a[l]=mv(fv(o,n,l));let i=l=>P(a[l],1,1,()=>{a[l]=null});return{c(){H(e.$$.fragment),t=U();for(let l=0;l<a.length;l+=1)a[l].c();r=Ie()},m(l,c){B(e,l,c),I(l,t,c);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(l,c);I(l,r,c),s=!0},p(l,c){if(c&2052){n=Ae(l[2]);let u;for(u=0;u<n.length;u+=1){let d=fv(l,n,u);a[u]?(a[u].p(d,c),S(a[u],1)):(a[u]=mv(d),a[u].c(),S(a[u],1),a[u].m(r.parentNode,r))}for(he(),u=n.length;u<a.length;u+=1)i(u);ge()}},i(l){if(!s){S(e.$$.fragment,l);for(let c=0;c<n.length;c+=1)S(a[c]);s=!0}},o(l){P(e.$$.fragment,l),a=a.filter(Boolean);for(let c=0;c<a.length;c+=1)P(a[c]);s=!1},d(l){l&&(C(t),C(r)),N(e,l),st(a,l)}}}function IE(o){let e,t,r,s,n;function a(){return o[17](o[22])}return{c(){e=T("div"),t=T("button"),t.textContent="Delete",r=U(),x(t,"class","mod-warning"),x(t,"title","Delete all data in this store"),x(e,"class","system3-actions svelte-1n3w4sk")},m(i,l){I(i,e,l),k(e,t),I(i,r,l),s||(n=te(t,"click",a),s=!0)},p(i,l){o=i},d(i){i&&(C(e),C(r)),s=!1,n()}}}function pv(o){let e,t;return e=new ze({props:{name:o[22].path||o[22].slug,description:"Size: "+o[22].estimatedSizeMB+"MB, Items: "+o[22].count,$$slots:{default:[IE]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&4&&(n.name=r[22].path||r[22].slug),s&4&&(n.description="Size: "+r[22].estimatedSizeMB+"MB, Items: "+r[22].count),s&33554436&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function mv(o){let e,t,r,s;e=new Je({props:{name:o[18]==="local"?"Tracked Documents":`Relay: ${o[18]}`}});let n=Ae(o[19]),a=[];for(let l=0;l<n.length;l+=1)a[l]=pv(uv(o,n,l));let i=l=>P(a[l],1,1,()=>{a[l]=null});return{c(){H(e.$$.fragment),t=U();for(let l=0;l<a.length;l+=1)a[l].c();r=Ie()},m(l,c){B(e,l,c),I(l,t,c);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(l,c);I(l,r,c),s=!0},p(l,c){let u={};if(c&4&&(u.name=l[18]==="local"?"Tracked Documents":`Relay: ${l[18]}`),e.$set(u),c&2052){n=Ae(l[19]);let d;for(d=0;d<n.length;d+=1){let m=uv(l,n,d);a[d]?(a[d].p(m,c),S(a[d],1)):(a[d]=pv(m),a[d].c(),S(a[d],1),a[d].m(r.parentNode,r))}for(he(),d=n.length;d<a.length;d+=1)i(d);ge()}},i(l){if(!s){S(e.$$.fragment,l);for(let c=0;c<n.length;c+=1)S(a[c]);s=!0}},o(l){P(e.$$.fragment,l),a=a.filter(Boolean);for(let c=0;c<a.length;c+=1)P(a[c]);s=!1},d(l){l&&(C(t),C(r)),N(e,l),st(a,l)}}}function LE(o){let e,t,r,s,n,a,i,l,c,u,d,m,g,h,_,w,v,A=[SE,_E,vE],O=[];function E(M,R){return M[3]?0:M[5]?1:M[0]?2:-1}return~(g=E(o,-1))&&(h=O[g]=A[g](o)),{c(){e=T("div"),e.textContent="Relay database analysis",t=U(),r=T("div"),s=T("div"),n=T("div"),n.innerHTML=`<div class="setting-item-name">Search across vaults</div> <div class="setting-item-description"><div class="mod-warning">Warning: This is a dangerous setting. It allows you to delete relay
					databases from other vaults.</div></div>`,a=U(),i=T("div"),l=T("div"),c=T("input"),u=U(),d=T("div"),m=U(),h&&h.c(),x(e,"class","modal-title"),x(n,"class","setting-item-info"),x(c,"type","checkbox"),x(c,"tabindex","-1"),c.checked=o[1],x(d,"class","checkbox-toggle"),x(l,"role","checkbox"),x(l,"aria-checked",o[1]),x(l,"tabindex","0"),x(l,"class","checkbox-container system3-dangerous svelte-1n3w4sk"),Be(l,"is-enabled",o[1]),x(i,"class","setting-item-control"),x(s,"class","setting-item"),x(r,"class","system3-indexeddb-analysis svelte-1n3w4sk")},m(M,R){I(M,e,R),I(M,t,R),I(M,r,R),k(r,s),k(s,n),k(s,a),k(s,i),k(i,l),k(l,c),k(l,u),k(l,d),k(r,m),~g&&O[g].m(r,null),_=!0,w||(v=[te(l,"keypress",o[15]),te(l,"click",o[16])],w=!0)},p(M,[R]){(!_||R&2)&&(c.checked=M[1]),(!_||R&2)&&x(l,"aria-checked",M[1]),(!_||R&2)&&Be(l,"is-enabled",M[1]);let D=g;g=E(M,R),g===D?~g&&O[g].p(M,R):(h&&(he(),P(O[D],1,1,()=>{O[D]=null}),ge()),~g?(h=O[g],h?h.p(M,R):(h=O[g]=A[g](M),h.c()),S(h,1),h.m(r,null)):h=null)},i(M){_||(S(h),_=!0)},o(M){P(h),_=!1},d(M){M&&(C(e),C(t),C(r)),~g&&O[g].d(),w=!1,Ce(v)}}}function TE(o,e,t){let r,s,n,a,i,l;var c;let{plugin:u}=e,d=_e(!0);me(o,d,M=>t(3,a=M));let m=_e(0);me(o,m,M=>t(4,i=M));let g=_e(null);me(o,g,M=>t(0,n=M));let h=_e(null);me(o,h,M=>t(5,l=M));let _=!1;function w(){return Ke(this,void 0,void 0,function*(){d.set(!0),h.set(null);try{let M=yield lv({appId:u.appId,filterByAppId:!_,onProgress:R=>m.set(R)});g.set(M)}catch(M){h.set(`Analysis failed: ${M.message}`)}finally{d.set(!1)}})}function v(M){return Ke(this,void 0,void 0,function*(){try{yield cv(M),n&&_x(g,n.largeStores=n.largeStores.filter(R=>R.slug!==M),n)}catch(R){h.set(`Failed to delete ${M}: ${R.message}`)}})}lr(()=>{w()});let A=()=>{t(1,_=!_),w()},O=()=>{t(1,_=!_),w()},E=M=>v(M.slug);return o.$$set=M=>{"plugin"in M&&t(12,u=M.plugin)},o.$$.update=()=>{if(o.$$.dirty&8193){e:t(14,r=t(13,c=n==null?void 0:n.largeStores.reduce((M,R)=>{let D=R.relay||"local";return M[D]||(M[D]=[]),M[D].push(R),M},{}))!==null&&c!==void 0?c:{})}if(o.$$.dirty&16384){e:t(2,s=Object.entries(r).sort(([M],[R])=>M==="local"?-1:R==="local"?1:M.localeCompare(R)))}},[n,_,s,a,i,l,d,m,g,h,w,v,u,c,r,A,O,E]}var Bm=class extends ee{constructor(e){super(),oe(this,e,TE,LE,Z,{plugin:12},wE)}},hv=Bm;var Zc=class extends gv.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new hv({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Wv=require("obsidian");var{Boolean:Tv}=tn;function PE(o){Pe(o,"svelte-18bqwhy",".file-name.svelte-18bqwhy{display:flex;align-items:center;gap:6px;font-size:0.9rem;flex:1;min-width:0}.details-container.svelte-18bqwhy{margin-left:auto;text-align:right;padding-left:8px;padding-right:8px}.details.svelte-18bqwhy{font-size:0.75rem;color:var(--text-muted)}.error-message.svelte-18bqwhy{color:var(--text-error);margin-top:2px;text-align:right}.more-files.svelte-18bqwhy{font-size:0.8rem;color:var(--text-muted);text-align:center}button.mod-warning.svelte-18bqwhy{display:flex;align-items:center;gap:4px;background-color:var(--background-modifier-error);color:var(--text-error)}.mod-primary{color:var(--interactive-accent)}.mod-success{color:var(--interactive-success)}.mod-warning{color:var(--text-warning)}.show-more-link.svelte-18bqwhy{color:var(--text-accent);cursor:pointer;font-size:0.8rem}.show-more-link.svelte-18bqwhy:hover{text-decoration:underline}")}function yv(o,e,t){let r=o.slice();return r[20]=e[t],r}function xv(o,e,t){let r=o.slice();return r[23]=e[t],r}function DE(o){return{c:X,m:X,p:X,i:X,o:X,d:X}}function FE(o){let e,t,r=Ae(Lv(o[19].documents)),s=[];for(let a=0;a<r.length;a+=1)s[a]=kv(yv(o,r,a));let n=a=>P(s[a],1,1,()=>{s[a]=null});return{c(){for(let a=0;a<s.length;a+=1)s[a].c();e=Ie()},m(a,i){for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(a,i);I(a,e,i),t=!0},p(a,i){if(i&8311){r=Ae(Lv(a[19].documents));let l;for(l=0;l<r.length;l+=1){let c=yv(a,r,l);s[l]?(s[l].p(c,i),S(s[l],1)):(s[l]=kv(c),s[l].c(),S(s[l],1),s[l].m(e.parentNode,e))}for(he(),l=r.length;l<s.length;l+=1)n(l);ge()}},i(a){if(!t){for(let i=0;i<r.length;i+=1)S(s[i]);t=!0}},o(a){s=s.filter(Tv);for(let i=0;i<s.length;i+=1)P(s[i]);t=!1},d(a){a&&C(e),st(s,a)}}}function bv(o){let e,t=Iv(o[23].queueState.timestamp)+"",r;return{c(){e=K("\u2022 "),r=K(t)},m(s,n){I(s,e,n),I(s,r,n)},p(s,n){n&3&&t!==(t=Iv(s[23].queueState.timestamp)+"")&&ne(r,t)},d(s){s&&(C(e),C(r))}}}function wv(o){let e,t=o[23].queueState.error+"",r;return{c(){e=T("div"),r=K(t),x(e,"class","error-message svelte-18bqwhy")},m(s,n){I(s,e,n),k(e,r)},p(s,n){n&3&&t!==(t=s[23].queueState.error+"")&&ne(r,t)},d(s){s&&C(e)}}}function vv(o){let e,t,r,s,n,a;t=new Vd({props:{size:14,class:"svg-icon lucide-refresh-cw"}});function i(){return o[10](o[23])}return{c(){e=T("button"),H(t.$$.fragment),r=K(`
							Retry`),x(e,"class","mod-warning svelte-18bqwhy")},m(l,c){I(l,e,c),B(t,e,null),k(e,r),s=!0,n||(a=te(e,"click",i),n=!0)},p(l,c){o=l},i(l){s||(S(t.$$.fragment,l),s=!0)},o(l){P(t.$$.fragment,l),s=!1},d(l){l&&C(e),N(t),n=!1,a()}}}function AE(o){var g,h,_;let e,t,r=o[5](o[23]).text+"",s,n,a,i,l,c,u=((g=o[23].queueState)==null?void 0:g.timestamp)&&bv(o),d=((h=o[23].queueState)==null?void 0:h.error)&&wv(o),m=((_=o[23].queueState)==null?void 0:_.status)==="failed"&&vv(o);return{c(){e=T("div"),t=T("span"),s=K(r),n=U(),u&&u.c(),a=U(),d&&d.c(),i=U(),m&&m.c(),l=Ie(),x(t,"class","details svelte-18bqwhy"),x(e,"class","details-container svelte-18bqwhy")},m(w,v){I(w,e,v),k(e,t),k(t,s),k(t,n),u&&u.m(t,null),k(t,a),d&&d.m(t,null),I(w,i,v),m&&m.m(w,v),I(w,l,v),c=!0},p(w,v){var A,O,E;(!c||v&3)&&r!==(r=w[5](w[23]).text+"")&&ne(s,r),(A=w[23].queueState)!=null&&A.timestamp?u?u.p(w,v):(u=bv(w),u.c(),u.m(t,a)):u&&(u.d(1),u=null),(O=w[23].queueState)!=null&&O.error?d?d.p(w,v):(d=wv(w),d.c(),d.m(t,null)):d&&(d.d(1),d=null),((E=w[23].queueState)==null?void 0:E.status)==="failed"?m?(m.p(w,v),v&3&&S(m,1)):(m=vv(w),m.c(),S(m,1),m.m(l.parentNode,l)):m&&(he(),P(m,1,1,()=>{m=null}),ge())},i(w){c||(S(m),c=!0)},o(w){P(m),c=!1},d(w){w&&(C(e),C(i),C(l)),u&&u.d(),d&&d.d(),m&&m.d(w)}}}function EE(o){let e,t=o[9].default,r=ye(t,o,o[13],null),s=r||AE(o);return{c(){s&&s.c()},m(n,a){s&&s.m(n,a),e=!0},p(n,a){r?r.p&&(!e||a&8192)&&be(r,t,n,n[13],e?xe(t,n[13],a,null):we(n[13]),null):s&&s.p&&(!e||a&3)&&s.p(n,e?a:-1)},i(n){e||(S(s,n),e=!0)},o(n){P(s,n),e=!1},d(n){s&&s.d(n)}}}function ME(o){let e,t,r,s,n=o[23].path.split("/").pop()+"",a,i;var l=o[5](o[23]).icon;function c(u,d){return{props:{size:16,class:"svg-icon "+u[5](u[23]).iconClass}}}return l&&(t=aa(l,c(o))),{c(){e=T("span"),t&&H(t.$$.fragment),r=U(),s=T("span"),a=K(n),x(e,"slot","name"),x(e,"class","file-name svelte-18bqwhy")},m(u,d){I(u,e,d),t&&B(t,e,null),k(e,r),k(e,s),k(s,a),i=!0},p(u,d){if(d&3&&l!==(l=u[5](u[23]).icon)){if(t){he();let m=t;P(m.$$.fragment,1,0,()=>{N(m,1)}),ge()}l?(t=aa(l,c(u,d)),H(t.$$.fragment),S(t.$$.fragment,1),B(t,e,r)):t=null}else if(l){let m={};d&3&&(m.class="svg-icon "+u[5](u[23]).iconClass),t.$set(m)}(!i||d&3)&&n!==(n=u[23].path.split("/").pop()+"")&&ne(a,n)},i(u){i||(t&&S(t.$$.fragment,u),i=!0)},o(u){t&&P(t.$$.fragment,u),i=!1},d(u){u&&C(e),t&&N(t)}}}function _v(o){let e,t;return e=new It({props:{$$slots:{name:[ME],default:[EE]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&8195&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function Sv(o){let e,t;return e=new It({props:{$$slots:{name:[RE]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&8195&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function RE(o){let e,t,r=Cv(o[1](o[20]).remainingCount)+"",s,n,a=o[20].title.toLowerCase()+"",i,l,c,u,d,m,g,h;function _(){return o[11](o[20])}function w(...v){return o[12](o[20],...v)}return{c(){var v;e=T("span"),t=K("...and "),s=K(r),n=K(` more
					`),i=K(a),l=U(),c=T("span"),u=K("(show more)"),m=U(),x(c,"class","show-more-link svelte-18bqwhy"),x(c,"role","button"),x(c,"tabindex","0"),x(c,"aria-label",d=`Show ${((v=o[2][o[20].title])==null?void 0:v.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`),x(e,"slot","name"),x(e,"class","more-files svelte-18bqwhy")},m(v,A){I(v,e,A),k(e,t),k(e,s),k(e,n),k(e,i),k(e,l),k(e,c),k(c,u),k(e,m),g||(h=[te(c,"click",_),te(c,"keydown",w)],g=!0)},p(v,A){var O;o=v,A&3&&r!==(r=Cv(o[1](o[20]).remainingCount)+"")&&ne(s,r),A&1&&a!==(a=o[20].title.toLowerCase()+"")&&ne(i,a),A&1&&d!==(d=`Show ${((O=o[2][o[20].title])==null?void 0:O.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`)&&x(c,"aria-label",d)},d(v){v&&C(e),g=!1,Ce(h)}}}function kv(o){let e,t,r,s=o[1](o[20]).remainingCount>0,n,a;e=new Je({props:{name:o[20].title}});let i=Ae(o[1](o[20]).visibleDocs),l=[];for(let d=0;d<i.length;d+=1)l[d]=_v(xv(o,i,d));let c=d=>P(l[d],1,1,()=>{l[d]=null}),u=s&&Sv(o);return{c(){H(e.$$.fragment),t=U();for(let d=0;d<l.length;d+=1)l[d].c();r=U(),u&&u.c(),n=Ie()},m(d,m){B(e,d,m),I(d,t,m);for(let g=0;g<l.length;g+=1)l[g]&&l[g].m(d,m);I(d,r,m),u&&u.m(d,m),I(d,n,m),a=!0},p(d,m){let g={};if(m&1&&(g.name=d[20].title),e.$set(g),m&8291){i=Ae(d[1](d[20]).visibleDocs);let h;for(h=0;h<i.length;h+=1){let _=xv(d,i,h);l[h]?(l[h].p(_,m),S(l[h],1)):(l[h]=_v(_),l[h].c(),S(l[h],1),l[h].m(r.parentNode,r))}for(he(),h=i.length;h<l.length;h+=1)c(h);ge()}m&3&&(s=d[1](d[20]).remainingCount>0),s?u?(u.p(d,m),m&3&&S(u,1)):(u=Sv(d),u.c(),S(u,1),u.m(n.parentNode,n)):u&&(he(),P(u,1,1,()=>{u=null}),ge())},i(d){if(!a){S(e.$$.fragment,d);for(let m=0;m<i.length;m+=1)S(l[m]);S(u),a=!0}},o(d){P(e.$$.fragment,d),l=l.filter(Tv);for(let m=0;m<l.length;m+=1)P(l[m]);P(u),a=!1},d(d){d&&(C(t),C(r),C(n)),N(e,d),st(l,d),u&&u.d(d)}}}function OE(o){let e;return{c(){e=T("div"),e.textContent="Loading...",x(e,"class","loading")},m(t,r){I(t,e,r)},p:X,i:X,o:X,d(t){t&&C(e)}}}function UE(o){let e,t,r,s={ctx:o,current:null,token:null,hasCatch:!1,pending:OE,then:FE,catch:DE,value:19,blocks:[,,,]};return ca(t=o[0],s),{c(){e=Ie(),s.block.c()},m(n,a){I(n,e,a),s.block.m(n,s.anchor=a),s.mount=()=>e.parentNode,s.anchor=e,r=!0},p(n,[a]){o=n,s.ctx=o,a&1&&t!==(t=o[0])&&ca(t,s)||ec(s,o,a)},i(n){r||(S(s.block),r=!0)},o(n){for(let a=0;a<3;a+=1){let i=s.blocks[a];P(i)}r=!1},d(n){n&&C(e),s.block.d(n),s.token=null,s=null}}}function Cv(o){return new Intl.NumberFormat().format(o)}function Iv(o){let e=new Date(o),r=new Date().getTime()-e.getTime(),s=Math.floor(r/(1e3*60));if(s<1)return"just now";if(s===1)return"1 minute ago";if(s<60)return`${s} minutes ago`;let n=Math.floor(s/60);if(n===1)return"1 hour ago";if(n<24)return`${n} hours ago`;let a=Math.floor(n/24);return a===1?"yesterday":`${a} days ago`}function Lv(o){let e=o.filter(n=>{var a;return((a=n.queueState)===null||a===void 0?void 0:a.status)==="running"}),t=o.filter(n=>{var a;return((a=n.queueState)===null||a===void 0?void 0:a.status)==="failed"}),r=o.filter(n=>{var a;return((a=n.queueState)===null||a===void 0?void 0:a.status)==="pending"}),s=o.filter(n=>{var a;return((a=n.queueState)===null||a===void 0?void 0:a.status)==="completed"});return[e.length>0&&{title:"Active Files",documents:e},t.length>0&&{title:"Stuck Files",documents:t},r.length>0&&{title:"Queued Files",documents:r},s.length>0&&{title:"Completed Files",documents:s}].filter(Boolean)}function $E(o,e,t){let r,s,n,a,i,{$$slots:l={},$$scope:c}=e,{folder:u}=e,{backgroundSync:d}=e,m={"Active Files":{initialCount:1/0,incrementCount:100},"Stuck Files":{initialCount:1/0,incrementCount:100},"Queued Files":{initialCount:10,incrementCount:100},"Completed Files":{initialCount:5,incrementCount:100},default:{initialCount:1/0,incrementCount:100}},g=_e({}),h=ro(g,R=>D=>{let F=m[D.title]||m.default,V=R[D.title]||F.initialCount,q=D.documents.slice(0,V),j=D.documents.length-V;return{visibleCount:V,visibleDocs:q,remainingCount:j}});me(o,h,R=>t(1,i=R));function _(R){let D=m[R]||m.default;g.update(F=>Object.assign(Object.assign({},F),{[R]:(F[R]||D.initialCount)+D.incrementCount}))}function w(R){return Ke(this,void 0,void 0,function*(){var D;let F=[],V=Array.from(R.docs.values());for(let q of V){let j=yield q.getOrigin(),z=yield q.getServerSynced(),Y={guid:q.guid,path:R.getPath(q.path),doc:q,origin:j||"unknown",serverSynced:z},pe=Array.from(r).find(se=>se.guid===q.guid),De=Array.from(s).find(se=>se.guid===q.guid),G=n.find(se=>se.guid===q.guid);if(pe||De||G){let se=pe||De||G;Y.queueState={status:se.status,type:"type"in se?se.type:"sync",error:"error"in se?se.error:void 0,timestamp:"timestamp"in se?se.timestamp:Date.now()}}else j==="local"&&!z?Y.queueState={status:"pending",type:"sync",timestamp:Date.now()}:z?Y.queueState={status:"completed",type:"sync",timestamp:Date.now()}:Y.queueState={status:"pending",type:"sync",timestamp:Date.now()};F.push(Y)}return{folder:R,documents:F,progress:((D=d.getGroupProgress(R))===null||D===void 0?void 0:D.percent)||0}})}function v(R){let{origin:D,serverSynced:F,queueState:V}=R,q=(V==null?void 0:V.status)||"completed",j=(V==null?void 0:V.type)||"sync";return D==="remote"&&!F&&q==="running"&&j==="download"?{text:"Downloading",description:"Initial acquisition",icon:Ld,iconClass:"mod-primary"}:D==="remote"&&!F&&q==="pending"&&j==="download"?{text:"Queued for Download",description:"Waiting to download",icon:wi,iconClass:""}:D==="remote"&&!F&&q==="failed"&&j==="download"?{text:"Download stuck",description:"Needs retry",icon:vi,iconClass:"mod-warning"}:D==="local"&&!F&&q==="running"&&j==="sync"?{text:"Uploading",description:"First-time upload",icon:jd,iconClass:"mod-primary"}:D==="local"&&!F&&q==="pending"&&j==="sync"?{text:"Queued for Upload",description:"Waiting to upload",icon:wi,iconClass:""}:D==="local"&&!F&&q==="failed"&&j==="sync"?{text:"Upload stuck",description:"Needs retry",icon:vi,iconClass:"mod-warning"}:F&&q==="running"&&j==="sync"?{text:"Syncing",description:"Collaborative update",icon:yd,iconClass:"mod-primary"}:F&&q==="pending"&&j==="sync"?{text:"Queued for Sync",description:"Waiting to sync",icon:wi,iconClass:""}:F&&q==="failed"&&j==="sync"?{text:"Sync stuck",description:"Needs retry",icon:vi,iconClass:"mod-warning"}:F&&q==="completed"?{text:"Complete",description:"Fully synchronized",icon:Sd,iconClass:"mod-success"}:{text:"Unknown",description:"Status unknown",icon:Fd,iconClass:""}}function A(R){return Ke(this,void 0,void 0,function*(){var D,F;let V={id:R.guid,guid:R.guid,path:R.path,timestamp:((D=R.queueState)===null||D===void 0?void 0:D.timestamp)||Date.now(),type:((F=R.queueState)===null||F===void 0?void 0:F.type)||"sync",status:"failed",sharedFolderGuid:R.doc.sharedFolder.guid};yield d.retryLogItem(V)})}let O=R=>A(R),E=R=>{_(R.title)},M=(R,D)=>D.key==="Enter"&&_(R.title);return o.$$set=R=>{"folder"in R&&t(7,u=R.folder),"backgroundSync"in R&&t(8,d=R.backgroundSync),"$$scope"in R&&t(13,c=R.$$scope)},o.$$.update=()=>{if(o.$$.dirty&256){e:r=new Set(d.activeSync.items())}if(o.$$.dirty&256){e:s=new Set(d.activeDownloads.items())}if(o.$$.dirty&256){e:n=d.getSyncLog()}if(o.$$.dirty&128){e:t(0,a=w(u))}},[a,i,m,h,_,v,A,u,d,l,O,E,M,c]}var Nm=class extends ee{constructor(e){super(),oe(this,e,$E,UE,Z,{folder:7,backgroundSync:8},PE)}},Hm=Nm;var{Map:BE}=tn;function NE(o){Pe(o,"svelte-ztgdsf",".folder-header.svelte-ztgdsf{display:flex;align-items:center;cursor:pointer;background:none;border:none;padding:0;width:100%;text-align:left;color:inherit;font:inherit}.arrow.svelte-ztgdsf{margin-right:8px;font-size:0.8em;transition:transform 0.15s ease}.arrow.is-expanded.svelte-ztgdsf{transform:rotate(90deg)}.sync-stats.svelte-ztgdsf{margin-left:8px;display:flex;gap:4px}.tag.svelte-ztgdsf{font-size:0.7em;padding:2px 6px;border-radius:4px;background-color:var(--background-modifier-border);color:var(--text-muted)}.tag.mod-success.svelte-ztgdsf{background-color:var(--interactive-success);color:var(--text-on-accent)}.tag.mod-warning.svelte-ztgdsf{background-color:var(--text-warning);color:var(--text-on-accent)}.progress-container.svelte-ztgdsf{display:flex;align-items:center;margin-top:4px;width:100%}.progress-bar.svelte-ztgdsf{flex:1;height:6px;background-color:var(--background-modifier-border);border-radius:3px;overflow:hidden;margin-right:8px}.progress-value.svelte-ztgdsf{height:100%;background-color:var(--interactive-accent);border-radius:3px}.progress-text.svelte-ztgdsf{font-size:0.75rem;color:var(--text-muted)}")}function Pv(o,e,t){let r=o.slice();r[25]=e[t];let s=r[4].get(r[25].guid);return r[26]=s,r}function Dv(o){let e,t;return e=new Je({props:{name:"Sync Status"}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function Fv(o){let e,t;return e=new ze({props:{name:o[11]?"Sync in Progress":o[10]?"Queued Files":"Sync Complete",description:`${o[2]} active \u2022 ${o[7]} stuck \u2022 ${o[3]} queued \u2022 ${o[8]} complete`,$$slots:{default:[qE]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&3072&&(n.name=r[11]?"Sync in Progress":r[10]?"Queued Files":"Sync Complete"),s&396&&(n.description=`${r[2]} active \u2022 ${r[7]} stuck \u2022 ${r[3]} queued \u2022 ${r[8]} complete`),s&536874496&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function Av(o){let e,t,r,s,n,a,i=[VE,HE],l=[];function c(u,d){return u[9]?0:1}return t=c(o,-1),r=l[t]=i[t](o),{c(){e=T("button"),r.c(),x(e,"class","mod-cta")},m(u,d){I(u,e,d),l[t].m(e,null),s=!0,n||(a=te(e,"click",o[16]),n=!0)},p(u,d){let m=t;t=c(u,d),t!==m&&(he(),P(l[m],1,1,()=>{l[m]=null}),ge(),r=l[t],r||(r=l[t]=i[t](u),r.c()),S(r,1),r.m(e,null))},i(u){s||(S(r),s=!0)},o(u){P(r),s=!1},d(u){u&&C(e),l[t].d(),n=!1,a()}}}function HE(o){let e,t,r;return e=new $d({props:{size:16,class:"svg-icon lucide-pause",style:"margin-right: 8px;"}}),{c(){H(e.$$.fragment),t=K(`
						Pause`)},m(s,n){B(e,s,n),I(s,t,n),r=!0},i(s){r||(S(e.$$.fragment,s),r=!0)},o(s){P(e.$$.fragment,s),r=!1},d(s){s&&C(t),N(e,s)}}}function VE(o){let e,t,r;return e=new Nd({props:{size:16,class:"svg-icon lucide-play",style:"margin-right: 8px;"}}),{c(){H(e.$$.fragment),t=K(`
						Resume`)},m(s,n){B(e,s,n),I(s,t,n),r=!0},i(s){r||(S(e.$$.fragment,s),r=!0)},o(s){P(e.$$.fragment,s),r=!1},d(s){s&&C(t),N(e,s)}}}function qE(o){let e,t,r=(o[11]||o[10])&&Av(o);return{c(){r&&r.c(),e=Ie()},m(s,n){r&&r.m(s,n),I(s,e,n),t=!0},p(s,n){s[11]||s[10]?r?(r.p(s,n),n&3072&&S(r,1)):(r=Av(s),r.c(),S(r,1),r.m(e.parentNode,e)):r&&(he(),P(r,1,1,()=>{r=null}),ge())},i(s){t||(S(r),t=!0)},o(s){P(r),t=!1},d(s){s&&C(e),r&&r.d(s)}}}function WE(o){let e=[],t=new BE,r,s,n=Ae(o[6]),a=i=>i[25].guid;for(let i=0;i<n.length;i+=1){let l=Pv(o,n,i),c=a(l);t.set(c,e[i]=$v(c,l))}return{c(){for(let i=0;i<e.length;i+=1)e[i].c();r=Ie()},m(i,l){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(i,l);I(i,r,l),s=!0},p(i,l){l&32851&&(n=Ae(i[6]),he(),e=Mx(e,l,a,1,i,n,t,r.parentNode,Ex,$v,r,Pv),ge())},i(i){if(!s){for(let l=0;l<n.length;l+=1)S(e[l]);s=!0}},o(i){for(let l=0;l<e.length;l+=1)P(e[l]);s=!1},d(i){i&&C(r);for(let l=0;l<e.length;l+=1)e[l].d(i)}}}function zE(o){let e,t,r,s;return e=new Je({props:{$$slots:{name:[QE],default:[YE]},$$scope:{ctx:o}}}),r=new Hm({props:{folder:o[5],backgroundSync:o[0]}}),{c(){H(e.$$.fragment),t=U(),H(r.$$.fragment)},m(n,a){B(e,n,a),I(n,t,a),B(r,n,a),s=!0},p(n,a){let i={};a&536875040&&(i.$$scope={dirty:a,ctx:n}),e.$set(i);let l={};a&32&&(l.folder=n[5]),a&1&&(l.backgroundSync=n[0]),r.$set(l)},i(n){s||(S(e.$$.fragment,n),S(r.$$.fragment,n),s=!0)},o(n){P(e.$$.fragment,n),P(r.$$.fragment,n),s=!1},d(n){n&&C(t),N(e,n),N(r,n)}}}function Ev(o){let e,t,r,s,n,a=o[26].progress+"",i,l;return{c(){e=T("div"),t=T("div"),r=T("div"),s=U(),n=T("span"),i=K(a),l=K("%"),x(r,"class","progress-value svelte-ztgdsf"),de(r,"width",o[26].progress+"%"),x(t,"class","progress-bar svelte-ztgdsf"),x(n,"class","progress-text svelte-ztgdsf"),x(e,"class","progress-container svelte-ztgdsf")},m(c,u){I(c,e,u),k(e,t),k(t,r),k(e,s),k(e,n),k(n,i),k(n,l)},p(c,u){u&80&&de(r,"width",c[26].progress+"%"),u&80&&a!==(a=c[26].progress+"")&&ne(i,a)},d(c){c&&C(e)}}}function KE(o){let e,t=o[26]&&(o[26].running>0||o[26].failed>0)&&Ev(o);return{c(){t&&t.c(),e=Ie()},m(r,s){t&&t.m(r,s),I(r,e,s)},p(r,s){r[26]&&(r[26].running>0||r[26].failed>0)?t?t.p(r,s):(t=Ev(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&C(e),t&&t.d(r)}}}function Mv(o){let e,t=o[26].running+"",r,s;return{c(){e=T("span"),r=K(t),s=K(" active"),x(e,"class","tag mod-success svelte-ztgdsf")},m(n,a){I(n,e,a),k(e,r),k(e,s)},p(n,a){a&80&&t!==(t=n[26].running+"")&&ne(r,t)},d(n){n&&C(e)}}}function Rv(o){let e,t=o[26].failed+"",r,s;return{c(){e=T("span"),r=K(t),s=K(" stuck"),x(e,"class","tag mod-warning svelte-ztgdsf")},m(n,a){I(n,e,a),k(e,r),k(e,s)},p(n,a){a&80&&t!==(t=n[26].failed+"")&&ne(r,t)},d(n){n&&C(e)}}}function Ov(o){let e,t=o[26].pending+"",r,s;return{c(){e=T("span"),r=K(t),s=K(" queued"),x(e,"class","tag svelte-ztgdsf")},m(n,a){I(n,e,a),k(e,r),k(e,s)},p(n,a){a&80&&t!==(t=n[26].pending+"")&&ne(r,t)},d(n){n&&C(e)}}}function GE(o){var E,M,R;let e,t,r,s,n,a=o[25].name+"",i,l,c,u,d,m,g,h,_=((E=o[26])==null?void 0:E.running)>0&&Mv(o),w=((M=o[26])==null?void 0:M.failed)>0&&Rv(o),v=((R=o[26])==null?void 0:R.pending)>0&&Ov(o);function A(){return o[22](o[25])}function O(...D){return o[23](o[25],...D)}return{c(){e=T("div"),t=T("span"),r=K("\u25B6"),n=U(),i=K(a),l=U(),c=T("span"),_&&_.c(),u=U(),w&&w.c(),d=U(),v&&v.c(),x(t,"class",s="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf"),x(c,"class","sync-stats svelte-ztgdsf"),x(e,"class","folder-header svelte-ztgdsf"),x(e,"role","button"),x(e,"tabindex","0"),x(e,"aria-expanded",m=!!o[1][o[25].guid])},m(D,F){I(D,e,F),k(e,t),k(t,r),k(e,n),k(e,i),k(e,l),k(e,c),_&&_.m(c,null),k(c,u),w&&w.m(c,null),k(c,d),v&&v.m(c,null),g||(h=[te(e,"click",A),te(e,"keydown",O)],g=!0)},p(D,F){var V,q,j;o=D,F&66&&s!==(s="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf")&&x(t,"class",s),F&64&&a!==(a=o[25].name+"")&&ne(i,a),((V=o[26])==null?void 0:V.running)>0?_?_.p(o,F):(_=Mv(o),_.c(),_.m(c,u)):_&&(_.d(1),_=null),((q=o[26])==null?void 0:q.failed)>0?w?w.p(o,F):(w=Rv(o),w.c(),w.m(c,d)):w&&(w.d(1),w=null),((j=o[26])==null?void 0:j.pending)>0?v?v.p(o,F):(v=Ov(o),v.c(),v.m(c,null)):v&&(v.d(1),v=null),F&66&&m!==(m=!!o[1][o[25].guid])&&x(e,"aria-expanded",m)},d(D){D&&C(e),_&&_.d(),w&&w.d(),v&&v.d(),g=!1,Ce(h)}}}function jE(o){let e,t;return e=new So({props:{folder:o[25],$$slots:{default:[GE]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&64&&(n.folder=r[25]),s&536870994&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function Uv(o){let e,t;return e=new Hm({props:{folder:o[25],backgroundSync:o[0]}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&64&&(n.folder=r[25]),s&1&&(n.backgroundSync=r[0]),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function $v(o,e){let t,r,s,n,a;r=new Je({props:{$$slots:{name:[jE],default:[KE]},$$scope:{ctx:e}}});let i=e[1][e[25].guid]&&Uv(e);return{key:o,first:null,c(){t=Ie(),H(r.$$.fragment),s=U(),i&&i.c(),n=Ie(),this.first=t},m(l,c){I(l,t,c),B(r,l,c),I(l,s,c),i&&i.m(l,c),I(l,n,c),a=!0},p(l,c){e=l;let u={};c&536870994&&(u.$$scope={dirty:c,ctx:e}),r.$set(u),e[1][e[25].guid]?i?(i.p(e,c),c&66&&S(i,1)):(i=Uv(e),i.c(),S(i,1),i.m(n.parentNode,n)):i&&(he(),P(i,1,1,()=>{i=null}),ge())},i(l){a||(S(r.$$.fragment,l),S(i),a=!0)},o(l){P(r.$$.fragment,l),P(i),a=!1},d(l){l&&(C(t),C(s),C(n)),N(r,l),i&&i.d(l)}}}function Bv(o){let e,t,r,s,n,a=o[12].progress+"",i,l;return{c(){e=T("div"),t=T("div"),r=T("div"),s=U(),n=T("span"),i=K(a),l=K("%"),x(r,"class","progress-value svelte-ztgdsf"),de(r,"width",o[12].progress+"%"),x(t,"class","progress-bar svelte-ztgdsf"),x(n,"class","progress-text svelte-ztgdsf"),x(e,"class","progress-container svelte-ztgdsf")},m(c,u){I(c,e,u),k(e,t),k(t,r),k(e,s),k(e,n),k(n,i),k(n,l)},p(c,u){u&4096&&de(r,"width",c[12].progress+"%"),u&4096&&a!==(a=c[12].progress+"")&&ne(i,a)},d(c){c&&C(e)}}}function YE(o){let e,t=(o[12].running>0||o[12].failed>0)&&Bv(o);return{c(){t&&t.c(),e=Ie()},m(r,s){t&&t.m(r,s),I(r,e,s)},p(r,s){r[12].running>0||r[12].failed>0?t?t.p(r,s):(t=Bv(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&C(e),t&&t.d(r)}}}function Nv(o){let e,t=o[12].running+"",r,s;return{c(){e=T("span"),r=K(t),s=K(" active"),x(e,"class","tag mod-success svelte-ztgdsf")},m(n,a){I(n,e,a),k(e,r),k(e,s)},p(n,a){a&4096&&t!==(t=n[12].running+"")&&ne(r,t)},d(n){n&&C(e)}}}function Hv(o){let e,t=o[12].failed+"",r,s;return{c(){e=T("span"),r=K(t),s=K(" stuck"),x(e,"class","tag mod-warning svelte-ztgdsf")},m(n,a){I(n,e,a),k(e,r),k(e,s)},p(n,a){a&4096&&t!==(t=n[12].failed+"")&&ne(r,t)},d(n){n&&C(e)}}}function Vv(o){let e,t=o[12].pending+"",r,s;return{c(){e=T("span"),r=K(t),s=K(" queued"),x(e,"class","tag svelte-ztgdsf")},m(n,a){I(n,e,a),k(e,r),k(e,s)},p(n,a){a&4096&&t!==(t=n[12].pending+"")&&ne(r,t)},d(n){n&&C(e)}}}function JE(o){let e,t=o[5].name+"",r,s,n,a,i,l=o[12].running>0&&Nv(o),c=o[12].failed>0&&Hv(o),u=o[12].pending>0&&Vv(o);return{c(){e=T("div"),r=K(t),s=U(),n=T("span"),l&&l.c(),a=U(),c&&c.c(),i=U(),u&&u.c(),x(n,"class","sync-stats svelte-ztgdsf"),x(e,"class","folder-header svelte-ztgdsf")},m(d,m){I(d,e,m),k(e,r),k(e,s),k(e,n),l&&l.m(n,null),k(n,a),c&&c.m(n,null),k(n,i),u&&u.m(n,null)},p(d,m){m&32&&t!==(t=d[5].name+"")&&ne(r,t),d[12].running>0?l?l.p(d,m):(l=Nv(d),l.c(),l.m(n,a)):l&&(l.d(1),l=null),d[12].failed>0?c?c.p(d,m):(c=Hv(d),c.c(),c.m(n,i)):c&&(c.d(1),c=null),d[12].pending>0?u?u.p(d,m):(u=Vv(d),u.c(),u.m(n,null)):u&&(u.d(1),u=null)},d(d){d&&C(e),l&&l.d(),c&&c.d(),u&&u.d()}}}function QE(o){let e,t;return e=new So({props:{folder:o[5],$$slots:{default:[JE]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&32&&(n.folder=r[5]),s&536875040&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function XE(o){let e,t,r,s,n,a,i=!o[5]&&Dv(o),l=!o[5]&&Fv(o),c=[zE,WE],u=[];function d(m,g){return m[5]&&m[12]?0:1}return s=d(o,-1),n=u[s]=c[s](o),{c(){e=T("div"),i&&i.c(),t=U(),l&&l.c(),r=U(),n.c(),x(e,"class","setting-item-container")},m(m,g){I(m,e,g),i&&i.m(e,null),k(e,t),l&&l.m(e,null),k(e,r),u[s].m(e,null),a=!0},p(m,[g]){m[5]?i&&(he(),P(i,1,1,()=>{i=null}),ge()):i?g&32&&S(i,1):(i=Dv(m),i.c(),S(i,1),i.m(e,t)),m[5]?l&&(he(),P(l,1,1,()=>{l=null}),ge()):l?(l.p(m,g),g&32&&S(l,1)):(l=Fv(m),l.c(),S(l,1),l.m(e,r));let h=s;s=d(m,g),s===h?u[s].p(m,g):(he(),P(u[h],1,1,()=>{u[h]=null}),ge(),n=u[s],n?n.p(m,g):(n=u[s]=c[s](m),n.c()),S(n,1),n.m(e,null))},i(m){a||(S(i),S(l),S(n),a=!0)},o(m){P(i),P(l),P(n),a=!1},d(m){m&&C(e),i&&i.d(),l&&l.d(),u[s].d()}}}function ZE(o,e,t){let r,s,n,a,i,l,c,u,d,m,g,{backgroundSync:h}=e,{sharedFolders:_}=e,{focusedFolderGuid:w}=e,v={},A=0,O=0,E=0,M=0,{activeSync:R,activeDownloads:D}=h;me(o,R,z=>t(21,g=z)),me(o,D,z=>t(20,m=z));function F(z){t(1,v[z]=!v[z],v),t(1,v),t(6,r),t(17,_)}function V(){l?h.resume():h.pause()}let q=z=>F(z.guid),j=(z,Y)=>Y.key==="Enter"&&F(z.guid);return o.$$set=z=>{"backgroundSync"in z&&t(0,h=z.backgroundSync),"sharedFolders"in z&&t(17,_=z.sharedFolders),"focusedFolderGuid"in z&&t(18,w=z.focusedFolderGuid)},o.$$.update=()=>{if(o.$$.dirty&131072){e:t(6,r=_.items().sort((z,Y)=>z.name.localeCompare(Y.name)))}if(o.$$.dirty&66){e:r.forEach(z=>{z.guid in v||t(1,v[z.guid]=!0,v)}),t(1,v),t(6,r),t(17,_)}if(o.$$.dirty&393216){e:t(5,s=w?_.items().find(z=>z.guid===w):void 0)}if(o.$$.dirty&3145793){e:t(4,n=new Map(r.map(z=>{var Y,pe;return[z.guid,{progress:((Y=h.getGroupProgress(z))===null||Y===void 0?void 0:Y.percent)||0,running:[...g.items(),...m.items()].filter(De=>De.sharedFolder.guid===z.guid).length,failed:((pe=h.syncGroups.get(z))===null||pe===void 0?void 0:pe.status)==="failed"?1:0,pending:[...h.pendingSyncs,...h.pendingDownloads].filter(De=>De.sharedFolder.guid===z.guid).length,completed:(()=>{let De=h.syncGroups.get(z);return((De==null?void 0:De.completedSyncs)||0)+((De==null?void 0:De.completedDownloads)||0)})(),sharedFolder:z}]})))}if(o.$$.dirty&48){e:t(12,a=s?n.get(s.guid):void 0)}if(o.$$.dirty&1){e:t(19,i=h.getQueueStatus())}if(o.$$.dirty&524288){e:t(9,l=i.isPaused)}if(o.$$.dirty&524288){e:c=i.syncsActive>0||i.downloadsActive>0}if(o.$$.dirty&16){e:{let z=0,Y=0,pe=0,De=0;for(let G of n.values())z+=G.running,Y+=G.failed,pe+=G.pending,De+=G.completed;t(2,A=z),t(7,O=Y),t(3,E=pe),t(8,M=De)}}if(o.$$.dirty&4){e:t(11,u=A>0)}if(o.$$.dirty&8){e:t(10,d=E>0)}},[h,v,A,E,n,s,r,O,M,l,d,u,a,R,D,F,V,_,w,i,m,g,q,j]}var Vm=class extends ee{constructor(e){super(),oe(this,e,ZE,XE,Z,{backgroundSync:0,sharedFolders:17,focusedFolderGuid:18},NE)}},qv=Vm;var Ai=class extends Wv.Modal{constructor(t,r,s,n){super(t);this.backgroundSync=r;this.sharedFolders=s;this.focusedFolderGuid=n}onOpen(){let{contentEl:t}=this;t.empty(),this.component=new qv({target:t,props:{backgroundSync:this.backgroundSync,sharedFolders:this.sharedFolders,focusedFolderGuid:this.focusedFolderGuid,closeModal:()=>this.close()}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};function qm(o){return o.startsWith("v")?o.slice(1):o}function eM(o,e){return o.map((t,r)=>[t,e[r]])}function tM(o,e){try{let t=qm(o).split(".").map(parseInt),r=qm(e).split(".").map(parseInt);for(let[s,n]of eM(t,r))if(s>n)return!0}catch(t){}return!1}var ef=class extends dt{constructor(t,r,s){super("UpdateManager");this.plugin=t;this.timeProvider=r;this.releaseSettings=s;this.updateCheckInterval=null;this.lastReleaseCheck=0;this.lastChannelCheck=0;this.CHECK_INTERVAL=1e3*60*60*24;this.githubReleases=new Yo("system3-relay/releases"),this.releaseChannels=new Yo("system3-relay/releaseChannels")}get releases(){return[...this.githubReleases.values()].sort((t,r)=>r.tag_name.localeCompare(t.tag_name,void 0,{numeric:!0,sensitivity:"base"}))}get beta(){return this.releaseChannels.get("beta")}get stable(){return this.releaseChannels.get("stable")}async fetchReleases(){let r=await Rt("https://api.github.com/repos/No-Instructions/Relay/releases",{headers:{Accept:"application/vnd.github.v3+json","User-Agent":"Relay-Obsidian-Plugin"}});if(!r.ok)throw new Error(`GitHub API error: ${r.status}`);let s=await r.json();return Ge().enableNetworkLogging&&this.debug("GitHub releases fetched:",s),s}async fetchLatestRelease(){try{let s="https://api.github.com/repos/No-Instructions/Relay/releases/latest";this.debug(`Fetching latest release from: ${s}`);let n=await Rt(s,{headers:{"User-Agent":"Relay-Obsidian-Plugin"}});if(!n.ok)throw new Error(`GitHub API error: ${n.status}`);return await n.json()}catch(t){return this.error("Failed to fetch latest release:",t),null}}async fetchLatestTagFromChannel(t){try{let r={beta:"manifest-beta.json",stable:"manifest.json"}[t],s=r?await this.fetchRepoManifest(r):null;return s?(this.debug("repo manifest",s),s.version):null}catch(r){this.error("Failed to check for updates:",r)}return null}async getReleases(){try{let t=Date.now();if(t-this.lastReleaseCheck<5*60*1e3&&this.githubReleases.size>0)return[...this.githubReleases.values()];this.lastReleaseCheck=t,(await this.fetchReleases()).forEach(n=>{this.githubReleases.set(n.tag_name,n)});let s=await this.fetchLatestRelease();s&&(s.latest=!0,this.githubReleases.set(s.tag_name,s)),this.notifyListeners()}catch(t){this.error("Failed to fetch GitHub releases:",t)}return[...this.githubReleases.values()]}async getChannelRelease(){let t=Date.now(),r=this.releaseChannels.get(this.releaseSettings.get().channel);if(t-this.lastChannelCheck<5*60*1e3&&r)return r;this.lastReleaseCheck=t;let s=await this.getReleases();if(s.length===0)return this.debug("No releases found"),null;let n=this.releaseSettings.get().channel;if(!n)return null;let a=await this.fetchLatestTagFromChannel(n);if(!a)return null;let i=s.find(l=>qm(l.tag_name)===a);return i?(this.releaseChannels.set(n,i),this.notifyListeners(),i):null}async update(){await this.getReleases(),await this.getChannelRelease()}start(){this.update(),this.updateCheckInterval=this.timeProvider.setInterval(()=>this.update(),this.CHECK_INTERVAL)}stop(){this.updateCheckInterval!==null&&(this.timeProvider.clearInterval(this.updateCheckInterval),this.updateCheckInterval=null)}async fetchRepoManifest(t,r="main"){try{let a=`https://raw.githubusercontent.com/No-Instructions/Relay/${r}/${t}`;this.debug(`Fetching ${a}`);let i=await Rt(a);if(!i.ok)throw new Error("unable to fetch manifest");return await i.json()}catch(s){return this.error("Failed to fetch:",s),null}}async fetchReleaseManifest(t){try{let r=t.assets.find(a=>a.name==="manifest.json");if(!r)return this.debug("No manifest found in release assets"),null;this.debug("Fetching manifest from release asset:",r.browser_download_url);let s=await Rt(r.browser_download_url,{headers:{Accept:"application/octet-stream","User-Agent":"Relay-Obsidian-Plugin"}});if(!s.ok)throw new Error(`Failed to fetch manifest asset: ${s.status}`);let n=await s.json();return Ge().enableNetworkLogging&&this.debug("manifest fetched:",n),n}catch(r){return this.error("Failed to fetch manifest for release:",t,r),null}}getNewRelease(){let t=this.releaseChannels.get(this.releaseSettings.get().channel);if(t&&tM(t.tag_name,this.plugin.version))return t}async installUpdate(t){let r=await this.fetchReleaseManifest(t);try{this.debug(`Installing update from v${this.plugin.version} to v${r.version}...`,r),await this.plugin.app.plugins.installPlugin("No-Instructions/Relay",r.version,r),this.notifyListeners(),this.debug("Update complete. Reloading plugin...");let s="system3-relay",n=this.plugin.app.plugins;return await n.disablePlugin(s),await n.enablePlugin(s),!0}catch(s){return this.error("Failed to install update:",s),!1}}applyAutomaticUpdates(){if(this.releaseSettings.get().automaticUpdates){let t=this.getNewRelease();t&&this.installUpdate(t)}}destroy(){this.stop(),this.githubReleases=null,this.releaseChannels=null,super.destroy()}};var l_=require("obsidian");var a_=require("obsidian");function rM(o){Pe(o,"svelte-12doke6",'.modal-content.svelte-12doke6.svelte-12doke6{padding:0;display:flex;flex-direction:column;height:100%}.settings-container.svelte-12doke6.svelte-12doke6{margin:0 1rem;border-bottom:1px solid var(--background-modifier-border);margin-bottom:1rem}.settings-spacer.svelte-12doke6.svelte-12doke6{height:0.5rem}.checkbox-container.svelte-12doke6.svelte-12doke6{cursor:pointer}.loading-text.svelte-12doke6.svelte-12doke6,.no-releases-text.svelte-12doke6.svelte-12doke6{padding:12px;text-align:center;color:var(--text-muted);font-style:italic}.release-tags-container.svelte-12doke6.svelte-12doke6{display:flex;flex-wrap:wrap;column-gap:8px;row-gap:4px;padding:0 1rem 1rem;max-height:160px;overflow-y:auto}.release-tag-item.svelte-12doke6.svelte-12doke6{display:flex;justify-content:center;align-items:center;background-color:var(--background-secondary);border:1px solid var(--background-modifier-border);border-radius:4px;padding:4px 8px;height:24px;cursor:pointer;opacity:0.7;position:relative}.release-tag-item.svelte-12doke6.svelte-12doke6:hover{background-color:var(--background-modifier-hover);opacity:0.9}.release-tag-item[aria-selected="true"].svelte-12doke6.svelte-12doke6{background-color:var(--color-accent);border-color:var(--background-modifier-border);border-bottom-width:2px;opacity:1}.release-tag-item.current-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.development-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.main-branch-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.beta-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.release-tag-item.stable-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.prerelease-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;color:var(--text-on-accent);border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.channel-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.beta-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.stable-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.tag-name.svelte-12doke6.svelte-12doke6{font-weight:bold;font-size:0.8em;display:flex;align-items:center}.manifest-container.svelte-12doke6.svelte-12doke6{flex:1;display:flex;flex-direction:column;border:1px solid var(--background-modifier-border);border-radius:8px;background-color:var(--background-secondary);margin:0 1rem 1rem;overflow:hidden}.manifest-header.svelte-12doke6.svelte-12doke6{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background-color:var(--background-secondary-alt);border-bottom:1px solid var(--background-modifier-border)}.manifest-header.svelte-12doke6 h3.svelte-12doke6{margin:0;font-size:1.1em;color:var(--text-normal);display:flex;align-items:center}.manifest-header-actions.svelte-12doke6.svelte-12doke6{display:flex;align-items:center;gap:10px}.manifest-close-btn.svelte-12doke6.svelte-12doke6{cursor:pointer;font-size:1.2em;background:transparent;border:none;color:var(--text-normal)}.manifest-content.svelte-12doke6.svelte-12doke6{padding:16px;border-top:1px solid var(--background-modifier-border)}.manifest-field.svelte-12doke6.svelte-12doke6{margin-bottom:8px;display:flex;align-items:flex-start}.manifest-label.svelte-12doke6.svelte-12doke6{font-weight:bold;min-width:120px;color:var(--text-normal)}.manifest-value.svelte-12doke6.svelte-12doke6{flex:1}.manifest-version-mismatch.svelte-12doke6.svelte-12doke6{margin-left:10px;color:var(--text-error);font-size:0.85em;display:flex;align-items:center;gap:4px}.manifest-version-mismatch-icon.svelte-12doke6.svelte-12doke6{font-size:1.2em}.release-changelog.svelte-12doke6.svelte-12doke6{padding:16px;overflow:hidden;display:flex;flex-direction:column;height:320px}.release-changelog-content.svelte-12doke6.svelte-12doke6{overflow-x:auto;margin:0;font-size:0.85em;flex:1;overflow-y:auto;line-height:1.4}.currently-installed.svelte-12doke6.svelte-12doke6{color:var(--interactive-accent);font-weight:bold;padding:4px 8px;border-radius:4px}.install-version-btn.svelte-12doke6.svelte-12doke6{font-size:0.9em;padding:4px 12px;cursor:pointer}.manifest-error.svelte-12doke6.svelte-12doke6{padding:16px;text-align:center;background-color:var(--background-modifier-error);border-radius:6px;color:var(--text-on-accent);margin:0 1rem 1rem}.manifest-error-message.svelte-12doke6.svelte-12doke6{margin-bottom:12px}')}function zv(o,e,t){let r=o.slice();return r[71]=e[t],r}function oM(o){let e,t;return e=new It({props:{name:"Automatically install updates",$$slots:{default:[sM]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&128|s[2]&4096&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function sM(o){let e,t,r,s,n,a;return{c(){e=T("div"),t=T("input"),r=U(),s=T("div"),x(t,"type","checkbox"),t.checked=o[7],x(s,"class","checkbox-toggle"),x(e,"class","checkbox-container svelte-12doke6"),x(e,"role","checkbox"),x(e,"aria-checked",o[7]),x(e,"tabindex","0"),Be(e,"is-enabled",o[7])},m(i,l){I(i,e,l),k(e,t),k(e,r),k(e,s),n||(a=[te(e,"click",o[44]),te(e,"keydown",o[45])],n=!0)},p(i,l){l[0]&128&&(t.checked=i[7]),l[0]&128&&x(e,"aria-checked",i[7]),l[0]&128&&Be(e,"is-enabled",i[7])},d(i){i&&C(e),n=!1,Ce(a)}}}function Kv(o){let e,t;return e=new It({props:{name:"Show all releases",$$slots:{default:[nM]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&64|s[2]&4096&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function nM(o){let e,t,r,s,n,a;return{c(){e=T("div"),t=T("input"),r=U(),s=T("div"),x(t,"type","checkbox"),t.checked=o[6],x(s,"class","checkbox-toggle"),x(e,"class","checkbox-container svelte-12doke6"),x(e,"role","checkbox"),x(e,"aria-checked",o[6]),x(e,"tabindex","0"),Be(e,"is-enabled",o[6])},m(i,l){I(i,e,l),k(e,t),k(e,r),k(e,s),n||(a=[te(e,"click",o[46]),te(e,"keydown",o[47])],n=!0)},p(i,l){l[0]&64&&(t.checked=i[6]),l[0]&64&&x(e,"aria-checked",i[6]),l[0]&64&&Be(e,"is-enabled",i[6])},d(i){i&&C(e),n=!1,Ce(a)}}}function aM(o){let e,t,r=(!o[1]||o[7])&&Gv(o);function s(i,l){if(i[12])return uM;if(i[17])return fM}let n=s(o,[-1,-1,-1]),a=n&&n(o);return{c(){r&&r.c(),e=U(),a&&a.c(),t=Ie()},m(i,l){r&&r.m(i,l),I(i,e,l),a&&a.m(i,l),I(i,t,l)},p(i,l){!i[1]||i[7]?r?r.p(i,l):(r=Gv(i),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),n===(n=s(i,l))&&a?a.p(i,l):(a&&a.d(1),a=n&&n(i),a&&(a.c(),a.m(t.parentNode,t)))},d(i){i&&(C(e),C(t)),r&&r.d(i),a&&a.d(i)}}}function iM(o){let e;return{c(){e=T("div"),e.textContent="No matching releases found with the current filter",x(e,"class","no-releases-text svelte-12doke6")},m(t,r){I(t,e,r)},p:X,d(t){t&&C(e)}}}function lM(o){let e;return{c(){e=T("div"),e.textContent="No GitHub releases found",x(e,"class","no-releases-text svelte-12doke6")},m(t,r){I(t,e,r)},p:X,d(t){t&&C(e)}}}function cM(o){let e;return{c(){e=T("div"),e.textContent="Loading GitHub releases...",x(e,"class","loading-text svelte-12doke6")},m(t,r){I(t,e,r)},p:X,d(t){t&&C(e)}}}function Gv(o){let e,t,r,s=!o[7]&&!o[9].some(o[43]),n,a=o[5]&&jv(o),i=o[4]&&Yv(o),l=s&&Jv(o),c=!o[7]&&!o[1]&&Qv(o);return{c(){e=T("div"),a&&a.c(),t=U(),i&&i.c(),r=U(),l&&l.c(),n=U(),c&&c.c(),x(e,"class","release-tags-container svelte-12doke6")},m(u,d){I(u,e,d),a&&a.m(e,null),k(e,t),i&&i.m(e,null),k(e,r),l&&l.m(e,null),k(e,n),c&&c.m(e,null)},p(u,d){u[5]?a?a.p(u,d):(a=jv(u),a.c(),a.m(e,t)):a&&(a.d(1),a=null),u[4]?i?i.p(u,d):(i=Yv(u),i.c(),i.m(e,r)):i&&(i.d(1),i=null),d[0]&640&&(s=!u[7]&&!u[9].some(u[43])),s?l?l.p(u,d):(l=Jv(u),l.c(),l.m(e,n)):l&&(l.d(1),l=null),!u[7]&&!u[1]?c?c.p(u,d):(c=Qv(u),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},d(u){u&&C(e),a&&a.d(),i&&i.d(),l&&l.d(),c&&c.d()}}}function jv(o){let e,t,r,s,n;return{c(){e=T("div"),t=T("div"),t.textContent="Stable",x(t,"class","tag-name svelte-12doke6"),x(e,"class","release-tag-item main-branch-version stable-version svelte-12doke6"),x(e,"role","tab"),x(e,"aria-selected",r=o[10]==="stable"),x(e,"tabindex","0")},m(a,i){I(a,e,i),k(e,t),s||(n=[te(e,"click",o[48]),te(e,"keydown",o[49])],s=!0)},p(a,i){i[0]&1024&&r!==(r=a[10]==="stable")&&x(e,"aria-selected",r)},d(a){a&&C(e),s=!1,Ce(n)}}}function Yv(o){let e,t,r,s,n;return{c(){e=T("div"),t=T("div"),t.textContent="Beta",x(t,"class","tag-name svelte-12doke6"),x(e,"class","release-tag-item main-branch-version beta-version svelte-12doke6"),x(e,"role","tab"),x(e,"aria-selected",r=o[10]==="beta"),x(e,"tabindex","0")},m(a,i){I(a,e,i),k(e,t),s||(n=[te(e,"click",o[50]),te(e,"keydown",o[51])],s=!0)},p(a,i){i[0]&1024&&r!==(r=a[10]==="beta")&&x(e,"aria-selected",r)},d(a){a&&C(e),s=!1,Ce(n)}}}function Jv(o){let e,t,r,s,n;return{c(){e=T("div"),t=T("div"),t.textContent="Dev",x(t,"class","tag-name svelte-12doke6"),x(e,"class","release-tag-item development-version svelte-12doke6"),x(e,"role","tab"),x(e,"aria-selected",r=o[11]===o[0].version),x(e,"tabindex","0")},m(a,i){I(a,e,i),k(e,t),s||(n=[te(e,"click",o[52]),te(e,"keydown",o[53])],s=!0)},p(a,i){i[0]&2049&&r!==(r=a[11]===a[0].version)&&x(e,"aria-selected",r)},d(a){a&&C(e),s=!1,Ce(n)}}}function Qv(o){let e,t=Ae(o[9]),r=[];for(let s=0;s<t.length;s+=1)r[s]=Xv(zv(o,t,s));return{c(){for(let s=0;s<r.length;s+=1)r[s].c();e=Ie()},m(s,n){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(s,n);I(s,e,n)},p(s,n){if(n[0]&536873472|n[1]&130){t=Ae(s[9]);let a;for(a=0;a<t.length;a+=1){let i=zv(s,t,a);r[a]?r[a].p(i,n):(r[a]=Xv(i),r[a].c(),r[a].m(e.parentNode,e))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(s){s&&C(e),st(r,s)}}}function Xv(o){let e,t,r=o[71].tag_name+"",s,n,a,i,l,c;function u(){return o[54](o[71])}function d(...m){return o[55](o[71],...m)}return{c(){e=T("div"),t=T("div"),s=K(r),n=U(),x(t,"class","tag-name svelte-12doke6"),x(e,"class",a="release-tag-item "+(o[29](o[71].tag_name)?"current-version":"")+" "+(n_(o[71])?"pre-release":"")+" svelte-12doke6"),x(e,"role","tab"),x(e,"aria-selected",i=o[11]===o[71].tag_name),x(e,"tabindex","0")},m(m,g){I(m,e,g),k(e,t),k(t,s),k(e,n),l||(c=[te(e,"click",u),te(e,"keydown",d)],l=!0)},p(m,g){o=m,g[0]&512&&r!==(r=o[71].tag_name+"")&&ne(s,r),g[0]&512&&a!==(a="release-tag-item "+(o[29](o[71].tag_name)?"current-version":"")+" "+(n_(o[71])?"pre-release":"")+" svelte-12doke6")&&x(e,"class",a),g[0]&2560&&i!==(i=o[11]===o[71].tag_name)&&x(e,"aria-selected",i)},d(m){m&&C(e),l=!1,Ce(c)}}}function fM(o){let e,t,r,s,n,a,i;return{c(){e=T("div"),t=T("div"),r=K(o[17]),s=U(),n=T("button"),n.textContent="Close",x(t,"class","manifest-error-message svelte-12doke6"),x(n,"class","manifest-close-btn svelte-12doke6"),x(e,"class","manifest-error svelte-12doke6")},m(l,c){I(l,e,c),k(e,t),k(t,r),k(e,s),k(e,n),a||(i=te(n,"click",o[40]),a=!0)},p(l,c){c[0]&131072&&ne(r,l[17])},d(l){l&&C(e),a=!1,i()}}}function uM(o){var z;let e,t,r,s,n,a,i=(z=o[41](o[11]))==null?void 0:z.prerelease,l,c,u,d,m,g,h,_,w,v,A=i&&Zv(o),O=o[13][o[11]]==="beta-alias"&&e_(o),E=o[13][o[11]]==="stable-alias"&&t_(o);function M(Y,pe){if(pe[0]&18432&&(m=null),pe[0]&2048&&(g=null),m==null&&(m=!!((Y[41](Y[11])||Y[14][Y[11]]==="stable-alias"||Y[14][Y[11]]==="beta-alias")&&!Y[29](Y[11]))),m)return pM;if(g==null&&(g=!!Y[29](Y[11])),g)return dM}let R=M(o,[-1,-1,-1]),D=R&&R(o);function F(Y,pe){return Y[14][Y[11]]==="stable-alias"||Y[14][Y[11]]==="beta-alias"||Y[10]==="development"?xM:Y[11]?yM:gM}let V=F(o,[-1,-1,-1]),q=V(o),j=o[16]&&r_(o);return{c(){e=T("div"),t=T("div"),r=T("h3"),s=K("Release Details: "),n=K(o[11]),a=U(),A&&A.c(),l=U(),O&&O.c(),c=U(),E&&E.c(),u=U(),d=T("div"),D&&D.c(),h=U(),_=T("div"),w=T("div"),q.c(),v=U(),j&&j.c(),x(r,"class","svelte-12doke6"),x(d,"class","manifest-header-actions svelte-12doke6"),x(t,"class","manifest-header svelte-12doke6"),x(w,"class","release-changelog-content svelte-12doke6"),x(_,"class","release-changelog svelte-12doke6"),x(e,"class","manifest-container svelte-12doke6")},m(Y,pe){I(Y,e,pe),k(e,t),k(t,r),k(r,s),k(r,n),k(r,a),A&&A.m(r,null),k(r,l),O&&O.m(r,null),k(r,c),E&&E.m(r,null),k(t,u),k(t,d),D&&D.m(d,null),k(e,h),k(e,_),k(_,w),q.m(w,null),k(e,v),j&&j.m(e,null)},p(Y,pe){var De;pe[0]&2048&&ne(n,Y[11]),pe[0]&2048&&(i=(De=Y[41](Y[11]))==null?void 0:De.prerelease),i?A||(A=Zv(Y),A.c(),A.m(r,l)):A&&(A.d(1),A=null),Y[13][Y[11]]==="beta-alias"?O||(O=e_(Y),O.c(),O.m(r,c)):O&&(O.d(1),O=null),Y[13][Y[11]]==="stable-alias"?E||(E=t_(Y),E.c(),E.m(r,null)):E&&(E.d(1),E=null),R===(R=M(Y,pe))&&D?D.p(Y,pe):(D&&D.d(1),D=R&&R(Y),D&&(D.c(),D.m(d,null))),V===(V=F(Y,pe))&&q?q.p(Y,pe):(q.d(1),q=V(Y),q&&(q.c(),q.m(w,null))),Y[16]?j?j.p(Y,pe):(j=r_(Y),j.c(),j.m(e,null)):j&&(j.d(1),j=null)},d(Y){Y&&C(e),A&&A.d(),O&&O.d(),E&&E.d(),D&&D.d(),q.d(),j&&j.d()}}}function Zv(o){let e;return{c(){e=T("span"),e.textContent="Pre-release",x(e,"class","prerelease-badge svelte-12doke6")},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function e_(o){let e;return{c(){e=T("span"),e.textContent="Beta",x(e,"class","channel-badge beta-badge svelte-12doke6")},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function t_(o){let e;return{c(){e=T("span"),e.textContent="Stable",x(e,"class","channel-badge stable-badge svelte-12doke6")},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function dM(o){let e;return{c(){e=T("span"),e.textContent="Installed",x(e,"class","currently-installed svelte-12doke6")},m(t,r){I(t,e,r)},p:X,d(t){t&&C(e)}}}function pM(o){let e,t,r,s;function n(l,c){return l[15]===l[11]?hM:mM}let a=n(o,[-1,-1,-1]),i=a(o);return{c(){e=T("button"),i.c(),x(e,"class","install-version-btn mod-cta svelte-12doke6"),e.disabled=t=o[15]===o[11]||o[2]},m(l,c){I(l,e,c),i.m(e,null),r||(s=te(e,"click",o[56]),r=!0)},p(l,c){a!==(a=n(l,c))&&(i.d(1),i=a(l),i&&(i.c(),i.m(e,null))),c[0]&34820&&t!==(t=l[15]===l[11]||l[2])&&(e.disabled=t)},d(l){l&&C(e),i.d(),r=!1,s()}}}function mM(o){let e;return{c(){e=K("Install")},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function hM(o){let e;return{c(){e=K("Installing...")},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function gM(o){let e;return{c(){e=K('"No changelog available"')},m(t,r){I(t,e,r)},p:X,d(t){t&&C(e)}}}function yM(o){var s;let e,t,r={ctx:o,current:null,token:null,hasCatch:!1,pending:vM,then:wM,catch:bM,value:70};return ca(t=o[37](((s=o[41](o[11]))==null?void 0:s.body)||"No changelog available"),r),{c(){e=Ie(),r.block.c()},m(n,a){I(n,e,a),r.block.m(n,r.anchor=a),r.mount=()=>e.parentNode,r.anchor=e},p(n,a){var i;o=n,r.ctx=o,a[0]&2048&&t!==(t=o[37](((i=o[41](o[11]))==null?void 0:i.body)||"No changelog available"))&&ca(t,r)||ec(r,o,a)},d(n){n&&C(e),r.block.d(n),r.token=null,r=null}}}function xM(o){let e;function t(n,a){if(n[14][n[11]]==="stable-alias")return kM;if(n[14][n[11]]==="beta-alias")return SM;if(n[11]===n[0].version)return _M}let r=t(o,[-1,-1,-1]),s=r&&r(o);return{c(){s&&s.c(),e=Ie()},m(n,a){s&&s.m(n,a),I(n,e,a)},p(n,a){r!==(r=t(n,a))&&(s&&s.d(1),s=r&&r(n),s&&(s.c(),s.m(e.parentNode,e)))},d(n){n&&C(e),s&&s.d(n)}}}function bM(o){return{c:X,m:X,p:X,d:X}}function wM(o){let e,t=o[70]+"",r;return{c(){e=new na(!1),r=Ie(),e.a=r},m(s,n){e.m(t,s,n),I(s,r,n)},p(s,n){n[0]&2048&&t!==(t=s[70]+"")&&e.p(t)},d(s){s&&(C(r),e.d())}}}function vM(o){let e;return{c(){e=K('"loading..."')},m(t,r){I(t,e,r)},p:X,d(t){t&&C(e)}}}function _M(o){let e;return{c(){e=T("p"),e.textContent="Current development version"},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function SM(o){let e;return{c(){e=T("p"),e.textContent="Current beta release from main branch manifest-beta.json"},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function kM(o){let e;return{c(){e=T("p"),e.textContent="Current stable release from main branch manifest.json"},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function r_(o){let e,t,r,s,n,a=o[12].version+"",i,l,c=o[11]!==o[12].version&&!o[11].startsWith("v"+o[12].version),u,d,m,g,h,_=o[12].name+"",w,v,A,O,E,M,R=o[12].author+"",D,F,V,q,j,z,Y=o[12].description+"",pe,De,G,se,ke,Qe,Re=o[12].isDesktopOnly?"Yes":"No",ce,le,W,Fe,Ye,vt,mt=o[12].minAppVersion+"",_t,ct=c&&o_(o);return{c(){e=T("div"),t=T("div"),r=T("span"),r.textContent="Version:",s=U(),n=T("span"),i=K(a),l=U(),ct&&ct.c(),u=U(),d=T("div"),m=T("span"),m.textContent="Name:",g=U(),h=T("span"),w=K(_),v=U(),A=T("div"),O=T("span"),O.textContent="Author:",E=U(),M=T("span"),D=K(R),F=U(),V=T("div"),q=T("span"),q.textContent="Description:",j=U(),z=T("span"),pe=K(Y),De=U(),G=T("div"),se=T("span"),se.textContent="isDesktopOnly:",ke=U(),Qe=T("span"),ce=K(Re),le=U(),W=T("div"),Fe=T("span"),Fe.textContent="minAppVersion:",Ye=U(),vt=T("span"),_t=K(mt),x(r,"class","manifest-label svelte-12doke6"),x(n,"class","manifest-value svelte-12doke6"),x(t,"class","manifest-field svelte-12doke6"),x(m,"class","manifest-label svelte-12doke6"),x(h,"class","manifest-value svelte-12doke6"),x(d,"class","manifest-field svelte-12doke6"),x(O,"class","manifest-label svelte-12doke6"),x(M,"class","manifest-value svelte-12doke6"),x(A,"class","manifest-field svelte-12doke6"),x(q,"class","manifest-label svelte-12doke6"),x(z,"class","manifest-value svelte-12doke6"),x(V,"class","manifest-field svelte-12doke6"),x(se,"class","manifest-label svelte-12doke6"),x(Qe,"class","manifest-value svelte-12doke6"),x(G,"class","manifest-field svelte-12doke6"),x(Fe,"class","manifest-label svelte-12doke6"),x(vt,"class","manifest-value svelte-12doke6"),x(W,"class","manifest-field svelte-12doke6"),x(e,"class","manifest-content svelte-12doke6")},m(yt,Qt){I(yt,e,Qt),k(e,t),k(t,r),k(t,s),k(t,n),k(n,i),k(t,l),ct&&ct.m(t,null),k(e,u),k(e,d),k(d,m),k(d,g),k(d,h),k(h,w),k(e,v),k(e,A),k(A,O),k(A,E),k(A,M),k(M,D),k(e,F),k(e,V),k(V,q),k(V,j),k(V,z),k(z,pe),k(e,De),k(e,G),k(G,se),k(G,ke),k(G,Qe),k(Qe,ce),k(e,le),k(e,W),k(W,Fe),k(W,Ye),k(W,vt),k(vt,_t)},p(yt,Qt){Qt[0]&4096&&a!==(a=yt[12].version+"")&&ne(i,a),Qt[0]&6144&&(c=yt[11]!==yt[12].version&&!yt[11].startsWith("v"+yt[12].version)),c?ct||(ct=o_(yt),ct.c(),ct.m(t,null)):ct&&(ct.d(1),ct=null),Qt[0]&4096&&_!==(_=yt[12].name+"")&&ne(w,_),Qt[0]&4096&&R!==(R=yt[12].author+"")&&ne(D,R),Qt[0]&4096&&Y!==(Y=yt[12].description+"")&&ne(pe,Y),Qt[0]&4096&&Re!==(Re=yt[12].isDesktopOnly?"Yes":"No")&&ne(ce,Re),Qt[0]&4096&&mt!==(mt=yt[12].minAppVersion+"")&&ne(_t,mt)},d(yt){yt&&C(e),ct&&ct.d()}}}function o_(o){let e;return{c(){e=T("span"),e.innerHTML=`<span class="manifest-version-mismatch-icon svelte-12doke6">\u26A0\uFE0F</span>
									Version mismatch`,x(e,"class","manifest-version-mismatch svelte-12doke6")},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function CM(o){let e,t=o[1]?"Relay installer":"Relay releases",r,s,n,a,i,l,c=Ge().enableAutomaticUpdatesOption,u,d,m,g=c&&oM(o),h=!o[7]&&!o[1]&&Kv(o);function _(A,O){return A[8]?cM:A[3].length===0?lM:A[9].length===0?iM:aM}let w=_(o,[-1,-1,-1]),v=w(o);return{c(){e=T("div"),r=K(t),s=U(),n=T("div"),a=T("div"),i=U(),l=T("div"),g&&g.c(),u=U(),h&&h.c(),d=U(),v.c(),x(e,"class","modal-title"),x(a,"class","settings-spacer svelte-12doke6"),x(l,"class","settings-container svelte-12doke6"),x(n,"class","modal-content svelte-12doke6")},m(A,O){I(A,e,O),k(e,r),I(A,s,O),I(A,n,O),k(n,a),k(n,i),k(n,l),g&&g.m(l,null),k(l,u),h&&h.m(l,null),k(n,d),v.m(n,null),m=!0},p(A,O){(!m||O[0]&2)&&t!==(t=A[1]?"Relay installer":"Relay releases")&&ne(r,t),c&&g.p(A,O),!A[7]&&!A[1]?h?(h.p(A,O),O[0]&130&&S(h,1)):(h=Kv(A),h.c(),S(h,1),h.m(l,null)):h&&(he(),P(h,1,1,()=>{h=null}),ge()),w===(w=_(A,O))&&v?v.p(A,O):(v.d(1),v=w(A),v&&(v.c(),v.m(n,null)))},i(A){m||(S(g),S(h),m=!0)},o(A){P(g),P(h),m=!1},d(A){A&&(C(e),C(s),C(n)),g&&g.d(),h&&h.d(),v.d()}}}var s_="system3-relay";function un(o){return o.startsWith("v")?o.substring(1):o}function n_(o){return(o==null?void 0:o.prerelease)===!0}function IM(o,e,t){let r,s,n,a,i,l,c,u,d,m,g,h,_,w,v,A,O,{plugin:E}=e,{version:M}=e,R=_e(E.manifest.version),D=_e(!1),F=_e(""),V=_e(""),q=_e(!1);me(o,q,Q=>t(8,u=Q));let j=_e(!1);me(o,j,Q=>t(6,l=Q));let z=_e(null);me(o,z,Q=>t(12,h=Q));let Y=_e("");me(o,Y,Q=>t(11,g=Q));let pe=_e(null),De=_e(null);me(o,De,Q=>t(17,O=Q));let G=_e(!1);me(o,G,Q=>t(16,A=Q));let se=_e(null);me(o,se,Q=>t(5,n=Q));let ke=_e(null);me(o,ke,Q=>t(4,s=Q));let Qe=_e(null);me(o,Qe,Q=>t(58,i=Q));let Re=_e(null);me(o,Re,Q=>t(57,a=Q));let ce=_e(!1),le=!1,W=_e(null);me(o,W,Q=>t(15,v=Q));let Fe=E.app;function Ye(Q){let ue=un(Q),ot=un(E.version);return ue===ot}let vt=_e({});me(o,vt,Q=>t(14,w=Q));let mt=_e({});me(o,mt,Q=>t(13,_=Q));let _t=_e(E.releaseSettings.get().channel);me(o,_t,Q=>t(10,m=Q));let ct=_e(!1);me(o,ct,Q=>t(7,c=Q));function yt(Q){return Ke(this,void 0,void 0,function*(){ct.set(Q);let ue=E.releaseSettings.get().channel;_t.set(ue),E.releaseSettings.update(ot=>Object.assign(Object.assign({},ot),{automaticUpdates:Q})),at(ue)})}lr(()=>{va(),Qt(),!M&&!r.some(Q=>{Q.tag_name,E.version})?(E.releaseSettings.update(Q=>Object.assign(Object.assign({},Q),{automaticUpdates:!1})),_t.set(null)):_t.set(E.releaseSettings.get().channel),z.set({version:M||E.version,name:E.manifest.name,author:E.manifest.author,description:E.manifest.description,isDesktopOnly:E.manifest.isDesktopOnly,minAppVersion:E.manifest.minAppVersion}),Y.set(M||E.version)});function Qt(){return Ke(this,void 0,void 0,function*(){ce.set(!0);try{let Q=yield E.updateManager.fetchRepoManifest("manifest.json");Q&&(se.set(Q),Qe.set(Q.version));let ue=yield E.updateManager.fetchRepoManifest("manifest-beta.json");ue&&(ke.set(ue),Re.set(ue.version))}catch(Q){E.error("Error fetching main branch manifests:",Q)}finally{ce.set(!1)}})}let Ms=ro(E.updateManager,()=>E.updateManager.releases);me(o,Ms,Q=>t(3,r=Q));let Io=ro([Ms,j],()=>r&&r.length>0?pn(l).sort():[]);me(o,Io,Q=>t(9,d=Q)),r.forEach(Q=>Ke(void 0,void 0,void 0,function*(){try{let ue=yield E.updateManager.fetchReleaseManifest(Q);ue&&vt.update(ot=>Object.assign(Object.assign({},ot),{[Q.tag_name]:ue.version}))}catch(ue){}}));function va(){return Ke(this,void 0,void 0,function*(){q.set(!0);try{yield E.updateManager.getReleases(),pn(l)}catch(Q){E.error("Error refreshing GitHub releases:",Q)}finally{q.set(!1)}})}function dn(Q){return Ke(this,void 0,void 0,function*(){let ue=document.createElement("div");return yield a_.MarkdownRenderer.render(E.app,Q,ue,"",E),ue.innerHTML})}function pn(Q){return Q?r:M?r.filter(ue=>M===un(ue.tag_name)):r.filter(ue=>{let ot=ue.tag_name;return _a(ue)})}function _a(Q){if(Q.prerelease||Q.draft)return!1;if(Q.latest||un(Q.tag_name)===i||un(Q.tag_name)===a)return!0;let ue=new Date(Q.created_at),ot=new Date;return ot.setMonth(ot.getMonth()-3),ue>ot}function xr(Q){return Ke(this,void 0,void 0,function*(){De.set(null),pe.set(Q);try{let ue=Lo(Q);if(!ue){De.set(`Could not find release for ${Q}`);return}let ot=yield E.updateManager.fetchReleaseManifest(ue);ot?(z.set(ot),Y.set(Q),G.set(!1),vt.update(Hr=>Object.assign(Object.assign({},Hr),{[Q]:ot.version}))):De.set(`Could not find manifest for ${Q}`)}catch(ue){E.error("Error fetching manifest:",ue),De.set(`Error fetching manifest: ${ue.message||"Unknown error"}`)}finally{pe.set(null)}})}function at(Q){let ue=Q==="stable"?n:s;if(ue){let ot=ue.version;_t.set(Q);let Hr=[...r.values()].find(re=>un(re.tag_name)===un(ot));Hr?(Q==="stable"?mt.update(re=>Object.assign(Object.assign({},re),{[Hr.tag_name]:"stable-alias"})):mt.update(re=>Object.assign(Object.assign({},re),{[Hr.tag_name]:"beta-alias"})),xr(Hr.tag_name)):(z.set(ue),Y.set(ot),Q==="stable"?mt.update(re=>Object.assign(Object.assign({},re),{[ot]:"stable-alias"})):mt.update(re=>Object.assign(Object.assign({},re),{[ot]:"beta-alias"})),G.set(!1))}else De.set(`Could not find ${Q} manifest`)}function Xt(){z.set(null),Y.set(""),De.set(null)}function Lo(Q){return[...r.values()].find(ue=>ue.tag_name===Q)}function ns(Q){return Ke(this,void 0,void 0,function*(){try{W.set(Q);let ue=Lo(Q);if(!ue)throw new Error(`Could not find release for ${Q}`);let ot=yield E.updateManager.fetchReleaseManifest(ue);if(!ot)throw new Error(`Could not find manifest for ${Q}`);t(2,le=!0),yield Fe.plugins.installPlugin(E.repo,Q,ot),yield Fe.plugins.disablePlugin(s_),yield Fe.plugins.enablePlugin(s_)}catch(ue){console.error(`Error installing version ${Q}:`,ue),E&&E.error(`Error installing version ${Q}:`,ue)}finally{E&&(t(2,le=!1),W.set(null))}})}let Tt=Q=>Ye(Q.tag_name),Sa=()=>{yt(!c)},as=Q=>{(Q.key==="Enter"||Q.key===" ")&&yt(!c)},Yt=()=>{j.update(Q=>!Q)},$e=Q=>{(Q.key==="Enter"||Q.key===" ")&&j.update(ue=>!ue)},so=()=>{E.releaseSettings.update(Q=>({...Q,channel:"stable"})),_t.set("stable"),at("stable")},is=Q=>{(Q.key==="Enter"||Q.key===" ")&&(E.releaseSettings.update(ue=>({...ue,channel:"stable"})),_t.set("stable"),at("stable"))},mn=()=>{E.releaseSettings.update(Q=>({...Q,channel:"beta"})),_t.set("beta"),at("beta")},ka=Q=>{(Q.key==="Enter"||Q.key===" ")&&(E.releaseSettings.update(ue=>({...ue,channel:"beta"})),_t.set("beta"),at("beta"))},Ca=()=>{_t.set(null),z.set({version:E.manifest.version,name:E.manifest.name,author:E.manifest.author,description:E.manifest.description,isDesktopOnly:E.manifest.isDesktopOnly,minAppVersion:E.manifest.minAppVersion}),Y.set(E.version),G.set(!1)},hn=Q=>{(Q.key==="Enter"||Q.key===" ")&&(_t.set(null),z.set({version:E.manifest.version,name:E.manifest.name,author:E.manifest.author,description:E.manifest.description,isDesktopOnly:E.manifest.isDesktopOnly,minAppVersion:E.manifest.minAppVersion}),Y.set(E.version),G.set(!1))},Vt=Q=>{_t.set(null),xr(Q.tag_name)},gn=(Q,ue)=>{(ue.key==="Enter"||ue.key===" ")&&(_t.set(null),xr(Q.tag_name))},Rs=async()=>{ns(g)};return o.$$set=Q=>{"plugin"in Q&&t(0,E=Q.plugin),"version"in Q&&t(1,M=Q.version)},[E,M,le,r,s,n,l,c,u,d,m,g,h,_,w,v,A,O,q,j,z,Y,De,G,se,ke,Qe,Re,W,Ye,vt,mt,_t,ct,yt,Ms,Io,dn,xr,at,Xt,Lo,ns,Tt,Sa,as,Yt,$e,so,is,mn,ka,Ca,hn,Vt,gn,Rs]}var Wm=class extends ee{constructor(e){super(),oe(this,e,IM,CM,Z,{plugin:0,version:1},rM,[-1,-1,-1])}},i_=Wm;var Ei=class extends l_.Modal{constructor(t,r,s){super(t);this.plugin=r;this.version=s}onOpen(){let{contentEl:t}=this;this.component=new i_({target:t,props:{plugin:this.plugin,version:this.version}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var LM={debugging:!1},TM={release:{channel:"stable",automaticUpdates:!1},sharedFolders:[],...Rl,...LM},tf=class extends u_.Plugin{constructor(){super(...arguments);this.webviewerPatched=!1;this.openModals=[];this.interceptedUrls=[];this.fileDiffMergeWarningKey="file-diff-merge-warning";this.version="0.5.4";this.repo="No-Instructions/Relay"}enableDebugging(t){El(!0),console.warn("RelayInstances",Bt),t&&this.debugSettings.update(r=>({...r,debugging:!0}))}disableDebugging(t){El(!1),t&&this.debugSettings.update(r=>({...r,debugging:!1}))}toggleDebugging(t){let r=!this.debugSettings.get().debugging;return El(r),t&&this.debugSettings.update(s=>({...s,debugging:r})),r}buildApiUrl(t){return"https://api.system3.md"+t}async onload(){this.appId=this.app.appId;let t=jt.moment.now();Bt.set(this,"plugin"),this.timeProvider=new ea,this.register(()=>{this.timeProvider.destroy()}),zy(new Qc(this.app.vault),this.timeProvider,".obsidian/plugins/system3-relay/relay.log",{maxFileSize:5*1024*1024,maxBackups:3,disableConsole:!1}),this.notifier=new Jc,this.toast=jy(this.notifier),this.debug=Te("[System 3][Relay]","debug"),this.log=Te("[System 3][Relay]","log"),this.warn=Te("[System 3][Relay]","warn"),this.error=Te("[System 3][Relay]","error"),this.settings=new zl(this,TM),await this.settings.load(),this.featureSettings=new kr(this.settings,"(enable*)"),this.debugSettings=new kr(this.settings,"(debugging)"),this.folderSettings=new kr(this.settings,"sharedFolders"),this.releaseSettings=new kr(this.settings,"release"),Nt.getInstance().setSettings(this.featureSettings),this.settingsTab=new Dc(this.app,this),this.addRibbonIcon("satellite","Relay",()=>{this.openSettings()}),this.updateManager=new ef(this,this.timeProvider,this.releaseSettings),Ge().enableAutomaticUpdatesOption&&this.updateManager.applyAutomaticUpdates(),this.debugSettings.subscribe(n=>{n.debugging?(this.enableDebugging(),this.removeCommand("enable-debugging"),this.addCommand({id:"toggle-feature-flags",name:"Show feature flags",callback:()=>{let a=new jc(this.app,()=>{this.reload()});this.openModals.push(a),a.open()}}),this.addCommand({id:"send-bug-report",name:"Send bug report",callback:()=>{let a=new Xc(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"show-debug-info",name:"Show debug info",callback:()=>{let a=new Yc(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"show-release-manager",name:"Show releases",callback:()=>{let a=new Ei(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"analyze-indexeddb",name:"Analyze database",callback:()=>{let a=new Zc(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"disable-debugging",name:"Disable debugging",callback:()=>{this.disableDebugging(!0)}}),this.addCommand({id:"show-sync-status",name:"Sync status",callback:()=>{let a=new Ai(this.app,this.backgroundSync,this.sharedFolders);this.openModals.push(a),a.open()}})):(this.removeCommand("toggle-feature-flags"),this.removeCommand("send-bug-report"),this.removeCommand("show-debug-info"),this.removeCommand("show-sync-status"),this.removeCommand("show-release-manager"),this.removeCommand("disable-debugging"),this.addCommand({id:"enable-debugging",name:"Enable debugging",callback:()=>{this.enableDebugging(!0)}}))}),this.addCommand({id:"reload",name:"Reload Relay",callback:()=>{this.reload()}}),this.updateManager.subscribe(()=>{let n=this.updateManager.getNewRelease();n?(this.removeCommand("update-plugin"),this.addCommand({id:"update-plugin",name:`Update Plugin (${this.version} \u2192 ${n.tag_name})`,callback:async()=>{await this.updateManager.installUpdate(n)}}),this.log(`Update available: v${this.version} \u2192 ${n.tag_name}`)):this.removeCommand("update-plugin")}),this.vault=this.app.vault;let s=this.vault.getName();this.fileManager=this.app.fileManager,this.hashStore=new Kl(this.appId),this.loginManager=new Ac(this.vault.getName(),this.openSettings.bind(this),this.timeProvider,this.patchWebviewer.bind(this)),this.relayManager=new Gc(this.loginManager),this.sharedFolders=new jl(this.relayManager,this.vault,this._createSharedFolder.bind(this),this.folderSettings),this.tokenStore=new Wc(this.loginManager,this.timeProvider,s,3),this.networkStatus=new Mw(this.timeProvider,"https://api.system3.md/health?version=0.5.4"),this.backgroundSync=new ic(this.loginManager,this.timeProvider,this.sharedFolders),this.loginManager.setup()||new jt.Notice("Please sign in to use relay"),this.app.workspace.onLayoutReady(()=>{this.sharedFolders.load(),this._liveViews=new mc(this.app,this.sharedFolders,this.loginManager,this.networkStatus),this.registerEditorExtension(this._liveViews.extensions),this.register(this.loginManager.on(()=>{this.loginManager.loggedIn?this._onLogin():this._onLogout()})),this.tokenStore.start(),c_.Platform.isIosApp||(this.networkStatus.addEventListener("offline",()=>{this.tokenStore.stop(),this.sharedFolders.forEach(n=>n.disconnect()),this._liveViews.goOffline()}),this.networkStatus.addEventListener("online",()=>{this.tokenStore.start(),this.relayManager.subscribe(),this.relayManager.update(),this._liveViews.goOnline()}),this.networkStatus.start()),this.registerView(pa,n=>new cc(n)),this.registerEvent(this.app.workspace.on("file-menu",(n,a)=>{if(a instanceof jt.TFolder){let i=this.sharedFolders.find(l=>l.path===a.path);if(!i)return;i.relayId&&n.addItem(l=>{l.setTitle(i.connected?"Disconnect":"Connect").setIcon("satellite").onClick(()=>{i.connected?(i.shouldConnect=!1,i.disconnect()):(i.shouldConnect=!0,i.connect()),this._liveViews.refresh("folder connection toggle")})}),n.addItem(l=>{l.setTitle("Folder settings").setIcon("gear").onClick(()=>{this.openSettings(`/shared-folders?id=${i.guid}&relay=${i.relayId}`)})}),i.relayId&&Ge().enableSyncModal&&n.addItem(l=>{l.setTitle("Sync Status").setIcon("list-checks").onClick(()=>{let c=new Ai(this.app,this.backgroundSync,this.sharedFolders,i.guid);this.openModals.push(c),c.open()})}),Ge().enableSyncMenu&&i.relayId&&i.connected&&n.addItem(l=>{l.setTitle("Sync").setIcon("folder-sync").onClick(()=>{i.netSync()})})}})),this.setup(),this._liveViews.refresh("init"),this.loadTime=jt.moment.now()-t})}async reload(){let t=this.manifest.id,r=this.app.plugins;await r.disablePlugin(t),await r.enablePlugin(t)}_createSharedFolder(t,r,s,n){let a=new kr(this.settings,`sharedFolders/[guid=${r}]`),i={guid:r,path:t};return s&&(i.relay=s),a.update(c=>({...c,path:t,guid:r,...s?{relay:s}:{},sync:c.sync?c.sync:Is.defaultFlags}),!0),new Gl(this.appId,r,t,this.loginManager,this.vault,this.fileManager,this.tokenStore,this.relayManager,this.app.metadataCache,this.hashStore,this.backgroundSync,a,s,n)}_onLogout(){var t,r;(t=this.tokenStore)==null||t.clear(),(r=this.relayManager)==null||r.logout(),this._liveViews.refresh("logout")}_onLogin(){var t;this.sharedFolders.load(),(t=this.relayManager)==null||t.login(),this._liveViews.refresh("login")}async openSettings(t="/"){let r=this.app.setting;await r.open(),await r.openTabById("system3-relay"),this.settingsTab.navigateTo(t)}patchWebviewer(){var r,s,n;let t=this;try{if(this.webviewerPatched)return;let a=(s=(r=this.app.internalPlugins)==null?void 0:r.plugins)==null?void 0:s.webviewer;if(!((n=a==null?void 0:a.instance)!=null&&n.options)||!a.enabled){this.warn("Webviewer plugin not found or not initialized");return}let i=a.instance.options,l=Object.getOwnPropertyDescriptor(i,"openExternalURLs");if(!l){this.warn("Could not find openExternalURLs property");return}Object.defineProperty(i,"openExternalURLs",{get(){var m;let d=window.event;if((d==null?void 0:d.type)==="open-url"&&((m=d==null?void 0:d.detail)!=null&&m.url)){let g=d.detail.url;for(let h of t.interceptedUrls)if(typeof h=="string"&&g.startsWith(h)||h instanceof RegExp&&h.test(g))return t.log("Intercepted webviewer, opening in default browser",d.detail.url),!1}return l.value},set(d){l.value=d},configurable:!0}),this.register(()=>{Object.defineProperty(i,"openExternalURLs",l)});let c=this.loginManager.webviewIntercept();this.debug("Intercepting Webviewer for URL pattern",c.source),this.interceptedUrls.push(c);let u=new RegExp("https://api.system3.md".replace("/","\\/")+".*");this.debug("Intercepting Webviewer for URL pattern",u.source),this.interceptedUrls.push(u),this.webviewerPatched=!0,this.debug("patched webviewer options")}catch(a){this.error("Failed to patch webviewer:",a)}}setup(){this.folderNavDecorations=new yc(this.vault,this.app.workspace,this.sharedFolders,this.backgroundSync),this.folderNavDecorations.refresh(),this.addSettingTab(this.settingsTab);let t=Te("[Live][Workspace]","log");this.registerEvent(this.app.workspace.on("file-open",c=>{t("file-open"),i._liveViews.refresh("file-open")})),this.registerEvent(this.app.workspace.on("layout-change",()=>{t("layout-change"),this._liveViews.refresh("layout-change")}));let r=Te("[System 3][Relay][Vault]","log"),s=c=>{let u=c.error;u&&u instanceof fn&&this.toast(u)};window.addEventListener("error",s,!0),this.register(()=>window.removeEventListener("error",s,!0));let n=c=>{c.reason instanceof fn&&this.toast(c.reason)},a=c=>n(c);window.addEventListener("unhandledrejection",a,!0),this.register(()=>window.removeEventListener("unhandledrejection",a,!0)),this.registerEvent(this.app.vault.on("create",c=>{let u=this.sharedFolders.lookup(c.path);if(u){let d=u.getVirtualPath(c.path);u.placeHold([c]).length>0?u.uploadFile(d):u.whenReady().then(g=>{g.getFile(d)})}})),this.registerEvent(this.app.vault.on("delete",c=>{if(c instanceof jt.TFolder){let d=this.sharedFolders.find(m=>m.path===c.path);if(d){this.sharedFolders.delete(d);return}}let u=this.sharedFolders.lookup(c.path);u&&(r("Delete",c.path),u.whenReady().then(d=>{d.proxy.deleteFile(c.path)}))})),this.registerEvent(this.app.vault.on("rename",(c,u)=>{if(c instanceof jt.TFolder){let h=this.sharedFolders.find(_=>_.path==u);if(h){h.move(c.path),this.sharedFolders.update();return}}let d=this.sharedFolders.lookup(u),m=this.sharedFolders.lookup(c.path),g=d||m;d&&m?(r("Rename",c.path,u),d.renameFile(c,u),m.renameFile(c,u),this._liveViews.refresh("rename"),this.folderNavDecorations.quickRefresh()):g&&(r("Rename",c,u),g.renameFile(c,u),this._liveViews.refresh("rename"),this.folderNavDecorations.refresh())})),this.registerEvent(this.app.vault.on("modify",c=>{let u=this.sharedFolders.lookup(c.path);if(u){r("Modify",c.path),Ge().enableDesyncPill&&this.folderNavDecorations.quickRefresh();let d=u.proxy.getFile(c.path);d&&Qo(d)&&d.sync(),this.app.metadataCache.trigger("resolve",d)}}));let i=this,l=an(jt.MarkdownView.prototype,{onUnloadFile(c){return function(u){return i._liveViews.wipe(),c.call(this,u)}}});this.register(l),this.patchWebviewer(),Go(yo.enableNewLinkFormat,()=>{let c=an(jt.MetadataCache.prototype,{fileToLinktext(u){return function(d,m,g){if(i.sharedFolders.lookup(d.path)){g===void 0&&(g=!0);let _=d.extension==="md"&&g?d.basename:d.name,w=(0,jt.normalizePath)(d.name),v=i.app.metadataCache.uniqueFileLookup.get(w.toLowerCase());if(v&&v.length===1&&v[0]===d)return _;{let A=d.extension==="md"&&g?d.path.slice(0,d.path.length-3):d.path,O=(0,f_.relative)(m,A);return O==="../"+_?"./"+_:O}}return u.call(this,d,m,g)}}});this.register(c)}),this.registerObsidianProtocolHandler("relay/settings/relays",async c=>{let u=c,d=new URLSearchParams({...u}).toString(),m=`/${u.action.split("/").slice(-1)}?${d}`;this.openSettings(m)}),this.registerObsidianProtocolHandler("relay/settings/shared-folders",async c=>{let u=c,d=new URLSearchParams({...u}).toString(),m=`/${u.action.split("/").slice(-1)}?${d}`;this.openSettings(m)}),this.registerObsidianProtocolHandler("relay/upgrade",async c=>{var m;let d=(m=c.version)==null?void 0:m.trim();this.installVersion(d)}),this.backgroundSync.start(),this.updateManager.start()}installVersion(t){let r=new Ei(this.app,this,t);this.openModals.push(r),r.open()}removeCommand(t){if((0,jt.requireApiVersion)("1.7.2"))super.removeCommand(t);else{let r=this.app,s=r.commands,n=`system3-relay:${t}`;(s.commands.hasOwnProperty(n)||r.hotkeyManager.removeDefaultHotkeys(n))&&(delete s.commands[n],delete s.editorCommands[n])}}onunload(){var t,r,s,n,a,i,l,c,u,d,m,g,h,_;(t=this.timeProvider)==null||t.destroy(),(r=this.folderNavDecorations)==null||r.destroy(),this.app.workspace.detachLeavesOfType(pa),this.updateManager&&(this.updateManager.destroy(),this.updateManager=null),(s=this._liveViews)==null||s.destroy(),this._liveViews=null,(n=this.relayManager)==null||n.destroy(),this.relayManager=null,(a=this.tokenStore)==null||a.stop(),(i=this.tokenStore)==null||i.clearState(),(l=this.tokenStore)==null||l.destroy(),this.tokenStore=null,(c=this.networkStatus)==null||c.stop(),(u=this.networkStatus)==null||u.destroy(),this.networkStatus=null,this.openModals.forEach(w=>{w.close()}),this.openModals.length=0,(d=this.sharedFolders)==null||d.destroy(),this.sharedFolders=null,(m=this.settingsTab)==null||m.destroy(),this.settingsTab=null,(g=this.loginManager)==null||g.destroy(),this.loginManager=null,(h=this.backgroundSync)==null||h.destroy(),this.backgroundSync=null,this.hashStore.destroy(),this.hashStore=null,(_=this.app)==null||_.workspace.updateOptions(),this.app=null,this.fileManager=null,this.manifest=null,this.vault=null,this.debugSettings.destroy(),this.debugSettings=null,this.folderSettings.destroy(),this.folderSettings=null,this.featureSettings.destroy(),this.featureSettings=null,this.releaseSettings.destroy(),this.releaseSettings=null,this.interceptedUrls.length=0,Nt.destroy(),Br.destroy(),this.notifier=null,this.toast=null,Jy(),Ru()}async loadSettings(){this.settings.load()}async saveSettings(){await this.settings.save()}};
/*! Bundled license information:

moment/moment.js:
  (*! moment.js *)
  (*! version : 2.29.4 *)
  (*! authors : Tim Wood, Iskren Chernev, Moment.js contributors *)
  (*! license : MIT *)
  (*! momentjs.com *)

lucide-svelte/dist/defaultAttributes.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-right-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-up-down.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-right.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-check-big.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-help.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/clock.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/download.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/folder.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/info.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/layers.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/lock.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/message-square-heart.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/pause.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/play.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/refresh-cw.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/satellite.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/settings.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/triangle-alert.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/upload.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/index.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/aliases.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)
*/

/* nosourcemap */